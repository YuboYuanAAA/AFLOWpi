<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>retr &mdash; AFLOWpi  documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="AFLOWpi  documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          AFLOWpi</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../plot.html">plot module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep.html">prep module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pseudo.html">pseudo module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retr.html">retr module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../run.html">run module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scfuj.html">scfuj module</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Source code for retr</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">AFLOWpi.run</span>
<span class="kn">import</span> <span class="nn">AFLOWpi.prep</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">logging</span> 
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">AFLOWpi.retr</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">sys</span> 
<span class="kn">import</span> <span class="nn">AFLOWpi.qe</span>
<span class="kn">import</span> <span class="nn">decimal</span>

<span class="c1">##############################################################################################################################</span>
<span class="c1">##############################################################################################################################</span>
<span class="c1">## auto k point</span>
<span class="c1">##############################################################################################################################</span>
<span class="c1">##############################################################################################################################</span>
<span class="k">def</span> <span class="nf">__find_numkpoints</span><span class="p">(</span><span class="n">outputFile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;TAGGED FOR REMOVAL&gt;</span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">kpointNumRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;\s*number\sof\sk\spoints\s*=\s*(\d*).*\n&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">kpointNumRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">__get_pool_num</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets number of pools requested for this particular execution for engine.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">           None</span>

<span class="sd">    Returns:</span>
<span class="sd">          npool (int): number of pools requested for this particular execution for engine</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">hard_limit</span><span class="o">=</span><span class="mi">4</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outputFile</span><span class="p">:</span>
            <span class="n">outputFileString</span><span class="o">=</span><span class="n">outputFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">n_reduced_k</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__find_numkpoints</span><span class="p">(</span><span class="n">outputFileString</span><span class="p">)</span>
        <span class="n">execPrefix</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__ConfigSectionMap</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">,</span><span class="s1">&#39;execprefix&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_reduced_k</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">num_mpi_procs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;np\s*(\d*)&#39;</span><span class="p">,</span><span class="n">execPrefix</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">npool</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_reduced_k</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">num_mpi_procs</span><span class="o">%</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">hard_limit</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">npool</span><span class="o">=</span><span class="n">i</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">npool</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>




<div class="viewcode-block" id="detachPosFlags"><a class="viewcode-back" href="../retr.html#retr.detachPosFlags">[docs]</a><span class="k">def</span> <span class="nf">detachPosFlags</span><span class="p">(</span><span class="n">positionString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Detach the position flags from the string of the atomic positions</span>

<span class="sd">    Arguments:</span>
<span class="sd">          positionString (str): string of the atomic positions</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          positions (list): atomic positions as a list</span>
<span class="sd">          flags (list): a list of the flags for by each position</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">posArray</span> <span class="o">=</span> <span class="n">positionString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">posArrayStripped</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">flagArray</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posArray</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posArray</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posArray</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">:</span>
                <span class="n">posArray</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">+=</span><span class="s1">&#39; 1 1 1&#39;</span>
            <span class="k">try</span><span class="p">:</span>

                <span class="n">posArrayStripped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posArray</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">flagArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posArray</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="n">flags</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flagArray</span><span class="p">)</span>
    <span class="n">positions</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posArrayStripped</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">positions</span><span class="p">,</span><span class="n">flags</span>



</div>
<div class="viewcode-block" id="attachPosFlags"><a class="viewcode-back" href="../retr.html#retr.attachPosFlags">[docs]</a><span class="k">def</span> <span class="nf">attachPosFlags</span><span class="p">(</span><span class="n">positionString</span><span class="p">,</span><span class="n">flagString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reattaches the flags to the end of the atomic position</span>

<span class="sd">    Arguments:</span>
<span class="sd">          positionString (str): string of the atomic positions</span>
<span class="sd">          flagString (str): string of the flags</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          positionString (str): Positions with flags attached</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">positionStringSplit</span> <span class="o">=</span> <span class="n">positionString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">flagStringSplit</span> <span class="o">=</span> <span class="n">flagString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">combined</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">positionStringSplit</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">flagStringSplit</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flagStringSplit</span><span class="p">))]</span>
    <span class="n">positionString</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">positionString</span>
</div>
<div class="viewcode-block" id="checkStatus"><a class="viewcode-back" href="../retr.html#retr.checkStatus">[docs]</a><span class="k">def</span> <span class="nf">checkStatus</span><span class="p">(</span><span class="n">PROJECT</span><span class="p">,</span><span class="n">SET</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="p">{},</span><span class="n">negate_status</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    function that loads the calclogs of each of the calculations in your run and </span>
<span class="sd">    displays status information about them.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          PROJECT        (str): Project name</span>
<span class="sd">    Keyword Arguments:</span>
<span class="sd">          SET            (str): Set name</span>
<span class="sd">          config         (str): Config file used</span>
<span class="sd">          step           (int): Which number step to seee (default all of them)</span>
<span class="sd">          status        (dict): dictionary containing the status and the value </span>
<span class="sd">                                you want to see (ex. {&#39;Error&#39;:True})</span>
<span class="sd">          negate_status (bool): Whether to take the calculations with that status or without it</span>

<span class="sd">    Returns:</span>
<span class="sd">          calcsList (list) list of each step of the calculations you</span>
<span class="sd">                           selected that satisfay the status criteria</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">step</span>
    <span class="n">calcsList</span><span class="o">=</span><span class="p">[]</span>    
    <span class="k">if</span> <span class="n">step</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>    
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">step</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">calcsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">loadlogs</span><span class="p">(</span><span class="n">PROJECT</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span><span class="s1">&#39;step_</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">step</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">calcsList</span><span class="o">=</span><span class="p">[</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">loadlogs</span><span class="p">(</span><span class="n">PROJECT</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span><span class="s1">&#39;step_</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">step</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)]</span>

    <span class="n">outString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">calcsList</span><span class="p">)):</span>

        <span class="n">origLength</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
        <span class="n">string_prev</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Folder&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="s1">&#39;ID&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">25</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">string</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%-8s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">][</span><span class="n">ID</span><span class="p">][</span><span class="s1">&#39;__status__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string_prev</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
                <span class="n">string</span><span class="o">=</span><span class="n">string_prev</span>
                <span class="n">string_prev</span><span class="o">=</span><span class="n">string</span>
                <span class="n">header</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
            
        <span class="n">calcCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">status</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">negate_status</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;__status__&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="n">v</span><span class="p">:</span>
                                <span class="k">del</span> <span class="n">calcCopy</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span>                                
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;__status__&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">!=</span><span class="n">v</span><span class="p">:</span>
                                <span class="k">del</span> <span class="n">calcCopy</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span>                                
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="n">headerString</span><span class="o">=</span><span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="n">outString</span><span class="o">+=</span>  <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">headerString</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">outString</span><span class="o">+=</span>  <span class="s1">&#39;STEP: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;  | </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">calcCopy</span><span class="p">),</span><span class="n">origLength</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">outString</span><span class="o">+=</span>  <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">headerString</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">outString</span><span class="o">+=</span>  <span class="n">headerString</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">outString</span><span class="o">+=</span>  <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">headerString</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcCopy</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">stringStatusList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%-8s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;__status__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
                <span class="n">string</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="n">ID</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">25</span><span class="p">)]</span>
                <span class="n">string</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">stringStatusList</span><span class="p">)</span>
                <span class="n">outString</span><span class="o">+=</span> <span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="c1">#copy back for return of subset</span>
            <span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">calcCopy</span><span class="p">)</span>

    <span class="k">print</span> <span class="n">outString</span>
    <span class="k">return</span> <span class="n">calcsList</span>
            </div>
<span class="k">def</span> <span class="nf">__getOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets string of output for that particular step in the workflow for a single calcualtion</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">           None</span>

<span class="sd">    Returns:</span>
<span class="sd">          outFileString (str): output of that particular step in the workflow</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outFilePath</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span>  <span class="o">%</span> <span class="n">ID</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outFilePath</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">outFileString</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outFileString</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;could not get output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outFilePath</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;could not get output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outFilePath</span>

<div class="viewcode-block" id="getCellVolume"><a class="viewcode-back" href="../retr.html#retr.getCellVolume">[docs]</a><span class="k">def</span> <span class="nf">getCellVolume</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">conventional</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets the cell volume from output if avaiable and if not gets it from the input</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>


<span class="sd">    Keyword Arguments:</span>
<span class="sd">          conventional (bool): return the volume of the primitive or conventional lattice </span>
<span class="sd">          string (bool): to return as a string or as a float</span>

<span class="sd">    Returns:</span>
<span class="sd">          vol (str): Volume of the cell </span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outFileString</span> <span class="o">=</span> <span class="n">__getOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">ur&#39;unit-cell volume\s*=\s*([0-9.-]*)&#39;</span><span class="p">,</span><span class="n">outFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">__splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;ibrav&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">conventional</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">13</span><span class="p">]:</span>
                <span class="n">vol</span><span class="o">*=</span><span class="mf">2.0</span>
            <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">]:</span>
                <span class="n">vol</span><span class="o">*=</span><span class="mf">4.0</span>


        <span class="k">if</span> <span class="n">string</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">vol</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;could not get volume from output&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;could not get volume from output&#39;</span>

</div>
<div class="viewcode-block" id="getCellVolumeFromVectors"><a class="viewcode-back" href="../retr.html#retr.getCellVolumeFromVectors">[docs]</a><span class="k">def</span> <span class="nf">getCellVolumeFromVectors</span><span class="p">(</span><span class="n">cellInput</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates cell volume from basis vectors</span>

<span class="sd">    Arguments:</span>
<span class="sd">          cellInput (numpy.matrix): basis set defining the cell</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          vol (float): volume of the cell (may be not scaled. it depends on your input matrix)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vol</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">cellInput</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cellInput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellInput</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">vol</span>
</div>
<span class="k">def</span> <span class="nf">__getInputFileString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets the string of the input that step of the calculation</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          inFileString (str): input string to that calculation step</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFile</span><span class="p">:</span>
        <span class="n">inFileString</span> <span class="o">=</span> <span class="n">inFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">inFileString</span> 


<span class="k">def</span> <span class="nf">__getInitialInputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets initial input to the workflow </span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          inFileString (str): initial input to the workflow </span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFile</span><span class="p">:</span>
        <span class="n">inFileString</span> <span class="o">=</span> <span class="n">inFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">inFileString</span> 


<span class="k">def</span> <span class="nf">__getInitialOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets initial output to the workflow </span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          inFileString (str): initial output to the workflow </span>

<span class="sd">    &#39;&#39;&#39;</span>


    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
        <span class="n">outFileString</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">outFileString</span> 



<span class="k">def</span> <span class="nf">__getSymList</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets symmetry operations from output if available</span>

<span class="sd">    Arguments:</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">       </span>
<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          joinedList (str): a string of the sym ops pulled from the engine output</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
        <span class="n">outFileString</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">joinedList</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;isym.*\n&#39;</span><span class="p">,</span><span class="n">outFileString</span><span class="p">)))</span>
    <span class="n">joinedList</span> <span class="o">=</span> <span class="s2">&quot;Symmetry Operations:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">joinedList</span>
    <span class="k">return</span> <span class="n">joinedList</span>

<span class="k">def</span> <span class="nf">__moveToSavedir</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Move a file to the savedir specified in the config file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          filePath (str): path of the file to be copied</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__ConfigSectionMap</span><span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">,</span><span class="s1">&#39;savedir&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">savedir</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__ConfigSectionMap</span><span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">,</span><span class="s1">&#39;savedir&#39;</span><span class="p">)</span>
                <span class="n">workdir</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__ConfigSectionMap</span><span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">,</span><span class="s1">&#39;workdir&#39;</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="n">zeroBaseDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
                <span class="n">zeroBaseDirName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
                <span class="n">firstBaseDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">zeroBaseDir</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">secondBaseDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">firstBaseDir</span><span class="p">)</span>
                    <span class="n">secondBaseDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">secondBaseDir</span><span class="p">)</span>
                    <span class="n">firstBaseDir</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">firstBaseDir</span><span class="p">)</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="n">secondBaseDir</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>


                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">savedir</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="n">configFileLocation</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__getConfigFile</span><span class="p">()</span>
                    <span class="n">savedir</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">configFileLocation</span><span class="p">,</span> <span class="n">savedir</span><span class="p">)</span>


                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savedir</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savedir</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not transfer </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">. </span><span class="si">%s</span><span class="s1"> does not exist and could not be created. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">savedir</span><span class="p">,</span><span class="n">savedir</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">firstBaseDir</span><span class="p">)</span><span class="o">==</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">workdir</span><span class="p">):</span>
                    <span class="n">firstLevel</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">zeroBaseDir</span><span class="p">))</span>
                    <span class="n">firstLevelNew</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savedir</span><span class="p">,</span><span class="n">firstLevel</span><span class="p">)</span>
                    <span class="n">secondLevelNew</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
                    <span class="n">savedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">firstLevelNew</span><span class="p">,</span><span class="n">zeroBaseDirName</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">secondBaseDir</span><span class="p">)</span><span class="o">==</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">workdir</span><span class="p">):</span>

                    <span class="n">firstLevel</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">zeroBaseDir</span><span class="p">))</span>
                    <span class="n">secondLevel</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">firstBaseDir</span><span class="p">))</span>
                    <span class="n">firstLevelNew</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savedir</span><span class="p">,</span><span class="n">secondLevel</span><span class="p">)</span>
                    <span class="n">secondLevelNew</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">firstLevelNew</span><span class="p">,</span><span class="n">firstLevel</span><span class="p">)</span>

                    <span class="n">savedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">secondLevelNew</span><span class="p">,</span><span class="n">zeroBaseDirName</span><span class="p">,)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">firstLevelNew</span><span class="o">=</span><span class="n">savedir</span>
                    <span class="n">secondLevelNew</span><span class="o">=</span><span class="s1">&#39;&#39;</span>



                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">firstLevelNew</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">firstLevelNew</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not transfer </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">. </span><span class="si">%s</span><span class="s1"> does not exist and could not be created. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">firstLevelNew</span><span class="p">,</span><span class="n">firstLevelNew</span><span class="p">))</span>


                <span class="k">if</span> <span class="n">secondLevelNew</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">secondLevelNew</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">secondLevelNew</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not transfer </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">. </span><span class="si">%s</span><span class="s1"> does not exist and could not be created. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">secondLevelNew</span><span class="p">,</span><span class="n">secondLevelNew</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">savedir</span><span class="p">):</span>
                    <span class="n">savedir</span><span class="o">+=</span><span class="s1">&#39;_SAVEDIR&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savedir</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savedir</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not transfer </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">. </span><span class="si">%s</span><span class="s1"> does not exist and could not be created. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">savedir</span><span class="p">,</span><span class="n">savedir</span><span class="p">))</span>

                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp  </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">savedir</span><span class="p">)))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<div class="viewcode-block" id="grabEnergy"><a class="viewcode-back" href="../retr.html#retr.grabEnergy">[docs]</a><span class="k">def</span> <span class="nf">grabEnergy</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Grabs energy for oneCalc and adds the keyword &#39;Energy&#39; with the value of the energy grabbed from the output</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">                          with the &#39;Energy&#39; keyword added</span>
<span class="sd">     </span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">newDict</span><span class="o">=</span><span class="n">grabEnergyOut</span><span class="p">({</span><span class="n">ID</span><span class="p">:</span><span class="n">oneCalc</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">newDict</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="grabEnergyOut"><a class="viewcode-back" href="../retr.html#retr.grabEnergyOut">[docs]</a><span class="k">def</span> <span class="nf">grabEnergyOut</span><span class="p">(</span><span class="n">calcs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Goes in every subdirectory of the calculation and searches</span>
<span class="sd">    for the final energy of the calculation and returns a new </span>
<span class="sd">    copy of the input dictionary that includes the final energy.</span>

<span class="sd">    Arguments:</span>
<span class="sd">	  calcs (dict): dictionary of dictionaries of calculations</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">	  calcs (dict): dictionary of dictionaries of calculations with energy added</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">calcs1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span>
    <span class="n">energyRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(?:(?:(?:(?:\!\s+)total)|(?:Final)) en\w+\s*=\s+(.+?)Ry)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs1</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">ID</span><span class="p">)):</span>
                <span class="k">with</span> <span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">ID</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
                    <span class="n">outFileString</span><span class="o">=</span><span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="c1">#searches for either total energy or final energy in the scf output and adds it to the output dictionary</span>
                    <span class="n">finalEnergy</span><span class="o">=</span><span class="n">energyRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">finalEnergy</span><span class="p">):</span>
                        <span class="n">energyFloat</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">finalEnergy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                        <span class="n">calcs</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">energyFloat</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1">#if the energy can not be found the test entry is deleted from the output dictionary</span>
                        <span class="n">outCalcPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span><span class="p">)</span>
                        <span class="k">print</span> <span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span>
                        <span class="n">calcs</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                
                <span class="n">outCalcPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span><span class="p">)</span>
                <span class="k">print</span> <span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span>
                <span class="n">calcs</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">outCalcPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span>
    <span class="k">return</span> <span class="n">calcs</span>


</div>
<div class="viewcode-block" id="getForce"><a class="viewcode-back" href="../retr.html#retr.getForce">[docs]</a><span class="k">def</span> <span class="nf">getForce</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets last entry of the total force in the calculation from the engine output.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">           None</span>

<span class="sd">    Returns:</span>
<span class="sd">            force_string (str): Total force from engine output</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">__getOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">forceRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(Total force =\s+[0-9.]+)&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">force_string</span> <span class="o">=</span> <span class="n">forceRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">output</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">force_string</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
</div>
<div class="viewcode-block" id="getCellOutput"><a class="viewcode-back" href="../retr.html#retr.getCellOutput">[docs]</a><span class="k">def</span> <span class="nf">getCellOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    retreives information about the structure and its chemistry and prints</span>
<span class="sd">    it into a file in the AFLOWpi folder inside the project/set directories</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          outputStr (str): Output of the report for the calculation</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outputStr</span><span class="o">=</span><span class="s1">&#39;********************************************************</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">outputStr</span><span class="o">+=</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">folder</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">scfOutput</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">ID</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="n">scfOutput</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s2">&quot;No caclulation output available for </span><span class="si">%s</span><span class="s2">. Are you sure the test ran properly?&quot;</span> <span class="o">%</span> <span class="n">scfOutput</span>

        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">scfInput</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.in&#39;</span> <span class="o">%</span> <span class="n">ID</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="n">scfInput</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFile</span><span class="p">:</span>

            <span class="n">inLines</span> <span class="o">=</span> <span class="n">inFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>


        <span class="k">print</span> <span class="s2">&quot;No caclulation output available for </span><span class="si">%s</span><span class="s2">. Are you sure the test ran properly?&quot;</span> <span class="o">%</span> <span class="n">scfOutput</span>
        <span class="k">return</span>
    <span class="n">retrDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="n">scfInput</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="s1">&#39;********************************************************</span><span class="se">\n\n</span><span class="s1">&#39;</span>        
        <span class="n">coordRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(Begin final coordinates(?:.*\n)+End final coordinates)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
        <span class="n">energyRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(?:(?:(?:(?:\!\s+)total)|(?:Final)) en\w+\s*=\s+(.+?)Ry)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

        <span class="n">stressRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(\s+total\s+stress.+(?:\(kbar\).+\n)(?:.+\n)*)&#39;</span><span class="p">)</span>
        <span class="n">forceRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(Total force =\s+[0-9.]+)&#39;</span><span class="p">)</span>



        <span class="n">coord</span>   <span class="o">=</span> <span class="n">coordRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">energyArr</span> <span class="o">=</span> <span class="n">energyRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">stressArr</span> <span class="o">=</span> <span class="n">stressRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">forceArr</span>  <span class="o">=</span> <span class="n">forceRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>


    <span class="k">try</span><span class="p">:</span>
        <span class="n">symList</span> <span class="o">=</span> <span class="n">__getSymList</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">)</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="n">symList</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="s1">&#39;Total Energy &#39;</span><span class="o">+</span><span class="n">energyArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; Ry</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">energyArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="n">forceArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">forceArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="n">stressArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">stressArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">pass</span>

    <span class="c1">###################</span>
    <span class="c1">####CELL PARAMS####</span>
    <span class="c1">###################</span>
    <span class="n">atomicCELLPARAMRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;Begin final coordinates\n.+\n+.+\n(.+)\n(.+)\n(.+)\n&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="n">initialParamsRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;crystal axes: \(cart. coord. in units of alat\)\n(.+)\n(.+)\n(.+)\n&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

    <span class="n">inputStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">atomCELLPARAMSortList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">alatStr</span> <span class="o">=</span>  <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;alat\s*=\s*[0-9.-]*&#39;</span><span class="p">,</span><span class="n">lines</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">alatStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">atomicCELLPARAMArr</span> <span class="o">=</span> <span class="n">atomicCELLPARAMRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">atomicCELLSTRING</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">atomicCELLPARAMArr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">atomicCELLSTRING</span><span class="o">=</span><span class="s1">&#39;Failed to get final coordinated. May have had convergence issue&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">atomicCELLPARAMArr</span> <span class="o">=</span> <span class="n">atomicCELLPARAMArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">atomicCELLPARAMArr</span> <span class="o">=</span> <span class="n">initialParamsRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">atomicCELLPARAMArr</span> <span class="o">=</span> <span class="n">atomicCELLPARAMArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">atomicCELLPARAMArr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="n">splitAtomicCELLPARAM</span> <span class="o">=</span> <span class="n">atomicCELLPARAMArr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">splitAtomicCELLPARAM</span> <span class="o">=</span> <span class="n">atomicCELLPARAMArr</span>
            <span class="n">testDictString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">outputStr</span><span class="o">+=</span> <span class="n">alatStr</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">CELL_PARAMETERS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">atomicCELLSTRING</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">inputStr</span><span class="o">+=</span><span class="n">alatStr</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">CELL_PARAMETERS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">atomicCELLSTRING</span>
            <span class="n">testDictString</span><span class="o">+=</span><span class="n">atomicCELLSTRING</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">testDictString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">testDictString</span>                
    <span class="k">except</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1">######################</span>
    <span class="c1">###ATOMIC POSITIONS###</span>
    <span class="c1">######################</span>
    <span class="n">atomicNLRegex</span>      <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(ATOMIC_POSITIONS\s*.+\n)&#39;</span><span class="p">)</span>
    <span class="n">atomicPosRegex</span>     <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
                <span class="n">inputStr</span><span class="o">+=</span><span class="n">atomicNLRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">atomPosSortList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
                <span class="n">atomicPosArr</span> <span class="o">=</span> <span class="n">atomicPosRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">outputStr</span><span class="o">+=</span><span class="s2">&quot;ATOMIC_POSITIONS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">atomicPosArr</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                <span class="n">splitAtomicPos</span> <span class="o">=</span> <span class="n">atomicPosArr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">splitAtomicPos</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">atomSplit</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">formattedAtomPos</span> <span class="o">=</span> <span class="n">atomSplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">atomSplit</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">atomSplit</span><span class="p">))])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="n">atomPosSortList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formattedAtomPos</span><span class="p">)</span>
        <span class="n">atomPosSortList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">atomPosSortList</span><span class="p">)</span>
        <span class="n">testDictString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">formattedAtomPos</span> <span class="ow">in</span> <span class="n">atomPosSortList</span><span class="p">:</span>
                <span class="n">testDictString</span><span class="o">+=</span><span class="n">formattedAtomPos</span>
                <span class="n">inputStr</span><span class="o">+=</span><span class="n">formattedAtomPos</span>

        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">testDictString</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">baseDir</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;/AFLOWpi/summary.log&#39;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">baseDir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">baseDir</span><span class="p">,</span><span class="s1">&#39;a+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
        <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outputStr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outputStr</span>
</div>
<span class="k">def</span> <span class="nf">__getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reads the output from the SCF or relax calculation to get the primitive cell parameters</span>
<span class="sd">    produced by the calculation. If it fails it defaults to the input lattice vectors</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary of a single calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          alat (float): the scale for the lattice vectors</span>
<span class="sd">          cell_matrix (numpy.array): the unscaled primitive lattice vectors</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">scfOutput</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1">#scfoutput = &#39;%s.out&#39; % ID</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">scfOutput</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>




        <span class="n">cellParams</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">cell_parameters</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
        <span class="n">splitInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>
        <span class="n">alat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">])</span>
        <span class="n">paramMatrix</span><span class="o">=</span><span class="n">__cellStringToMatrix</span><span class="p">(</span><span class="n">cellParams</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cellParams</span><span class="p">):</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">alat</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">paramMatrix</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">alat</span><span class="p">),</span><span class="n">paramMatrix</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">initialParams</span><span class="p">):</span>
                <span class="n">paramMatrixList</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">initialParams</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">paramArray</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                        <span class="n">paramMatrixList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">paramArray</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">paramArray</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">paramArray</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
                <span class="n">paramMatrix</span> <span class="o">=</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">paramMatrixList</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S10&#39;</span><span class="p">)</span>
                <span class="n">paramMatrix</span> <span class="o">=</span> <span class="n">paramMatrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">alat</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">paramMatrix</span>

        <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;No card!&#39;</span>
                <span class="k">return</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellMatrixFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>


        <span class="k">return</span> <span class="n">__getAlatFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]),</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellMatrixFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="get_parameters"><a class="viewcode-back" href="../retr.html#retr.get_parameters">[docs]</a><span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">conventional</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">conventional</span><span class="p">:</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getConventionalCellFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="c1">#        print cell</span>
<span class="c1">#        print type(cell)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellMatrixFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">free2abc</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">bohr</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        </div>
<span class="k">def</span> <span class="nf">__getAlatFromInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Grabs the value of alat from the QE pwscf input</span>

<span class="sd">    Arguments:</span>
<span class="sd">          inputString</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          alat (float): the alat scale for the primitive lattice vectors</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">splitInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__splitInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;A&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;a&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<div class="viewcode-block" id="getRecipParams"><a class="viewcode-back" href="../retr.html#retr.getRecipParams">[docs]</a><span class="k">def</span> <span class="nf">getRecipParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    reads the output from the SCF or relax calculation to get the </span>
<span class="sd">    reciprocal cell parameters produced by the calculation.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary of a single calculation</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          alat (float): alat multiplier</span>
<span class="sd">          paramMatrix (numpy.matrix): matrix of reciprocal lattice vectors</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">scfOutput</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">scfOutput</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">re0</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;^.+reciprocal axes: \(\cart. coord. in units 2 .+\)\s*\n^.+\((.+)\)\s*\n^.+\((.+)\)\s*\n^.+\((.+)\)\s*\n&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
            <span class="n">re2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;Begin final coordinates\n.+\n+.+alat= ([\d.]+).+\n&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

            <span class="n">alat</span> <span class="o">=</span> <span class="n">re2</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">cellParams</span> <span class="o">=</span> <span class="n">re0</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cellParams</span><span class="p">):</span>
                    <span class="n">paramMatrixList</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">cellParams</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">paramArray</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                            <span class="n">paramMatrixList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paramArray</span><span class="p">)</span>

                    <span class="n">paramMatrixList</span> <span class="o">=</span> <span class="p">[</span><span class="n">paramMatrixList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">paramMatrixList</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">paramMatrixList</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                    <span class="n">paramMatrix</span> <span class="o">=</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">paramMatrixList</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S10&#39;</span><span class="p">)</span>
                    <span class="n">paramMatrix</span> <span class="o">=</span> <span class="n">paramMatrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

                    <span class="k">return</span> <span class="n">alat</span><span class="p">,</span><span class="n">paramMatrix</span>

            <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s1">&#39;No card!&#39;</span>
                    <span class="k">return</span> <span class="n">alat</span><span class="p">,[[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]]</span>
	
</div>
<span class="k">def</span> <span class="nf">__getAtomNum</span><span class="p">(</span><span class="n">inputString</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets the number of atoms from a QE pwscf input file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          inputString (str): String of a QE pwscf input file</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          strip (bool): If True then Cr2,Cr45,Cr would be all considered the same species</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">          numOfEach (collections.OrderedDict): dictionary with keys for the species labels and values the number</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">nullstr</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="c1">##for the string in the dictionary of dictionaries</span>
    <span class="n">inputSplit</span> <span class="o">=</span> <span class="n">inputString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="sd">&#39;&#39;&#39;find all matches to get each of the atoms in the ATOMIC_POSITIONS LIST&#39;&#39;&#39;</span>
    <span class="n">atomList</span> <span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">atomList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atomList</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">strip</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">atomList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;1234567890&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atomList</span><span class="p">]</span>
    <span class="sd">&#39;&#39;&#39;put those matches into a dictionary of the species and its count&#39;&#39;&#39;</span>
    <span class="n">numOfEach</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">atomList</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">atomList</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">numOfEach</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="k">def</span> <span class="nf">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">latex</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Determines the name of the compound by looking at the input and</span>
<span class="sd">    finds the stoichiometric number of species in the compound</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): one calculation that is a dictionary of values associated with that calculation</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          strip (bool): strip species number when it equals 1</span>
<span class="sd">          latex (bool): output string in latex format</span>

<span class="sd">    Returns:</span>
<span class="sd">          name (str): chemical namex</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">inputString</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>
    <span class="n">numOfEach</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getAtomNum</span><span class="p">(</span><span class="n">inputString</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="n">strip</span><span class="p">)</span> 
    <span class="sd">&#39;&#39;&#39;get GCD of it&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">GCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">a</span>
            <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">GCD</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;cycle through the number of each species for each calculation</span>
<span class="sd">    to get the GCD of all the number of species in the calculation&#39;&#39;&#39;</span>
    <span class="n">stoicGCD</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">GCD</span><span class="p">,</span> <span class="n">numOfEach</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">numOfEachCopy</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">numOfEach</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;go through and divide the number of each species by the GCD</span>
<span class="sd">    and update the dictionary with {species:number of them in the cell}&#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">species</span><span class="p">,</span><span class="n">num</span> <span class="ow">in</span> <span class="n">numOfEach</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">numOfEachCopy</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="n">numOfEach</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">/</span> <span class="n">stoicGCD</span>

    <span class="sd">&#39;&#39;&#39;builds name for printing in order of elements are listed in the </span>
<span class="sd">    ATOMIC POSTIONS from top of that list is first atom down to bottom </span>
<span class="sd">    of the list is the last species in the name&#39;&#39;&#39;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">latex</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">name</span><span class="o">+=</span><span class="s1">&#39;$&#39;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">numOfEachCopy</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">number</span><span class="o">=</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">strip</span><span class="o">==</span><span class="bp">True</span> <span class="ow">and</span> <span class="n">value</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">number</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">latex</span><span class="o">==</span><span class="bp">True</span> <span class="ow">and</span> <span class="n">value</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">name</span><span class="o">+=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_{</span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">number</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="o">+=</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">number</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;returns the name of the compound ready to print with LaTeX rendering&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">latex</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">name</span><span class="o">+=</span><span class="s1">&#39;$&#39;</span>

    <span class="k">return</span> <span class="n">name</span>


<span class="k">def</span> <span class="nf">__getPathFromFile</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reads the input file for the band structure calculation and retrieves the </span>
<span class="sd">    k point path from the file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): one calculation that is a dictionary of values associated with that calculation</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          path (str): k point path for bands in the bands pwscf input file</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">calcID</span>  <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">oneCalc</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">bandsIn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.in&#39;</span> <span class="o">%</span> <span class="n">calcID</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bandsIn</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">bandsInFile</span><span class="p">:</span>
                    <span class="n">bandsInString</span> <span class="o">=</span> <span class="n">bandsInFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">k_points</span><span class="p">(</span><span class="n">bandsInString</span><span class="p">)</span>		



            <span class="k">return</span> <span class="n">path</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>
            <span class="k">print</span> <span class="s1">&#39;Did you run ppBands and did it complete properly?&#39;</span>
            <span class="k">return</span> 


<span class="k">def</span> <span class="nf">__getHighSymPoints</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Searching for the ibrav number in the input file for the calculation</span>
<span class="sd">    to determine the path for the band structure calculation</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">                </span>
<span class="sd">    Keyword Arguments:</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Returns:</span>
<span class="sd">          special_points (list): list of the HSP names</span>
<span class="sd">          band_path (str): path in string form</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">CUB</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
         <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
           <span class="s1">&#39;M&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;R&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
         <span class="p">}</span>

         <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-M-gG-R-X|M-R&#39;</span>
         <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
         <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>
    <span class="k">def</span> <span class="nf">FCC</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
         <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
           <span class="s1">&#39;K&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;U&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">,</span> <span class="mf">0.625</span><span class="p">),</span>
           <span class="s1">&#39;W&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
         <span class="p">}</span>

         <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-W-K-gG-L-U-W-L-K|U-X&#39;</span>
         <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
         <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>
    <span class="k">def</span> <span class="nf">BCC</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
         <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
           <span class="s1">&#39;H&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;P&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
           <span class="s1">&#39;N&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
         <span class="p">}</span>

         <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-H-N-gG-P-H|P-N&#39;</span>
         <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
         <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>


    <span class="k">def</span> <span class="nf">BCT1</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
       <span class="n">a</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">c</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>


       <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>

       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;M&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;N&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;P&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;Z1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>
         <span class="p">}</span>

       <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-M-gG-Z-P-N-Z1-M|X-P&#39;</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
       <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>


    <span class="k">def</span> <span class="nf">BCT2</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>

       <span class="n">a</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">c</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>


       <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
       <span class="n">zeta</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;N&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;P&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
           <span class="s1">&#39;gS&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;gS1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;Y1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">zeta</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
         <span class="p">}</span>

       <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-Y-gS-gG-Z-gS1-N-P-Y1-Z|X-P&#39;</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
       <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>


    <span class="k">def</span> <span class="nf">TET</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
         <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
           <span class="s1">&#39;A&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;M&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;R&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
         <span class="p">}</span>
         <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-M-gG-Z-R-A-Z|X-R|M-A&#39;</span>
         <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
         <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>

    <span class="k">def</span> <span class="nf">ORC</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
         <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
           <span class="s1">&#39;R&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;S&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;T&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;U&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
         <span class="p">}</span>

         <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-S-Y-gG-Z-U-R-T-Z|Y-T|U-X|S-R&#39;</span>
         <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
         <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>

    <span class="k">def</span> <span class="nf">ORCF1</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>

       <span class="n">a1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">b1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">c1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">myList</span> <span class="o">=</span> <span class="p">[</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">c1</span><span class="p">]</span>
       <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
       <span class="n">a</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
       <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
       <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
       <span class="n">b</span> <span class="o">=</span> <span class="n">myList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

       <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">zeta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;A&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">zeta</span><span class="p">),</span>
           <span class="s1">&#39;A1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">zeta</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;T&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;X1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
         <span class="p">}</span>

       <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-Y-T-Z-gG-X-A1-Y|T-X1|X-A-Z|L-gG&#39;</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
       <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>

    <span class="k">def</span> <span class="nf">ORCF2</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>

       <span class="n">a1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">b1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">c1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">myList</span> <span class="o">=</span> <span class="p">[</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">c1</span><span class="p">]</span>
       <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
       <span class="n">a</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
       <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
       <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
       <span class="n">b</span> <span class="o">=</span> <span class="n">myList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

       <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;C&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;C1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;D&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">delta</span><span class="p">),</span>
           <span class="s1">&#39;D1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">+</span><span class="n">delta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">delta</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;H&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">phi</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">phi</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;H1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">phi</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
         <span class="p">}</span>

       <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-Y-C-D-X-gG-Z-D1-H-C|C1-Z|X-H1|H-Y|L-gG&#39;</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
       <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>


    <span class="k">def</span> <span class="nf">ORCF3</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>

       <span class="n">a1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">b1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">c1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">myList</span> <span class="o">=</span> <span class="p">[</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">c1</span><span class="p">]</span>
       <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
       <span class="n">a</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
       <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
       <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
       <span class="n">b</span> <span class="o">=</span> <span class="n">myList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

       <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">zeta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;A&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">zeta</span><span class="p">),</span>
           <span class="s1">&#39;A1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">zeta</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;T&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;X1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
         <span class="p">}</span>

       <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-Y-T-Z-gG-X-A1-Y|X-A-Z|L-R&#39;</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
       <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>

    <span class="k">def</span> <span class="nf">ORCC</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
       <span class="n">a</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">b</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
       <span class="n">c</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
       <span class="n">myList</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
       <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
       <span class="n">a</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
       <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
       <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
       <span class="n">b</span> <span class="o">=</span> <span class="n">myList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

       <span class="n">zeta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;A&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;A1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;R&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;S&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;T&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;X1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
         <span class="p">}</span>

       <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-S-R-A-Z-gG-Y-X1-A1-T-Y|Z-T&#39;</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
       <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>

    <span class="k">def</span> <span class="nf">ORCI</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
         <span class="n">a1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
         <span class="n">b1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
         <span class="n">c1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
         <span class="n">myList</span> <span class="o">=</span> <span class="p">[</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">c1</span><span class="p">]</span>
         <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
         <span class="n">a</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
         <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
         <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
         <span class="n">b</span> <span class="o">=</span> <span class="n">myList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

         <span class="n">chi</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
         <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
         <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
         <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">b</span> <span class="o">+</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
         <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">delta</span><span class="p">),</span>
           <span class="s1">&#39;L1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="o">-</span><span class="n">mu</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">delta</span><span class="p">),</span>
           <span class="s1">&#39;L2&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">delta</span><span class="p">,</span> <span class="o">-</span><span class="n">mu</span><span class="p">),</span>
           <span class="s1">&#39;R&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;S&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;T&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;W&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">chi</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">chi</span><span class="p">),</span>
           <span class="s1">&#39;X1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">chi</span><span class="p">,</span> <span class="o">-</span><span class="n">chi</span><span class="p">),</span>
           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;Y1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
         <span class="p">}</span>
         <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-L-T-W-R-X1-Z-gG-Y-S-W|L1-Y|Y1-Z&#39;</span>
         <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
         <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>

    <span class="k">def</span> <span class="nf">HEX</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
         <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
           <span class="s1">&#39;A&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;H&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;K&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;M&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
         <span class="p">}</span>

         <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-M-K-gG-A-L-H-A|L-M|K-H&#39;</span>
         <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
         <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def MCL(cellOld):</span>
<span class="sd">       a1 = cellOld[0][0]</span>
<span class="sd">       b1 = (cellOld[1][0]**2 + cellOld[1][1]**2)**(0.5)</span>
<span class="sd">       c1 = cellOld[2][2]</span>
<span class="sd">       gamma = numpy.arctan(cellOld[1][1]/cellOld[1][0])</span>
<span class="sd">       myList = [a1, b1, c1]</span>
<span class="sd">       c = max(myList)</span>
<span class="sd">       a = min(myList)</span>
<span class="sd">       myList.remove(c)</span>
<span class="sd">       myList.remove(a)</span>
<span class="sd">       b = myList[0]</span>
<span class="sd">       alpha = gamma</span>

<span class="sd">       eta = (1 - b*numpy.cos(alpha)/c)/(2*numpy.sin(alpha)**2)</span>
<span class="sd">       nu = 0.5 - eta*c*numpy.cos(alpha)/b</span>
<span class="sd">       special_points = {</span>
<span class="sd">           &#39;gG&#39;    : (0.0, 0.0, 0.0),</span>
<span class="sd">           &#39;A&#39;    : (0.5, 0.5, 0.0),</span>
<span class="sd">           &#39;C&#39;    : (0.0, 0.5, 0.5),</span>
<span class="sd">           &#39;D&#39;    : (0.5, 0.0, 0.5),</span>
<span class="sd">           &#39;D1&#39;    : (0.5, 0.0, -0.5),</span>
<span class="sd">           &#39;E&#39;    : (0.5, 0.5, 0.5),</span>
<span class="sd">           &#39;H&#39;    : (0.0, eta, 1.0-nu),</span>
<span class="sd">           &#39;H1&#39;    : (0.0, 1.0-eta, nu),</span>
<span class="sd">           &#39;H2&#39;    : (0.0, eta, -nu),</span>
<span class="sd">           &#39;M&#39;    : (0.5, eta, 1.0-nu),</span>
<span class="sd">           &#39;M1&#39;    : (0.5, 1.0-eta, nu),</span>
<span class="sd">           &#39;M2&#39;    : (0.5, eta, -nu),</span>
<span class="sd">           &#39;X&#39;    : (0.0, 0.5, 0.0),</span>
<span class="sd">           &#39;Y&#39;    : (0.0, 0.0, 0.5),</span>
<span class="sd">           &#39;Y1&#39;    : (0.0, 0.0, -0.5),</span>
<span class="sd">           &#39;Z&#39;    : (0.5, 0.0, 0.0)</span>
<span class="sd">         }</span>

<span class="sd">       default_band_path = &#39;gG-Y-H-C-E-M1-A-X-H1|M-D-Z|Y-D&#39;</span>
<span class="sd">       band_path = default_band_path</span>
<span class="sd">       return special_points, band_path</span>
<span class="sd">    &#39;&#39;&#39;</span>


    <span class="k">def</span> <span class="nf">RHL1</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>

       <span class="n">tx</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
       <span class="n">c</span> <span class="o">=</span> <span class="p">(((</span><span class="n">tx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
       <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span>
       <span class="n">alpha</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
       <span class="n">eta1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
       <span class="n">eta2</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
       <span class="n">eta</span> <span class="o">=</span> <span class="n">eta1</span><span class="o">/</span><span class="n">eta2</span>
       <span class="n">nu</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">-</span> <span class="n">eta</span><span class="o">/</span><span class="mf">2.0</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;B&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;B1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
           <span class="s1">&#39;F&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;L1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;P&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">),</span>
           <span class="s1">&#39;P1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">nu</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">nu</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;P2&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">eta</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
           <span class="s1">&#39;Q&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">nu</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
         <span class="p">}</span>
       <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-L-B1|B-Z-gG-X|Q-F-P1-Z|L-P&#39;</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
       <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>

    <span class="k">def</span> <span class="nf">RHL2</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>           

        <span class="n">tx</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">(((</span><span class="n">tx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">-</span> <span class="n">eta</span><span class="o">/</span><span class="mf">2.0</span>

        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;F&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;P&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">nu</span><span class="p">,</span> <span class="o">-</span><span class="n">nu</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">nu</span><span class="p">),</span>
           <span class="s1">&#39;P1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nu</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
           <span class="s1">&#39;Q&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;Q1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
         <span class="p">}</span> 
        <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-P-Z-Q-gG-F-P1-Q1-L-Z&#39;</span>
        <span class="n">band_path</span> <span class="o">=</span> <span class="n">default_band_path</span>
        <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>


    <span class="k">def</span> <span class="nf">TRI1A</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;M&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;N&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;R&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="p">}</span>

        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;X-gG-Y|L-gG-Z|N-gG-M|R-gG&#39;</span>
        <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>
    <span class="k">def</span> <span class="nf">TRI2A</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;M&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;N&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;R&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="p">}</span>

        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;X-gG-Y|L-gG-Z|N-gG-M|R-gG&#39;</span>

        <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>

    <span class="k">def</span> <span class="nf">TRI1B</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;M&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;N&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;R&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="p">}</span>


        <span class="n">band_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;X-gG-Y|L-gG-Z|N-gG-M|R-gG&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>

    <span class="k">def</span> <span class="nf">TRI2B</span><span class="p">(</span><span class="n">cellOld</span><span class="p">):</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;M&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;N&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;R&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
           <span class="p">}</span>

        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;X-gG-Y|L-gG-Z|N-gG-M|R-gG&#39;</span>
        <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>

    <span class="c1">########################################################################################################################################</span>

    <span class="k">def</span> <span class="nf">choose_lattice</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">cellOld</span><span class="p">):</span>                        
        <span class="k">if</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">CUB</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>

        <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">FCC</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>

        <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">):</span>
           <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">BCC</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
           <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>

        <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">HEX</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>

        <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">5</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cellOld</span> <span class="o">=</span> <span class="n">cellOld</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>


            <span class="n">tx</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">c</span> <span class="o">=</span> <span class="p">(((</span><span class="n">tx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span>



            <span class="n">alpha</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>


            <span class="k">if</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">:</span>
                <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">RHL1</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>

            <span class="k">elif</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">:</span>
                <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">RHL2</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>


        <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">):</span>
           <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">TET</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
           <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>

        <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">7</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cellOld</span> <span class="o">=</span> <span class="n">cellOld</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>

            <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">):</span>
              <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">BCT1</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
              <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>

            <span class="k">elif</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">):</span>
              <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">BCT2</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
              <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>


        <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">8</span><span class="p">):</span>
           <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">ORC</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
           <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>

        <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">9</span><span class="p">):</span>
           <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">ORCC</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
           <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>

        <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">10</span><span class="p">):</span>

            <span class="n">a1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
            <span class="n">b1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">cellOld</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
            <span class="n">myList</span> <span class="o">=</span> <span class="p">[</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">c1</span><span class="p">]</span>
            <span class="n">c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
            <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">myList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">myList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">ORCF1</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>

            <span class="k">elif</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">ORCF2</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>

            <span class="k">elif</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">==</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                var1, var2 = ORCF3(cellOld)</span>
<span class="sd">                return var1, var2</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">raise</span> <span class="ne">Exception</span>
        <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">11</span><span class="p">):</span>

            <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">ORCI</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span>
        <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">14</span><span class="p">):</span>

            <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span>  <span class="n">free2abc</span><span class="p">(</span><span class="n">cellOld</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">bohr</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="n">minAngle</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)])</span>
            <span class="n">maxAngle</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">alpha</span><span class="o">==</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">beta</span><span class="o">==</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">gamma</span><span class="o">==</span><span class="mf">90.0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">alpha</span><span class="o">&gt;=</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">beta</span><span class="o">&gt;=</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">gamma</span><span class="o">&gt;=</span><span class="mf">90.0</span><span class="p">:</span>
                    <span class="n">var1</span><span class="p">,</span><span class="n">var2</span> <span class="o">=</span> <span class="n">TRI2A</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">var1</span><span class="p">,</span><span class="n">var2</span>
                <span class="k">if</span> <span class="n">alpha</span><span class="o">&lt;=</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">beta</span><span class="o">&lt;=</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">gamma</span><span class="o">&lt;=</span><span class="mf">90.0</span><span class="p">:</span>
                    <span class="n">var1</span><span class="p">,</span><span class="n">var2</span> <span class="o">=</span> <span class="n">TRI2B</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">var1</span><span class="p">,</span><span class="n">var2</span>
            <span class="k">elif</span> <span class="n">minAngle</span><span class="o">&gt;</span><span class="mf">90.0</span><span class="p">:</span>
                <span class="n">var1</span><span class="p">,</span><span class="n">var2</span> <span class="o">=</span> <span class="n">TRI1A</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">var1</span><span class="p">,</span><span class="n">var2</span>
            <span class="k">elif</span> <span class="n">maxAngle</span><span class="o">&lt;</span><span class="mi">90</span><span class="p">:</span>
                <span class="n">var1</span><span class="p">,</span><span class="n">var2</span> <span class="o">=</span> <span class="n">TRI1B</span><span class="p">(</span><span class="n">cellOld</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">var1</span><span class="p">,</span><span class="n">var2</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        elif(int(ibrav)==12):</span>
<span class="sd">            var1, var2 = MCL(cellOld)</span>
<span class="sd">            return var1, var2</span>
<span class="sd">        &#39;&#39;&#39;</span>                
    <span class="c1">#######################################################################</span>
    <span class="n">ibrav</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ibravRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;ibrav[\s]*=[\s]*([\d]+)\s*[,</span><span class="se">\n</span><span class="s1">]*&#39;</span><span class="p">)</span>

    <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ibravRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;Lattice type </span><span class="si">%s</span><span class="s1"> is not implemented&#39;</span> <span class="o">%</span> <span class="n">ibrav</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;The ibrav value from expresso has not yet been implemented to the framework&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span>

    <span class="n">alat</span><span class="p">,</span><span class="n">cellOld</span> <span class="o">=</span> <span class="n">__getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>        

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">cellOld</span><span class="o">/=</span><span class="n">alat</span>

    <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span> <span class="o">=</span> <span class="n">choose_lattice</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">cellOld</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>	



<div class="viewcode-block" id="writeInputFromOutput"><a class="viewcode-back" href="../retr.html#retr.writeInputFromOutput">[docs]</a><span class="k">def</span> <span class="nf">writeInputFromOutput</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">	  calcs (dict): dictionary of dictionaries of calculations</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          replace (bool): If true replace the input with updated atomic positions and cell parameters</span>
<span class="sd">          runlocal (bool): run local or write to &lt;ID&gt;.py</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">runlocal</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;RUN&#39;</span><span class="p">,</span><span class="s1">&#39;AFLOWpi.retr.__writeInputFromOutput(oneCalc,ID,replace=</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">replace</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__writeInputFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">)</span>
        </div>
<span class="k">def</span> <span class="nf">__writeInputFromOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generates an input of that step updated with the positions and lattice vectors of its output</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          newInput (str): string of that step&#39;s input updated with the positions and lattice vectors of its output</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">alatRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">ur&#39;(?:CELL_PARAMETERS)\s*\(\s*alat\s*=\s*([0-9.]*)\s*\)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outputFile</span><span class="p">:</span>
                <span class="n">engineOutput</span><span class="o">=</span><span class="n">outputFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            
            <span class="k">return</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">coordRegex</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>
        <span class="n">atomCoord</span> <span class="o">=</span> <span class="n">coordRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="n">alatRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">e</span>
    
    <span class="n">newInput</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="n">inFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">)</span>
    <span class="n">outFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_new.in&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inFileName</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFile</span><span class="p">:</span>
        <span class="n">inFileString</span> <span class="o">=</span> <span class="n">inFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">inFileStringOrig</span> <span class="o">=</span> <span class="n">inFileString</span>
        <span class="n">newInput</span> <span class="o">=</span> <span class="n">inFileString</span>
        <span class="n">nameListRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(&amp;[A-Za-z]+)|(?:\s*(\S*?)\s*=\s*(\S+?)(?:(?:\s*\,\s*)|(?:\s*\n)))&#39;</span><span class="p">)</span>
        <span class="n">namelist</span> <span class="o">=</span> <span class="n">nameListRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cellParamRegex</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">cell_parameters</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>
        <span class="n">CELL_PARAMETERS</span> <span class="o">=</span> <span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>        
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
        
    <span class="k">try</span><span class="p">:</span>
        
        <span class="n">tokenizedInput</span> <span class="o">=</span>  <span class="n">__splitInput</span><span class="p">(</span><span class="n">newInput</span><span class="p">)</span>
        <span class="n">tokenCopy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tokenizedInput</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">nameList</span><span class="p">,</span><span class="n">nameListDict</span> <span class="ow">in</span> <span class="n">tokenizedInput</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nameListDict</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">({</span><span class="s1">&#39;someDict&#39;</span><span class="p">:</span><span class="mi">42</span><span class="p">})):</span>
                <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">nameListDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;A&#39;</span> <span class="ow">or</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;B&#39;</span> <span class="ow">or</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;C&#39;</span> <span class="ow">or</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;COSBC&#39;</span> <span class="ow">or</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;COSAC&#39;</span> <span class="ow">or</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;COSAB&#39;</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">tokenCopy</span><span class="p">[</span><span class="n">nameList</span><span class="p">][</span><span class="n">parameter</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">parameter</span><span class="o">==</span><span class="s1">&#39;ibrav&#39;</span><span class="p">:</span>
                        <span class="n">tokenCopy</span><span class="p">[</span><span class="n">nameList</span><span class="p">][</span><span class="n">parameter</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>
            <span class="k">if</span> <span class="n">nameList</span><span class="o">==</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">:</span>
                <span class="n">tokenCopy</span><span class="p">[</span><span class="n">nameList</span><span class="p">][</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">alat</span><span class="p">)</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">newInput</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>

                <span class="n">coords</span><span class="p">,</span><span class="n">flags</span> <span class="o">=</span> <span class="n">detachPosFlags</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]))</span>
                <span class="n">tokenCopy</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">attachPosFlags</span><span class="p">(</span><span class="n">atomCoord</span><span class="p">,</span><span class="n">flags</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="n">newInput</span> <span class="o">=</span> <span class="n">__joinInput</span><span class="p">(</span><span class="n">tokenCopy</span><span class="p">)</span>        
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">newInput</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;ibrav\s*=\s*[0-9]*&#39;</span><span class="p">,</span><span class="s1">&#39;ibrav = 0&#39;</span><span class="p">,</span><span class="n">newInput</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;(?:celldm\(\s*[2-6]\s*\))\s*&#39;</span><span class="p">,</span><span class="n">newInput</span><span class="p">))</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">newInput</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&#39;(?:celldm\(\s*[2-6]\s*\))\s*=\s*[0-9.]*[,]*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span> <span class="p">,</span><span class="n">newInput</span><span class="p">)</span>
                <span class="n">newInput</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&#39;(?:celldm\(\s*1\s*\))\s*=\s*[0-9.]*[,]*&#39;</span><span class="p">,</span><span class="s1">&#39;celldm(1)=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">alat</span> <span class="p">,</span><span class="n">newInput</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">,</span><span class="n">newInput</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">cellParamRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(?:CELL_PARAMETERS)\s+.+\n((?:[-0-9|.]+)\s+(?:[-0-9|.]+)\s+(?:[-0-9|.]+)\s*\n*)+(?=(?:[A-Z|_|\s]+\n)|)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
                <span class="n">newInput</span> <span class="o">=</span> <span class="n">cellParamRegex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">CELL_PARAMETERS</span><span class="p">,</span><span class="n">newInput</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newInput</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">CELL_PARAMETERS</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">CELL_PARAMETERS</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="n">newInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">remove_blank_lines</span><span class="p">(</span><span class="n">newInput</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newInput</span>


<span class="k">def</span> <span class="nf">__prefixFromInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;CONSIDER FOR REMOVAL&gt;</span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__splitInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">)[</span><span class="s1">&#39;&amp;control&#39;</span><span class="p">][</span><span class="s1">&#39;prefix&#39;</span><span class="p">]</span>
    <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">prefix</span>
    

<span class="k">def</span> <span class="nf">__writeInputFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Writes an input file of that step updated with the positions and lattice vectors of its output</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          replace (bool): if True then replace the input with the updated one</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_new.in&#39;</span><span class="p">)</span>
    <span class="n">newInput</span> <span class="o">=</span> <span class="n">__writeInputFromOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newInput</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outFileName</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">newInput</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">replace</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_old.in&#39;</span><span class="p">))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_new.in&#39;</span><span class="p">),</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        



<span class="k">def</span> <span class="nf">__writeEfermi</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Grabs the fermi enery or HOMO energy from the output files of the dos calculations</span>
<span class="sd">    and converts into rydberg then writes it to file &lt;ID&gt;.efermi</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">Efermi</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1">#if it&#39;s not a MP grid don&#39;t pull the fermi level</span>
    <span class="n">outfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">ID</span><span class="p">)]</span>
    <span class="k">try</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">outfile</span> <span class="ow">in</span> <span class="n">outfiles</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
                            <span class="n">outFileString</span> <span class="o">=</span> <span class="n">outFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>	

                            <span class="n">HOMOList</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;highest occupied, lowest unoccupied level \(ev\):\s*(.+?)\s&#39;</span><span class="p">,</span><span class="n">outFileString</span><span class="p">)</span>	      
                            <span class="n">EfermiList</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;\s*the Fermi energy is\s*([.0-9]+)\s*ev&#39;</span><span class="p">,</span><span class="n">outFileString</span><span class="p">)</span>	       
                            <span class="n">justHOMOList</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;highest occupied level\s*\(ev\)\:\s*([.0-9]+)\s*&#39;</span><span class="p">,</span><span class="n">outFileString</span><span class="p">)</span>

                            <span class="n">spin_polarized</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;the spin up/dw Fermi energies are\s*([-]*[0-9.])\s*([-]*[0-9.])&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">HOMOList</span><span class="p">):</span>
                                    <span class="n">Efermi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">HOMOList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;highest occupied, lowest unoccupied level: </span><span class="si">%s</span><span class="s1"> eV&#39;</span> <span class="o">%</span> <span class="n">Efermi</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">EfermiList</span><span class="p">):</span>
                                    <span class="n">Efermi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">EfermiList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;the Fermi energy is: </span><span class="si">%s</span><span class="s1"> eV&#39;</span> <span class="o">%</span> <span class="n">Efermi</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">justHOMOList</span><span class="p">):</span>
                                    <span class="n">Efermi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">justHOMOList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;highest occupied level: </span><span class="si">%s</span><span class="s1"> eV&#39;</span> <span class="o">%</span> <span class="n">Efermi</span><span class="p">)</span>

                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">spin_polarized</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">outFileString</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">Efermi</span><span class="o">=</span><span class="n">spin_polarized</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>



    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;could not find eFermi/HOMO-LUMO in </span><span class="si">%s</span><span class="s1"> checking to see if EFERMI/HOMOLUMO is in calc dictionary from previous calculation.&#39;</span><span class="p">)</span>

    <span class="s1">&#39;look to see if efermi is there from dos calc and if not add efermi as part of the dos calc&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">Efermi</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;EFERMI&#39;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Efermi</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;EFERMI&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Efermi</span>
    <span class="sd">&#39;&#39;&#39;save value of efermi&#39;&#39;&#39;</span>
    <span class="n">fermi_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.efermi&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fermi_file</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
            <span class="n">outFileObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Efermi</span><span class="p">))</span>
        

<span class="k">def</span> <span class="nf">__getEfermi</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Grabs fermi level from &lt;ID&gt;.efermi file. if there is none returns 0.0</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          efermi (float): fermi level </span>
<span class="sd">   </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">glob_ID</span><span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;dos&#39;</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">straight</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">fermi_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.efermi&#39;</span><span class="o">%</span><span class="n">glob_ID</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fermi_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
            <span class="n">efermi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">outFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">efermi</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">e</span>
        <span class="k">return</span> <span class="mf">0.0</span>


<span class="k">def</span> <span class="nf">__joinInput</span><span class="p">(</span><span class="n">inputDict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Joins input tokenized by AFLOWpi.retr.__splitInput and returns a string of a QE pwscf input file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          inputDict (dict): tokenized input file</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          newInputString (str): a string of a QE pwscf input file</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">newInputString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">namelist</span><span class="p">,</span><span class="n">parameters</span> <span class="ow">in</span> <span class="n">inputDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;&amp;&#39;</span> <span class="ow">in</span> <span class="n">namelist</span><span class="p">:</span>        
            <span class="n">newInputString</span><span class="o">+=</span><span class="n">namelist</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">inputDict</span><span class="p">[</span><span class="n">namelist</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">newInputString</span><span class="o">+=</span> <span class="s1">&#39;   </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">,</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">value</span><span class="p">)</span>

            <span class="n">newInputString</span><span class="o">+=</span><span class="s1">&#39;/</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">newInputString</span><span class="o">+=</span><span class="n">namelist</span>
                <span class="k">if</span> <span class="n">namelist</span><span class="o">==</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span> <span class="ow">and</span> <span class="n">inputDict</span><span class="p">[</span><span class="n">namelist</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">inputDict</span><span class="p">[</span><span class="n">namelist</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;{crystal}&#39;</span>
                    
                <span class="n">newInputString</span><span class="o">+=</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">inputDict</span><span class="p">[</span><span class="n">namelist</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>                
                <span class="n">newInputString</span><span class="o">+=</span><span class="n">inputDict</span><span class="p">[</span><span class="n">namelist</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="n">newInputString</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">remove_blank_lines</span><span class="p">(</span><span class="n">newInputString</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newInputString</span>



<span class="c1"># def __getDistOutput(inputFile,distance=20.0):</span>
<span class="c1">#     &#39;&#39;&#39;</span>
    

<span class="c1">#     Arguments:</span>


<span class="c1">#     Keyword Arguments:</span>


<span class="c1">#     Returns:</span>


<span class="c1">#     &#39;&#39;&#39;</span>

<span class="c1">#     pass</span>


<span class="k">def</span> <span class="nf">__getPath</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">points</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get path between HSP</span>

<span class="sd">    Arguments:</span>
<span class="sd">          dk (float): distance between points </span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">       </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>
<span class="sd">          points (bool): Give the path as points or in aflow convention</span>

<span class="sd">    Returns:</span>
<span class="sd">          numPointStr (str): path between HSP</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">kdistance</span><span class="p">(</span><span class="n">hs</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">hs</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">hs</span><span class="p">)</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span>
        <span class="n">dist2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dist2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getSegments</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">segments</span>

    <span class="k">def</span> <span class="nf">getPoints</span><span class="p">(</span><span class="n">pathSegment</span><span class="p">):</span>
        <span class="n">pointsList</span> <span class="o">=</span> <span class="n">pathSegment</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pointsList</span>
    <span class="k">def</span> <span class="nf">getNumPoints</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">list1</span> <span class="o">=</span> <span class="n">getSegments</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">numPts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="p">(</span><span class="n">list1</span><span class="p">):</span>
            <span class="n">numPts</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">getPoints</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">numPts</span>

    <span class="n">ibrav</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ibravRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;ibrav[\s]*=[\s]*([\d]+)\s*[,</span><span class="se">\n</span><span class="s1">]*&#39;</span><span class="p">)</span>
    <span class="n">ibrav</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ibravRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>	

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;Lattice type </span><span class="si">%s</span><span class="s1"> is not implemented&#39;</span> <span class="o">%</span> <span class="n">ibrav</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;The ibrav value from expresso has not yet been implemented to the framework&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span>

    <span class="n">alat</span><span class="p">,</span><span class="n">cell</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>



    <span class="n">totalK</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span> <span class="o">=</span> <span class="n">__getHighSymPoints</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="o">=</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">hs</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>  <span class="c1"># reciprocal lattice</span>
    <span class="n">segs</span> <span class="o">=</span> <span class="n">getSegments</span><span class="p">(</span><span class="n">band_path</span><span class="p">)</span>

    <span class="n">numPointsStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">getNumPoints</span><span class="p">(</span><span class="n">band_path</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="c1">#starts the string we need to make</span>
    <span class="k">if</span> <span class="n">points</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">numPointsStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    <span class="n">path_points</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">segs</span><span class="p">:</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">getPoints</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="c1">#gets the points in each segment of path spereated by |            </span>
        <span class="n">point1</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">point2</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">index2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">point1</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">index2</span><span class="p">]</span>
                <span class="n">point2</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">index2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">special_points</span><span class="p">[</span><span class="n">point1</span><span class="p">]</span> 
                <span class="n">p2</span> <span class="o">=</span> <span class="n">special_points</span><span class="p">[</span><span class="n">point2</span><span class="p">]</span>

                <span class="n">newDK</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">alat</span><span class="p">)</span><span class="o">*</span><span class="n">dk</span>
                <span class="n">numK</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">kdistance</span><span class="p">(</span><span class="n">hs</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span><span class="o">/</span><span class="n">newDK</span><span class="p">)))</span>
                <span class="n">totalK</span><span class="o">+=</span><span class="n">numK</span>

                <span class="n">numK</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numK</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">points</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                    <span class="n">a0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">numK</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
                    <span class="n">a1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">numK</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
                    <span class="n">a2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">numK</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>



                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a0</span><span class="p">)):</span>
                        <span class="n">lbl</span><span class="o">=</span><span class="n">point1</span>
                        <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">numK</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                            <span class="n">lbl</span><span class="o">=</span><span class="n">point2</span>
                        <span class="n">numPointsStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%8.7f</span><span class="s1"> </span><span class="si">%8.7f</span><span class="s1"> </span><span class="si">%8.7f</span><span class="s1"> !! </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">a0</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">a1</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">a2</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">lbl</span><span class="p">)</span>



                <span class="k">else</span><span class="p">:</span>
                    <span class="n">numPointsStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">point1</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">numK</span><span class="p">)</span> 
                    <span class="k">if</span><span class="p">(</span><span class="n">index2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
                        <span class="n">numPointsStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">point2</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>     

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">e</span>
    <span class="k">if</span> <span class="n">points</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>

        <span class="n">numPointsStr</span><span class="o">=</span><span class="n">numPointsStr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;!!&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%5.4f</span><span class="s1"> !!&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">totalK</span><span class="p">)))</span>
        <span class="n">numPointsStr</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">totalK</span><span class="o">+</span><span class="n">numPointsStr</span>
    <span class="k">return</span> <span class="n">numPointsStr</span>


<span class="k">def</span> <span class="nf">__joinMatrixLabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">matrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Joins a list of the atomic position species labels with a list or array of their atomic positions</span>

<span class="sd">    Arguments:</span>
<span class="sd">          labels (list): list or array of the atomic positions species labels</span>
<span class="sd">          matrix (numpy.matrix): the positions in matrix, array, or list form</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          outString (str): a string of the atomic positions joined with their species labels</span>

<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">matrixString</span> <span class="o">=</span> <span class="n">__cellMatrixToString</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

    <span class="n">outString</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">matrixString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))])</span>
    <span class="k">return</span> <span class="n">outString</span>

<span class="k">def</span> <span class="nf">__orderSplitInput</span><span class="p">(</span><span class="n">inputCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Order tokenized input as QE needs it</span>

<span class="sd">    Arguments:</span>
<span class="sd">          inputCalc (calc): tokenized QE pwscf input</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          newOrderedDict (dict): the ordered tokenized QE pwscf input</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">newOrderedDict</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">inputOrder</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&amp;control&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;electrons&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;ions&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;cell&#39;</span><span class="p">,</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">,</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">,</span><span class="s1">&#39;K_POINTS&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">inputOrder</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">inputCalc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">newOrderedDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">item</span><span class="p">:</span><span class="n">inputCalc</span><span class="p">[</span><span class="n">item</span><span class="p">]})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newOrderedDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">item</span><span class="p">:</span><span class="n">OrderedDict</span><span class="p">()})</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputCalc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inputOrder</span><span class="p">:</span>
            <span class="n">newOrderedDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span><span class="n">inputCalc</span><span class="p">[</span><span class="n">key</span><span class="p">]})</span>

    <span class="k">return</span> <span class="n">newOrderedDict</span>

<span class="k">def</span> <span class="nf">__splitInput</span><span class="p">(</span><span class="n">inFileString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Tokenizes the QE pwscf input file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          inFileString (str): string of a QE pwscf input file</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          inputDict (dict): the tokenized input</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">inputDict</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">nameListRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;\s*(&amp;[A-Za-z]+)|(?:\s*(\S*?)\s*=\s*(\S+?)(?:(?:\s*\,\s*)|(?:\s*\n)))&#39;</span><span class="p">)</span>
    <span class="n">namelist</span> <span class="o">=</span> <span class="n">nameListRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">namelist</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">namelist</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">lastOne</span> <span class="o">=</span> <span class="n">namelist</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="n">lastOne</span><span class="p">]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>                    
                <span class="k">if</span> <span class="n">lastOne</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inputDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">inputDict</span><span class="p">[</span><span class="n">lastOne</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
                <span class="n">inputDict</span><span class="p">[</span><span class="n">lastOne</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="n">namelist</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">=</span><span class="n">namelist</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


    <span class="n">atomicSpecRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;ATOMIC_SPECIES\s*\n((?:(?:\s*[A-Za-z0-9]+)\s+(?:[0-9.]+)\s+(?:.+)\n*)+)(?=(?:[A-Z_\s]+\n)|)&#39;</span><span class="p">,(</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">atomicSpecRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>



    <span class="n">modifier_regex</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;modifier&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modifier_regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)):</span>

        <span class="n">paramUnits</span><span class="o">=</span><span class="n">modifier_regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paramUnits</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="n">paramUnits</span> <span class="o">=</span> <span class="n">paramUnits</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paramUnits</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="n">paramUnits</span> <span class="o">=</span> <span class="n">paramUnits</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paramUnits</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="n">paramUnits</span> <span class="o">=</span> <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">paramUnits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paramUnits</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">paramUnits</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    <span class="n">coordRegex</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">inFileString</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">coordRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">coords</span>
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">paramUnits</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">cellParamRegex</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">cell_parameters</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">unitsRegex</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">cell_parameters</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;modifier&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)):</span>
            <span class="n">paramUnits</span><span class="o">=</span><span class="n">unitsRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">paramUnits</span> <span class="o">=</span> <span class="n">paramUnits</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paramUnits</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
                <span class="n">paramUnits</span> <span class="o">=</span> <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">paramUnits</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">paramUnits</span><span class="o">=</span><span class="s1">&#39;&#39;</span>


        <span class="n">cellParams</span> <span class="o">=</span> <span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cellParams</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">cellParams</span><span class="o">=</span><span class="n">cellParams</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cellParams</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">paramUnits</span>



    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">kpoints</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">k_points</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>            
            <span class="n">modifier</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">k_points</span><span class="p">(</span><span class="n">inFileString</span><span class="p">,</span><span class="s1">&#39;modifier&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modifier</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
                <span class="n">modifier</span> <span class="o">=</span> <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">modifier</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">modifier</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

            <span class="n">kpointInput</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">kpoints</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;K_POINTS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;K_POINTS&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">modifier</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;K_POINTS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kpoints</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="n">modifier</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">print</span> <span class="n">e</span>


    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">inputDict</span>


<div class="viewcode-block" id="getBravaisLatticeName"><a class="viewcode-back" href="../retr.html#retr.getBravaisLatticeName">[docs]</a><span class="k">def</span> <span class="nf">getBravaisLatticeName</span><span class="p">(</span><span class="n">bravaisLatticeNumber</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the name of the crystal system from the bravias lattice number</span>

<span class="sd">    Arguments:</span>
<span class="sd">          braviasLatticeNumber (int): the number of the bravais lattice in QE convention</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          A string of the name of the crystal system</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;cubic&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;rhombohedral&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;hexagonal&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;tetragonal&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;orthorhombic&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;triclinic&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not a valid bravais lattice number&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;Not a valid bravais lattice number&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

</div>
<div class="viewcode-block" id="pw2cif"><a class="viewcode-back" href="../retr.html#retr.pw2cif">[docs]</a><span class="k">def</span> <span class="nf">pw2cif</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">inpt</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">outp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">outputFolder</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">filePrefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Writes a simple CIF file for engine input and outputs for viewing the structure</span>

<span class="sd">    Arguments:</span>
<span class="sd">	  calcs (dict): dictionary of dictionaries of calculations</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          inpt (bool): Do CIF for input</span>
<span class="sd">          outp (bool): Do CIF for output</span>
<span class="sd">          outputFolder (str): Output directory for the CIF</span>
<span class="sd">          filePrefix (str): Optional prefix to the CIF filenames</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>        
    <span class="k">if</span> <span class="n">inpt</span><span class="o">==</span><span class="bp">True</span> <span class="ow">and</span> <span class="n">outp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">inpt_or_outp</span><span class="o">=</span><span class="s2">&quot;&#39;both&#39;&quot;</span>
    <span class="k">elif</span> <span class="n">inpt</span><span class="o">==</span><span class="bp">True</span> <span class="ow">and</span> <span class="n">output</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="n">inpt_or_outp</span><span class="o">=</span><span class="s2">&quot;&#39;False&#39;&quot;</span>
    <span class="k">elif</span> <span class="n">inpt</span><span class="o">==</span><span class="bp">False</span> <span class="ow">and</span> <span class="n">output</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">inpt_or_outp</span><span class="o">=</span><span class="s2">&quot;&#39;output&#39;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inpt_or_outp</span><span class="o">=</span><span class="s1">&#39;&quot;&quot;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">runlocal</span><span class="p">:</span>
                <span class="n">inOrOut</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="n">inpt_or_outp</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__pw2cif</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">inOrOut</span><span class="o">=</span><span class="n">inOrOut</span><span class="p">,</span><span class="n">outputFolder</span><span class="o">=</span><span class="n">outputFolder</span><span class="p">,</span><span class="n">filePrefix</span><span class="o">=</span><span class="n">filePrefix</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inOrOut</span><span class="o">=</span><span class="n">inpt_or_outp</span>
                <span class="k">if</span> <span class="n">outputFolder</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>

                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;RUN&#39;</span><span class="p">,</span><span class="s1">&#39;AFLOWpi.retr.__pw2cif(oneCalc,ID,inOrOut=</span><span class="si">%s</span><span class="s1">,outputFolder=None,filePrefix=&quot;</span><span class="si">%s</span><span class="s1">&quot;)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">inOrOut</span><span class="p">,</span><span class="n">filePrefix</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;RUN&#39;</span><span class="p">,</span><span class="s1">&#39;AFLOWpi.retr.__pw2cif(oneCalc,ID,inOrOut=</span><span class="si">%s</span><span class="s1">,outputFolder=&quot;</span><span class="si">%s</span><span class="s1">&quot;,filePrefix=&quot;</span><span class="si">%s</span><span class="s1">&quot;)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">inOrOut</span><span class="p">,</span><span class="n">outputFolder</span><span class="p">,</span><span class="n">filePrefix</span><span class="p">))</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">__pw2cif</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">inOrOut</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="n">outputFolder</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">filePrefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generates the CIF from input or output of single calculation at that step</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step         </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          inOrOut (str): which structs to do CIF for.. &#39;input&#39; &#39;output&#39; or &#39;both&#39;</span>
<span class="sd">          outputFolder (str): Output directory for the CIF</span>
<span class="sd">          filePrefix (str): Optional prefix to the CIF filenames</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">def</span> <span class="nf">atomPosPretty</span><span class="p">(</span><span class="n">atomicPositionString</span><span class="p">,</span><span class="n">ibrav</span><span class="p">):</span>
            
            <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">atomPosSortList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">splitAtomicPos</span> <span class="o">=</span> <span class="n">atomicPositionString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>                
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>


            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">splitAtomicPos</span><span class="p">:</span>
                
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">atomSplit</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">formattedAtomPos</span> <span class="o">=</span> <span class="n">atomSplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%14.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">atomSplit</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">atomSplit</span><span class="p">))])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">atomPosSortList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formattedAtomPos</span><span class="p">)</span>


            <span class="n">atomPosSortCifList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">atomPosSortCifListSecond</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">countDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">atomPosSortList</span><span class="p">:</span>
                <span class="n">splitItem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">firstItem</span> <span class="o">=</span> <span class="n">splitItem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">firstItem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">countDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span><span class="o">=</span><span class="n">count</span>

            <span class="n">countDictOrig</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">countDict</span><span class="p">)</span>
            <span class="n">origDictSecond</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">countDict</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">item1</span> <span class="ow">in</span> <span class="n">atomPosSortList</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">splitItem</span> <span class="o">=</span> <span class="n">item1</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">firstItem</span> <span class="o">=</span> <span class="n">splitItem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    
                    <span class="n">secondItem</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">firstItem</span><span class="p">,</span><span class="n">countDictOrig</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span><span class="o">-</span><span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

                    

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">entry</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> 1.0 </span><span class="si">%04f</span><span class="s1"> </span><span class="si">%04f</span><span class="s1"> </span><span class="si">%04f</span><span class="s1"> Biso 1.0 </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">secondItem</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">splitItem</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">splitItem</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">splitItem</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="n">firstItem</span><span class="p">)</span>
                        <span class="n">atomPosSortCifList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

                    
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                decriment the counter for the atom in question</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span> <span class="o">=</span> <span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>                

<span class="c1">########################################################################################</span>
<span class="c1">########################################################################################</span>
<span class="c1">########################################################################################</span>
            <span class="n">loopblock</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;loop_</span>
<span class="s2">      _atom_site_label</span>
<span class="s2">      _atom_site_occupancy</span>
<span class="s2">      _atom_site_fract_x</span>
<span class="s2">      _atom_site_fract_y</span>
<span class="s2">      _atom_site_fract_z</span>
<span class="s2">      _atom_site_thermal_displace_type</span>
<span class="s2">      _atom_site_B_iso_or_equiv</span>
<span class="s2">      _atom_site_type_symbol</span>
<span class="s2">&quot;&quot;&quot;</span>
            
            <span class="n">outputString</span> <span class="o">=</span> <span class="n">loopblock</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">atomPosSortCifList</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">outputString</span>

    <span class="k">if</span> <span class="n">inOrOut</span> <span class="o">!=</span> <span class="s1">&#39;input&#39;</span> <span class="ow">and</span> <span class="n">inOrOut</span> <span class="o">!=</span> <span class="s1">&#39;output&#39;</span> <span class="ow">and</span> <span class="n">inOrOut</span> <span class="o">!=</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="k">print</span> <span class="s2">&quot;options for variable &#39;inOrOut&#39; must be &#39;in&#39;,&#39;out&#39;,or &#39;both&#39;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;options for variable &#39;inOrOut&#39; must be &#39;in&#39;,&#39;out&#39;,or &#39;both&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">filePrefix</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">filePrefix</span><span class="o">=</span><span class="n">filePrefix</span><span class="o">+</span><span class="s1">&#39;_&#39;</span>
    <span class="n">input_suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">cif_suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">cif_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    <span class="n">cif_prefix</span><span class="o">=</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span>
    <span class="n">outFileString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">inputFileString</span>  <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>
    
    <span class="n">ibravRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;ibrav[\s]*=[\s]*([\d]+)\s*[,</span><span class="se">\n</span><span class="s1">]*&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inOrOut</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;input&#39;</span> <span class="ow">or</span> <span class="n">inOrOut</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;both&#39;</span><span class="p">:</span>

        <span class="n">labels</span><span class="p">,</span><span class="n">atomicPositions</span><span class="p">,</span><span class="n">cellParamVec</span> <span class="o">=</span> <span class="n">__getConventionalCellFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

        <span class="n">input_suffix</span><span class="o">=</span><span class="s1">&#39;.in&#39;</span>
        <span class="n">cif_suffix</span><span class="o">=</span><span class="s1">&#39;.in.cif&#39;</span>
        

        <span class="n">inputDict</span> <span class="o">=</span> <span class="n">__splitInput</span><span class="p">(</span><span class="n">inputFileString</span><span class="p">)</span>
        <span class="n">ibravRegex</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;ibrav\s*=\s*([0-9]{1,2})&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ibravOrig</span><span class="o">=</span> <span class="n">ibravRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inputFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ibravOrig</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>

                <span class="n">labels</span><span class="p">,</span><span class="n">atomicPositions</span><span class="p">,</span><span class="n">cellParamVec</span> <span class="o">=</span> <span class="n">__rho2hex</span><span class="p">(</span><span class="n">cellParamVec</span><span class="p">,</span><span class="n">atomicPositions</span><span class="p">,</span><span class="n">labels</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span>  <span class="n">free2abc</span><span class="p">(</span><span class="n">cellParamVec</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">degrees</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="bp">False</span><span class="p">,)</span>
        
        <span class="n">outFileString</span><span class="o">+=</span><span class="s2">&quot;&quot;&quot;data_global</span>
<span class="s2">_chemical_name &#39;</span><span class="si">%s</span><span class="s2">&#39;</span>

<span class="s2">_cell_length_a </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_length_b </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_length_c </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_alpha </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_beta </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_gamma </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cif_prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">)</span>

        <span class="n">atomicPositions</span> <span class="o">=</span> <span class="n">__cellMatrixToString</span><span class="p">(</span><span class="n">atomicPositions</span><span class="p">)</span>
        <span class="n">atomicPositions</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">atomicPositions</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))])</span>        
        <span class="n">outFileString</span> <span class="o">+=</span> <span class="n">atomPosPretty</span><span class="p">(</span><span class="n">atomicPositions</span><span class="p">,</span><span class="n">ibravOrig</span><span class="p">)</span>
        <span class="n">outFileString</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">outputFolder</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outputFolder</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputFolder</span><span class="p">,</span><span class="n">filePrefix</span><span class="o">+</span><span class="s1">&#39;STRUCT_&#39;</span><span class="o">+</span><span class="n">cif_prefix</span><span class="o">+</span><span class="n">ID</span><span class="o">+</span><span class="n">cif_suffix</span><span class="p">),</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inOrOut</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;output&#39;</span> <span class="ow">or</span> <span class="n">inOrOut</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">input_suffix</span><span class="o">=</span><span class="s1">&#39;.out&#39;</span>
        <span class="n">cif_suffix</span><span class="o">=</span><span class="s1">&#39;.out.cif&#39;</span>
        <span class="n">inputDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">outFileString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>




        <span class="k">try</span><span class="p">:</span>

            <span class="n">labels</span><span class="p">,</span><span class="n">positions</span><span class="p">,</span><span class="n">cell</span> <span class="o">=</span> <span class="n">__getConventionalCellFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

            

            <span class="n">ibrav</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>        
            <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span>
            <span class="n">positions</span><span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>

            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFileObj</span><span class="p">:</span>
                     <span class="n">exceptionInputFileString</span>  <span class="o">=</span> <span class="n">inFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>



            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;Error finding ATOMIC_POSITIONS from output&quot;</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error finding ATOMIC_POSITIONS from output&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        
        <span class="n">cellParamVec</span> <span class="o">=</span> <span class="n">__getCellOutDim</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>


        <span class="n">a</span> <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
        <span class="n">b</span>  <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
        <span class="n">c</span>  <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
        <span class="n">alpha</span>  <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span>

        <span class="n">gamma</span> <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span>  <span class="n">free2abc</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">degrees</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="bp">False</span><span class="p">,)</span>        



        <span class="n">outFileString</span><span class="o">+=</span><span class="s2">&quot;&quot;&quot;data_global</span>
<span class="s2">_chemical_name &#39;</span><span class="si">%s</span><span class="s2">&#39;</span>
<span class="s2">_cell_length_a </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_length_b </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_length_c </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_alpha </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_beta </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_gamma </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cif_prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">)</span>
        
        <span class="n">positions</span><span class="o">=</span> <span class="n">__joinMatrixLabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">positions</span><span class="p">)</span>


        <span class="n">outFileString</span> <span class="o">+=</span> <span class="n">atomPosPretty</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">ibrav</span><span class="p">)</span>
        <span class="n">outFileString</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">outputFolder</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">outputFolder</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>
        <span class="n">joiner</span> <span class="o">=</span> <span class="n">filePrefix</span><span class="o">+</span><span class="s1">&#39;STRUCT_&#39;</span><span class="o">+</span><span class="n">cif_prefix</span><span class="o">+</span><span class="n">ID</span><span class="o">+</span><span class="n">cif_suffix</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputFolder</span><span class="p">,</span><span class="n">joiner</span><span class="p">),</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>



<div class="viewcode-block" id="celldm2params"><a class="viewcode-back" href="../retr.html#retr.celldm2params">[docs]</a><span class="k">def</span> <span class="nf">celldm2params</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;Marked for removal&gt;</span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="sd">&#39;&#39;&#39;not sure what this is. probably is not needed anymore much and should be removed&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*1.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*2.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">b</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*3.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">c</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*4.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*5.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">beta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*6.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>



    <span class="n">a</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">b</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">c</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">alpha</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">beta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span>

</div>
<div class="viewcode-block" id="inputDict2params"><a class="viewcode-back" href="../retr.html#retr.inputDict2params">[docs]</a><span class="k">def</span> <span class="nf">inputDict2params</span><span class="p">(</span><span class="n">inputDict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">inputDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>

        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;ibrav&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
            <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">inputDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">celldm2params</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> 
        <span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> 
        <span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">120.0</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">120.0</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="o">-</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>                    
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>


    <span class="n">a</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">b</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">c</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">alpha</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">beta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span>
</div>
<span class="k">def</span> <span class="nf">__getCellOutDim</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the cell parameters a,b,c,alpha,beta,gamma of the primitive lattice from the output.</span>
<span class="sd">    If the primitive lattice does not change during the calculation it takes it from the input</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step         </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">         out_params (dict): dictionary of a,b,c,alpha,beta,gamma of the primitive lattice from the output</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">ibravRegex</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;ibrav\s*=\s*([0-9]{1,2})&#39;</span><span class="p">)</span>
    <span class="n">inputFileString</span>  <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ibravOrig</span><span class="o">=</span> <span class="n">ibravRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inputFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFileObj</span><span class="p">:</span>
        <span class="n">inFileString</span>  <span class="o">=</span> <span class="n">inFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">cellParamRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(?:CELL_PARAMETERS)\s*\(alat\s*=\s*[0-9.]*\)\n([.0-9\s-]*)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="n">splitParams</span> <span class="o">=</span>  <span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cellParamRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;crystal axes: \(cart. coord. in units of alat\)\n\s*a\(1\)\s*=\s*\(\s*([0-9.\s]*)\)\s*\n\s*a\(2\)\s*=\s*\(\s*([0-9.\s]*)\)\s*\n\s*a\(3\)\s*=\s*\(\s*([0-9.\s]*)\)\s*\n&#39;</span><span class="p">)</span>
            <span class="n">splitParams</span> <span class="o">=</span>  <span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="n">alat</span><span class="p">,</span><span class="n">cellOld</span> <span class="o">=</span> <span class="n">__getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

    <span class="n">paramList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">alat</span><span class="p">,</span><span class="n">cellParaMatrix</span><span class="o">=</span><span class="n">__getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">cellParaMatrix</span><span class="o">*=</span><span class="n">alat</span>

    <span class="n">alatRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(?:CELL_PARAMETERS)\s*\(alat\s*=\s*([0-9.]*)\)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

    <span class="n">splitInput</span>  <span class="o">=</span> <span class="n">__splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>

    <span class="n">string</span><span class="o">=</span> <span class="n">free2abc</span><span class="p">(</span><span class="n">cellParaMatrix</span><span class="p">)</span>
    <span class="n">cellParams</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cellParams</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">cellParams</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.0000000001</span><span class="p">:</span>
            <span class="n">cellParams</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>




    <span class="n">ibravOrig</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;ibrav&#39;</span><span class="p">])</span>


    <span class="n">celldmDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">celldmDict</span><span class="p">[</span><span class="s1">&#39;ibrav&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ibravOrig</span>

    <span class="n">out_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;beta&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;gamma&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">5</span><span class="p">]}</span>
    <span class="k">return</span> <span class="n">out_params</span>

<span class="k">def</span> <span class="nf">__getInputParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the cell parameters a,b,c,alpha,beta,gamma of the primitive lattice from the input.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step         </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">         out_params (dict): dictionary of a,b,c,alpha,beta,gamma of the primitive lattice from the input</span>

<span class="sd">    &#39;&#39;&#39;</span>        
        

    <span class="n">inputFileString</span>  <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>

    <span class="n">inputDict</span> <span class="o">=</span> <span class="n">__splitInput</span><span class="p">(</span><span class="n">inputFileString</span><span class="p">)[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;celldm&#39;</span><span class="p">,</span><span class="n">key</span><span class="p">):</span> 
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;ibrav&#39;</span><span class="p">,</span><span class="n">key</span><span class="p">):</span> 
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">inputDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">inputDict2params</span><span class="p">(</span><span class="n">inputDict</span><span class="p">)</span>

    <span class="n">BohrToAngstrom</span> <span class="o">=</span> <span class="mf">0.529177249</span>
    <span class="n">a</span><span class="o">*=</span> <span class="n">BohrToAngstrom</span>
    <span class="n">b</span><span class="o">*=</span> <span class="n">BohrToAngstrom</span>
    <span class="n">c</span><span class="o">*=</span> <span class="n">BohrToAngstrom</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span><span class="s1">&#39;beta&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span><span class="s1">&#39;gamma&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)}</span>

<div class="viewcode-block" id="celldm2free"><a class="viewcode-back" href="../retr.html#retr.celldm2free">[docs]</a><span class="k">def</span> <span class="nf">celldm2free</span><span class="p">(</span><span class="n">ibrav</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm3</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm4</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm5</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm6</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">returnString</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts  QE&#39;s celldm format into QE convention primitive lattice vectors </span>

<span class="sd">    Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">           ibrav (int): bravais lattice type by QE convention</span>
<span class="sd">           celldm1 (float): a</span>
<span class="sd">           celldm2 (float): b/a</span>
<span class="sd">           celldm3 (float): c/a</span>
<span class="sd">           celldm4 (float): Cosine of the angle between axis b and c</span>
<span class="sd">           celldm5 (float): Cosine of the angle between axis a and c</span>
<span class="sd">           celldm6 (float): Cosine of the angle between axis a and b</span>
<span class="sd">           returnString (bool): return vectors as a string or as a numpy matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">         Either a numpy.matrix or a string of the primitive lattice vectors generated from the celldm input</span>

<span class="sd">    &#39;&#39;&#39;</span>        


    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">14</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ibrav = </span><span class="si">%s</span><span class="s1"> not a valid option&#39;</span> <span class="o">%</span> <span class="n">ibrav</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;ibrav = </span><span class="si">%s</span><span class="s1"> not a valid option&#39;</span> <span class="o">%</span> <span class="n">ibrav</span>

    <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span>




    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">celldm1</span><span class="p">,</span><span class="mi">0</span>      <span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                               <span class="p">(</span><span class="mi">0</span>      <span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                               <span class="p">(</span><span class="mi">0</span>     <span class="p">,</span><span class="mi">0</span>       <span class="p">,</span><span class="n">celldm1</span><span class="p">)))</span>
    

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="o">-</span><span class="n">celldm1</span>  <span class="p">,</span><span class="mi">0</span>      <span class="p">,</span><span class="n">celldm1</span><span class="p">),</span>
                               <span class="p">(</span> <span class="mi">0</span>        <span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="n">celldm1</span><span class="p">),</span>
                               <span class="p">(</span><span class="o">-</span><span class="n">celldm1</span>  <span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="mi">0</span>      <span class="p">)))</span><span class="o">/</span><span class="mf">2.0</span>
        
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span> <span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm1</span><span class="p">),</span>
                               <span class="p">(</span><span class="o">-</span><span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm1</span><span class="p">),</span>
                               <span class="p">(</span><span class="o">-</span><span class="n">celldm1</span><span class="p">,</span><span class="o">-</span><span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm1</span><span class="p">)))</span><span class="o">/</span><span class="mf">2.0</span>
        
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="mi">1</span>        <span class="p">,</span><span class="mi">0</span>               <span class="p">,</span> <span class="mi">0</span>      <span class="p">),</span>
                               <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span>     <span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">,</span> <span class="mi">0</span>      <span class="p">),</span>
                               <span class="p">(</span><span class="mi">0</span>        <span class="p">,</span><span class="mi">0</span>               <span class="p">,</span> <span class="n">celldm3</span><span class="p">)))</span><span class="o">*</span><span class="n">celldm1</span>


    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">c</span><span class="o">=</span><span class="n">celldm4</span>
        <span class="n">tx</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ty</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">tz</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">matrix</span> <span class="o">=</span> <span class="n">celldm1</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">tx</span>  <span class="p">,</span><span class="o">-</span><span class="n">ty</span>  <span class="p">,</span> <span class="n">tz</span><span class="p">),</span>
                                       <span class="p">(</span><span class="mi">0</span>   <span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">ty</span><span class="p">,</span> <span class="n">tz</span><span class="p">),</span>
                                       <span class="p">(</span><span class="o">-</span><span class="n">tx</span> <span class="p">,</span><span class="o">-</span><span class="n">ty</span>  <span class="p">,</span> <span class="n">tz</span><span class="p">)))</span>

                    
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==-</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">c</span><span class="o">=</span><span class="n">celldm4</span>
        <span class="n">tx</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ty</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">tz</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">tz</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">tz</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">celldm1</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
                                                     <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">celldm1</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">celldm3</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">((</span>
                <span class="p">(</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">celldm3</span><span class="p">),</span>
                <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">celldm3</span><span class="p">),</span>
                <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">celldm3</span><span class="p">),</span>
                <span class="p">))</span>
        <span class="n">matrix</span><span class="o">*=</span><span class="n">celldm1</span><span class="o">/</span><span class="mf">2.0</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">8</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">celldm1</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span>     <span class="p">,</span> <span class="mf">0.0</span>    <span class="p">,),</span>
                                       <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">celldm2</span> <span class="p">,</span> <span class="mf">0.0</span>    <span class="p">,),</span>
                                       <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>     <span class="p">,</span> <span class="n">celldm3</span><span class="p">,)))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">a</span><span class="o">=</span><span class="n">celldm1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">b</span><span class="o">=</span><span class="n">celldm2</span><span class="o">*</span><span class="n">celldm1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">c</span><span class="o">=</span><span class="n">celldm3</span><span class="o">*</span><span class="n">celldm1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span> <span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="n">c</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==-</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="n">c</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">a</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="n">c</span>  <span class="p">),</span>
                               <span class="p">(</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="mi">0</span>  <span class="p">),</span>  
                               <span class="p">(</span><span class="mi">0</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">c</span>  <span class="p">)))</span><span class="o">/</span><span class="mf">2.0</span>




    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span> <span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> 
                             <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> 
                             <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">12</span><span class="p">:</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm4</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">a</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">),</span>
                               <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span><span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span>
                               <span class="p">(</span><span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>           <span class="n">c</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==-</span><span class="mi">12</span><span class="p">:</span>
        <span class="n">beta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm5</span><span class="p">)</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">))))</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">13</span><span class="p">:</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm4</span><span class="p">)</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>                <span class="mi">0</span><span class="p">,</span>                <span class="o">-</span><span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>                <span class="mi">0</span><span class="p">,</span>                 <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">14</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm4</span><span class="p">)</span>
        <span class="n">beta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm5</span><span class="p">)</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm6</span><span class="p">)</span>

        <span class="n">twoone</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">))</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">insert</span> <span class="o">=</span>  <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">celldm4</span><span class="o">*</span><span class="n">celldm5</span><span class="o">*</span><span class="n">celldm6</span><span class="o">-</span><span class="n">celldm4</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">celldm5</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">celldm6</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">twotwo</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>

        <span class="n">matrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">a</span><span class="p">,</span>                  <span class="mi">0</span><span class="p">,</span>                  <span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span>  <span class="n">twoone</span><span class="p">,</span>             <span class="n">twotwo</span><span class="p">)))</span>


    <span class="k">if</span> <span class="n">returnString</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">vecString</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;{:^6.10f} {:^6.10f} {:^6.10f}</span>
<span class="s1">{:6^.10f} {:6^.10f} {:6^.10f}</span>
<span class="s1">{:6^.10f} {:6^.10f} {:6^.10f}</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">vecString</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">matrix</span>
</div>
<span class="k">def</span> <span class="nf">__pw2aflowConvention</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;CONSIDER FOR REMOVAL&gt;</span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="sd">&#39;&#39;&#39;transform the positions first with the pre-transformed vectors&#39;&#39;&#39;</span>
    <span class="n">newSymMatrix</span>       <span class="o">=</span> <span class="n">__pw2aflowPositions</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;now get the transformed cell vectors&#39;&#39;&#39;</span>
    <span class="n">newCellParamMatrix</span> <span class="o">=</span> <span class="n">__pw2aflowConventionVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">newCellParamMatrix</span><span class="p">,</span><span class="n">newSymMatrix</span>

<span class="k">def</span> <span class="nf">__pw2aflowConventionVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;CONSIDER FOR REMOVAL&gt;</span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">returnMatrix</span><span class="o">*=</span> <span class="mf">0.529177249</span>
    <span class="n">temp</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="n">lengths</span> <span class="o">=</span> <span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">0</span><span class="p">),(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">1</span><span class="p">),(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>

    <span class="n">tempIndex</span><span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]</span>

    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">returnMatrix</span>



<span class="k">def</span> <span class="nf">__pw2aflowPositions</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;CONSIDER FOR REMOVAL&gt;    </span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        


    <span class="n">cellMatrix</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">cellMatrix</span><span class="o">*=</span> <span class="mf">0.529177249</span>

    <span class="n">temp</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">tempPos</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="n">lengths</span> <span class="o">=</span> <span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">0</span><span class="p">),(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">1</span><span class="p">),(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>

    <span class="n">tempIndex</span><span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]</span>
    <span class="sd">&#39;&#39;&#39;transpose so we can switch the vertical vectors easier&#39;&#39;&#39;</span>
    <span class="n">transposedPositions</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">T</span>
    <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">transposedPositions</span><span class="p">)</span>

    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">transposedPositions</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">transposedPositions</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">transposedPositions</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        
    <span class="sd">&#39;&#39;&#39;transpose the positions again so they&#39;re back to normal&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">returnMatrix</span><span class="o">.</span><span class="n">T</span>


<span class="k">def</span> <span class="nf">__free2celldm</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">primitive</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert lattice vectors to celldm</span>

<span class="sd">    Arguments:</span>
<span class="sd">          cellparamatrix (numpy.matrix): matrix of cell vectors</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          ibrav (int): Overrides the bravais lattice automatically detected </span>
<span class="sd">                       (must be in QE convention if primitive)</span>
<span class="sd">          primitive (bool): If True it will treat cellparamatrix as primitive lattice vectors</span>

<span class="sd">    Returns:</span>
<span class="sd">         paramDict (dict): dictionary of the celldm generated by the input matrix</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">splitString</span><span class="o">=</span>  <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">free2ibrav</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">,</span><span class="n">primitive</span><span class="o">=</span><span class="n">primitive</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
    <span class="n">paramDict</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">splitString</span><span class="p">:</span>
        <span class="n">paramDict</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; ,&#39;</span><span class="p">)</span>
        
    <span class="n">newParamDict</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s1">&#39;ibrav&#39;</span><span class="p">:</span>
            <span class="n">newParamDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newParamDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">paramDict</span>

<div class="viewcode-block" id="free2ibrav"><a class="viewcode-back" href="../retr.html#retr.free2ibrav">[docs]</a><span class="k">def</span> <span class="nf">free2ibrav</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">primitive</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert lattice vectors to celldm</span>

<span class="sd">    Arguments:</span>
<span class="sd">          cellparamatrix (numpy.matrix): matrix of cell vectors</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          ibrav (int): Overrides the bravais lattice automatically detected </span>
<span class="sd">                       (must be in QE convention if primitive)</span>
<span class="sd">          primitive (bool): If True it will treat cellparamatrix as primitive lattice vectors</span>

<span class="sd">    Returns:</span>
<span class="sd">         ibravStr (str): string of the celldm used for QE pwscf input</span>

<span class="sd">    &#39;&#39;&#39;</span>        
    
    <span class="k">if</span> <span class="n">primitive</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">cellParamMatrixConv</span> <span class="o">=</span> <span class="n">__prim2ConvVec</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">)</span>        

    <span class="k">else</span><span class="p">:</span>
        <span class="n">cellParamMatrixConv</span> <span class="o">=</span> <span class="n">cellparamatrix</span>



    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">ibrav</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">))</span>

    <span class="n">conv</span><span class="o">=</span><span class="n">cellParamMatrixConv</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span><span class="o">*</span><span class="mf">0.529177249</span>
    
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">try</span><span class="p">:</span>

        

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="n">cellParamMatrixConv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="n">celldm_1</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">celldm_2</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">a</span>
    <span class="n">celldm_3</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="n">a</span>

    <span class="n">celldm_4</span> <span class="o">=</span> <span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">celldm_5</span> <span class="o">=</span> <span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">celldm_6</span> <span class="o">=</span> <span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>


    <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">celldm_1</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_1</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm_2</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_2</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm_3</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_3</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm_4</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_4</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm_5</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_5</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm_6</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_6</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
            <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(4)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_4</span><span class="p">)</span> 


        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==-</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span><span class="mi">10</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
            <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_2</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="s2">, celldm(4)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_2</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">,</span> <span class="n">celldm_4</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="o">-</span><span class="mi">12</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="s2">, celldm(5)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_2</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">,</span> <span class="n">celldm_5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="s2">, celldm(4)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_2</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">,</span> <span class="n">celldm_4</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">14</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="s2">, celldm(4)=</span><span class="si">%f</span><span class="s2"> celldm(5)=</span><span class="si">%f</span><span class="s2"> celldm(6)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_2</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">,</span> <span class="n">celldm_4</span><span class="p">,</span> <span class="n">celldm_5</span><span class="p">,</span> <span class="n">celldm_6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ibrav </span><span class="si">%s</span><span class="s1"> is not a valid option.&#39;</span> <span class="o">%</span> <span class="n">ibrav</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;ibrav </span><span class="si">%s</span><span class="s1"> is not a valid option.&#39;</span> <span class="o">%</span> <span class="n">ibrav</span>
            <span class="k">return</span> 

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>

        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ibravStr</span>



</div>
<div class="viewcode-block" id="free2abc"><a class="viewcode-back" href="../retr.html#retr.free2abc">[docs]</a><span class="k">def</span> <span class="nf">free2abc</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">degrees</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">bohr</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert lattice vectors to a,b,c,alpha,beta,gamma of the primitive lattice</span>

<span class="sd">    Arguments:</span>
<span class="sd">          cellparamatrix (numpy.matrix): matrix of cell vectors</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          cosine (bool): If True alpha,beta,gamma are cos(alpha),cos(beta),cos(gamma),</span>
<span class="sd">          degrees (bool): If True return alpha,beta,gamma in degrees; radians if False</span>
<span class="sd">          string (bool): If True return a,b,c,alpha,beta,gamma as a string; if False return as a list</span>
<span class="sd">          bohr (bool): If True return a,b,c in bohr radii; if False return in angstrom</span>

<span class="sd">    Returns:</span>
<span class="sd">         paramArray (list): a list of the parameters a,b,c,alpha,beta,gamma generated from the input matrix</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">ibrav</span> <span class="o">=</span> <span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cellparamatrix</span><span class="o">=</span><span class="n">cellparamatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">e</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">cellparamatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="n">degree2radian</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">ibrav</span> <span class="o">=</span> <span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">))</span>
    <span class="n">beta</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">))</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000001</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000001</span><span class="p">:</span>
        <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000001</span><span class="p">:</span>
        <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0</span>


    <span class="n">AngstromToBohr</span> <span class="o">=</span> <span class="mf">1.88971616463207</span>
    <span class="n">BohrToAngstrom</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">AngstromToBohr</span>
    <span class="k">if</span> <span class="n">bohr</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="n">a</span><span class="o">*=</span><span class="n">BohrToAngstrom</span>
        <span class="n">b</span><span class="o">*=</span><span class="n">BohrToAngstrom</span>
        <span class="n">c</span><span class="o">*=</span><span class="n">BohrToAngstrom</span>

    <span class="k">if</span> <span class="n">cosine</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">cosBC</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">cosAC</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">cosAB</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">paramArray</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">cosBC</span><span class="p">,</span><span class="n">cosAC</span><span class="p">,</span><span class="n">cosAB</span><span class="p">]</span>
        <span class="n">returnString</span> <span class="o">=</span> <span class="s1">&#39;a=</span><span class="si">%s</span><span class="s1">,b=</span><span class="si">%s</span><span class="s1">,c=</span><span class="si">%s</span><span class="s1">,cos(alpha)=</span><span class="si">%s</span><span class="s1">,cos(beta)=</span><span class="si">%s</span><span class="s1">,cos(gamma)=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">paramArray</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">degrees</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">/=</span><span class="n">degree2radian</span>
        <span class="n">beta</span><span class="o">/=</span> <span class="n">degree2radian</span>
        <span class="n">gamma</span><span class="o">/=</span><span class="n">degree2radian</span>

    <span class="k">if</span> <span class="n">cosine</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">paramArray</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">returnString</span> <span class="o">=</span> <span class="s1">&#39;A=</span><span class="si">%s</span><span class="s1">,B=</span><span class="si">%s</span><span class="s1">,C=</span><span class="si">%s</span><span class="s1">,alpha=</span><span class="si">%s</span><span class="s1">,beta=</span><span class="si">%s</span><span class="s1">,gamma=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">paramArray</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">string</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">returnString</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">paramArray</span>
            
 
</div>
<div class="viewcode-block" id="celldm2abc"><a class="viewcode-back" href="../retr.html#retr.celldm2abc">[docs]</a><span class="k">def</span> <span class="nf">celldm2abc</span><span class="p">(</span><span class="n">ibrav</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm3</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm4</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm5</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm6</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">degrees</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert celldm for espresso into A,B,C,and angles alpha,beta,gamma</span>

<span class="sd">    Arguments:</span>
<span class="sd">          cellparamatrix (numpy.matrix): matrix of cell vectors</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          cosine (bool): If True alpha,beta,gamma are cos(alpha),cos(beta),cos(gamma),</span>
<span class="sd">          degrees (bool): If True return alpha,beta,gamma in degrees; radians if False</span>

<span class="sd">    Returns:</span>
<span class="sd">         paramArray (list): a list of the parameters a,b,c,alpha,beta,gamma generated from the input matrix</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">celldm2</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">celldm3</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">celldm4</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">celldm5</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">celldm6</span><span class="o">=</span><span class="mf">0.0</span>


    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">8</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
        <span class="n">celldm4</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">celldm5</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">celldm6</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">12</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">13</span><span class="p">:</span>
        <span class="n">celldm5</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">celldm6</span><span class="o">=</span><span class="mf">0.0</span>


        
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
        <span class="n">celldm2</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">celldm4</span><span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">celldm5</span><span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">celldm6</span><span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
        <span class="n">celldm2</span><span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">celldm4</span><span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">celldm5</span><span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">celldm6</span><span class="o">=-</span><span class="mf">0.5</span>

    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">celldm2</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">celldm3</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">celldm5</span><span class="o">=</span><span class="n">celldm4</span>
        <span class="n">celldm6</span><span class="o">=</span><span class="n">celldm4</span>
        
    <span class="k">else</span><span class="p">:</span>

        <span class="k">print</span> <span class="s1">&#39;ibrav=</span><span class="si">%s</span><span class="s1"> not supported&#39;</span> <span class="o">%</span> <span class="n">ibrav</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;ibrav=</span><span class="si">%s</span><span class="s1"> not supported&#39;</span> <span class="o">%</span> <span class="n">ibrav</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">a</span><span class="o">=</span><span class="n">celldm1</span>
    <span class="n">b</span><span class="o">=</span><span class="n">celldm2</span><span class="o">*</span><span class="n">celldm1</span>
    <span class="n">c</span><span class="o">=</span><span class="n">celldm3</span><span class="o">*</span><span class="n">celldm1</span>
    <span class="k">if</span> <span class="n">cosine</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm4</span><span class="p">)</span>
        <span class="n">beta</span><span class="o">=</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm5</span><span class="p">)</span>
        <span class="n">gamma</span><span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm6</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
            <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
            <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">=</span> <span class="n">celldm4</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">celldm5</span>
        <span class="n">gamma</span><span class="o">=</span> <span class="n">celldm6</span>
    <span class="n">degree2radian</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="k">if</span> <span class="n">degrees</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">/=</span> <span class="n">degree2radian</span>
        <span class="n">beta</span> <span class="o">/=</span> <span class="n">degree2radian</span>
        <span class="n">gamma</span><span class="o">/=</span> <span class="n">degree2radian</span>


    <span class="n">a</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">b</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">c</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">alpha</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">beta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span>
</div>
<div class="viewcode-block" id="abc2celldm"><a class="viewcode-back" href="../retr.html#retr.abc2celldm">[docs]</a><span class="k">def</span> <span class="nf">abc2celldm</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert a,b,c,alpha,beta,gamma into celldm for QE</span>

<span class="sd">    Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          a (float): length of a</span>
<span class="sd">          b (float): length of b</span>
<span class="sd">          c (float): length of c</span>
<span class="sd">          alpha (float): Angle between axis b and c</span>
<span class="sd">          beta  (float): Angle between axis a and c</span>
<span class="sd">          gamma (float): Angle between axis a and b</span>
<span class="sd">          ibrav (int): ibrav to be used to convert for defaults</span>

<span class="sd">    Returns:</span>
<span class="sd">          celldm_array (array): an array of (ibrav,celldm(1),celldm(2),celldm(3),celldm(4),celldm(5),celldm(6))</span>

<span class="sd">    &#39;&#39;&#39;</span>        


    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==-</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">90.0</span>
        <span class="n">beta</span>  <span class="o">=</span> <span class="mf">90.0</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">120.0</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">alpha</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">12</span><span class="p">:</span>
        <span class="n">gamma</span><span class="o">=</span><span class="mf">90.0</span>
        <span class="n">beta</span><span class="o">=</span><span class="mf">90.0</span>

    <span class="n">celldm1</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">celldm2</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">a</span>
    <span class="n">celldm3</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="n">a</span>
    <span class="n">celldm4</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
    <span class="n">celldm5</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
    <span class="n">celldm6</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>

    <span class="n">celldm1</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm1</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm2</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm2</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm3</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm3</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm4</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm4</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm5</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm5</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm6</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm6</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">celldm4</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000000001</span><span class="p">:</span>
       <span class="n">celldm4</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">celldm5</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000000001</span><span class="p">:</span>
       <span class="n">celldm5</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">celldm6</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000000001</span><span class="p">:</span>
       <span class="n">celldm6</span><span class="o">=</span><span class="mf">0.0</span>


    <span class="k">return</span> <span class="n">ibrav</span><span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="n">celldm2</span><span class="p">,</span><span class="n">celldm3</span><span class="p">,</span><span class="n">celldm4</span><span class="p">,</span><span class="n">celldm5</span><span class="p">,</span><span class="n">celldm6</span>
</div>
<div class="viewcode-block" id="abcVol"><a class="viewcode-back" href="../retr.html#retr.abcVol">[docs]</a><span class="k">def</span> <span class="nf">abcVol</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get volume from a,b,c,alpha,beta,gamma</span>

<span class="sd">    Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          a (float): length of a</span>
<span class="sd">          b (float): length of b</span>
<span class="sd">          c (float): length of c</span>
<span class="sd">          alpha (float): Angle between axis b and c</span>
<span class="sd">          beta  (float): Angle between axis a and c</span>
<span class="sd">          gamma (float): Angle between axis a and b</span>
<span class="sd">          ibrav (int): ibrav to be used to convert for defaults</span>

<span class="sd">    Returns:</span>
<span class="sd">          cell_vol (float): volume of the cell</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">cellParamMatrix</span> <span class="o">=</span> <span class="n">abc2free</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">,</span><span class="n">returnString</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">getCellVolumeFromVectors</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="abc2free"><a class="viewcode-back" href="../retr.html#retr.abc2free">[docs]</a><span class="k">def</span> <span class="nf">abc2free</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">returnString</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts a,b,c,alpha,beta,gamma into QE convention primitive lattice vectors </span>

<span class="sd">    Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          a (float): length of a</span>
<span class="sd">          b (float): length of b</span>
<span class="sd">          c (float): length of c</span>
<span class="sd">          alpha (float): Angle between axis b and c</span>
<span class="sd">          beta  (float): Angle between axis a and c</span>
<span class="sd">          gamma (float): Angle between axis a and b</span>
<span class="sd">          ibrav (int): bravais lattice type by QE convention</span>
<span class="sd">          returnString (bool): return vectors as a string or as a numpy matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">          Either a numpy.matrix or a string of the primitive lattice vectors generated from the celldm input</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">ibrav</span><span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="n">celldm2</span><span class="p">,</span><span class="n">celldm3</span><span class="p">,</span><span class="n">celldm4</span><span class="p">,</span><span class="n">celldm5</span><span class="p">,</span><span class="n">celldm6</span> <span class="o">=</span> <span class="n">abc2celldm</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">)</span>
    <span class="n">cell_vectors</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">celldm2free</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="n">celldm2</span><span class="p">,</span><span class="n">celldm3</span><span class="p">,</span><span class="n">celldm4</span><span class="p">,</span><span class="n">celldm5</span><span class="p">,</span><span class="n">celldm6</span><span class="p">,</span><span class="n">returnString</span><span class="o">=</span><span class="n">returnString</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cell_vectors</span>
</div>
<div class="viewcode-block" id="ibrav2String"><a class="viewcode-back" href="../retr.html#retr.ibrav2String">[docs]</a><span class="k">def</span> <span class="nf">ibrav2String</span><span class="p">(</span><span class="n">ibrav</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm3</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm4</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm5</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">celldm6</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;CONSIDER FOR REMOVAL&gt;</span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=1, celldm(1)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">celldm1</span>
        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=2, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm2</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span><span class="mi">7</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=2, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm3</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=2, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm2</span><span class="p">,</span> <span class="n">celldm3</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=2, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="s2">, celldm(4)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm2</span><span class="p">,</span> <span class="n">celldm3</span><span class="p">,</span> <span class="n">celldm4</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">14</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=2, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="s2">, celldm(4)=</span><span class="si">%f</span><span class="s2"> celldm(5)=</span><span class="si">%f</span><span class="s2"> celldm(6)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm2</span><span class="p">,</span> <span class="n">celldm3</span><span class="p">,</span> <span class="n">celldm4</span><span class="p">,</span> <span class="n">celldm5</span><span class="p">,</span> <span class="n">celldm6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ibrav </span><span class="si">%s</span><span class="s1"> is not a valid option.&#39;</span> <span class="o">%</span> <span class="n">ibrav</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;ibrav </span><span class="si">%s</span><span class="s1"> is not a valid option.&#39;</span> <span class="o">%</span> <span class="n">ibrav</span>
            <span class="k">return</span> 

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ibravStr</span>


</div>
<div class="viewcode-block" id="getPositionsFromOutput"><a class="viewcode-back" href="../retr.html#retr.getPositionsFromOutput">[docs]</a><span class="k">def</span> <span class="nf">getPositionsFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the atomic positions from the output. If atomic positons can not be read from</span>
<span class="sd">    output then the the positions from the input are returned.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          pos (numpy.matrix): atomic positions</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
            <span class="n">outFileString</span>  <span class="o">=</span> <span class="n">outFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">pos</span><span class="o">=</span> <span class="n">__getPositions</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pos</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
                <span class="n">outFileString</span>  <span class="o">=</span> <span class="n">outFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">__getPositions</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">pos</span> 
    <span class="k">except</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
                <span class="n">outFileString</span>  <span class="o">=</span> <span class="n">outFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="n">pos</span> <span class="o">=</span> <span class="n">__getPositions</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">pos</span> 
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="getCellMatrixFromInput"><a class="viewcode-back" href="../retr.html#retr.getCellMatrixFromInput">[docs]</a><span class="k">def</span> <span class="nf">getCellMatrixFromInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the primitive cell vectors from the input.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          string (bool): Return a string or matrix</span>
<span class="sd">          scale (bool): scale the vectors by alat</span>

<span class="sd">    Returns:</span>
<span class="sd">          cellParamMatrix (numpy.matrix): primitive lattice params</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">splitInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__splitInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;CELL_PARAMETERS&#39;</span> <span class="ow">in</span> <span class="n">splitInput</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="sd">&#39;&#39;&#39;sanitize the modifier&#39;&#39;&#39;</span>
        <span class="n">modifier</span><span class="o">=</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;(){}&#39;</span><span class="p">)</span>
        <span class="n">cellTimes</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">scale</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modifier</span><span class="o">==</span><span class="s1">&#39;angstrom&#39;</span><span class="p">:</span>
                <span class="n">cellTimes</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">0.529177249</span>
        <span class="n">cellParamString</span> <span class="o">=</span> <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span>
        <span class="n">cellParamMatrix</span> <span class="o">=</span> <span class="n">__cellStringToMatrix</span><span class="p">(</span><span class="n">cellParamString</span><span class="p">)</span><span class="o">*</span><span class="n">cellTimes</span>

        <span class="k">return</span> <span class="n">cellParamMatrix</span>
    <span class="n">celldm2freeDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ibrav&#39;</span><span class="p">:</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;ibrav&#39;</span><span class="p">],</span><span class="s1">&#39;returnString&#39;</span><span class="p">:</span><span class="n">string</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;celldm&#39;</span><span class="p">,</span><span class="n">items</span><span class="p">)):</span>
            <span class="n">inputVar</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">inputVar</span> <span class="o">=</span> <span class="n">inputVar</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="n">celldm2freeDict</span><span class="p">[</span><span class="n">inputVar</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="n">items</span><span class="p">])</span>

    <span class="n">pos</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">celldm2free</span><span class="p">(</span><span class="o">**</span><span class="n">celldm2freeDict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pos</span>

</div>
<span class="k">def</span> <span class="nf">__getCelldm2freeDict</span><span class="p">(</span><span class="n">free2celldm_output_dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Cleans fortran array format into a format for python ex. celldm(1) to celldm1</span>

<span class="sd">    Arguments:</span>
<span class="sd">          free2celldm_output_dict (dict): output from AFLOWpi.retr.free2celldm</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          output_dict (dict) dictionary with cleaned keywords</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">outputDict</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">free2celldm_output_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;celldm&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">)):</span>
            <span class="n">inputVar</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">inputVar</span> <span class="o">=</span> <span class="n">inputVar</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">outputDict</span><span class="p">[</span><span class="n">inputVar</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s1">&#39;ibrav&#39;</span><span class="p">:</span>
            <span class="n">outputDict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outputDict</span>

<div class="viewcode-block" id="getPositionsFromInput"><a class="viewcode-back" href="../retr.html#retr.getPositionsFromInput">[docs]</a><span class="k">def</span> <span class="nf">getPositionsFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFileObj</span><span class="p">:</span>
            <span class="n">inFileString</span>  <span class="o">=</span> <span class="n">inFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">return</span> <span class="n">__getPositions</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">__getPositions</span><span class="p">(</span><span class="n">inputString</span><span class="p">,</span><span class="n">matrix</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="n">atomicPos</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">atomicPos</span><span class="p">,</span><span class="n">flags</span> <span class="o">=</span> <span class="n">detachPosFlags</span><span class="p">(</span><span class="n">atomicPos</span><span class="p">)</span>

    <span class="n">splitAtomicPos</span> <span class="o">=</span> <span class="n">atomicPos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">posArray</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">splitAtomicPos</span><span class="p">:</span>
        <span class="n">splitAtom</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitAtom</span><span class="p">):</span>
            <span class="n">posArray</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">splitAtom</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>

    <span class="k">if</span> <span class="n">matrix</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="n">arrayStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">posArray</span><span class="p">:</span>
            <span class="n">addition</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>                

            <span class="n">arrayStr</span><span class="o">+=</span><span class="n">addition</span>

        <span class="k">return</span> <span class="n">arrayStr</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">posArray</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputMatrix</span>





<span class="k">def</span> <span class="nf">__getPosLabels</span><span class="p">(</span><span class="n">inputString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        


    <span class="k">try</span><span class="p">:</span>
        <span class="n">atomicPos</span>     <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">splitAtomicPos</span> <span class="o">=</span> <span class="n">atomicPos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">splitAtomicPos</span><span class="p">:</span>
        <span class="n">splitAtom</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitAtom</span><span class="p">):</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitAtom</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">labels</span>


<span class="c1">##############################################################################################################################</span>
<span class="c1">##############################################################################################################################</span>
<span class="c1">## prim to conv cell transform</span>
<span class="c1">##############################################################################################################################</span>
<span class="c1">##############################################################################################################################</span>

<span class="k">def</span> <span class="nf">__rho2hex</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">2.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                            <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                            <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span><span class="o">-</span><span class="mf">2.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span><span class="o">/</span><span class="mf">3.0</span>


    <span class="n">prim2conv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">conv2prim</span><span class="p">)</span>
    <span class="n">hex_vec</span><span class="o">=</span><span class="n">prim2conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">first</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">2.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                        <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                        <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span><span class="o">/</span><span class="mf">3.0</span>
    <span class="n">second</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.0</span>  <span class="p">,</span><span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                        <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">2.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                        <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">2.0</span> <span class="p">]])</span><span class="o">/</span><span class="mf">3.0</span>

    <span class="n">first_copy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="n">second_copy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">first_copy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">first</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">second_copy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">first</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="n">sym_list</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>


    <span class="n">first_list</span> <span class="o">=</span> <span class="n">first_copy</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">second_list</span><span class="o">=</span> <span class="n">second_copy</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">sym_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">first_list</span><span class="p">)</span>
    <span class="n">sym_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">second_list</span><span class="p">)</span>
    <span class="n">symMatrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">sym_list</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">symMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">prim2conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">hex_vec</span>

<span class="k">def</span> <span class="nf">__prim2ConvMatrix</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">ibrav</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">))</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">cellParamMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                             <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                             <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span>

<span class="c1">#    &#39;&#39;&#39;conventional cells are primative cells so don&#39;t do anything&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span>  <span class="ow">or</span>  <span class="n">ibrav</span><span class="o">==</span><span class="mi">4</span>  <span class="ow">or</span>  <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">8</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">12</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">14</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span>        


<span class="c1">#    &#39;&#39;&#39;Face Centered Cubic and Orthorhombic&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
                <span class="p">[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                <span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>


    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
                <span class="p">[</span> <span class="mf">1.0</span>  <span class="p">,</span><span class="o">-</span><span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span><span class="o">-</span><span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span> 
                <span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>

    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">]:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
                <span class="p">[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span><span class="o">-</span><span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span> 
                <span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>
        

<span class="c1">#    &#39;&#39;&#39;Base Centered Orthorhombic and Monoclinic C centered&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">0.5</span>  <span class="p">,</span> <span class="mf">0.5</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span>  <span class="p">,</span> <span class="mf">0.5</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">13</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">0.5</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span><span class="o">-</span><span class="mf">0.5</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.5</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.5</span> <span class="p">]])</span>

    
    <span class="n">prim2conv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">conv2prim</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">prim2conv</span>




<span class="k">def</span> <span class="nf">__prim2ConvVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">prim2conv</span> <span class="o">=</span> <span class="n">__prim2ConvMatrix</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">)</span>
    <span class="n">cellParamMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">conv</span><span class="o">=</span><span class="n">prim2conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixCopy</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">conv</span>

<span class="k">def</span> <span class="nf">__conv2PrimVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">prim2conv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">__prim2ConvMatrix</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">))</span>
    <span class="n">cellParamMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">prim</span><span class="o">=</span><span class="n">prim2conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixCopy</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prim</span>

<span class="k">def</span> <span class="nf">__getConventionalCellFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">inputString</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>
    <span class="n">cellParamMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellMatrixFromInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>

    <span class="n">convCell</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__prim2ConvVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="sd">&#39;&#39;&#39;for aflow integration&#39;&#39;&#39;</span>
        
    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getPositionsFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getPosLabels</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__prim2convPositions</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">convCell</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">convCell</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span><span class="p">,</span><span class="n">convCell</span>


<span class="k">def</span> <span class="nf">__getConventionalCellFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">outputString</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">alat</span><span class="p">,</span><span class="n">cellParamMatrix</span> <span class="o">=</span> <span class="n">__getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

    <span class="n">convCell</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__prim2ConvVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>

    <span class="sd">&#39;&#39;&#39;for aflow integration&#39;&#39;&#39;</span>

    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getPositionsFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">inputString</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getPosLabels</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__prim2convPositions</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellParamMatrix</span><span class="p">)</span>



    <span class="n">convCell</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">convCell</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span><span class="p">,</span><span class="n">convCell</span>

<div class="viewcode-block" id="transform_input_conv"><a class="viewcode-back" href="../retr.html#retr.transform_input_conv">[docs]</a><span class="k">def</span> <span class="nf">transform_input_conv</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span><span class="p">,</span><span class="n">convCell</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getConventionalCellFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    
    <span class="n">atomic_pos</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__joinMatrixLabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span><span class="p">)</span>
    <span class="n">celldmDict</span>  <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__free2celldm</span><span class="p">(</span><span class="n">convCell</span><span class="p">)</span>
    
    <span class="n">splitInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">celldmDict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">atomic_pos</span>
    <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;nat&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">newInput</span>  <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__joinInput</span><span class="p">(</span><span class="n">splitInput</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newInput</span>


</div>
<span class="k">def</span> <span class="nf">__prim2convPositions</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellParamMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">returnMatrix</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="n">ibrav</span> <span class="o">=</span> <span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>

    <span class="c1">#&#39;&#39;&#39;primative=conv&#39;&#39;&#39;</span>
    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftAfter</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">8</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">12</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">14</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span>
    

    <span class="c1">#&#39;&#39;&#39;base centered&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
        <span class="k">pass</span>


        
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">13</span><span class="p">:</span>  

        <span class="k">pass</span>

    <span class="c1">#&#39;&#39;&#39;face centered&#39;&#39;&#39;        </span>

    <span class="c1">#&#39;&#39;&#39;body centered&#39;&#39;&#39;    </span>

    <span class="c1">#&#39;&#39;&#39;hexagonal&#39;&#39;&#39;    </span>


    <span class="n">prim2Conv</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__prim2ConvMatrix</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>




    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
        <span class="n">largerReturn</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="c1">#double length of labels</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="n">lat1</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>
        <span class="n">lat2</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat1</span><span class="p">)):</span>
            <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftAfter</span><span class="p">(</span><span class="n">lat1</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat2</span><span class="p">)):</span>
            <span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftX</span><span class="p">(</span><span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftY</span><span class="p">(</span><span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftZ</span><span class="p">(</span><span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="o">+</span><span class="mi">1</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">lat1</span><span class="p">)]</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftAfter</span><span class="p">(</span><span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>


        <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">largerReturn</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">largerReturn</span><span class="p">)):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span>
            <span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">prim2Conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span>  <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span><span class="p">:</span>
        <span class="n">largerReturn</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="c1">#double the length of the labels twice</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="n">lat1</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>
        <span class="n">lat2</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>
        <span class="n">lat3</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>
        <span class="n">lat4</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat1</span><span class="p">)):</span>
            <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftAfter</span><span class="p">(</span><span class="n">lat1</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>
            
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat2</span><span class="p">)):</span>
            <span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftY</span><span class="p">(</span><span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftZ</span><span class="p">(</span><span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="o">+</span><span class="mi">1</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">lat1</span><span class="p">)]</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftAfter</span><span class="p">(</span><span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat3</span><span class="p">)):</span>
            <span class="n">lat3</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftX</span><span class="p">(</span><span class="n">lat3</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lat3</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftZ</span><span class="p">(</span><span class="n">lat3</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">lat1</span><span class="p">)]</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftAfter</span><span class="p">(</span><span class="n">lat3</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat4</span><span class="p">)):</span>
            <span class="n">lat4</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftY</span><span class="p">(</span><span class="n">lat4</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lat4</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftZ</span><span class="p">(</span><span class="n">lat4</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">lat1</span><span class="p">)]</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftAfter</span><span class="p">(</span><span class="n">lat4</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>

        
        <span class="n">largerReturn</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__shiftAfter</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">largerReturn</span><span class="p">))</span>
        <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">largerReturn</span>
        

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">largerReturn</span><span class="p">)):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span>
            <span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">prim2Conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="n">returnMatrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>

    <span class="n">returnMatrixList</span><span class="o">=</span><span class="n">returnMatrix</span>
    <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">returnMatrix</span>


<span class="k">def</span> <span class="nf">__conv2primPositions</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellParamMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">returnMatrix</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="n">prim2Conv</span> <span class="o">=</span> <span class="n">__prim2ConvMatrix</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">symMatrix</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span>  <span class="n">prim2Conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">returnMatrix</span>


<div class="viewcode-block" id="convertFCC"><a class="viewcode-back" href="../retr.html#retr.convertFCC">[docs]</a><span class="k">def</span> <span class="nf">convertFCC</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFileObj</span><span class="p">:</span>
            <span class="n">inputString</span>  <span class="o">=</span> <span class="n">inFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">__getPosLabels</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="n">cellVectors</span> <span class="o">=</span>  <span class="n">__getCellInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">scaled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">getPositionsFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">posNew</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>

        <span class="n">posTemp</span> <span class="o">=</span> <span class="n">__duplicateEdgeAtoms</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span>
        <span class="n">posTemp</span> <span class="o">=</span>  <span class="n">__reduceDuplicates</span><span class="p">(</span><span class="n">posTemp</span><span class="p">)</span>
        <span class="n">posNew</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">posTemp</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">posNew</span><span class="p">]</span>

    <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                            <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                            <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">]])</span><span class="o">/</span><span class="mi">2</span>

    <span class="n">prim2conv</span> <span class="o">=</span>     <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">conv2prim</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">conv</span> <span class="o">=</span>  <span class="n">prim2conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="n">a</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span>  <span class="n">b</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span>  <span class="n">c</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="p">]],)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
        <span class="n">positions</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">prim2conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>




<span class="c1">##############################################################################################################</span>
<span class="c1">##</span>
<span class="c1">## NOT DONE</span>
<span class="c1">##</span>
<span class="c1">##############################################################################################################</span>

<span class="c1"># def get_aflow_transform(ibrav):</span>

<span class="c1">#     #SC ST SO RHO TRI SMCL                                                                                                                                                                                                                                                        </span>
<span class="c1">#     if ibrav in [1,4,5,6,8,12,14]:</span>
<span class="c1">#         cellParamMatrix = numpy.matrix([[ 1.0  , 0.0 , 0.0 ],</span>
<span class="c1">#                                         [ 0.0  , 1.0 , 0.0 ],</span>
<span class="c1">#                                         [ 0.0  , 0.0 , 1.0 ]])</span>
<span class="c1">#     #FC                                                                                                                                                                                                                                                                           </span>
<span class="c1">#     if ibrav in [2,10]:</span>
<span class="c1">#         cellParamMatrix = numpy.matrix([[ 0.0  , 1.0 , 1.0, ],</span>
<span class="c1">#                                         [ 1.0  , 0.0 , 1.0, ],</span>
<span class="c1">#                                         [ 1.0  , 1.0 , 0.0, ],])/2.0</span>
<span class="c1">#     #BC                                                                                                                                                                                                                                                                           </span>
<span class="c1">#     if ibrav in [3,7,11]:</span>
<span class="c1">#         cellParamMatrix = numpy.matrix([[-1.0  , 1.0 , 1.0 ],</span>
<span class="c1">#                                         [ 1.0  ,-1.0 , 1.0 ],</span>
<span class="c1">#                                         [ 1.0  , 1.0 ,-1.0 ]])/2.0</span>
<span class="c1">#     #ORCC                                                                                                                                                                                                                                                                         </span>
<span class="c1">#     if ibrav in [9]:</span>
<span class="c1">#         cellParamMatrix = numpy.matrix([[ 1.0  ,-1.0 , 0.0 ],</span>
<span class="c1">#                                         [ 1.0  , 1.0 , 0.0 ],</span>
<span class="c1">#                                         [ 0.0  , 0.0 , 2.0 ]])/2.0</span>
<span class="c1">#     #MCLC                                                                                                             </span>

<span class="c1">#     if ibrav in [13]:</span>
<span class="c1">#         cellParamMatrix = numpy.matrix([[ 1.0  , 1.0 , 0.0 ],</span>
<span class="c1">#                                         [-1.0  , 1.0 , 0.0 ],</span>
<span class="c1">#                                         [ 0.0  , 0.0 , 2.0 ]])/2.0</span>
<span class="c1">#     return cellParamMatrix</span>

<span class="c1"># def get_conv_aflow(cellParamMatrix,ibrav=0):</span>

<span class="c1">#     transform_matrix = get_aflow_transform(ibrav)</span>
<span class="c1">#     transform = numpy.linalg.inv(transform_matrix)</span>
<span class="c1">#     return transform.dot(cellParamMatrix)</span>


<span class="c1"># def QE_AFLOW(inputString):</span>

<span class="c1">#     cellParamMatrix = AFLOWpi.retr.getCellMatrixFromInput(inputString,scale=False)</span>
<span class="c1">#     to_prim=numpy.linalg.inv(AFLOWpi.retr.__prim2ConvMatrix(cellParamMatrix,ibrav+1))</span>

<span class="c1">#     symMatrix = AFLOWpi.retr.__getPositions(inputString).astype(numpy.float16)</span>

<span class="c1">#     input_dict = AFLOWpi.retr.__splitInput(inputString)</span>
<span class="c1">#     cellParamMatrix = to_prim.dot(get_conv_aflow(cellParamMatrix,ibrav=ibrav+1))</span>
<span class="c1">#     cellParamMatrix = AFLOWpi.retr.__cellMatrixToString(cellParamMatrix)</span>

<span class="c1">#     input_dict[&#39;CELL_PARAMETERS&#39;][&#39;__content__&#39;]=cellParamMatrix</span>

<span class="c1">#     pos_conv_aflow = get_conv_aflow(symMatrix.T,ibrav=ibrav+1)</span>
<span class="c1">#     symMatrix = to_prim.dot(pos_conv_aflow).T</span>
<span class="c1">#     symMatrix = AFLOWpi.retr.__shiftAfter(symMatrix)</span>
<span class="c1">#     labels = AFLOWpi.retr.__getPosLabels(inputString)</span>
<span class="c1">#     symMatrix = AFLOWpi.retr.__joinMatrixLabels(labels,symMatrix)</span>

<span class="c1">#     input_dict[&#39;ATOMIC_POSITIONS&#39;][&#39;__content__&#39;]=symMatrix</span>
<span class="c1">#     input_dict[&#39;ATOMIC_SPECIES&#39;][&#39;__content__&#39;]=&#39;\n&#39;.join(list(set(labels)))+&#39;\n&#39;</span>
<span class="c1">#     inputString = AFLOWpi.retr.__joinInput(input_dict)</span>

<span class="c1">#     return inputString</span>

<span class="c1">##############################################################################################################</span>
<span class="c1">##</span>
<span class="c1">## NOT DONE</span>
<span class="c1">##</span>
<span class="c1">##############################################################################################################</span>
</div>
<div class="viewcode-block" id="getIbravFromVectors"><a class="viewcode-back" href="../retr.html#retr.getIbravFromVectors">[docs]</a><span class="k">def</span> <span class="nf">getIbravFromVectors</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>


    <span class="n">alpha</span> <span class="o">=</span> <span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">beta</span>  <span class="o">=</span> <span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">alphaDegrees</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">alphaDegrees</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">betaDegrees</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">betaDegrees</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gammaDegrees</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">gammaDegrees</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>



    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0001</span><span class="p">:</span>
        <span class="n">alphaDegrees</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0001</span><span class="p">:</span>
        <span class="n">betaDegrees</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0001</span><span class="p">:</span>
        <span class="n">gammaDegrees</span><span class="o">=</span><span class="mf">0.0</span>

    

<span class="c1">#    print a</span>
<span class="c1">#    print b</span>
<span class="c1">#    print c</span>
<span class="c1">#    print alphaDegrees</span>
<span class="c1">#    print betaDegrees</span>
<span class="c1">#    print gammaDegrees</span>

    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>

        <span class="n">sortedVec</span> <span class="o">=</span>  <span class="n">__sortMatrix</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>

        <span class="n">reversedMat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">sortedVec</span><span class="o">.</span><span class="n">getA</span><span class="p">())])</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
        <span class="sd">&#39;&#39;&#39;in the case of FCC&#39;&#39;&#39;</span>
        <span class="k">if</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mf">60.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">60.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mf">60.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span>
            
            <span class="sd">&#39;&#39;&#39;in the case of simple cubic&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">reversedMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">a</span> <span class="ow">and</span> <span class="n">reversedMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">b</span> <span class="ow">and</span> <span class="n">reversedMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
            <span class="sd">&#39;&#39;&#39;in the case of BCC&#39;&#39;&#39;</span>


        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span>  <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">5</span>            
            
        <span class="sd">&#39;&#39;&#39;in the case of hexagonal&#39;&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">120.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">4</span>
        <span class="sd">&#39;&#39;&#39;in the case of rhombohedral&#39;&#39;&#39;</span>


    <span class="k">elif</span> <span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span>  <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mf">109.471220</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">109.471220</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mf">109.471220</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)):</span>
        <span class="k">return</span> <span class="mi">3</span>

    
    <span class="k">elif</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;in the case of simple Tet&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">6</span>
            <span class="sd">&#39;&#39;&#39;in the case of ORCC base cenetered ortho&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">9</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">9</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">9</span>


            <span class="s1">&#39;in the case of MCLC base centered monoclinic&#39;</span>
        <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">13</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">13</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">13</span>



        <span class="sd">&#39;&#39;&#39;in the case of BCO&#39;&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span>  <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">7</span>

            <span class="sd">&#39;&#39;&#39;in the case of ORCI&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">11</span>


        <span class="sd">&#39;&#39;&#39;in the case of simple ortho&#39;&#39;&#39;</span>
    <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span>  <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span><span class="p">:</span>

        <span class="n">sortedVec</span> <span class="o">=</span>  <span class="n">__sortMatrix</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>
        <span class="n">reversedMat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">sortedVec</span><span class="o">.</span><span class="n">getA</span><span class="p">())])</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>

        <span class="k">if</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">8</span>



            <span class="s1">&#39;in the case of MCL simple monoclinic&#39;</span>
        <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">12</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">12</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">12</span>



        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="n">ORCFtest</span> <span class="o">=</span> <span class="n">__convertCellBC</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>

<span class="c1">#            ORCFtest =  potentialConv(cellVectors)</span>

            <span class="n">aTest</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
            <span class="n">bTest</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
            <span class="n">cTest</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>


            <span class="n">alphaTest</span> <span class="o">=</span> <span class="n">ORCFtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">bTest</span><span class="o">*</span><span class="n">cTest</span><span class="p">)</span>
            <span class="n">betaTest</span>  <span class="o">=</span> <span class="n">ORCFtest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">aTest</span><span class="o">*</span><span class="n">cTest</span><span class="p">)</span>
            <span class="n">gammaTest</span> <span class="o">=</span> <span class="n">ORCFtest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">aTest</span><span class="o">*</span><span class="n">bTest</span><span class="p">)</span>

            <span class="n">alphaDegreesTest</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">alphaTest</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">betaDegreesTest</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">betaTest</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">gammaDegreesTest</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">gammaTest</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
        

            <span class="s1">&#39;in the case of ORCF try to convert cell to ORCF and see if alpha,beta,gamma=90 degrees&#39;</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegreesTest</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegreesTest</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegreesTest</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">10</span>
                <span class="s1">&#39;if not then this is triclinic &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">14</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
        

        <span class="s1">&#39;in the case of ORCI body centered ortho&#39;</span>
</div>
<span class="k">def</span> <span class="nf">__convertCellBC</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">,</span><span class="n">toPrimOrConv</span><span class="o">=</span><span class="s1">&#39;conv&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>
    <span class="n">convertMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span>
                                  <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">],</span>
                                  <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>


    <span class="n">div2matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
                               <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
                               <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]])</span>

    <span class="n">convertMatrix</span> <span class="o">=</span> <span class="n">convertMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">div2matrix</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">toPrimOrConv</span><span class="o">==</span><span class="s1">&#39;prim&#39;</span><span class="p">:</span>
        <span class="n">convertMatrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">convertMatrix</span><span class="p">)</span>
    
    <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">convertMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">returnMatrix</span>
    <span class="sd">&#39;&#39;&#39;needs to be removed sometime soon&#39;&#39;&#39;</span>
    <span class="sd">&#39;&#39;&#39;needs to be removed sometime soon&#39;&#39;&#39;</span>

<span class="k">def</span> <span class="nf">__cellStringToMatrix</span><span class="p">(</span><span class="n">cellParamString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">cellParamSplit</span> <span class="o">=</span> <span class="n">cellParamString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>                                                                  
                                                                                                                   
    <span class="n">splitList</span> <span class="o">=</span> <span class="p">[]</span>                                                                                                    

    <span class="n">splitList</span> <span class="o">=</span> <span class="p">[</span><span class="n">split</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">cellParamSplit</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">)]</span>
    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">splitList</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">symMatrix</span>

<span class="k">def</span> <span class="nf">__cellMatrixToString</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cellMatrix</span><span class="o">=</span><span class="n">cellMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">outputString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">)):</span>
        <span class="n">outputString</span><span class="o">+=</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%16.10f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cellMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        

    <span class="k">return</span> <span class="n">outputString</span>

<span class="k">def</span> <span class="nf">__getCellInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">scaled</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets the primitive cell vectors from the input file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          scaled (bool): scale vectors by alat</span>

<span class="sd">    Returns:</span>
<span class="sd">          symMatrix (numpy.matrix): matrix representing primive lattice vectors</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cellParamMatrixDict</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>
        <span class="n">ibrav</span><span class="o">=</span><span class="n">cellParamMatrixDict</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;ibrav&#39;</span><span class="p">]</span>
        <span class="n">celldmDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ibrav&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)}</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span>  <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cellParamMatrixDict</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;celldm&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">!=</span><span class="mi">0</span> <span class="p">]:</span>
            <span class="n">fixed</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[)(\s]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">celldmDict</span><span class="p">[</span><span class="n">fixed</span><span class="p">]</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                       
        
        <span class="n">cellParams</span> <span class="o">=</span> <span class="n">celldm2free</span><span class="p">(</span><span class="o">**</span><span class="n">celldmDict</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;no CELL_PARAMETERS in input&#39;</span>
        <span class="k">return</span>

    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">__cellStringToMatrix</span><span class="p">(</span><span class="n">cellParams</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">scaled</span><span class="p">:</span>
        <span class="n">symMatrix</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">/</span><span class="n">a</span>

    <span class="k">return</span> <span class="n">symMatrix</span>


<span class="c1">##############################################################################################################################</span>
<span class="c1">##############################################################################################################################</span>
<span class="c1">## cell and position transform</span>
<span class="c1">##############################################################################################################################</span>
<span class="c1">##############################################################################################################################</span>

<span class="k">def</span> <span class="nf">__getSymmInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">getPositionsFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">orig</span>


<span class="k">def</span> <span class="nf">__duplicateEdgeAtoms</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">arrayList</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">arrayMat</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="o">=</span><span class="n">arrayMat</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
            <span class="sd">&#39;&#39;&#39;if atom is on side of cell make duplicate on the other side&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>            

        <span class="n">formMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayList</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">formMatrix</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">arrayList</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">arrayMat</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="o">=</span><span class="n">arrayMat</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
            <span class="sd">&#39;&#39;&#39;if atom is on side of cell make duplicate on the other side&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>            

        <span class="n">formMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayList</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">formMatrix</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">symMatrix</span>


<span class="k">def</span> <span class="nf">__getCartConvMatrix</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="sd">&#39;&#39;&#39;get the conventional matrix from the primitive including the positions&#39;&#39;&#39;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>


    <span class="n">cosA</span> <span class="o">=</span> <span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">cosB</span>  <span class="o">=</span> <span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">cosG</span> <span class="o">=</span> <span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>


    <span class="n">alphaRad</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cosA</span><span class="p">)</span>
    <span class="n">betaRad</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cosB</span><span class="p">)</span>
    <span class="n">gammaRad</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cosG</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaRad</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
        <span class="n">alphaRad</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaRad</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
        <span class="n">betaRad</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaRad</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
        <span class="n">gammaRad</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">sinA</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alphaRad</span><span class="p">)</span>
    <span class="n">sinB</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">betaRad</span><span class="p">)</span>
    <span class="n">sinG</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gammaRad</span><span class="p">)</span>

    
    <span class="n">cartMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="n">cosG</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">cosB</span>                     <span class="p">],</span>
                               <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="n">sinG</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">sinB</span><span class="o">*</span><span class="n">cosA</span>                <span class="p">],</span>
                               <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="n">c</span><span class="o">*</span><span class="n">sinB</span><span class="o">*</span><span class="n">sinA</span>                <span class="p">],])</span>


    <span class="k">return</span> <span class="n">cartMatrix</span>

<span class="k">def</span> <span class="nf">__convertCartesian</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">scaleFactor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts atomic positions from crystal to cartesian coordinates</span>

<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          scaleFactor (int): scaling factor for output matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">          in_cart (postions in cartiesian coordinates)</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">returnMatrix</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="n">cartMatrix</span> <span class="o">=</span> <span class="n">__getCartConvMatrix</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)):</span>
        <span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">=</span><span class="n">cartMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="n">in_cart</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">in_cart</span>

<span class="k">def</span> <span class="nf">__convertFractional</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">scaleFactor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts atomic positions from cartesian to crystal coordinates</span>

<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          scaleFactor (int): scaling factor for output matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">          in_cart (numpy.matrix): postions in crystal coordinates</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">symMatrix</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cellMatrix</span><span class="o">=</span><span class="n">cellMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>


    <span class="n">cartMatrix</span> <span class="o">=</span> <span class="n">__getCartConvMatrix</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="n">cartMatrixInv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cartMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">cartMatrixInv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">=</span><span class="n">cartMatrixInv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>

    <span class="n">returnMat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">returnMat</span>




<span class="k">def</span> <span class="nf">__expandBoundariesNoScale</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">numX</span><span class="p">,</span><span class="n">numY</span><span class="p">,</span><span class="n">numZ</span><span class="p">,</span><span class="n">inList</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrix</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">symMatrixList</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">superList</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">if</span> <span class="n">expand</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixList</span><span class="p">)):</span>
            <span class="n">superList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">item</span><span class="p">],</span><span class="n">symMatrixList</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">symMatrixList</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">symMatrixList</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">2</span><span class="p">],])</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">superList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">numX</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">numY</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">numZ</span><span class="p">])</span>


                    
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">inList</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="n">symMatrix</span><span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">symMatrix</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span>


<span class="k">def</span> <span class="nf">__shiftX</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          coordVec (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+=</span><span class="n">shift</span>

    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">__shiftY</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          coordVec (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="n">shift</span>
    <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">__shiftZ</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          coordVec (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+=</span><span class="n">shift</span>

    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">__checkEqualPoint</span><span class="p">(</span><span class="n">oldMatrix</span><span class="p">,</span><span class="n">newMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">oldMatrix</span><span class="o">==</span><span class="n">newMatrix</span>


<span class="k">def</span> <span class="nf">__shiftAfterRotation</span><span class="p">(</span><span class="n">coordVec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          coordVec (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="sd">&#39;&#39;&#39;shift back to centering around the middle of cell&#39;&#39;&#39;</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+=</span><span class="mf">0.5</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="mf">0.5</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+=</span><span class="mf">0.5</span>


    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>




<div class="viewcode-block" id="getPointGroup"><a class="viewcode-back" href="../retr.html#retr.getPointGroup">[docs]</a><span class="k">def</span> <span class="nf">getPointGroup</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    NOT COMPLETED.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>


<span class="sd">    Keyword Arguments:</span>
<span class="sd">          source (string): either &#39;input&#39; or &#39;output&#39; to get point group from input</span>
<span class="sd">                           or output atomic positions</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">source</span><span class="o">!=</span><span class="s1">&#39;input&#39;</span> <span class="ow">and</span> <span class="n">source</span><span class="o">!=</span><span class="s1">&#39;output&#39;</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;source must equal &quot;input&quot; or &quot;output&quot;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;source must equal &quot;input&quot; or &quot;output&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> 
    <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s1">&#39;input&#39;</span><span class="p">:</span>
        <span class="n">cellInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getCellInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
        <span class="n">symInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getSymmInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s1">&#39;output&#39;</span><span class="p">:</span>
        <span class="n">symInput</span> <span class="o">=</span> <span class="n">getPositionsFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
        <span class="n">alat</span><span class="p">,</span><span class="n">symInput</span> <span class="o">=</span> <span class="n">__getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>


        
    <span class="n">ibrav</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cellInput</span><span class="p">)</span>

        

    

    </div>
<span class="k">def</span> <span class="nf">__sortMatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          matrix (numpy.matrix): sorts the matrix</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">sortedMatrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">uniqueSet</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;if atom is at side of cell pull it back&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">arrayVec</span> <span class="ow">in</span> <span class="n">sortedMatrix</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;add it to a set so we don&#39;t have repeats&#39;&#39;&#39;</span>
        <span class="n">uniqueSet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">))</span>
    <span class="n">sortedMatrix</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">uniqueSet</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;sort it so we can have a proper comparison&#39;&#39;&#39;</span>
    <span class="n">sortedMatrix</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sortedMatrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">sortedMatrix</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">__shiftAfter</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          matrix (numpy.matrix): sorts the matrix</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">arrayList</span><span class="o">=</span><span class="p">[]</span>

    

    <span class="k">for</span> <span class="n">arrayVec</span> <span class="ow">in</span> <span class="n">matrix</span><span class="p">:</span>
        <span class="n">arrayVec</span><span class="o">=</span><span class="n">arrayVec</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="sd">&#39;&#39;&#39;shift positions in cell to account for sides of cell&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-=</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-=</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0</span>

        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+=</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">/</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+=</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span><span class="o">/</span><span class="mf">1.0</span>
        <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayList</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>


<div class="viewcode-block" id="compMatrices"><a class="viewcode-back" href="../retr.html#retr.compMatrices">[docs]</a><span class="k">def</span> <span class="nf">compMatrices</span><span class="p">(</span><span class="n">matrix1</span><span class="p">,</span><span class="n">matrix2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Compare two numpy matrices to see if they are equal or not</span>

<span class="sd">    Arguments:</span>
<span class="sd">          matrix1 (numpy.matrix): first matrix</span>
<span class="sd">          matrix2 (numpy.matrix): second matrix</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          equalBool (bool): True if they&#39;re equal False if they&#39;re not</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">matrix1</span> <span class="o">=</span>  <span class="n">__shiftCell</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
    <span class="n">matrix2</span> <span class="o">=</span>  <span class="n">__shiftCell</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>

    <span class="n">matrix1</span> <span class="o">=</span> <span class="n">__reduceDuplicates</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
    <span class="n">matrix2</span> <span class="o">=</span> <span class="n">__reduceDuplicates</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>

    <span class="n">sortedMatrix1</span> <span class="o">=</span> <span class="n">__sortMatrix</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
    <span class="n">sortedMatrix2</span> <span class="o">=</span>  <span class="n">__sortMatrix</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">equalBool</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">sortedMatrix1</span> <span class="o">==</span> <span class="n">sortedMatrix2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">equalBool</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="n">matrix1</span> <span class="o">=</span> <span class="n">__duplicateEdgeAtoms</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
            <span class="n">matrix2</span> <span class="o">=</span> <span class="n">__duplicateEdgeAtoms</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>
            <span class="n">matrix1</span> <span class="o">=</span> <span class="n">__reduceDuplicates</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
            <span class="n">matrix2</span> <span class="o">=</span> <span class="n">__reduceDuplicates</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>

            <span class="n">sortedMatrix1</span> <span class="o">=</span> <span class="n">__sortMatrix</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
            <span class="n">sortedMatrix2</span> <span class="o">=</span>  <span class="n">__sortMatrix</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>
            <span class="n">equalBool</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">sortedMatrix1</span> <span class="o">==</span> <span class="n">sortedMatrix2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">equalBool</span>
    <span class="k">except</span><span class="p">:</span>

        <span class="k">return</span> <span class="bp">False</span>

        
        

</div>
<div class="viewcode-block" id="invertXYZ"><a class="viewcode-back" href="../retr.html#retr.invertXYZ">[docs]</a><span class="k">def</span> <span class="nf">invertXYZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">):</span>    
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">__convertCartesian</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__invertXYZ</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>


    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">__convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">symMatrix</span>


        
</div>
<div class="viewcode-block" id="invertX"><a class="viewcode-back" href="../retr.html#retr.invertX">[docs]</a><span class="k">def</span> <span class="nf">invertX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__invertX</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">__convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)):</span>
        <span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftAfterRotation</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">outputMatrix</span></div>
<div class="viewcode-block" id="invertY"><a class="viewcode-back" href="../retr.html#retr.invertY">[docs]</a><span class="k">def</span> <span class="nf">invertY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__invertY</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">__convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)):</span>
        <span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftAfterRotation</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">outputMatrix</span>
</div>
<div class="viewcode-block" id="invertZ"><a class="viewcode-back" href="../retr.html#retr.invertZ">[docs]</a><span class="k">def</span> <span class="nf">invertZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__invertZ</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">__convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)):</span>
        <span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftAfterRotation</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">outputMatrix</span>


        </div>
<div class="viewcode-block" id="shiftX"><a class="viewcode-back" href="../retr.html#retr.shiftX">[docs]</a><span class="k">def</span> <span class="nf">shiftX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__shiftX</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">shift</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">symMatrixCopy</span>

</div>
<div class="viewcode-block" id="shiftY"><a class="viewcode-back" href="../retr.html#retr.shiftY">[docs]</a><span class="k">def</span> <span class="nf">shiftY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__shiftY</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">shift</span><span class="o">*</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">symMatrixCopy</span>



</div>
<div class="viewcode-block" id="shiftZ"><a class="viewcode-back" href="../retr.html#retr.shiftZ">[docs]</a><span class="k">def</span> <span class="nf">shiftZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__shiftZ</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">shift</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">symMatrixCopy</span>


        </div>
<div class="viewcode-block" id="glideXshiftY"><a class="viewcode-back" href="../retr.html#retr.glideXshiftY">[docs]</a><span class="k">def</span> <span class="nf">glideXshiftY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftY</span><span class="p">(</span><span class="n">invertX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span></div>
<div class="viewcode-block" id="glideXshiftZ"><a class="viewcode-back" href="../retr.html#retr.glideXshiftZ">[docs]</a><span class="k">def</span> <span class="nf">glideXshiftZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftZ</span><span class="p">(</span><span class="n">invertX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span></div>
<div class="viewcode-block" id="glideYshiftZ"><a class="viewcode-back" href="../retr.html#retr.glideYshiftZ">[docs]</a><span class="k">def</span> <span class="nf">glideYshiftZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftZ</span><span class="p">(</span><span class="n">invertY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span></div>
<div class="viewcode-block" id="glideYshiftX"><a class="viewcode-back" href="../retr.html#retr.glideYshiftX">[docs]</a><span class="k">def</span> <span class="nf">glideYshiftX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftX</span><span class="p">(</span><span class="n">invertY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span></div>
<div class="viewcode-block" id="glideZshiftX"><a class="viewcode-back" href="../retr.html#retr.glideZshiftX">[docs]</a><span class="k">def</span> <span class="nf">glideZshiftX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftX</span><span class="p">(</span><span class="n">invertZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span></div>
<div class="viewcode-block" id="glideZshiftY"><a class="viewcode-back" href="../retr.html#retr.glideZshiftY">[docs]</a><span class="k">def</span> <span class="nf">glideZshiftY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftY</span><span class="p">(</span><span class="n">invertZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span>



</div>
<div class="viewcode-block" id="rotateAlpha"><a class="viewcode-back" href="../retr.html#retr.rotateAlpha">[docs]</a><span class="k">def</span> <span class="nf">rotateAlpha</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="s1">&#39;shift fractional coords to center around 0,0,0&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="s1">&#39;convert to cartesian&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="s1">&#39;rotate in cartesian around z axis&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">coordMatrix</span> <span class="o">=</span> <span class="n">__rotateAlpha</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordMatrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="s1">&#39;transform back to fractional coords&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertFractional</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>



    <span class="s1">&#39;shift back to center around 0.5,0.5,0.5&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">symMatrixCopy</span>
</div>
<div class="viewcode-block" id="rotateBeta"><a class="viewcode-back" href="../retr.html#retr.rotateBeta">[docs]</a><span class="k">def</span> <span class="nf">rotateBeta</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="s1">&#39;shift fractional coords to center around 0,0,0&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="s1">&#39;convert to cartesian&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="s1">&#39;rotate in cartesian around z axis&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">coordMatrix</span> <span class="o">=</span> <span class="n">__rotateBeta</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordMatrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="s1">&#39;transform back to fractional coords&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertFractional</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>



    <span class="s1">&#39;shift back to center around 0.5,0.5,0.5&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">symMatrixCopy</span>
</div>
<div class="viewcode-block" id="rotateGamma"><a class="viewcode-back" href="../retr.html#retr.rotateGamma">[docs]</a><span class="k">def</span> <span class="nf">rotateGamma</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="s1">&#39;shift fractional coords to center around 0,0,0&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="s1">&#39;convert to cartesian&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="s1">&#39;rotate in cartesian around z axis&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">coordMatrix</span> <span class="o">=</span> <span class="n">__rotateGamma</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordMatrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="s1">&#39;transform back to fractional coords&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">__convertFractional</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>



    <span class="s1">&#39;shift back to center around 0.5,0.5,0.5&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">__shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">symMatrixCopy</span>
        
</div>
<span class="k">def</span> <span class="nf">__invertXYZ</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">xScale</span><span class="p">,</span><span class="n">yScale</span><span class="p">,</span><span class="n">zScale</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=-</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">=-</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">__invertX</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">xScale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=-</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">__invertY</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">yScale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">__invertZ</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">zScale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">=-</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>


                      
<span class="k">def</span> <span class="nf">__rotateAlpha</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">angle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">([</span><span class="n">angle</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>

    <span class="n">rotationMatrix</span> <span class="o">=</span>     <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span>       <span class="mi">1</span>         <span class="p">,</span>       <span class="mi">0</span>         <span class="p">,</span>    <span class="mi">0</span>               <span class="p">],</span>
                                       <span class="p">[</span>       <span class="mi">0</span>          <span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>   <span class="p">],</span>
                                       <span class="p">[</span>       <span class="mi">0</span>          <span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>   <span class="p">],</span> <span class="p">])</span>



    <span class="n">coordVec</span> <span class="o">=</span> <span class="n">rotationMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coordVec</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="k">return</span> <span class="n">coordVec</span>



<span class="k">def</span> <span class="nf">__rotateBeta</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">angle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">([</span><span class="n">angle</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>



    <span class="n">rotationMatrix</span> <span class="o">=</span>     <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="p">,</span>     <span class="mi">0</span>           <span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>    <span class="p">],</span>
                                       <span class="p">[</span>     <span class="mi">0</span>           <span class="p">,</span>     <span class="mi">1</span>           <span class="p">,</span>    <span class="mi">0</span>               <span class="p">],</span>
                                       <span class="p">[</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>     <span class="mi">0</span>           <span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>    <span class="p">],</span> <span class="p">])</span>

    


    <span class="n">coordVec</span> <span class="o">=</span> <span class="n">rotationMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coordVec</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="k">return</span> <span class="n">coordVec</span>


    


<span class="k">def</span> <span class="nf">__rotateGamma</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">angle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">([</span><span class="n">angle</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>


    <span class="n">rotationMatrix</span> <span class="o">=</span>     <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="p">,</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>      <span class="mi">0</span>             <span class="p">],</span>
                                       <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>      <span class="mi">0</span>             <span class="p">],</span>
                                       <span class="p">[</span>        <span class="mi">0</span>         <span class="p">,</span>     <span class="mi">0</span>           <span class="p">,</span>     <span class="mi">1</span>             <span class="p">],</span> <span class="p">])</span>

    <span class="n">coordVec</span> <span class="o">=</span> <span class="n">rotationMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coordVec</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">coordVec</span>

<span class="k">def</span> <span class="nf">__shiftBeforeRotation</span><span class="p">(</span><span class="n">coordVec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="sd">&#39;&#39;&#39;shift to center all atoms around cartesian origin&#39;&#39;&#39;</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-=</span><span class="mf">0.5</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-=</span><span class="mf">0.5</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="mf">0.5</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">__shiftCell</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">arrayList</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">arrayMat</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
        <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">arrayMat</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
 <span class="c1">#       arrayVec=arrayVec.tolist()</span>
        <span class="sd">&#39;&#39;&#39;shift positions in cell to account for sides of cell&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">arrayMat</span><span class="o">-=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">arrayMat</span><span class="o">-=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">arrayMat</span><span class="o">-=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>
    <span class="k">for</span> <span class="n">arrayMat</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
        <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">arrayMat</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">arrayMat</span><span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">arrayMat</span><span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">arrayMat</span><span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>



        <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>


    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayList</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>


    <span class="k">return</span> <span class="n">outMatrix</span>



<div class="viewcode-block" id="shiftCell"><a class="viewcode-back" href="../retr.html#retr.shiftCell">[docs]</a><span class="k">def</span> <span class="nf">shiftCell</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">__shiftAfter</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>

    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">__reduceDuplicates</span><span class="p">(</span><span class="n">outMatrix</span><span class="p">)</span>

    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">__duplicateEdgeAtoms</span><span class="p">(</span><span class="n">outMatrix</span><span class="p">)</span>
    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">__reduceDuplicates</span><span class="p">(</span><span class="n">outMatrix</span><span class="p">)</span>
    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">__shiftAfter</span><span class="p">(</span><span class="n">outMatrix</span><span class="p">)</span>
    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">__reduceDuplicates</span><span class="p">(</span><span class="n">outMatrix</span><span class="p">)</span>



    <span class="k">return</span> <span class="n">outMatrix</span>
</div>
<span class="k">def</span> <span class="nf">__reduceDuplicates</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">arrayListCopy</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>

    <span class="sd">&#39;&#39;&#39;to get rid of duplicates&#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">arrayMat</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
        <span class="n">arrayVec</span><span class="o">=</span><span class="n">arrayMat</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">arrayListCopy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">arrayListCopy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arrayListCopy</span><span class="p">)</span>
    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayListCopy</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">outMatrix</span>



<span class="c1">##############################################################################################################################</span>
<span class="c1">##############################################################################################################################</span>
<span class="c1">## misc</span>
<span class="c1">##############################################################################################################################</span>
<span class="c1">##############################################################################################################################</span>
<div class="viewcode-block" id="chemAsKeys"><a class="viewcode-back" href="../retr.html#retr.chemAsKeys">[docs]</a><span class="k">def</span> <span class="nf">chemAsKeys</span><span class="p">(</span><span class="n">calcs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    For sets of calcs that only differ by chemistry you can replace the</span>
<span class="sd">    hash by the chemical name. May not always work. Especially if there</span>
<span class="sd">    are two compounds with swapped positions of atoms of different elements</span>

<span class="sd">    Arguments:</span>
<span class="sd">	  calcs (dict): dictionary of dictionaries of calculations</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">	  calcsCopy (dict): returns new dictionay with keys as the chemical stoiciometry</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">calcsCopy</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">stoicNameList</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">newKey</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">)</span>
        <span class="n">stoicNameList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newKey</span><span class="p">)</span>
        <span class="n">calcsCopy</span><span class="p">[</span><span class="n">newKey</span><span class="p">]</span><span class="o">=</span><span class="n">oneCalc</span>


    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">stoicNameList</span><span class="p">))</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">calcs</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;cannot uniquely identify each calc with a corresponding chem. returning original calcs&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;cannot uniquely identify each calc with a corresponding chem. returning original calcs&#39;</span>
    

    <span class="k">return</span> <span class="n">calcsCopy</span>
</pre></div></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016, Andrew Supka.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>