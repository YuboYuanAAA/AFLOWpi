

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>retr &mdash; AFLOWpi  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="AFLOWpi  documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> AFLOWpi
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plot.html">plot module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep.html">prep module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pseudo.html">pseudo module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retr.html">retr module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../run.html">run module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scfuj.html">scfuj module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AFLOWpi</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>retr</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for retr</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">AFLOWpi</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="k">def</span> <span class="nf">_increase_celldm1</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;prev&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span>

    <span class="c1">#change prefix in input file so it doesn&#39;t conflict with later calculations after thermal</span>

    <span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_modifyNamelistPW</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;&amp;control&#39;</span><span class="p">,</span><span class="s1">&#39;prefix&#39;</span><span class="p">,</span><span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">_vol&quot;&#39;</span><span class="o">%</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">])</span>
    <span class="n">oneCalc</span><span class="p">[</span><span class="s2">&quot;_AFLOWPI_PREFIX_&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s2">&quot;_AFLOWPI_PREFIX_&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;_vol&quot;</span>

    <span class="n">inp_file</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getInputFileString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">celldm1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">inp_file</span><span class="p">)[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">])</span>

    <span class="n">new_celldm1</span><span class="o">=</span><span class="n">celldm1</span><span class="o">*</span><span class="n">amount</span>


    <span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_modifyNamelistPW</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">,</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">,</span><span class="n">new_celldm1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span>


<span class="k">def</span> <span class="nf">_get_gruneisen</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">band</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">norm_ID</span>  <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;phonon&#39;</span><span class="p">)</span>
    <span class="n">expn_ID</span>  <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;thermal&#39;</span><span class="p">)</span>

    <span class="n">expn_vol_ID</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;thermal_relax&#39;</span><span class="p">)</span>

    <span class="n">norm_vol</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellVolume</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">norm_ID</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">conventional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">expn_vol</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellVolume</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">expn_vol_ID</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">conventional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">bohr2meter</span><span class="o">=</span><span class="mf">5.29177e-11</span>
    <span class="n">norm_vol</span><span class="o">*=</span><span class="n">bohr2meter</span><span class="o">**</span><span class="mf">3.0</span>
    <span class="n">expn_vol</span><span class="o">*=</span><span class="n">bohr2meter</span><span class="o">**</span><span class="mf">3.0</span>


<span class="c1">#    print expn_vol/norm_vol</span>
<span class="c1">#    print </span>
 
    <span class="k">if</span> <span class="n">band</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
       <span class="nb">print</span> <span class="n">band</span>
       <span class="k">raise</span> <span class="ne">SystemExit</span>
       <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;phBAND.gp&#39;</span>
    <span class="k">else</span><span class="p">:</span>
<span class="c1">#        extension=&#39;&#39;</span>
        <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;eig.ap&#39;</span>

    <span class="n">norm_freq</span><span class="p">,</span><span class="n">q_point_old</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_ph_dos_data</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">norm_ID</span><span class="p">,</span><span class="n">extension</span><span class="o">=</span><span class="n">extension</span><span class="p">)</span>
    <span class="n">expn_freq</span><span class="p">,</span><span class="n">q_point_old</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_ph_dos_data</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">expn_ID</span><span class="p">,</span><span class="n">extension</span><span class="o">=</span><span class="n">extension</span><span class="p">)</span>



    <span class="n">grun</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">q_point</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">omega</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">norm_freq</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">band</span><span class="p">:</span>
            <span class="n">q_point</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q_point_old</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">norm_freq</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="k">try</span><span class="p">:</span>
                    <span class="n">deriv</span>  <span class="o">=</span> <span class="p">(</span><span class="n">expn_freq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">norm_freq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">expn_vol</span><span class="o">-</span><span class="n">norm_vol</span><span class="p">)</span>
                    <span class="n">deriv</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">norm_vol</span><span class="o">/</span><span class="n">norm_freq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">deriv</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">deriv</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">grun</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deriv</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                            <span class="n">grun</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="n">grun</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deriv</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm_freq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                            <span class="n">omega</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm_freq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">grun</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                            <span class="n">grun</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="n">grun</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm_freq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                            <span class="n">omega</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm_freq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">continue</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1">#                print e</span>


<span class="c1">#    print len(grun)</span>
<span class="c1">#    print len(q_point_old)</span>
<span class="c1">#    print len(q_point)</span>


<span class="c1">#   raise SystemExit</span>
    <span class="k">if</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">grun_data_str</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">          </span><span class="si">%s</span><span class="s1">                  </span><span class="si">%s</span><span class="s1">                 </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="s1">&#39;TA&#39;</span><span class="p">,</span><span class="s2">&quot;TA&#39;&quot;</span><span class="p">,</span><span class="s1">&#39;LA&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grun</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grun</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">grun</span><span class="p">[</span><span class="mi">12</span><span class="p">]):</span>
                    <span class="n">grun_data_str</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">%10.8f</span><span class="s1"> &#39;</span><span class="o">%</span><span class="n">q_point</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grun</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                        <span class="n">grun_data_str</span><span class="o">+=</span><span class="s1">&#39;</span><span class="si">%16.16f</span><span class="s1"> &#39;</span><span class="o">%</span><span class="n">grun</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grun_data_str</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grun</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grun</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
<span class="c1">#                    print grun[i][j]</span>
<span class="c1">#                    print grun[i][j]**2.0</span>
                    <span class="n">grun_data_str</span><span class="o">+=</span><span class="s1">&#39;</span><span class="si">%16.16f</span><span class="s1"> </span><span class="si">%16.16f</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">grun</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>
 <span class="c1">#   if len(grun)==3:</span>
 <span class="c1">#       pass</span>
    <span class="c1"># else:</span>
    <span class="c1">#     for i in range(len(grun[0][3:-1])):</span>
    <span class="c1">#         grun_data_str+=&#39;Optical             &#39;</span>
    <span class="c1">#     for i in range(len(q_point)):</span>
    <span class="c1">#         grun_data_str+=&#39;\n%10.8f %16.16f %16.16f  %16.16f&#39;%(q_point[i],grun[0][i],grun[1][i],grun[2][i])</span>
    <span class="c1">#         for j in range(len(grun[i][3:-1])):</span>
    <span class="c1">#             grun_data_str+=&#39;%16.16f&#39;%(grun[i][j])</span>
        

    <span class="k">if</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">grun_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.phGRUN.gp&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grun_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.phSCATTER.gp&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">grun_file_name</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">gpfo</span><span class="p">:</span>
        <span class="n">gpfo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">grun_data_str</span><span class="p">)</span>
    
    <span class="n">av_TA</span>       <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">grun</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">grun</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">av_TA_prime</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">grun</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">grun</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">av_LA</span>      <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">grun</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">grun</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="p">[</span><span class="n">av_TA</span><span class="p">,</span><span class="n">av_TA_prime</span><span class="p">,</span><span class="n">av_LA</span><span class="p">]</span>
        
    
            

<span class="c1">#    frequency = </span>
<span class="c1">#    delta_vol_frequency= </span>
<span class="k">def</span> <span class="nf">_get_ph_dos_data</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">extension</span><span class="o">=</span><span class="s1">&#39;phBAND.gp&#39;</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

    <span class="n">data_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">postfix</span><span class="p">,</span><span class="n">extension</span><span class="p">))</span>


    <span class="c1">#data =numpy.loadtxt(data_file_name,dtype=numpy.float64,)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_file_name</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fo</span><span class="p">:</span>
        <span class="n">fs</span><span class="o">=</span><span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">fs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">dat_temp</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="n">temp_one</span> <span class="o">=</span> <span class="p">[</span><span class="n">dat_temp</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
            <span class="n">temp_one</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dat_temp</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_one</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1">#    print data</span>

    <span class="n">ret_dat</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">ret_dat</span>
    <span class="n">ret_dat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ret_dat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">ret_dat</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
    <span class="nb">print</span> <span class="n">ret_dat</span>
    <span class="k">return</span> <span class="n">ret_dat</span><span class="p">,</span><span class="n">ret_dat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_get_ph_band_data</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">extension</span><span class="o">=</span><span class="s1">&#39;phBAND.gp&#39;</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

    <span class="n">data_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">postfix</span><span class="p">,</span><span class="n">extension</span><span class="p">))</span>


    <span class="c1">#data =numpy.loadtxt(data_file_name,dtype=numpy.float64,)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_file_name</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fo</span><span class="p">:</span>
        <span class="n">fs</span><span class="o">=</span><span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">fs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:],</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>



    

<span class="k">def</span> <span class="nf">_get_gamma_velocity</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">freq</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">_get_debye_freq</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>


    <span class="n">path_str</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_phonon_band_path</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

    <span class="n">path_pts_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#    print path_pts_list</span>
    <span class="n">freq</span><span class="p">,</span><span class="n">q_vals</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_ph_dos_data</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">TA</span>       <span class="o">=</span> <span class="n">freq</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">TA_prime</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">LA</span>       <span class="o">=</span> <span class="n">freq</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
<span class="c1">#    q_vals   = freq[-1]</span>

    <span class="n">total</span><span class="o">=</span><span class="mi">0</span>
<span class="c1">#    for i in range(len(path_pts_list)):</span>
    <span class="n">path_index</span><span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path_pts_list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">path_pts_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">path_pts_list</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">path_index</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">sum</span><span class="p">(</span><span class="n">path_pts_list</span><span class="p">[:</span><span class="n">i</span><span class="p">]),</span><span class="nb">sum</span><span class="p">(</span><span class="n">path_pts_list</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path_index</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">sum</span><span class="p">(</span><span class="n">path_pts_list</span><span class="p">[:</span><span class="n">i</span><span class="p">]),</span><span class="nb">sum</span><span class="p">(</span><span class="n">path_pts_list</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])])</span>
    


    
<span class="c1">#    index = for i in path_pts_list</span>
<span class="c1">#    print path_index</span>
<span class="c1">#    print TA</span>
    <span class="n">average_freq_TA</span>       <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">TA</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path_index</span><span class="p">])</span>
    <span class="n">average_freq_TA_prime</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">TA_prime</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path_index</span><span class="p">])</span>
    <span class="n">average_freq_LA</span>       <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">LA</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path_index</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">average_freq_TA</span><span class="p">,</span><span class="n">average_freq_TA_prime</span><span class="p">,</span><span class="n">average_freq_LA</span>

<span class="k">def</span> <span class="nf">_get_debye_temp</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="c1">#get the frequencies for TA, TA&#39;, and LA</span>
    <span class="n">frequencies</span><span class="p">,</span><span class="n">q_vals</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_ph_dos_data</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

    <span class="c1">#q vals so we can find v_debye near gamma</span>
<span class="c1">#    q_vals = frequencies[-1]</span>

    
<span class="c1">#    frequencies[0] = [i*0.0299792458 for i in frequencies[0]]</span>
<span class="c1">#    frequencies[1] = [i*0.0299792458 for i in frequencies[1]]</span>
<span class="c1">#    frequencies[2] = [i*0.0299792458 for i in frequencies[2]]</span>
    <span class="c1">#get volume of original cell</span>
    <span class="n">norm_ID</span>  <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;phonon&#39;</span><span class="p">)</span>
    <span class="n">cell_vol</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellVolume</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">norm_ID</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">conventional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#convert to meters</span>
    <span class="n">bohr2meter</span><span class="o">=</span><span class="mf">5.29177e-11</span>
    <span class="n">V</span><span class="o">=</span><span class="n">cell_vol</span><span class="o">*</span><span class="n">bohr2meter</span><span class="o">**</span><span class="mf">3.0</span>

    <span class="c1">#get num atoms in cell</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;nat&#39;</span><span class="p">])</span>

    <span class="c1">#some constants</span>
    <span class="n">h_bar</span><span class="o">=</span><span class="mf">1.0545718</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">34</span> 
    <span class="n">k_b</span><span class="o">=</span><span class="mf">1.38064852</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">23</span>

    <span class="c1">#get v_debye for each branch</span>
    <span class="n">v_i</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_debye_freq</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">v_s_TA</span>       <span class="o">=</span> <span class="n">v_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">v_s_TA_prime</span> <span class="o">=</span> <span class="n">v_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">v_s_LA</span>       <span class="o">=</span> <span class="n">v_i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


    <span class="c1">#calculate debye temperature for each branch</span>
    <span class="n">wo_v</span>           <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">h_bar</span><span class="o">/</span><span class="n">k_b</span><span class="c1">#*(6.0*numpy.pi**2.0*N/V)**(1.0/3.0)</span>
    <span class="n">debye_TA</span>       <span class="o">=</span> <span class="n">wo_v</span><span class="o">*</span><span class="n">v_s_TA</span>
    <span class="n">debye_TA_prime</span> <span class="o">=</span> <span class="n">wo_v</span><span class="o">*</span><span class="n">v_s_TA_prime</span>
    <span class="n">debye_LA</span>       <span class="o">=</span> <span class="n">wo_v</span><span class="o">*</span><span class="n">v_s_LA</span>


<span class="c1">#    print debye_TA</span>
<span class="c1">#    print debye_TA_prime</span>
<span class="c1">#    print debye_LA</span>

    <span class="k">return</span> <span class="n">debye_TA</span><span class="p">,</span><span class="n">debye_TA_prime</span><span class="p">,</span><span class="n">debye_LA</span>



<span class="k">def</span> <span class="nf">_therm_pp</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
<span class="c1">#    grun_i  = AFLOWpi.retr._get_gruneisen(oneCalc,ID)</span>
    <span class="n">grun_i</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_gruneisen</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">band</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">theta_i</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_debye_temp</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
<span class="c1">#    print theta_i</span>
    <span class="c1">#get volume of original cell</span>
    <span class="n">norm_ID</span>  <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;phonon&#39;</span><span class="p">)</span>
    <span class="n">cell_vol</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellVolume</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">norm_ID</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">conventional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#convert to meters</span>
    <span class="n">bohr2meter</span><span class="o">=</span><span class="mf">5.29177e-11</span>
    <span class="n">V</span><span class="o">=</span><span class="n">cell_vol</span><span class="o">*</span><span class="n">bohr2meter</span><span class="o">**</span><span class="mf">3.0</span>


    <span class="c1">#get num atoms in cell</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;nat&#39;</span><span class="p">])</span>


    <span class="n">cell_mass</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_cell_mass</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    
    <span class="c1">#convert amu to kg</span>
    <span class="n">M</span><span class="o">=</span><span class="n">cell_mass</span><span class="o">*</span><span class="mf">1.66054e-27</span>
    <span class="n">Mass</span><span class="o">=</span><span class="n">M</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">Vol</span><span class="o">=</span><span class="n">V</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="c1">#get the frequencies for TA, TA&#39;, and LA</span>
    <span class="n">frequencies</span><span class="p">,</span><span class="n">q_vals</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_ph_dos_data</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

    <span class="n">v_i</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_debye_freq</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

    <span class="nb">print</span> <span class="n">Vol</span>
    <span class="nb">print</span> <span class="n">Mass</span>
    <span class="nb">print</span> <span class="n">grun_i</span>
    <span class="nb">print</span> <span class="n">v_i</span>
    <span class="nb">print</span> <span class="n">theta_i</span>


    <span class="n">therm_cond_data_str</span><span class="o">=</span><span class="s2">&quot;T       Total        TA           TA&#39;          La&quot;</span>
    <span class="n">TEMP</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2000.0</span><span class="p">,</span><span class="mf">400.0</span><span class="p">)</span>

    <span class="n">Vol</span>   <span class="o">=</span> <span class="mf">375.60264000000006</span> <span class="c1"># volume of one cell in angstrom^3                                                      </span>
    <span class="n">Vol</span>  <span class="o">*=</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">30.0</span><span class="p">)</span> <span class="c1"># convert angstrom to m^3                                                                    </span>
    <span class="n">Vol</span>  <span class="o">/=</span> <span class="mf">8.0</span> <span class="c1"># do volume per atom                                                                                   </span>

    <span class="n">Mass</span>   <span class="o">=</span> <span class="mf">63.5463</span><span class="o">*</span><span class="mf">3.0</span>  <span class="c1"># 3 Cu                                                                                       </span>
    <span class="n">Mass</span> <span class="o">+=</span> <span class="mf">78.9718</span><span class="o">*</span><span class="mf">4.0</span>  <span class="c1"># 4 Se                                                                                        </span>
    <span class="n">Mass</span> <span class="o">+=</span> <span class="mf">121.760</span><span class="o">*</span><span class="mf">1.0</span>  <span class="c1"># 1 Antimony                                                                                  </span>
    <span class="n">Mass</span> <span class="o">*=</span> <span class="mf">1.66054e-27</span> <span class="c1"># convert amu to kg                                                                            </span>
    <span class="n">Mass</span> <span class="o">/=</span> <span class="mf">8.0</span>        <span class="c1"># average mass per atom      </span>

    <span class="n">v_i</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">1485.0</span><span class="p">,</span> <span class="mf">1699.0</span><span class="p">,</span> <span class="mf">3643.0</span><span class="p">]</span> <span class="c1">#TA, TA&#39;, LA                                                                         </span>
    <span class="n">theta_i</span> <span class="o">=</span> <span class="p">[</span><span class="mf">60.0</span><span class="p">,</span>   <span class="mf">65.0</span><span class="p">,</span>   <span class="mf">78.0</span>  <span class="p">]</span> <span class="c1">#TA, TA&#39;, LA                                                                      </span>
    <span class="n">grun_i</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">1.27</span><span class="p">,</span>   <span class="mf">1.14</span><span class="p">,</span>   <span class="mf">1.26</span><span class="p">,</span> <span class="p">]</span> <span class="c1">#TA, TA&#39;, LA     </span>


    <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">TEMP</span><span class="p">:</span>
        <span class="n">total</span><span class="p">,</span><span class="n">TA_cont</span><span class="p">,</span><span class="n">TA_prime_cont</span><span class="p">,</span><span class="n">LA_cont</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_do_therm</span><span class="p">(</span><span class="n">v_i</span><span class="p">,</span><span class="n">theta_i</span><span class="p">,</span><span class="n">grun_i</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
        
        <span class="n">therm_cond_data_str</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">%7.1f</span><span class="s1"> </span><span class="si">%12.3f</span><span class="s1"> </span><span class="si">%12.3f</span><span class="s1"> </span><span class="si">%12.3f</span><span class="s1"> </span><span class="si">%12.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">total</span><span class="p">,</span><span class="n">TA_cont</span><span class="p">,</span><span class="n">TA_prime_cont</span><span class="p">,</span><span class="n">LA_cont</span><span class="p">)</span>

    <span class="n">therm_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_thermal_cond.dat&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">therm_file_name</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tcfo</span><span class="p">:</span>
        <span class="n">tcfo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">therm_cond_data_str</span><span class="p">)</span> 


<span class="k">def</span> <span class="nf">_test_therm_pp</span><span class="p">():</span>

    <span class="n">therm_cond_data_str</span><span class="o">=</span><span class="s2">&quot;T       Total        TA           TA&#39;          La&quot;</span>
<span class="c1">#   TEMP = numpy.linspace(1.0,2001.0,2000.0)</span>
    <span class="n">TEMP</span> <span class="o">=</span> <span class="p">[</span><span class="mf">80.0</span><span class="p">,</span>
            <span class="mf">87.3333333333333</span><span class="p">,</span>
            <span class="mf">94.6666666666667</span> <span class="p">,</span>
            <span class="mi">102</span><span class="p">,</span>
            <span class="mf">109.333333333333</span><span class="p">,</span>
            <span class="mf">116.666666666667</span><span class="p">,</span>
            <span class="mi">124</span><span class="p">,</span>
            <span class="mf">131.333333333333</span><span class="p">,</span>
            <span class="mf">138.666666666667</span><span class="p">,</span>
            <span class="mi">146</span><span class="p">,</span>
            <span class="mf">153.333333333333</span><span class="p">,</span>
            <span class="mf">160.666666666667</span><span class="p">,</span>
            <span class="mi">168</span><span class="p">,</span>
            <span class="mf">175.333333333333</span><span class="p">,</span>
            <span class="mf">182.666666666667</span><span class="p">,</span>
            <span class="mi">190</span><span class="p">,</span>
            <span class="mf">197.333333333333</span><span class="p">,</span>
            <span class="mf">204.666666666667</span><span class="p">,</span>
            <span class="mi">212</span><span class="p">,</span>
            <span class="mf">219.333333333333</span><span class="p">,</span>
            <span class="mf">226.666666666667</span><span class="p">,</span>
            <span class="mi">234</span><span class="p">,</span>
            <span class="mf">241.333333333333</span><span class="p">,</span>
            <span class="mf">248.666666666667</span><span class="p">,</span>
            <span class="mi">256</span><span class="p">,</span>
            <span class="mf">263.333333333333</span><span class="p">,</span>
            <span class="mf">270.666666666667</span><span class="p">,</span>
            <span class="mi">278</span><span class="p">,</span>
            <span class="mf">285.333333333333</span><span class="p">,</span>
            <span class="mf">292.666666666667</span><span class="p">,</span>
            <span class="mi">300</span><span class="p">,</span>
            <span class="p">]</span>

    <span class="n">Vol</span>   <span class="o">=</span> <span class="mf">375.60264000000006</span> <span class="c1"># volume of one cell in angstrom^3                                                      </span>
    <span class="n">Vol</span>  <span class="o">*=</span> <span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">30.0</span><span class="p">)</span> <span class="c1"># convert angstrom to m^3                                                                    </span>
    <span class="n">Vol</span>  <span class="o">/=</span> <span class="mf">8.0</span> <span class="c1"># do volume per atom                                                                                   </span>

    <span class="n">Mass</span>   <span class="o">=</span> <span class="mf">63.5463</span><span class="o">*</span><span class="mf">3.0</span>  <span class="c1"># 3 Cu                                                                                       </span>
    <span class="n">Mass</span> <span class="o">+=</span> <span class="mf">78.9718</span><span class="o">*</span><span class="mf">4.0</span>  <span class="c1"># 4 Se                                                                                        </span>
    <span class="n">Mass</span> <span class="o">+=</span> <span class="mf">121.760</span><span class="o">*</span><span class="mf">1.0</span>  <span class="c1"># 1 Antimony                                                                                  </span>
    <span class="n">Mass</span> <span class="o">*=</span> <span class="mf">1.66054e-27</span> <span class="c1"># convert amu to kg                                                                            </span>
    <span class="n">Mass</span> <span class="o">/=</span> <span class="mf">8.0</span>        <span class="c1"># average mass per atom      </span>

    <span class="n">v_i</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">1485.0</span><span class="p">,</span> <span class="mf">1699.0</span><span class="p">,</span> <span class="mf">3643.0</span><span class="p">]</span> <span class="c1">#TA, TA&#39;, LA                                                                         </span>
    <span class="n">theta_i</span> <span class="o">=</span> <span class="p">[</span><span class="mf">60.0</span><span class="p">,</span>   <span class="mf">65.0</span><span class="p">,</span>   <span class="mf">78.0</span>  <span class="p">]</span> <span class="c1">#TA, TA&#39;, LA                                                                      </span>
    <span class="n">grun_i</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">1.27</span><span class="p">,</span>   <span class="mf">1.14</span><span class="p">,</span>   <span class="mf">1.26</span><span class="p">,</span> <span class="p">]</span> <span class="c1">#TA, TA&#39;, LA     </span>


    <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">TEMP</span><span class="p">:</span>
        <span class="n">total</span><span class="p">,</span><span class="n">TA_cont</span><span class="p">,</span><span class="n">TA_prime_cont</span><span class="p">,</span><span class="n">LA_cont</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_do_therm</span><span class="p">(</span><span class="n">v_i</span><span class="p">,</span><span class="n">theta_i</span><span class="p">,</span><span class="n">grun_i</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
        
        <span class="n">therm_cond_data_str</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">%7.1f</span><span class="s1"> </span><span class="si">%12.3f</span><span class="s1"> </span><span class="si">%12.3f</span><span class="s1"> </span><span class="si">%12.3f</span><span class="s1"> </span><span class="si">%12.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">total</span><span class="p">,</span><span class="n">TA_cont</span><span class="p">,</span><span class="n">TA_prime_cont</span><span class="p">,</span><span class="n">LA_cont</span><span class="p">)</span>

    <span class="n">therm_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span><span class="s1">&#39;test_thermal_cond.dat&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">therm_file_name</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tcfo</span><span class="p">:</span>
        <span class="n">tcfo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">therm_cond_data_str</span><span class="p">)</span> 


<span class="c1">######################################################################################################################                                                                                               </span>
<span class="c1">######################################################################################################################                                                                                               </span>

<span class="k">def</span> <span class="nf">_do_therm</span><span class="p">(</span><span class="n">v_i</span><span class="p">,</span><span class="n">theta_i</span><span class="p">,</span><span class="n">grun_i</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
    <span class="c1">######################################################################################################################</span>
    <span class="k">def</span> <span class="nf">calc_tau_N_TA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">vol</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
        <span class="c1">#Relax Temp Scattering TA&#39;                                                                                                                                          </span>
        <span class="n">h_bar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.0545718</span><span class="o">*</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">34.0</span><span class="p">)))</span> <span class="c1"># hbar</span>
        <span class="n">k_b</span>   <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.38064852</span><span class="o">*</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">23.0</span><span class="p">)))</span> <span class="c1">#boltzmann                                               </span>

        <span class="n">one_over_tau_N_TA</span>  <span class="o">=</span> <span class="n">k_b</span><span class="o">**</span><span class="mf">4.0</span>
        <span class="n">one_over_tau_N_TA</span> <span class="o">*=</span> <span class="n">grun</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="n">one_over_tau_N_TA</span> <span class="o">*=</span> <span class="n">vol</span>
        <span class="n">one_over_tau_N_TA</span> <span class="o">/=</span> <span class="n">mass</span>
        <span class="n">one_over_tau_N_TA</span> <span class="o">/=</span> <span class="n">h_bar</span><span class="o">**</span><span class="mf">3.0</span>
        <span class="n">one_over_tau_N_TA</span> <span class="o">/=</span> <span class="n">velocity</span><span class="o">**</span><span class="mf">5.0</span>

        <span class="n">one_over_tau_N_TA</span> <span class="o">*=</span> <span class="n">k_b</span><span class="o">/</span><span class="n">h_bar</span>
        <span class="n">one_over_tau_N_TA</span> <span class="o">*=</span> <span class="n">x</span>
        <span class="n">one_over_tau_N_TA</span> <span class="o">*=</span> <span class="n">T</span><span class="o">**</span><span class="mf">5.0</span>

        <span class="n">tau_N_TA</span>  <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">one_over_tau_N_TA</span>

        <span class="k">return</span> <span class="n">tau_N_TA</span>
    <span class="c1">######################################################################################################################</span>
    <span class="k">def</span> <span class="nf">calc_tau_N_LA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">vol</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
        <span class="c1">#Relax Temp Scattering LA                                                                                                         </span>
        <span class="n">h_bar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.0545718</span><span class="o">*</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">34.0</span><span class="p">)))</span> <span class="c1"># hbar</span>
        <span class="n">k_b</span>   <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.38064852</span><span class="o">*</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">23.0</span><span class="p">)))</span> <span class="c1">#boltzmann                                                                                                                                                                                                      </span>
        <span class="n">one_over_tau_N_LA</span>  <span class="o">=</span> <span class="n">k_b</span><span class="o">**</span><span class="mf">3.0</span>
        <span class="n">one_over_tau_N_LA</span> <span class="o">*=</span> <span class="n">grun</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="n">one_over_tau_N_LA</span> <span class="o">*=</span> <span class="n">vol</span>
        <span class="n">one_over_tau_N_LA</span> <span class="o">/=</span> <span class="n">mass</span>
        <span class="n">one_over_tau_N_LA</span> <span class="o">/=</span> <span class="n">h_bar</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="n">one_over_tau_N_LA</span> <span class="o">/=</span> <span class="n">velocity</span><span class="o">**</span><span class="mf">5.0</span>

        <span class="n">one_over_tau_N_LA</span> <span class="o">*=</span> <span class="p">(</span><span class="n">k_b</span><span class="o">/</span><span class="n">h_bar</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="n">one_over_tau_N_LA</span> <span class="o">*=</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="n">one_over_tau_N_LA</span> <span class="o">*=</span> <span class="n">T</span><span class="o">**</span><span class="mf">5.0</span>

        <span class="n">tau_N_LA</span>  <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">one_over_tau_N_LA</span>

        <span class="k">return</span> <span class="n">tau_N_LA</span>
    <span class="c1">######################################################################################################################                                                                                   </span>
    <span class="k">def</span> <span class="nf">calc_tau_U</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">debye_temp</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
        <span class="c1">#Relax Temp Umklamp LA                                                                                     </span>
        <span class="n">h_bar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.0545718</span><span class="o">*</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">34.0</span><span class="p">)))</span> <span class="c1"># hbar</span>
        <span class="n">k_b</span>   <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.38064852</span><span class="o">*</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">23.0</span><span class="p">)))</span> <span class="c1">#boltzmann                                                                                            </span>

        <span class="n">one_over_tau_U</span>  <span class="o">=</span> <span class="n">h_bar</span>
        <span class="n">one_over_tau_U</span> <span class="o">*=</span> <span class="n">grun</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="n">one_over_tau_U</span> <span class="o">/=</span> <span class="n">mass</span>
        <span class="n">one_over_tau_U</span> <span class="o">/=</span> <span class="n">velocity</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="n">one_over_tau_U</span> <span class="o">/=</span> <span class="n">debye_temp</span>

        <span class="n">one_over_tau_U</span> <span class="o">*=</span> <span class="p">(</span><span class="n">k_b</span><span class="o">/</span><span class="n">h_bar</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="n">one_over_tau_U</span> <span class="o">*=</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="n">one_over_tau_U</span> <span class="o">*=</span> <span class="n">T</span><span class="o">**</span><span class="mf">3.0</span>

        <span class="n">one_over_tau_U</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">debye_temp</span><span class="o">/</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">T</span><span class="p">))</span>

        <span class="n">tau_U</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">one_over_tau_U</span>

        <span class="k">return</span> <span class="n">tau_U</span>
    <span class="c1">######################################################################################################################</span>
    <span class="k">def</span> <span class="nf">first_int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">debye_temp</span><span class="p">,</span><span class="n">vol</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">trans</span><span class="p">):</span>
        <span class="c1">#do first integral in DB model</span>
        <span class="n">tau_U</span><span class="o">=</span><span class="n">calc_tau_U</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">debye_temp</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trans</span><span class="p">:</span>
            <span class="n">tau_N</span><span class="o">=</span><span class="n">calc_tau_N_TA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">vol</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tau_N</span><span class="o">=</span><span class="n">calc_tau_N_LA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">vol</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>

        <span class="n">Tc</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">tau_U</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">tau_N</span><span class="p">)</span>

        <span class="n">sol</span>  <span class="o">=</span> <span class="n">Tc</span>
        <span class="n">sol</span> <span class="o">*=</span> <span class="n">x</span><span class="o">**</span><span class="mf">4.0</span>
        <span class="n">sol</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>


        <span class="k">return</span> <span class="n">sol</span>
    <span class="c1">######################################################################################################################      </span>
    <span class="k">def</span> <span class="nf">second_int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">debye_temp</span><span class="p">,</span><span class="n">vol</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">trans</span><span class="p">):</span>
        <span class="c1">#do second integral in DB model</span>
        <span class="n">tau_U</span><span class="o">=</span><span class="n">calc_tau_U</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">debye_temp</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trans</span><span class="p">:</span>
            <span class="n">tau_N</span><span class="o">=</span><span class="n">calc_tau_N_TA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">vol</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tau_N</span><span class="o">=</span><span class="n">calc_tau_N_LA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">vol</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>

        <span class="n">Tc</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">tau_U</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">tau_N</span><span class="p">)</span>

        <span class="c1">#Tc/tau_N</span>
        <span class="n">Tc_mod</span> <span class="o">=</span> <span class="n">tau_U</span><span class="o">/</span><span class="p">(</span><span class="n">tau_U</span> <span class="o">+</span> <span class="n">tau_N</span><span class="p">)</span>


        <span class="n">sol</span>  <span class="o">=</span> <span class="n">Tc_mod</span>
        <span class="n">sol</span> <span class="o">*=</span> <span class="n">x</span><span class="o">**</span><span class="mf">4.0</span>
        <span class="n">sol</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>


        <span class="k">return</span> <span class="n">sol</span>
    <span class="c1">######################################################################################################################</span>
    <span class="k">def</span> <span class="nf">third_int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">debye_temp</span><span class="p">,</span><span class="n">vol</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">trans</span><span class="p">):</span>
        <span class="c1">#do third integral in DB model</span>
        <span class="n">tau_U</span><span class="o">=</span><span class="n">calc_tau_U</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">debye_temp</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trans</span><span class="p">:</span>
            <span class="n">tau_N</span><span class="o">=</span><span class="n">calc_tau_N_TA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">vol</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tau_N</span><span class="o">=</span><span class="n">calc_tau_N_LA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grun</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">vol</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>


        <span class="c1">#Tc/(tau_U*tau_N)</span>
        <span class="n">Tc_mod</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">tau_U</span> <span class="o">+</span> <span class="n">tau_N</span><span class="p">)</span>

        <span class="n">sol</span>  <span class="o">=</span> <span class="n">Tc_mod</span>
        <span class="n">sol</span> <span class="o">*=</span> <span class="n">x</span><span class="o">**</span><span class="mf">4.0</span>
        <span class="n">sol</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>

        <span class="k">return</span> <span class="n">sol</span>



    <span class="c1">######################################################################################################################</span>
    <span class="c1">#define constants</span>
    <span class="n">h_bar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.0545718</span><span class="o">*</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">34.0</span><span class="p">)))</span> <span class="c1"># hbar</span>
    <span class="n">k_b</span>   <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.38064852</span><span class="o">*</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">23.0</span><span class="p">)))</span> <span class="c1">#boltzmann  </span>

    <span class="c1">#define a constant from other constants</span>
    <span class="n">C_PHON_CONST</span>  <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span>
    <span class="n">C_PHON_CONST</span> <span class="o">*=</span> <span class="n">k_b</span><span class="o">**</span><span class="mf">4.0</span>
    <span class="n">C_PHON_CONST</span> <span class="o">*=</span> <span class="n">T</span><span class="o">**</span><span class="mf">3.0</span>
    <span class="n">C_PHON_CONST</span> <span class="o">/=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mf">2.0</span>
    <span class="n">C_PHON_CONST</span> <span class="o">/=</span> <span class="n">h_bar</span><span class="o">**</span><span class="mf">3.0</span>

    <span class="c1">#speed of sound for each accoustic branch</span>
    <span class="n">vel_TA</span>    <span class="o">=</span> <span class="n">v_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vel_TA1</span>   <span class="o">=</span> <span class="n">v_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">vel_LA</span>    <span class="o">=</span> <span class="n">v_i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1">#scaling constants for each accoustic branch</span>
    <span class="n">C_TA</span>      <span class="o">=</span> <span class="n">C_PHON_CONST</span><span class="o">/</span><span class="n">vel_TA</span>
    <span class="n">C_T1</span>      <span class="o">=</span> <span class="n">C_PHON_CONST</span><span class="o">/</span><span class="n">vel_TA1</span>
    <span class="n">C_LA</span>      <span class="o">=</span> <span class="n">C_PHON_CONST</span><span class="o">/</span><span class="n">vel_LA</span>
    <span class="c1">#debye temp for each accoustic branch</span>
    <span class="n">theta_TA</span>  <span class="o">=</span> <span class="n">theta_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">theta_TA1</span> <span class="o">=</span> <span class="n">theta_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">theta_LA</span>  <span class="o">=</span> <span class="n">theta_i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1">#gruneisen parameter for each accoustic branch</span>
    <span class="n">grun_TA</span>   <span class="o">=</span> <span class="n">grun_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">grun_TA1</span>  <span class="o">=</span> <span class="n">grun_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">grun_LA</span>   <span class="o">=</span> <span class="n">grun_i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1">#upper limit of integration for a given T for the integrals for each accoustic branch</span>
    <span class="n">max_TA</span>    <span class="o">=</span> <span class="n">theta_TA</span><span class="o">/</span><span class="n">T</span>
    <span class="n">max_TA1</span>   <span class="o">=</span> <span class="n">theta_TA1</span><span class="o">/</span><span class="n">T</span>
    <span class="n">max_LA</span>    <span class="o">=</span> <span class="n">theta_LA</span><span class="o">/</span><span class="n">T</span>
    <span class="nb">print</span> <span class="n">max_TA</span><span class="p">,</span><span class="n">max_TA1</span><span class="p">,</span><span class="n">max_LA</span>
    <span class="nb">print</span> 
    <span class="nb">print</span> 
    
    <span class="c1">##################################################################################</span>
    <span class="c1">#calculate the three integrals for TA phonon and find lattice k for TA</span>
    <span class="n">TA_1</span> <span class="o">=</span>  <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">first_int</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span><span class="n">max_TA</span><span class="p">,(</span><span class="n">grun_TA</span><span class="p">,</span><span class="n">vel_TA</span><span class="p">,</span><span class="n">theta_TA</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
                                 <span class="n">epsabs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1.49e-6</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">TA_2</span> <span class="o">=</span>  <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">second_int</span><span class="p">,</span><span class="mf">0.00</span><span class="p">,</span><span class="n">max_TA</span><span class="p">,(</span><span class="n">grun_TA</span><span class="p">,</span><span class="n">vel_TA</span><span class="p">,</span><span class="n">theta_TA</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
                                 <span class="n">epsabs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1.49e-6</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">TA_3</span> <span class="o">=</span>  <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">third_int</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span><span class="n">max_TA</span><span class="p">,(</span><span class="n">grun_TA</span><span class="p">,</span><span class="n">vel_TA</span><span class="p">,</span><span class="n">theta_TA</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
                                 <span class="n">epsabs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1.49e-6</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">klattice_TA</span>  <span class="o">=</span> <span class="n">C_TA</span> <span class="o">*</span> <span class="p">(</span><span class="n">TA_1</span> <span class="o">+</span> <span class="n">TA_2</span><span class="o">**</span><span class="mf">2.0</span><span class="o">/</span><span class="n">TA_3</span><span class="p">)</span>           
    <span class="c1">#calculate the three integrals for TA&#39; phonon and find lattice k for TA&#39;</span>
    <span class="n">T1_1</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">first_int</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span><span class="n">max_TA1</span><span class="p">,(</span><span class="n">grun_TA1</span><span class="p">,</span><span class="n">vel_TA1</span><span class="p">,</span><span class="n">theta_TA1</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
                                <span class="n">epsabs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1.49e-6</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">T1_2</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">second_int</span><span class="p">,</span><span class="mf">0.00</span><span class="p">,</span><span class="n">max_TA1</span><span class="p">,(</span><span class="n">grun_TA1</span><span class="p">,</span><span class="n">vel_TA1</span><span class="p">,</span><span class="n">theta_TA1</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
                                <span class="n">epsabs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1.49e-6</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">T1_3</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">third_int</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span><span class="n">max_TA1</span><span class="p">,(</span><span class="n">grun_TA1</span><span class="p">,</span><span class="n">vel_TA1</span><span class="p">,</span><span class="n">theta_TA1</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
                                <span class="n">epsabs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1.49e-6</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">klattice_T1</span>  <span class="o">=</span> <span class="n">C_T1</span> <span class="o">*</span> <span class="p">(</span><span class="n">T1_1</span> <span class="o">+</span> <span class="n">T1_2</span><span class="o">**</span><span class="mf">2.0</span><span class="o">/</span><span class="n">T1_3</span><span class="p">)</span>           
    <span class="c1">#calculate the three integrals for LA phonon and find lattice k for LA</span>
    <span class="n">LA_1</span> <span class="o">=</span>  <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">first_int</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span><span class="n">max_LA</span><span class="p">,(</span><span class="n">grun_LA</span><span class="p">,</span><span class="n">vel_LA</span><span class="p">,</span><span class="n">theta_LA</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
                                 <span class="n">epsabs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1.49e-6</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">LA_2</span> <span class="o">=</span>  <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">second_int</span><span class="p">,</span><span class="mf">0.00</span><span class="p">,</span><span class="n">max_LA</span><span class="p">,(</span><span class="n">grun_LA</span><span class="p">,</span><span class="n">vel_LA</span><span class="p">,</span><span class="n">theta_LA</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
                                 <span class="n">epsabs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1.49e-6</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">LA_3</span> <span class="o">=</span>  <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">third_int</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span><span class="n">max_LA</span><span class="p">,(</span><span class="n">grun_LA</span><span class="p">,</span><span class="n">vel_LA</span><span class="p">,</span><span class="n">theta_LA</span><span class="p">,</span><span class="n">Vol</span><span class="p">,</span><span class="n">Mass</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
                                 <span class="n">epsabs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1.49e-6</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">#   LA_3 =  scipy.integrate.quad(third_int, 0.001,max_LA,(grun_LA,vel_LA,theta_LA,Vol,Mass,T,False),epsabs=1.49e-20, epsrel=1.49e-20)[</span>
<span class="c1">#   print LA_3.message</span>
<span class="c1">#   LA_3 = LA_3[0]</span>


    <span class="n">klattice_LA</span>  <span class="o">=</span>  <span class="n">C_LA</span> <span class="o">*</span> <span class="p">(</span><span class="n">LA_1</span> <span class="o">+</span> <span class="n">LA_2</span><span class="o">**</span><span class="mf">2.0</span><span class="o">/</span><span class="n">LA_3</span><span class="p">)</span>
    <span class="c1">##################################################################################                                           </span>
    <span class="c1">#sum over all contibutions for lattice k at Temp T </span>
    <span class="n">klattice_total</span>  <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">klattice_total</span> <span class="o">+=</span> <span class="n">klattice_TA</span>
    <span class="n">klattice_total</span> <span class="o">+=</span> <span class="n">klattice_T1</span>
    <span class="n">klattice_total</span> <span class="o">+=</span> <span class="n">klattice_LA</span>

    <span class="k">return</span> <span class="n">klattice_total</span><span class="p">,</span><span class="n">klattice_TA</span><span class="p">,</span><span class="n">klattice_T1</span><span class="p">,</span><span class="n">klattice_LA</span>

<span class="c1">#def  _get_long_phon(oneCalc,ID,optical=True):</span>

<span class="c1">#     band_file_name = os.path.join(oneCalc[&#39;_AFLOWPI_FOLDER_&#39;],&#39;%s.phBAND.gp&#39;%ID)</span>

<span class="c1">#     with open(band_file_name,&#39;r&#39;) as bdfo:</span>
<span class="c1">#         bdfs = bdfo.read()</span>



<span class="c1">#     gg=re.findall(&#39;^\s*0.00.*\n&#39;,bdfs,re.M)</span>
<span class="c1">#     split_at_gamma = gg[0].split()[1:]</span>

<span class="c1">#     long_phon_ind = [i+1 for i in range(len(split_at_gamma)) if abs(float(split_at_gamma[i]))==0.00]</span>
<span class="c1"># #    print long_phon_ind </span>
<span class="c1"># #    print long_phon_ind </span>
<span class="c1"># #    print long_phon_ind </span>

<span class="c1">#     phon=[list(),list(),list()]</span>
<span class="c1">#     q_vals=[]</span>
<span class="c1">#     opt=[[]]</span>
<span class="c1"># #     for i in bdfs.split(&#39;\n&#39;):</span>
<span class="c1"># # #        print i</span>

<span class="c1"># #         per_q = [float(j) for j in i.split() ]</span>
<span class="c1"># #         try:</span>
<span class="c1"># # #            phon[0].append(per_q[long_phon_ind[0]])</span>
<span class="c1"># # #            phon[1].append(per_q[long_phon_ind[1]])</span>
<span class="c1"># # #            phon[2].append(per_q[long_phon_ind[2]]) </span>
<span class="c1"># #             q_vals.append(per_q[0])</span>
<span class="c1"># #             phon[0].append(per_q[1])</span>
<span class="c1"># #             phon[1].append(per_q[2])</span>
<span class="c1"># #             phon[2].append(per_q[3]) </span>


<span class="c1"># #             if optical==True:</span>
<span class="c1"># #                 for k in range(len(per_q))[4:]:</span>
<span class="c1"># #                     try:</span>
<span class="c1"># # #                        print k-4</span>
<span class="c1"># #                         opt[k-4].append(per_q[k])</span>
<span class="c1"># #                     except Exception,e:</span>
<span class="c1"># #                         opt[k-4]=[]</span>
<span class="c1"># #                         opt[k-4]=[per_q[k]]</span>

<span class="c1"># #         except:</span>
<span class="c1"># #             pass</span>


<span class="c1"># #     v0 = _get_gamma_velocity(phon[0],q_vals)</span>
<span class="c1"># #     v1 = _get_gamma_velocity(phon[1],q_vals)</span>
<span class="c1"># #     v2 = _get_gamma_velocity(phon[2],q_vals)</span>
<span class="c1"># # #    grad_first_phon  = numpy.gradient(phon[0])</span>
<span class="c1"># # #    grad_second_phon  =numpy.gradient(phon[1])</span>
<span class="c1"># # #    grad_third_phon  = numpy.gradient(phon[2])</span>


<span class="c1"># #   #  sums= {0:sum(grad_first_phon[:30]),1:sum(grad_second_phon[:30]),2:sum(grad_third_phon[:30]),}</span>
<span class="c1"># #     sums = {0:v0,1:v1,2:v2}</span>
<span class="c1"># # #    print grad_first_phon[:50]</span>
<span class="c1"># # #    print grad_second_phon[:50]</span>
<span class="c1"># # #    print grad_third_phon[:50]</span>


<span class="c1"># #     sorted_ind = [i[0] for i in  sorted(sums.items())]</span>

<span class="c1"># #     #convert cm^-1 to rad/s</span>
<span class="c1">#      sf = 0.0299792458*10.0**12</span>
<span class="c1"># # #    print sf</span>
<span class="c1"># # #    print sf</span>
<span class="c1"># # #    print sf</span>
<span class="c1"># #     #scale frequencies to meters</span>
<span class="c1">#      phon[sorted_ind[0]]=[i*sf for i in phon[sorted_ind[0]]]</span>
<span class="c1">#      phon[sorted_ind[1]]=[i*sf for i in phon[sorted_ind[1]]]</span>
<span class="c1">#      phon[sorted_ind[2]]=[i*sf for i in phon[sorted_ind[2]]]</span>
<span class="c1"># # #    print q_vals</span>
<span class="c1"># # #    return [phon[0],phon[1],phon[2],q_vals]</span>
<span class="c1"># #     if optical==True:</span>
<span class="c1"># #         ret_list = [phon[sorted_ind[0]],phon[sorted_ind[1]],phon[sorted_ind[2]],]</span>
<span class="c1"># #         ret_list.extend(opt)</span>
<span class="c1"># #         ret_list.append(q_vals)</span>
<span class="c1"># #         return ret_list</span>
<span class="c1"># #     else:</span>
<span class="c1"># #         return [phon[sorted_ind[0]],phon[sorted_ind[1]],phon[sorted_ind[2]],q_vals]</span>


<span class="kn">import</span> <span class="nn">AFLOWpi</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="k">def</span> <span class="nf">gap_size</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">bandgap_type</span><span class="o">=</span><span class="n">gap_type</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bandgap_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;p-type&#39;</span><span class="p">,</span><span class="s1">&#39;n-type&#39;</span><span class="p">,</span><span class="s1">&#39;insulator&#39;</span><span class="p">]:</span>
            <span class="nb">print</span> <span class="s1">&#39;conductor..no gap&#39;</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="n">bandgap_type</span><span class="o">==</span><span class="s1">&#39;p-type&#39;</span><span class="p">:</span>
            <span class="n">en</span><span class="p">,</span><span class="n">dos</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_dos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">dos_range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">40.0</span><span class="p">])</span>
            <span class="n">start</span><span class="o">=</span><span class="mf">0.1</span>
            <span class="n">end</span><span class="o">=</span><span class="mf">0.1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dos</span><span class="p">))[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
<span class="c1">#            for i in range(len(dos)):</span>
                <span class="k">if</span> <span class="n">dos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.00001</span><span class="p">:</span>
                    <span class="n">end</span><span class="o">=</span><span class="n">en</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">break</span>
            <span class="k">return</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span>


        <span class="k">elif</span> <span class="n">bandgap_type</span><span class="o">==</span><span class="s1">&#39;n-type&#39;</span><span class="p">:</span>
            <span class="n">en</span><span class="p">,</span><span class="n">dos</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_dos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">dos_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">40.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">])</span>
            <span class="n">start</span><span class="o">=-</span><span class="mf">0.1</span>
            <span class="n">end</span><span class="o">=</span><span class="mf">0.1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dos</span><span class="p">))[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]):</span>
<span class="c1">#            for i in reversed(range(len(dos))):</span>
                <span class="k">if</span> <span class="n">dos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.00001</span><span class="p">:</span>
                    <span class="n">end</span><span class="o">=</span><span class="n">en</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">break</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>


        <span class="k">elif</span> <span class="n">bandgap_type</span><span class="o">==</span><span class="s1">&#39;insulator&#39;</span><span class="p">:</span>
            <span class="n">en</span><span class="p">,</span><span class="n">dos_down</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_dos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">dos_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">40.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">])</span>
            <span class="n">en</span><span class="p">,</span><span class="n">dos_up</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_dos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">dos_range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">40.0</span><span class="p">])</span>
            <span class="n">start</span><span class="o">=-</span><span class="mf">0.1</span>
            <span class="n">end</span><span class="o">=</span><span class="mf">0.1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dos_down</span><span class="p">))[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">dos_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.00001</span><span class="p">:</span>
                    <span class="n">end</span><span class="o">=</span><span class="n">en</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">break</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dos_up</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">dos_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.00001</span><span class="p">:</span>
                    <span class="n">start</span><span class="o">=</span><span class="n">en</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">break</span>

            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>



                       
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">e</span>
        <span class="k">return</span> <span class="mf">0.0</span>

<span class="k">def</span> <span class="nf">gap_type</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dos_range</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">range_up</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span><span class="n">dos_range</span><span class="p">]</span>
        <span class="n">range_down</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">dos_range</span><span class="p">,</span><span class="o">-</span><span class="mf">0.05</span><span class="p">]</span>
        <span class="n">en_above</span><span class="p">,</span><span class="n">dos_above</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_dos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">dos_range</span><span class="o">=</span><span class="n">range_up</span><span class="p">)</span>
        <span class="n">en_below</span><span class="p">,</span><span class="n">dos_below</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_get_dos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">dos_range</span><span class="o">=</span><span class="n">range_down</span><span class="p">)</span>
        <span class="n">dos_above_found</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">dos_below_found</span><span class="o">=</span><span class="kc">False</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dos_above</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]):</span>

            <span class="k">if</span> <span class="n">dos_above</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.0001</span><span class="p">:</span>
                <span class="n">dos_above_found</span><span class="o">=</span><span class="kc">True</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dos_below</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]):</span>

            <span class="k">if</span> <span class="n">dos_below</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.0001</span><span class="p">:</span>
                <span class="n">dos_below_found</span><span class="o">=</span><span class="kc">True</span>

        <span class="k">if</span> <span class="n">dos_above_found</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">dos_below_found</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;conductor&#39;</span>
        <span class="k">elif</span> <span class="n">dos_above_found</span><span class="o">==</span><span class="kc">False</span> <span class="ow">and</span> <span class="n">dos_below_found</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;p-type&#39;</span>
        <span class="k">elif</span> <span class="n">dos_above_found</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">dos_below_found</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;n-type&#39;</span>
        <span class="k">elif</span> <span class="n">dos_above_found</span><span class="o">==</span><span class="kc">False</span> <span class="ow">and</span> <span class="n">dos_below_found</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;insulator&#39;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;None&#39;</span>


<span class="k">def</span> <span class="nf">_get_dos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">LSDA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">dos_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dos_ID</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;dos&#39;</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

	<span class="sd">&#39;&#39;&#39;extracts HOMO from nscf calculation output file as input to the plotting&#39;&#39;&#39;</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="n">Efermi</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getEfermi</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Efermi</span><span class="p">)</span><span class="o">!=</span><span class="nb">type</span><span class="p">(</span><span class="mf">0.5</span><span class="p">):</span>
			<span class="n">LSDA</span><span class="o">=</span><span class="kc">True</span>
			
	<span class="k">except</span><span class="p">:</span>
		<span class="n">Efermi</span><span class="o">=</span><span class="mf">0.0</span>
	<span class="n">subdir</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>

	<span class="sd">&quot;&quot;&quot;get the path to the subdirectory of the calc that you are making plots for&quot;&quot;&quot;</span>


	<span class="sd">&#39;&#39;&#39;name of file of the DOS plots is dosBandPlot_&lt;_AFLOWPI_PREFIX_&gt;&#39;&#39;&#39;</span>
	<span class="n">fileplot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;DOS_</span><span class="si">%s%s</span><span class="s1">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">]))</span>

	<span class="c1">#to set figure size and default fonts</span>


	<span class="sd">&quot;&quot;&quot;get the path to the subdirectory of the calc that you are making plots for&quot;&quot;&quot;</span>
        <span class="n">filedos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_dos.dat&#39;</span><span class="o">%</span><span class="n">dos_ID</span><span class="p">)</span>
        
	<span class="k">try</span><span class="p">:</span>
		<span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filedos</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
	<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

	<span class="n">en</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">enup</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">endown</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">dos</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">dosdw</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scaling_dosup</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">scaling_downdw</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">scaling_dos</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>      <span class="c1">#append DOS data to en,dos,dosw lists</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">LSDA</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                            <span class="n">val_up</span>   <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">Efermi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">val_down</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">Efermi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
 <span class="c1">#                           if val_up &lt; dos_range[1] and valZ_up &gt; dos_range[0]:</span>
                            <span class="n">enup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_up</span><span class="p">)</span>
<span class="c1">#                            if val_down &lt;dos_range[1] and val_down &gt; dos_range[0]:</span>
                            <span class="n">endown</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_down</span><span class="p">)</span>
				
			<span class="k">else</span><span class="p">:</span>
                            <span class="n">val</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">Efermi</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">scaling_dosdw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]))</span>
                            <span class="n">scaling_dosup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>

                            <span class="k">if</span> <span class="n">val_down</span> <span class="o">&lt;</span><span class="n">dos_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">val_down</span> <span class="o">&gt;</span> <span class="n">dos_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                                <span class="n">dosdw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]))</span>
                                <span class="n">en_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_down</span><span class="p">)</span> <span class="c1">#to shift all the y values with respect to the Fermi level</span>
                            <span class="k">if</span> <span class="n">val_up</span> <span class="o">&lt;</span><span class="n">dos_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">val_up</span> <span class="o">&gt;</span> <span class="n">dos_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                                <span class="n">dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
                                <span class="n">en_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_up</span><span class="p">)</span> <span class="c1">#to shift all the y values with respect to the Fermi level</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">scaling_dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">dos_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;</span><span class="n">dos_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
                                <span class="n">en</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="c1">#to shift all the y values with respect to the Fermi level</span>
		
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">pass</span>
	<span class="k">if</span> <span class="n">LSDA</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
		<span class="n">enup</span>  <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">enup</span><span class="p">)</span>
		<span class="n">endown</span><span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">endown</span><span class="p">)</span>

                <span class="n">floatdosDOWN</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">dosdw</span><span class="p">)</span>
                <span class="n">floatdos</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">dos</span><span class="p">)</span>

<span class="c1">#                renormalize_dw=1.0/sum(scaling_dosdw)</span>
<span class="c1">#                renormalize_up=1.0/sum(scaling_dosup)</span>
                <span class="n">renormalize_dw</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">dosdw</span><span class="p">)</span>
                <span class="n">renormalize_up</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">dosup</span><span class="p">)</span>

                <span class="n">array_dosup</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">floatdos</span><span class="p">)</span><span class="o">*</span><span class="n">renormalize_up</span>
                <span class="n">floatdos</span><span class="o">=</span><span class="n">array_dos</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                <span class="n">array_dosdw</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">)</span><span class="o">*</span><span class="n">renormalize_dw</span>
                <span class="n">floatdosDOWN</span><span class="o">=</span><span class="n">array_dosdw</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="n">endos</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">en</span><span class="p">)</span>  <span class="c1">#to convert the list x from float to numbers</span>
<span class="c1">#                renormalize=1.0/sum(scaling_dos)</span>
                <span class="n">renormalize</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">dos</span><span class="p">)</span>                
                <span class="n">floatdos</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">dos</span><span class="p">)</span>
                <span class="n">array_dos</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">floatdos</span><span class="p">)</span><span class="o">*</span><span class="n">renormalize</span>
                <span class="n">floatdos</span><span class="o">=</span><span class="n">array_dos</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

	<span class="n">enshift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">endos</span><span class="p">)</span> <span class="c1">#to treat the list b as an array?</span>

        
        <span class="k">if</span> <span class="n">LSDA</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">enshift</span><span class="p">,</span><span class="n">floatdos</span><span class="p">,</span><span class="n">floatdosDOWN</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">enshift</span><span class="p">,</span><span class="n">floatdos</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">AFLOWpi</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">decimal</span>


<span class="k">def</span> <span class="nf">supercell</span><span class="p">(</span><span class="n">inputString</span><span class="p">,</span><span class="n">numX</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">numY</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">numZ</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">inputString</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_transformInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>    
    <span class="k">return</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_constructSupercell</span><span class="p">(</span><span class="n">inputString</span><span class="p">,</span><span class="n">numX</span><span class="o">=</span><span class="n">numX</span><span class="p">,</span><span class="n">numY</span><span class="o">=</span><span class="n">numY</span><span class="p">,</span><span class="n">numZ</span><span class="o">=</span><span class="n">numZ</span><span class="p">)</span>




<span class="k">def</span> <span class="nf">_expandBoundaries</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">numX</span><span class="p">,</span><span class="n">numY</span><span class="p">,</span><span class="n">numZ</span><span class="p">,</span><span class="n">beginX</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">beginY</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">beginZ</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">superList</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">symMatrix</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">numX</span><span class="p">):</span>
            <span class="n">first</span>  <span class="o">=</span> <span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">numX</span><span class="p">))</span>
            <span class="n">second</span> <span class="o">=</span> <span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">third</span>  <span class="o">=</span> <span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">superList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="n">first</span><span class="p">,</span><span class="n">second</span><span class="p">,</span><span class="n">third</span><span class="p">])</span>

    <span class="n">newPos</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">]</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">]</span>
    <span class="n">superList</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1">#################################################################</span>
    <span class="c1">#################################################################</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newPos</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">numY</span><span class="p">):</span>
            <span class="n">first</span>  <span class="o">=</span> <span class="n">newPos</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">second</span> <span class="o">=</span> <span class="p">(</span><span class="n">newPos</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">numY</span><span class="p">))</span>
            <span class="n">third</span>  <span class="o">=</span> <span class="n">newPos</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">superList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="n">first</span><span class="p">,</span><span class="n">second</span><span class="p">,</span><span class="n">third</span><span class="p">])</span>

    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">]</span>
    <span class="n">newPos</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">]</span>
    <span class="n">superList</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1">#################################################################</span>
    <span class="c1">#################################################################</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newPos</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">numZ</span><span class="p">):</span>
            <span class="n">first</span>  <span class="o">=</span> <span class="n">newPos</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">second</span> <span class="o">=</span> <span class="n">newPos</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">third</span>  <span class="o">=</span> <span class="p">(</span><span class="n">newPos</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">numZ</span><span class="p">))</span>
            <span class="n">superList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="n">first</span><span class="p">,</span><span class="n">second</span><span class="p">,</span><span class="n">third</span><span class="p">])</span>

    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">]</span>
    <span class="n">newPos</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">]</span>

    <span class="n">orig_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">orig_atom_ss_index</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">numX</span><span class="o">*</span><span class="n">numY</span><span class="o">*</span><span class="n">numZ</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>


    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">orig_atom_ss_index</span><span class="p">)):</span>
        
        <span class="n">popped</span><span class="o">=</span><span class="n">superList</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">orig_atom_ss_index</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">superList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">popped</span><span class="p">)</span>

    <span class="n">symMatrix</span><span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">])</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span>

<span class="k">def</span> <span class="nf">_constructSupercell</span><span class="p">(</span><span class="n">inputString</span><span class="p">,</span><span class="n">numX</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">numY</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">numZ</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">stringOrMatrix</span><span class="o">=</span><span class="s1">&#39;String&#39;</span><span class="p">,</span><span class="n">newVectors</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">splitInput</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="s1">&#39;</span><span class="si">{crystal}</span><span class="s1">&#39;</span> <span class="o">!=</span> <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;unit in AFLOWpi.retr._constructSupercell not for ATOMIC_POSITIONS MUST BE </span><span class="si">{crystal}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inputString</span>
    <span class="n">cellParamMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellMatrixFromInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getPosLabels</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getPositions</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>

    <span class="n">symMatrix_orig</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="n">labels_orig</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

    <span class="n">coordold</span><span class="p">,</span><span class="n">flags</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">detachPosFlags</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">inputString</span><span class="p">))</span>

    <span class="n">outputString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">superList</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">if</span> <span class="n">newVectors</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_expandBoundaries</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">numX</span><span class="p">,</span><span class="n">numY</span><span class="p">,</span><span class="n">numZ</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_expandBoundariesNoScale</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">numX</span><span class="p">,</span><span class="n">numY</span><span class="p">,</span><span class="n">numZ</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">posLineStr</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%20.14f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">9</span><span class="p">))))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">outputString</span><span class="o">+=</span><span class="s1">&#39;</span><span class="si">%4s</span><span class="s1"> </span><span class="si">%8s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="n">posLineStr</span><span class="p">)</span>

    
    <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;nat&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>

    <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">numX</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;celldm(2)&#39;</span> <span class="ow">in</span> <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">scaleY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">numY</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">numX</span><span class="p">)</span>
        <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;celldm(2)&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;celldm(2)&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">scaleY</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;celldm(3)&#39;</span> <span class="ow">in</span> <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">scaleZ</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">numZ</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">numX</span><span class="p">)</span>
        <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;celldm(3)&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;celldm(3)&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">scaleZ</span><span class="p">)</span>


    <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">outputString</span>

    <span class="n">returnString</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_joinInput</span><span class="p">(</span><span class="n">splitInput</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">returnString</span>



<span class="kn">import</span> <span class="nn">AFLOWpi</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">def</span> <span class="nf">atomicDistances</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">inpt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">outp</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">engineDir</span>  <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_ConfigSectionMap</span><span class="p">(</span><span class="s2">&quot;prep&quot;</span><span class="p">,</span><span class="s1">&#39;engine_dir&#39;</span><span class="p">)</span>	
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">engineDir</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">configFileLocation</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_getConfigFile</span><span class="p">()</span>
        <span class="n">engineDir</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">configFileLocation</span><span class="p">,</span> <span class="n">enginedir</span><span class="p">)</span>
    <span class="n">distXPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">engineDir</span><span class="p">,</span><span class="s1">&#39;dist.x&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_ConfigSectionMap</span><span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">,</span><span class="s1">&#39;copy_exec&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">totree</span><span class="p">(</span><span class="n">distXPath</span><span class="p">,</span><span class="n">calcs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">runlocal</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">outp</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getDist</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">outp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inpt</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getDist</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">outp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">outp</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;RUN&#39;</span><span class="p">,</span><span class="s1">&#39;AFLOWpi.retr._getDist(oneCalc,ID,outp=True)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inpt</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;RUN&#39;</span><span class="p">,</span><span class="s1">&#39;AFLOWpi.retr._getDist(oneCalc,ID,outp=False)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_getDist</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">outp</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">outp</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_writeInputFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_new.in&#39;</span><span class="p">),</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_dist.in&#39;</span><span class="p">))</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.in&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_dist.in&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="c1">#fix to clear restart_mode in input file to avoid error with dist.x</span>
    <span class="n">dist_ID</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_dist&#39;</span><span class="o">%</span><span class="n">ID</span>        
    <span class="n">infil</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getInputFileString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">dist_ID</span><span class="p">)</span>
    <span class="n">inDict</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">infil</span><span class="p">)</span>
    <span class="n">inDict</span><span class="p">[</span><span class="s1">&#39;&amp;control&#39;</span><span class="p">][</span><span class="s1">&#39;restart_mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&quot;from_scratch&quot;&#39;</span>
    <span class="n">infil</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_joinInput</span><span class="p">(</span><span class="n">inDict</span><span class="p">)</span>
    <span class="n">dest_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_dist.in&#39;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dest_file</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fo</span><span class="p">:</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">infil</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_ConfigSectionMap</span><span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">,</span><span class="s1">&#39;copy_exec&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
        <span class="n">engineDir</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_ConfigSectionMap</span><span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">,</span><span class="s1">&#39;engine_dir&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">enginedir</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">configFileLocation</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_getConfigFile</span><span class="p">()</span>
            <span class="n">enginedir</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">configFileLocation</span><span class="p">,</span> <span class="n">enginedir</span><span class="p">)</span>

        <span class="n">execPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">engineDir</span><span class="p">,</span><span class="s1">&#39;dist.x&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">execPath</span><span class="o">=</span><span class="s1">&#39;./dist.x&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &lt; </span><span class="si">%s</span><span class="s1">_dist.in &gt; /dev/null&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">execPath</span><span class="p">,</span><span class="n">ID</span><span class="p">),</span><span class="n">cwd</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">outp</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;dist.out&#39;</span><span class="p">),</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_output_dist.out&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;dist.out&#39;</span><span class="p">),</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_input_dist.out&#39;</span><span class="p">))</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;dist.x did not run properly&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;ERROR: dist.x did not run properly&#39;</span>


<span class="kn">import</span> <span class="nn">AFLOWpi.run</span>
<span class="kn">import</span> <span class="nn">AFLOWpi.prep</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">logging</span> 
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">AFLOWpi.retr</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">sys</span> 
<span class="kn">import</span> <span class="nn">AFLOWpi.qe</span>
<span class="kn">import</span> <span class="nn">decimal</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">cStringIO</span>

<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">nostdout</span><span class="p">():</span>
    <span class="n">save_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="k">yield</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">save_stdout</span>


<span class="c1">##############################################################################################################################</span>
<span class="c1">##############################################################################################################################</span>
<span class="c1">## auto k point</span>
<span class="c1">##############################################################################################################################</span>
<span class="c1">##############################################################################################################################</span>
<span class="k">def</span> <span class="nf">_find_numkpoints</span><span class="p">(</span><span class="n">outputFile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;TAGGED FOR REMOVAL&gt;</span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">kpointNumRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;\s*number\sof\sk\spoints\s*=\s*(\d*).*\n&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">kpointNumRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">_get_pool_num</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets number of pools requested for this particular execution for engine.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">           None</span>

<span class="sd">    Returns:</span>
<span class="sd">          npool (int): number of pools requested for this particular execution for engine</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">hard_limit</span><span class="o">=</span><span class="mi">4</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outputFile</span><span class="p">:</span>
            <span class="n">outputFileString</span><span class="o">=</span><span class="n">outputFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">n_reduced_k</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_find_numkpoints</span><span class="p">(</span><span class="n">outputFileString</span><span class="p">)</span>
        <span class="n">execPrefix</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_ConfigSectionMap</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">,</span><span class="s1">&#39;exec_prefix&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_reduced_k</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">num_mpi_procs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;np\s*(\d*)&#39;</span><span class="p">,</span><span class="n">execPrefix</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">npool</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_reduced_k</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">num_mpi_procs</span><span class="o">%</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">hard_limit</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">npool</span><span class="o">=</span><span class="n">i</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">npool</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>




<span class="k">def</span> <span class="nf">detachPosFlags</span><span class="p">(</span><span class="n">positionString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Detach the position flags from the string of the atomic positions</span>

<span class="sd">    Arguments:</span>
<span class="sd">          positionString (str): string of the atomic positions</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          positions (list): atomic positions as a list</span>
<span class="sd">          flags (list): a list of the flags for by each position</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">posArray</span> <span class="o">=</span> <span class="n">positionString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">posArrayStripped</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">flagArray</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posArray</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posArray</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posArray</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">:</span>
                <span class="n">posArray</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">+=</span><span class="s1">&#39; 1 1 1&#39;</span>
            <span class="k">try</span><span class="p">:</span>

                <span class="n">posArrayStripped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posArray</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">flagArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posArray</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="n">flags</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flagArray</span><span class="p">)</span>
    <span class="n">positions</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posArrayStripped</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">positions</span><span class="p">,</span><span class="n">flags</span>




<span class="k">def</span> <span class="nf">attachPosFlags</span><span class="p">(</span><span class="n">positionString</span><span class="p">,</span><span class="n">flagString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reattaches the flags to the end of the atomic position</span>

<span class="sd">    Arguments:</span>
<span class="sd">          positionString (str): string of the atomic positions</span>
<span class="sd">          flagString (str): string of the flags</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          positionString (str): Positions with flags attached</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">positionStringSplit</span> <span class="o">=</span> <span class="n">positionString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">flagStringSplit</span> <span class="o">=</span> <span class="n">flagString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">combined</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">positionStringSplit</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">flagStringSplit</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flagStringSplit</span><span class="p">))]</span>
    <span class="n">positionString</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">positionString</span>

<span class="k">def</span> <span class="nf">checkStatus</span><span class="p">(</span><span class="n">PROJECT</span><span class="p">,</span><span class="n">SET</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="p">{},</span><span class="n">negate_status</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    function that loads the calclogs of each of the calculations in your run and </span>
<span class="sd">    displays status information about them.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          PROJECT        (str): Project name</span>
<span class="sd">    Keyword Arguments:</span>
<span class="sd">          SET            (str): Set name</span>
<span class="sd">          config         (str): Config file used</span>
<span class="sd">          step           (int): Which number step to seee (default all of them)</span>
<span class="sd">          status        (dict): dictionary containing the status and the value </span>
<span class="sd">                                you want to see (ex. {&#39;Error&#39;:True})</span>
<span class="sd">          negate_status (bool): Whether to take the calculations with that status or without it</span>

<span class="sd">    Returns:</span>
<span class="sd">          calcsList (list): list of each step of the calculations you</span>
<span class="sd">                           selected that satisfay the status criteria</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">calcsList</span><span class="o">=</span><span class="p">[]</span>    
    <span class="k">if</span> <span class="n">step</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>    
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">step</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">one_step</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">loadlogs</span><span class="p">(</span><span class="n">PROJECT</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span><span class="s1">&#39;step_</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">step</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span><span class="n">suppress_warning</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">calcsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one_step</span><span class="p">)</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">calcsList</span><span class="o">=</span><span class="p">[</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">loadlogs</span><span class="p">(</span><span class="n">PROJECT</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span><span class="s1">&#39;step_</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">step</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)]</span>

    <span class="n">outString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">calcsList</span><span class="p">)):</span>

        <span class="n">origLength</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
        <span class="n">string_prev</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Folder&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="s1">&#39;ID&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">25</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">string</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%-8s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">][</span><span class="n">ID</span><span class="p">][</span><span class="s1">&#39;__status__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string_prev</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
                <span class="n">string</span><span class="o">=</span><span class="n">string_prev</span>
                <span class="n">string_prev</span><span class="o">=</span><span class="n">string</span>
                <span class="n">header</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
            
        <span class="n">calcCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">status</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">negate_status</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;__status__&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="n">v</span><span class="p">:</span>
                                <span class="k">del</span> <span class="n">calcCopy</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span>                                
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;__status__&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">!=</span><span class="n">v</span><span class="p">:</span>
                                <span class="k">del</span> <span class="n">calcCopy</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span>                                
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="n">headerString</span><span class="o">=</span><span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="n">outString</span><span class="o">+=</span>  <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">headerString</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">outString</span><span class="o">+=</span>  <span class="s1">&#39;STEP: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;  | </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">calcCopy</span><span class="p">),</span><span class="n">origLength</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">outString</span><span class="o">+=</span>  <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">headerString</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">outString</span><span class="o">+=</span>  <span class="n">headerString</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">outString</span><span class="o">+=</span>  <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">headerString</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcCopy</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">stringStatusList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%-8s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;__status__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
                <span class="n">string</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="n">ID</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">25</span><span class="p">)]</span>
                <span class="n">string</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">stringStatusList</span><span class="p">)</span>
                <span class="n">outString</span><span class="o">+=</span> <span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="c1">#copy back for return of subset</span>
            <span class="n">calcsList</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">calcCopy</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">calcsList</span>
            
<span class="k">def</span> <span class="nf">_getOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets string of output for that particular step in the workflow for a single calcualtion</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">           None</span>

<span class="sd">    Returns:</span>
<span class="sd">          outFileString (str): output of that particular step in the workflow</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outFilePath</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span>  <span class="o">%</span> <span class="n">ID</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outFilePath</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">outFileString</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outFileString</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;could not get output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outFilePath</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;could not get output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outFilePath</span>

<span class="k">def</span> <span class="nf">getCellVolume</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">conventional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets the cell volume from output if avaiable and if not gets it from the input</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>


<span class="sd">    Keyword Arguments:</span>
<span class="sd">          conventional (bool): return the volume of the primitive or conventional lattice </span>
<span class="sd">          string (bool): to return as a string or as a float</span>

<span class="sd">    Returns:</span>
<span class="sd">          vol (str): Volume of the cell </span>

<span class="sd">    &#39;&#39;&#39;</span>


    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">ID</span>
        <span class="n">outFileString</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">ur&#39;unit-cell volume\s*=\s*([0-9.-]*)&#39;</span><span class="p">,</span><span class="n">outFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>




    <span class="k">except</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">input_str</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_loadOneCalc</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="p">)[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>
            <span class="n">cell_vec</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellMatrixFromInput</span><span class="p">(</span><span class="n">input_str</span><span class="p">)</span>
            <span class="n">vol</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellVolumeFromVectors</span><span class="p">(</span><span class="n">cell_vec</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span> <span class="n">e</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;could not get volume from output&#39;</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s1">&#39;could not get volume from output&#39;</span>

    <span class="k">if</span> <span class="n">conventional</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;ibrav&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">13</span><span class="p">]:</span>
            <span class="n">vol</span><span class="o">*=</span><span class="mf">2.0</span>
        <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">]:</span>
            <span class="n">vol</span><span class="o">*=</span><span class="mf">4.0</span>

    <span class="k">if</span> <span class="n">string</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">vol</span>


<span class="k">def</span> <span class="nf">getCellVolumeFromVectors</span><span class="p">(</span><span class="n">cellInput</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates cell volume from basis vectors</span>

<span class="sd">    Arguments:</span>
<span class="sd">          cellInput (numpy.matrix): basis set defining the cell</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          vol (float): volume of the cell (may be not scaled. it depends on your input matrix)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vol</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">cellInput</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cellInput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellInput</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">vol</span>

<span class="k">def</span> <span class="nf">_getInputFileString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets the string of the input that step of the calculation</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          inFileString (str): input string to that calculation step</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFile</span><span class="p">:</span>
        <span class="n">inFileString</span> <span class="o">=</span> <span class="n">inFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">inFileString</span> 


<span class="k">def</span> <span class="nf">_getInitialInputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets initial input to the workflow </span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          inFileString (str): initial input to the workflow </span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFile</span><span class="p">:</span>
        <span class="n">inFileString</span> <span class="o">=</span> <span class="n">inFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">inFileString</span> 


<span class="k">def</span> <span class="nf">_getInitialOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets initial output to the workflow </span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          inFileString (str): initial output to the workflow </span>

<span class="sd">    &#39;&#39;&#39;</span>


    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
        <span class="n">outFileString</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">outFileString</span> 



<span class="k">def</span> <span class="nf">_getSymList</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets symmetry operations from output if available</span>

<span class="sd">    Arguments:</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">       </span>
<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          joinedList (str): a string of the sym ops pulled from the engine output</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
        <span class="n">outFileString</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">joinedList</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;isym.*\n&#39;</span><span class="p">,</span><span class="n">outFileString</span><span class="p">)))</span>
    <span class="n">joinedList</span> <span class="o">=</span> <span class="s2">&quot;Symmetry Operations:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">joinedList</span>
    <span class="k">return</span> <span class="n">joinedList</span>

<span class="k">def</span> <span class="nf">_moveToSavedir</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Move a file to the savedir specified in the config file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          filePath (str): path of the file to be copied</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_ConfigSectionMap</span><span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">,</span><span class="s1">&#39;save_dir&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">savedir</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_ConfigSectionMap</span><span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">,</span><span class="s1">&#39;save_dir&#39;</span><span class="p">)</span>
                <span class="n">workdir</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_ConfigSectionMap</span><span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">,</span><span class="s1">&#39;work_dir&#39;</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">workdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="n">zeroBaseDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
                <span class="n">zeroBaseDirName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
                <span class="n">firstBaseDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">zeroBaseDir</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">secondBaseDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">firstBaseDir</span><span class="p">)</span>
                    <span class="n">secondBaseDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">secondBaseDir</span><span class="p">)</span>
                    <span class="n">firstBaseDir</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">firstBaseDir</span><span class="p">)</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="n">secondBaseDir</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>


                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">savedir</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">configFileLocation</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_getConfigFile</span><span class="p">()</span>
                    <span class="n">savedir</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">configFileLocation</span><span class="p">,</span> <span class="n">savedir</span><span class="p">)</span>


                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savedir</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savedir</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not transfer </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">. </span><span class="si">%s</span><span class="s1"> does not exist and could not be created. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">savedir</span><span class="p">,</span><span class="n">savedir</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">firstBaseDir</span><span class="p">)</span><span class="o">==</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">workdir</span><span class="p">):</span>
                    <span class="n">firstLevel</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">zeroBaseDir</span><span class="p">))</span>
                    <span class="n">firstLevelNew</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savedir</span><span class="p">,</span><span class="n">firstLevel</span><span class="p">)</span>
                    <span class="n">secondLevelNew</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
                    <span class="n">savedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">firstLevelNew</span><span class="p">,</span><span class="n">zeroBaseDirName</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">secondBaseDir</span><span class="p">)</span><span class="o">==</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">workdir</span><span class="p">):</span>

                    <span class="n">firstLevel</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">zeroBaseDir</span><span class="p">))</span>
                    <span class="n">secondLevel</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">firstBaseDir</span><span class="p">))</span>
                    <span class="n">firstLevelNew</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savedir</span><span class="p">,</span><span class="n">secondLevel</span><span class="p">)</span>
                    <span class="n">secondLevelNew</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">firstLevelNew</span><span class="p">,</span><span class="n">firstLevel</span><span class="p">)</span>

                    <span class="n">savedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">secondLevelNew</span><span class="p">,</span><span class="n">zeroBaseDirName</span><span class="p">,)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">firstLevelNew</span><span class="o">=</span><span class="n">savedir</span>
                    <span class="n">secondLevelNew</span><span class="o">=</span><span class="s1">&#39;&#39;</span>



                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">firstLevelNew</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">firstLevelNew</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not transfer </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">. </span><span class="si">%s</span><span class="s1"> does not exist and could not be created. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">firstLevelNew</span><span class="p">,</span><span class="n">firstLevelNew</span><span class="p">))</span>


                <span class="k">if</span> <span class="n">secondLevelNew</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">secondLevelNew</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">secondLevelNew</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not transfer </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">. </span><span class="si">%s</span><span class="s1"> does not exist and could not be created. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">secondLevelNew</span><span class="p">,</span><span class="n">secondLevelNew</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">savedir</span><span class="p">):</span>
                    <span class="n">savedir</span><span class="o">+=</span><span class="s1">&#39;_SAVEDIR&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savedir</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savedir</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not transfer </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">. </span><span class="si">%s</span><span class="s1"> does not exist and could not be created. &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">savedir</span><span class="p">,</span><span class="n">savedir</span><span class="p">))</span>

                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp  </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">savedir</span><span class="p">)))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">grabEnergy</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Grabs energy for oneCalc and adds the keyword &#39;Energy&#39; with the value of the energy grabbed from the output</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">                          with the &#39;Energy&#39; keyword added</span>
<span class="sd">     </span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">newDict</span><span class="o">=</span><span class="n">grabEnergyOut</span><span class="p">({</span><span class="n">ID</span><span class="p">:</span><span class="n">oneCalc</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">newDict</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">grabEnergyOut</span><span class="p">(</span><span class="n">calcs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Goes in every subdirectory of the calculation and searches</span>
<span class="sd">    for the final energy of the calculation and returns a new </span>
<span class="sd">    copy of the input dictionary that includes the final energy.</span>

<span class="sd">    Arguments:</span>
<span class="sd">	  calcs (dict): dictionary of dictionaries of calculations</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">	  calcs (dict): dictionary of dictionaries of calculations with energy added</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">calcs1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span>
    <span class="n">energyRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(?:(?:(?:(?:\!\s+)total)|(?:Final)) en\w+\s*=\s+(.+?)Ry)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs1</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">ID</span><span class="p">)):</span>
                <span class="k">with</span> <span class="n">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">ID</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
                    <span class="n">outFileString</span><span class="o">=</span><span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="c1">#searches for either total energy or final energy in the scf output and </span>
                    <span class="c1">#adds it to the output dictionary</span>
                    <span class="n">finalEnergy</span><span class="o">=</span><span class="n">energyRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">finalEnergy</span><span class="p">):</span>
                        <span class="n">energyFloat</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">finalEnergy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                        <span class="n">calcs</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">energyFloat</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1">#if the energy can not be found the test entry is deleted from the output dictionary</span>
                        <span class="n">outCalcPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span><span class="p">)</span>
                        <span class="nb">print</span> <span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span>
                        <span class="n">calcs</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                
                <span class="n">outCalcPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span><span class="p">)</span>
                <span class="nb">print</span> <span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span>
                <span class="n">calcs</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">outCalcPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s1">&#39;could not get energy. check output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">outCalcPath</span>
    <span class="k">return</span> <span class="n">calcs</span>



<span class="k">def</span> <span class="nf">getForce</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets last entry of the total force in the calculation from the engine output.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">           None</span>

<span class="sd">    Returns:</span>
<span class="sd">            force_string (str): Total force from engine output</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">forceRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(Total force =\s+[0-9.]+)&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">force_string</span> <span class="o">=</span> <span class="n">forceRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">output</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">string</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">force_string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">force_string</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>


<span class="k">def</span> <span class="nf">getStress</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="n">stressRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(\s+total\s+stress.+(?:\(kbar\).+\n)(?:.+\n)*)&#39;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">stress_string</span> <span class="o">=</span> <span class="n">stressRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">output</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">stress_string</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>


<span class="k">def</span> <span class="nf">getCellOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    retreives information about the structure and its chemistry and prints</span>
<span class="sd">    it into a file in the AFLOWpi folder inside the project/set directories</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          outputStr (str): Output of the report for the calculation</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outputStr</span><span class="o">=</span><span class="s1">&#39;********************************************************</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">outputStr</span><span class="o">+=</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">folder</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">scfOutput</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">ID</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="n">scfOutput</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;No caclulation output available for </span><span class="si">%s</span><span class="s2">. Are you sure the test ran properly?&quot;</span> <span class="o">%</span> <span class="n">scfOutput</span>

        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">scfInput</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.in&#39;</span> <span class="o">%</span> <span class="n">ID</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="n">scfInput</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFile</span><span class="p">:</span>

            <span class="n">inLines</span> <span class="o">=</span> <span class="n">inFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>


        <span class="nb">print</span> <span class="s2">&quot;No caclulation output available for </span><span class="si">%s</span><span class="s2">. Are you sure the test ran properly?&quot;</span> <span class="o">%</span> <span class="n">scfOutput</span>
        <span class="k">return</span>
    <span class="n">retrDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="n">scfInput</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="s1">&#39;********************************************************</span><span class="se">\n\n</span><span class="s1">&#39;</span>        
        <span class="n">coordRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(Begin final coordinates(?:.*\n)+End final coordinates)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
        <span class="n">energyRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(?:(?:(?:(?:\!\s+)total)|(?:Final)) en\w+\s*=\s+(.+?)Ry)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

        <span class="n">stressRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(\s+total\s+stress.+(?:\(kbar\).+\n)(?:.+\n)*)&#39;</span><span class="p">)</span>
        <span class="n">forceRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(Total force =\s+[0-9.]+)&#39;</span><span class="p">)</span>



        <span class="n">coord</span>   <span class="o">=</span> <span class="n">coordRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">energyArr</span> <span class="o">=</span> <span class="n">energyRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">stressArr</span> <span class="o">=</span> <span class="n">stressRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">forceArr</span>  <span class="o">=</span> <span class="n">forceRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>


    <span class="k">try</span><span class="p">:</span>
        <span class="n">symList</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getSymList</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">)</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="n">symList</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="s1">&#39;Total Energy &#39;</span><span class="o">+</span><span class="n">energyArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; Ry</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">energyArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="n">forceArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">forceArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">outputStr</span><span class="o">+=</span><span class="n">stressArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">stressArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">pass</span>

    <span class="c1">###################</span>
    <span class="c1">####CELL PARAMS####</span>
    <span class="c1">###################</span>
    <span class="n">atomicCELLPARAMRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;Begin final coordinates\n.+\n+.+\n(.+)\n(.+)\n(.+)\n&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="n">initialParamsRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;crystal axes: \(cart. coord. in units of alat\)\n(.+)\n(.+)\n(.+)\n&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

    <span class="n">inputStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">atomCELLPARAMSortList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">alatStr</span> <span class="o">=</span>  <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;alat\s*=\s*[0-9.-]*&#39;</span><span class="p">,</span><span class="n">lines</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">alatStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">atomicCELLPARAMArr</span> <span class="o">=</span> <span class="n">atomicCELLPARAMRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">atomicCELLSTRING</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">atomicCELLPARAMArr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">atomicCELLSTRING</span><span class="o">=</span><span class="s1">&#39;Failed to get final coordinated. May have had convergence issue&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">atomicCELLPARAMArr</span> <span class="o">=</span> <span class="n">atomicCELLPARAMArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">atomicCELLPARAMArr</span> <span class="o">=</span> <span class="n">initialParamsRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">atomicCELLPARAMArr</span> <span class="o">=</span> <span class="n">atomicCELLPARAMArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">atomicCELLPARAMArr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="n">splitAtomicCELLPARAM</span> <span class="o">=</span> <span class="n">atomicCELLPARAMArr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">splitAtomicCELLPARAM</span> <span class="o">=</span> <span class="n">atomicCELLPARAMArr</span>
            <span class="n">testDictString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">outputStr</span><span class="o">+=</span> <span class="n">alatStr</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">CELL_PARAMETERS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">atomicCELLSTRING</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">inputStr</span><span class="o">+=</span><span class="n">alatStr</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">CELL_PARAMETERS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">atomicCELLSTRING</span>
            <span class="n">testDictString</span><span class="o">+=</span><span class="n">atomicCELLSTRING</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">testDictString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">testDictString</span>                
    <span class="k">except</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1">######################</span>
    <span class="c1">###ATOMIC POSITIONS###</span>
    <span class="c1">######################</span>
    <span class="n">atomicNLRegex</span>      <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(ATOMIC_POSITIONS\s*.+\n)&#39;</span><span class="p">)</span>
    <span class="n">atomicPosRegex</span>     <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
                <span class="n">inputStr</span><span class="o">+=</span><span class="n">atomicNLRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">atomPosSortList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
                <span class="n">atomicPosArr</span> <span class="o">=</span> <span class="n">atomicPosRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">outputStr</span><span class="o">+=</span><span class="s2">&quot;ATOMIC_POSITIONS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">atomicPosArr</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                <span class="n">splitAtomicPos</span> <span class="o">=</span> <span class="n">atomicPosArr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">splitAtomicPos</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">atomSplit</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">formattedAtomPos</span> <span class="o">=</span> <span class="n">atomSplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">atomSplit</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">atomSplit</span><span class="p">))])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="n">atomPosSortList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formattedAtomPos</span><span class="p">)</span>
        <span class="n">atomPosSortList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">atomPosSortList</span><span class="p">)</span>
        <span class="n">testDictString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">formattedAtomPos</span> <span class="ow">in</span> <span class="n">atomPosSortList</span><span class="p">:</span>
                <span class="n">testDictString</span><span class="o">+=</span><span class="n">formattedAtomPos</span>
                <span class="n">inputStr</span><span class="o">+=</span><span class="n">formattedAtomPos</span>

        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">testDictString</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="n">retrDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">baseDir</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;/AFLOWpi/summary.log&#39;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">baseDir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">baseDir</span><span class="p">,</span><span class="s1">&#39;a+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
        <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outputStr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outputStr</span>

<span class="k">def</span> <span class="nf">_getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reads the output from the SCF or relax calculation to get the primitive cell parameters</span>
<span class="sd">    produced by the calculation. If it fails it defaults to the input lattice vectors</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary of a single calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          alat (float): the scale for the lattice vectors</span>
<span class="sd">          cell_matrix (numpy.array): the unscaled primitive lattice vectors</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">scfOutput</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">scfOutput</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>




        <span class="n">cellParams</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">cell_parameters</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
        <span class="n">splitInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>
        <span class="n">alat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">])</span>
        <span class="n">paramMatrix</span><span class="o">=</span><span class="n">_cellStringToMatrix</span><span class="p">(</span><span class="n">cellParams</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cellParams</span><span class="p">):</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">alat</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">paramMatrix</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">alat</span><span class="p">),</span><span class="n">paramMatrix</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">initialParams</span><span class="p">):</span>
                <span class="n">paramMatrixList</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">initialParams</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">paramArray</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                        <span class="n">paramMatrixList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">paramArray</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">paramArray</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">paramArray</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
                <span class="n">paramMatrix</span> <span class="o">=</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">paramMatrixList</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S10&#39;</span><span class="p">)</span>
                <span class="n">paramMatrix</span> <span class="o">=</span> <span class="n">paramMatrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">alat</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">paramMatrix</span>

        <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;No card!&#39;</span>
                <span class="k">return</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellMatrixFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
     
        <span class="n">paramMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellMatrixFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>

        <span class="n">alat</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getAlatFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span> 
        <span class="n">paramMatrix</span><span class="o">/=</span><span class="n">alat</span>

        <span class="k">return</span> <span class="n">alat</span><span class="p">,</span><span class="n">paramMatrix</span> 

<span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">conventional</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">conventional</span><span class="p">:</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getConventionalCellFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellMatrixFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">free2abc</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">bohr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
<span class="k">def</span> <span class="nf">_getAlatFromInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Grabs the value of alat from the QE pwscf input</span>

<span class="sd">    Arguments:</span>
<span class="sd">          inputString</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          alat (float): the alat scale for the primitive lattice vectors</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">splitInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;A&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;a&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">getRecipParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    reads the output from the SCF or relax calculation to get the </span>
<span class="sd">    reciprocal cell parameters produced by the calculation.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary of a single calculation</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          alat (float): alat multiplier</span>
<span class="sd">          paramMatrix (numpy.matrix): matrix of reciprocal lattice vectors</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">scfOutput</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">scfOutput</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">re0</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;^.+reciprocal axes: \(\cart. coord. in units 2 .+\)\s*\n^.+\((.+)\)\s*\n^.+\((.+)\)\s*\n^.+\((.+)\)\s*\n&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
            <span class="n">re2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;Begin final coordinates\n.+\n+.+alat= ([\d.]+).+\n&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

            <span class="n">alat</span> <span class="o">=</span> <span class="n">re2</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">cellParams</span> <span class="o">=</span> <span class="n">re0</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cellParams</span><span class="p">):</span>
                    <span class="n">paramMatrixList</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">cellParams</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">paramArray</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                            <span class="n">paramMatrixList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paramArray</span><span class="p">)</span>

                    <span class="n">paramMatrixList</span> <span class="o">=</span> <span class="p">[</span><span class="n">paramMatrixList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">paramMatrixList</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">paramMatrixList</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                    <span class="n">paramMatrix</span> <span class="o">=</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">paramMatrixList</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S10&#39;</span><span class="p">)</span>
                    <span class="n">paramMatrix</span> <span class="o">=</span> <span class="n">paramMatrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

                    <span class="k">return</span> <span class="n">alat</span><span class="p">,</span><span class="n">paramMatrix</span>

            <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s1">&#39;No card!&#39;</span>
                    <span class="k">return</span> <span class="n">alat</span><span class="p">,[[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]]</span>
	

<span class="k">def</span> <span class="nf">_getAtomNum</span><span class="p">(</span><span class="n">inputString</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets the number of atoms from a QE pwscf input file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          inputString (str): String of a QE pwscf input file</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          strip (bool): If True then Cr2,Cr45,Cr would be all considered the same species</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">          numOfEach (collections.OrderedDict): dictionary with keys for the species labels and values the number</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">nullstr</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="c1">##for the string in the dictionary of dictionaries</span>
    <span class="n">inputSplit</span> <span class="o">=</span> <span class="n">inputString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="sd">&#39;&#39;&#39;find all matches to get each of the atoms in the ATOMIC_POSITIONS LIST&#39;&#39;&#39;</span>
    <span class="n">atomList</span> <span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">atomList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atomList</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">strip</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">atomList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;1234567890&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atomList</span><span class="p">]</span>
    <span class="sd">&#39;&#39;&#39;put those matches into a dictionary of the species and its count&#39;&#39;&#39;</span>
    <span class="n">numOfEach</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">atomList</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">atomList</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">numOfEach</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="k">def</span> <span class="nf">_getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">latex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Determines the name of the compound by looking at the input and</span>
<span class="sd">    finds the stoichiometric number of species in the compound</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): one calculation that is a dictionary of values associated with that calculation</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          strip (bool): strip species number when it equals 1</span>
<span class="sd">          latex (bool): output string in latex format</span>

<span class="sd">    Returns:</span>
<span class="sd">          name (str): chemical namex</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">inputString</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>
    <span class="n">numOfEach</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getAtomNum</span><span class="p">(</span><span class="n">inputString</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="n">strip</span><span class="p">)</span> 
    <span class="sd">&#39;&#39;&#39;get GCD of it&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">GCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">a</span>
            <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">GCD</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;cycle through the number of each species for each calculation</span>
<span class="sd">    to get the GCD of all the number of species in the calculation&#39;&#39;&#39;</span>
    <span class="n">stoicGCD</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">GCD</span><span class="p">,</span> <span class="n">numOfEach</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">numOfEachCopy</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">numOfEach</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;go through and divide the number of each species by the GCD</span>
<span class="sd">    and update the dictionary with {species:number of them in the cell}&#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">species</span><span class="p">,</span><span class="n">num</span> <span class="ow">in</span> <span class="n">numOfEach</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">numOfEachCopy</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="n">numOfEach</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">/</span> <span class="n">stoicGCD</span>

    <span class="sd">&#39;&#39;&#39;builds name for printing in order of elements are listed in the </span>
<span class="sd">    ATOMIC POSTIONS from top of that list is first atom down to bottom </span>
<span class="sd">    of the list is the last species in the name&#39;&#39;&#39;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">latex</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">name</span><span class="o">+=</span><span class="s1">&#39;$&#39;</span>

    <span class="k">if</span> <span class="n">order</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">numOfEachCopy</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="n">numOfEachCopy</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
        <span class="n">number</span><span class="o">=</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">strip</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">value</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">number</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">latex</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">value</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">name</span><span class="o">+=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_{</span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">number</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="o">+=</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">number</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;returns the name of the compound ready to print with LaTeX rendering&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">latex</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">name</span><span class="o">+=</span><span class="s1">&#39;$&#39;</span>

    <span class="k">return</span> <span class="n">name</span>


<span class="k">def</span> <span class="nf">_getPathFromFile</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reads the input file for the band structure calculation and retrieves the </span>
<span class="sd">    k point path from the file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): one calculation that is a dictionary of values associated with that calculation</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          path (str): k point path for bands in the bands pwscf input file</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">calcID</span>  <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">oneCalc</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">bandsIn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.in&#39;</span> <span class="o">%</span> <span class="n">calcID</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bandsIn</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">bandsInFile</span><span class="p">:</span>
                    <span class="n">bandsInString</span> <span class="o">=</span> <span class="n">bandsInFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">k_points</span><span class="p">(</span><span class="n">bandsInString</span><span class="p">)</span>		



            <span class="k">return</span> <span class="n">path</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span> <span class="n">e</span>
            <span class="nb">print</span> <span class="s1">&#39;Did you run ppBands and did it complete properly?&#39;</span>
            <span class="k">return</span> 

<span class="c1">###############################################################################</span>
<span class="c1">###############################################################################</span>
<span class="k">def</span> <span class="nf">_getHighSymPoints</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Searching for the ibrav number in the input file for the calculation</span>
<span class="sd">    to determine the path for the band structure calculation</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">                </span>
<span class="sd">    Keyword Arguments:</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Returns:</span>
<span class="sd">          special_points (list): list of the HSP names</span>
<span class="sd">          band_path (str): path in string form</span>

<span class="sd">    &#39;&#39;&#39;</span>



    <span class="n">ibrav</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ibravRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;ibrav[\s]*=[\s]*([\d]+)\s*[,</span><span class="se">\n</span><span class="s1">]*&#39;</span><span class="p">)</span>

    <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ibravRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s1">&#39;Lattice type </span><span class="si">%s</span><span class="s1"> is not implemented&#39;</span> <span class="o">%</span> <span class="n">ibrav</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;The ibrav value from expresso has not yet been implemented to the framework&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span>


    <span class="n">alat</span><span class="p">,</span><span class="n">cellOld</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>        
    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span>  <span class="n">free2abc</span><span class="p">(</span><span class="n">cellOld</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">bohr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">###############################################################################</span>
<span class="c1">###############################################################################</span>
    <span class="k">if</span>   <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>  <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;CUB&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>  <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;FCC&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>  <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;BCC&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>  <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;HEX&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>  <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;TET&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">8</span><span class="p">:</span>  <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;ORC&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span>  <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;ORCC&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span> <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;ORCI&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">:</span>   <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;RHL1&#39;</span>
        <span class="k">elif</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">:</span> <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;RHL2&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">):</span>   <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;BCT1&#39;</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">):</span> <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;BCT2&#39;</span>
        <span class="k">else</span><span class="p">:</span>        <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;BCC&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span><span class="mf">1.0</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>  <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;ORCF1&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span> <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;ORCF2&#39;</span>
        <span class="k">else</span><span class="p">:</span>                              <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;ORCF2&#39;</span>
    <span class="k">elif</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">14</span><span class="p">):</span>
        <span class="n">minAngle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">([</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">])</span>
        <span class="n">maxAngle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amax</span><span class="p">([</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">alpha</span><span class="o">==</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">beta</span><span class="o">==</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">gamma</span><span class="o">==</span><span class="mf">90.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alpha</span><span class="o">&gt;=</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">beta</span><span class="o">&gt;=</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">gamma</span><span class="o">&gt;=</span><span class="mf">90.0</span><span class="p">:</span> <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;TRI2A&#39;</span>
            <span class="k">if</span> <span class="n">alpha</span><span class="o">&lt;=</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">beta</span><span class="o">&lt;=</span><span class="mf">90.0</span> <span class="ow">or</span> <span class="n">gamma</span><span class="o">&lt;=</span><span class="mf">90.0</span><span class="p">:</span> <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;TRI2B&#39;</span>
        <span class="k">elif</span> <span class="n">minAngle</span><span class="o">&gt;</span><span class="mf">90.0</span><span class="p">:</span>                              <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;TRI1A&#39;</span>
        <span class="k">elif</span> <span class="n">maxAngle</span><span class="o">&lt;</span><span class="mi">90</span><span class="p">:</span>                                <span class="n">ibrav_var</span> <span class="o">=</span>  <span class="s1">&#39;TRI1B&#39;</span>
<span class="c1">###############################################################################</span>
<span class="c1">###############################################################################</span>
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;CUB&#39;</span><span class="p">:</span>
        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-M-gG-R-X|M-R&#39;</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="s1">&#39;M&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="s1">&#39;R&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                           <span class="s1">&#39;X&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)}</span>
                           
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;FCC&#39;</span><span class="p">:</span>
        <span class="n">default_band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-W-K-gG-L-U-W-L-K|U-X&#39;</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;K&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">),</span>
                          <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;U&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">,</span> <span class="mf">0.625</span><span class="p">),</span>
                          <span class="s1">&#39;W&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
                          <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)}</span>
                          
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;BCC&#39;</span><span class="p">:</span>
        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-H-N-gG-P-H|P-N&#39;</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                          <span class="s1">&#39;H&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;P&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,),</span> 
                          <span class="s1">&#39;N&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)}</span>
            
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;HEX&#39;</span><span class="p">:</span>
        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-M-K-gG-A-L-H-A|L-M|K-H&#39;</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                          <span class="s1">&#39;A&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;H&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;K&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;M&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)}</span>
        
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;RHL1&#39;</span><span class="p">:</span>
        <span class="n">eta1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">eta2</span> <span class="o">=</span> <span class="n">eta1</span><span class="o">+</span><span class="mf">1.0</span>
        <span class="n">eta</span><span class="o">=</span><span class="n">eta1</span><span class="o">/</span><span class="n">eta2</span>
        <span class="n">nu</span> <span class="o">=</span><span class="mf">0.75</span><span class="o">-</span><span class="n">eta</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-L-B1|B-Z-gG-X|Q-F-P1-Z|L-P&#39;</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;B&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">),</span>
                          <span class="s1">&#39;B1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
                          <span class="s1">&#39;F&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;L1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;P&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">),</span>
                          <span class="s1">&#39;P1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">nu</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">nu</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">),</span>
                          <span class="s1">&#39;P2&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">eta</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
                          <span class="s1">&#39;Q&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">nu</span><span class="p">),</span>
                          <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)}</span>
         
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;RHL2&#39;</span><span class="p">:</span>
        <span class="n">eta</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">nu</span> <span class="o">=</span><span class="mf">0.75</span><span class="o">-</span><span class="n">eta</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-P-Z-Q-gG-F-P1-Q1-L-Z&#39;</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;F&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;P&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">nu</span><span class="p">,</span> <span class="o">-</span><span class="n">nu</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">nu</span><span class="p">),</span>
                          <span class="s1">&#39;P1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nu</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
                          <span class="s1">&#39;Q&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
                          <span class="s1">&#39;Q1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">),</span>
                          <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)}</span> 

    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;TET&#39;</span><span class="p">:</span>
        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-M-gG-Z-R-A-Z|X-R|M-A&#39;</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;A&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;M&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;R&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;BCT1&#39;</span><span class="p">:</span>
       <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-M-gG-Z-P-N-Z1-M|X-P&#39;</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;M&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;N&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;P&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
                         <span class="s1">&#39;X&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;Z&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">),</span>
                         <span class="s1">&#39;Z1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">)}</span>
         
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;BCT2&#39;</span><span class="p">:</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-Y-gS-gG-Z-gS1-N-P-Y1-Z|X-P&#39;</span>
       <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
       <span class="n">zeta</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;N&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;P&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
                         <span class="s1">&#39;gS&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
                         <span class="s1">&#39;gS1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">),</span>
                         <span class="s1">&#39;X&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;Y&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;Y1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">zeta</span><span class="p">),</span>
                         <span class="s1">&#39;Z&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)}</span>
         
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;ORC&#39;</span><span class="p">:</span>
         <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-S-Y-gG-Z-U-R-T-Z|Y-T|U-X|S-R&#39;</span>
         <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>  <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="s1">&#39;R&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                           <span class="s1">&#39;S&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="s1">&#39;T&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                           <span class="s1">&#39;U&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                           <span class="s1">&#39;X&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="s1">&#39;Y&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="s1">&#39;Z&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;ORCF1&#39;</span><span class="p">:</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-Y-T-Z-gG-X-A1-Y|T-X1|X-A-Z|L-gG&#39;</span>
       <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">zeta</span> <span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;A&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">zeta</span><span class="p">),</span>
                         <span class="s1">&#39;A1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">zeta</span><span class="p">),</span>
                         <span class="s1">&#39;L&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;T&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;X&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
                         <span class="s1">&#39;X1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">),</span>
                         <span class="s1">&#39;Y&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;Z&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;ORCF2&#39;</span><span class="p">:</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-Y-C-D-X-gG-Z-D1-H-C|C1-Z|X-H1|H-Y|L-gG&#39;</span>
       <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">delta</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;C&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">),</span>
                         <span class="s1">&#39;C1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
                         <span class="s1">&#39;D&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">delta</span><span class="p">),</span>
                         <span class="s1">&#39;D1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">+</span><span class="n">delta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">delta</span><span class="p">),</span>
                         <span class="s1">&#39;L&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;H&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">phi</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">phi</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;H1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">phi</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;X&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;Y&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;Z&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),}</span>

    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;ORCF3&#39;</span><span class="p">:</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-Y-T-Z-gG-X-A1-Y|X-A-Z|L-R&#39;</span>
       <span class="n">eta</span> <span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">zeta</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;A&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">zeta</span><span class="p">),</span>
                         <span class="s1">&#39;A1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">zeta</span><span class="p">),</span>
                         <span class="s1">&#39;L&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;T&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;X&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
                         <span class="s1">&#39;X1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">),</span>
                         <span class="s1">&#39;Y&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;Z&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;ORCC&#39;</span><span class="p">:</span>
       <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-S-R-A-Z-gG-Y-X1-A1-T-Y|Z-T&#39;</span>
       <span class="n">zeta</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
       <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;A&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;A1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;R&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;S&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;T&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                         <span class="s1">&#39;X&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;X1&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">zeta</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;Y&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="s1">&#39;Z&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)}</span>
         
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;ORCI&#39;</span><span class="p">:</span>
         <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;gG-X-L-T-W-R-X1-Z-gG-Y-S-W|L1-Y|Y1-Z&#39;</span>
         <span class="n">chi</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
         <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
         <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
         <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">b</span> <span class="o">+</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
         <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                           <span class="s1">&#39;L&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">delta</span><span class="p">),</span>
                           <span class="s1">&#39;L1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="o">-</span><span class="n">mu</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">delta</span><span class="p">),</span>
                           <span class="s1">&#39;L2&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">delta</span><span class="p">,</span> <span class="o">-</span><span class="n">mu</span><span class="p">),</span>
                           <span class="s1">&#39;R&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="s1">&#39;S&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="s1">&#39;T&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                           <span class="s1">&#39;W&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">),</span>
                           <span class="s1">&#39;X&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">chi</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">chi</span><span class="p">),</span>
                           <span class="s1">&#39;X1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">chi</span><span class="p">,</span> <span class="o">-</span><span class="n">chi</span><span class="p">),</span>
                           <span class="s1">&#39;Y&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span>
                           <span class="s1">&#39;Y1&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">eta</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="o">-</span><span class="n">eta</span><span class="p">),</span>
                           <span class="s1">&#39;Z&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)}</span>
   
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;TRI1A&#39;</span><span class="p">:</span>        
        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;X-gG-Y|L-gG-Z|N-gG-M|R-gG&#39;</span> 
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;L&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;M&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;N&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;R&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;X&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;Y&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;Z&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),}</span>
        
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;TRI2A&#39;</span><span class="p">:</span>        
        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;X-gG-Y|L-gG-Z|N-gG-M|R-gG&#39;</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;L&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;M&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;N&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;R&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;X&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;Y&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;Z&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),}</span>
 
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;TRI1B&#39;</span><span class="p">:</span>        
        <span class="n">band_path</span> <span class="o">=</span> <span class="s2">&quot;X-gG-Y|L-gG-Z|N-gG-M|R-gG&quot;</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;L&#39;</span>     <span class="p">:</span> <span class="p">(</span> <span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;M&#39;</span>     <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;N&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;R&#39;</span>     <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;X&#39;</span>     <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;Y&#39;</span>     <span class="p">:</span> <span class="p">(</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;Z&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),}</span>

    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;TRI2B&#39;</span><span class="p">:</span>        
        <span class="n">band_path</span> <span class="o">=</span> <span class="s1">&#39;X-gG-Y|L-gG-Z|N-gG-M|R-gG&#39;</span>
        <span class="n">special_points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gG&#39;</span>    <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;L&#39;</span>     <span class="p">:</span> <span class="p">(</span> <span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;M&#39;</span>     <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;N&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;R&#39;</span>     <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                          <span class="s1">&#39;X&#39;</span>     <span class="p">:</span> <span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;Y&#39;</span>     <span class="p">:</span> <span class="p">(</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
                          <span class="s1">&#39;Z&#39;</span>     <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),}</span>
            
    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;MCLC&#39;</span><span class="p">:</span>
       <span class="n">sin_gamma</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cos_gamma</span><span class="p">))</span> 
       <span class="n">mu</span>        <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
       <span class="n">delta</span>     <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">cos_gamma</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">a</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
       <span class="n">xi</span>        <span class="o">=</span> <span class="n">mu</span> <span class="o">-</span><span class="mf">0.25</span><span class="o">*+</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">b</span><span class="o">*</span><span class="n">cos_gamma</span><span class="o">/</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="p">(</span><span class="n">sin_gamma</span><span class="o">**</span><span class="mf">2.0</span><span class="p">))</span>
       <span class="n">eta</span>       <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">xi</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">cos_gamma</span><span class="o">/</span><span class="n">b</span>
       <span class="n">phi</span>       <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">xi</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">mu</span>
       <span class="n">psi</span>       <span class="o">=</span> <span class="n">eta</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">delta</span>

    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;MCLC2&#39;</span><span class="p">:</span>        
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">ibrav_var</span><span class="o">==</span><span class="s1">&#39;MCLC5&#39;</span><span class="p">:</span>        
        <span class="k">pass</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def MCL(cellOld):</span>
<span class="sd">       a1 = cellOld[0][0]</span>
<span class="sd">       b1 = (cellOld[1][0]**2 + cellOld[1][1]**2)**(0.5)</span>
<span class="sd">       c1 = cellOld[2][2]</span>
<span class="sd">       gamma = numpy.arctan(cellOld[1][1]/cellOld[1][0])</span>
<span class="sd">       myList = [a1, b1, c1]</span>
<span class="sd">       c = max(myList)</span>
<span class="sd">       a = min(myList)</span>
<span class="sd">       myList.remove(c)</span>
<span class="sd">       myList.remove(a)</span>
<span class="sd">       b = myList[0]</span>
<span class="sd">       alpha = gamma</span>

<span class="sd">       eta = (1 - b*numpy.cos(alpha)/c)/(2*numpy.sin(alpha)**2)</span>
<span class="sd">       nu = 0.5 - eta*c*numpy.cos(alpha)/b</span>
<span class="sd">       special_points = {</span>
<span class="sd">           &#39;gG&#39;    : (0.0, 0.0, 0.0),</span>
<span class="sd">           &#39;A&#39;    : (0.5, 0.5, 0.0),</span>
<span class="sd">           &#39;C&#39;    : (0.0, 0.5, 0.5),</span>
<span class="sd">           &#39;D&#39;    : (0.5, 0.0, 0.5),</span>
<span class="sd">           &#39;D1&#39;    : (0.5, 0.0, -0.5),</span>
<span class="sd">           &#39;E&#39;    : (0.5, 0.5, 0.5),</span>
<span class="sd">           &#39;H&#39;    : (0.0, eta, 1.0-nu),</span>
<span class="sd">           &#39;H1&#39;    : (0.0, 1.0-eta, nu),</span>
<span class="sd">           &#39;H2&#39;    : (0.0, eta, -nu),</span>
<span class="sd">           &#39;M&#39;    : (0.5, eta, 1.0-nu),</span>
<span class="sd">           &#39;M1&#39;    : (0.5, 1.0-eta, nu),</span>
<span class="sd">           &#39;M2&#39;    : (0.5, eta, -nu),</span>
<span class="sd">           &#39;X&#39;    : (0.0, 0.5, 0.0),</span>
<span class="sd">           &#39;Y&#39;    : (0.0, 0.0, 0.5),</span>
<span class="sd">           &#39;Y1&#39;    : (0.0, 0.0, -0.5),</span>
<span class="sd">           &#39;Z&#39;    : (0.5, 0.0, 0.0)</span>
<span class="sd">         }</span>

<span class="sd">       default_band_path = &#39;gG-Y-H-C-E-M1-A-X-H1|M-D-Z|Y-D&#39;</span>
<span class="sd">       band_path = default_band_path</span>
<span class="sd">       return special_points, band_path</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="c1">###############################################################################</span>
<span class="c1">###############################################################################           </span>
    <span class="n">aflow_conv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">qe_conv</span>    <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">aflow_conv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>                       
        <span class="n">qe_conv</span>    <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">aflow_conv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>                    
        <span class="n">qe_conv</span>    <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>                    
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
        <span class="n">aflow_conv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">qe_conv</span>    <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span> <span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">aflow_conv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span> <span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">qe_conv</span>    <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span><span class="p">:</span>
        <span class="n">aflow_conv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">qe_conv</span>    <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>  
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
        <span class="n">aflow_conv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">qe_conv</span>    <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]])</span><span class="o">/</span><span class="mf">2.0</span>

                                   
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">special_points</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">second</span> <span class="o">=</span> <span class="p">(</span><span class="n">aflow_conv</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">qe_conv</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">special_points</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">second</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span>	
<span class="c1">#############################################################################################################</span>
<span class="c1">#############################################################################################################</span>
<span class="c1">#############################################################################################################</span>










<span class="k">def</span> <span class="nf">writeInputFromOutput</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">	  calcs (dict): dictionary of dictionaries of calculations</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          replace (bool): If true replace the input with updated atomic positions and cell parameters</span>
<span class="sd">          runlocal (bool): run local or write to &lt;ID&gt;.py</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">runlocal</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;RUN&#39;</span><span class="p">,</span><span class="s1">&#39;AFLOWpi.retr._writeInputFromOutput(oneCalc,ID,replace=</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">replace</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_writeInputFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">)</span>
        
<span class="k">def</span> <span class="nf">_writeInputFromOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generates an input of that step updated with the positions and lattice vectors of its output</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          newInput (str): string of that step&#39;s input updated with the positions and lattice vectors of its output</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">alatRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">ur&#39;(?:CELL_PARAMETERS)\s*\(\s*alat\s*=\s*([0-9.]*)\s*\)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outputFile</span><span class="p">:</span>
                <span class="n">engineOutput</span><span class="o">=</span><span class="n">outputFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            
            <span class="k">return</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">coordRegex</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>
        <span class="n">atomCoord</span> <span class="o">=</span> <span class="n">coordRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="n">alatRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="nb">print</span> <span class="n">e</span>
    
    <span class="n">newInput</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="n">inFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">)</span>
    <span class="n">outFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_new.in&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inFileName</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFile</span><span class="p">:</span>
        <span class="n">inFileString</span> <span class="o">=</span> <span class="n">inFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">inFileStringOrig</span> <span class="o">=</span> <span class="n">inFileString</span>
        <span class="n">newInput</span> <span class="o">=</span> <span class="n">inFileString</span>
        <span class="n">nameListRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(&amp;[A-Za-z]+)|(?:\s*(\S*?)\s*=\s*(\S+?)(?:(?:\s*\,\s*)|(?:\s*\n)))&#39;</span><span class="p">)</span>
        <span class="n">namelist</span> <span class="o">=</span> <span class="n">nameListRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cellParamRegex</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">cell_parameters</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>
        <span class="n">CELL_PARAMETERS</span> <span class="o">=</span> <span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>        
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
        
    <span class="k">try</span><span class="p">:</span>
        
        <span class="n">tokenizedInput</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">newInput</span><span class="p">)</span>
        <span class="n">tokenCopy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tokenizedInput</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">nameList</span><span class="p">,</span><span class="n">nameListDict</span> <span class="ow">in</span> <span class="n">tokenizedInput</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nameListDict</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">({</span><span class="s1">&#39;someDict&#39;</span><span class="p">:</span><span class="mi">42</span><span class="p">})):</span>
                <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">nameListDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;A&#39;</span> <span class="ow">or</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;B&#39;</span> <span class="ow">or</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;C&#39;</span> <span class="ow">or</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;COSBC&#39;</span> <span class="ow">or</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;COSAC&#39;</span> <span class="ow">or</span> <span class="n">parameter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;COSAB&#39;</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">tokenCopy</span><span class="p">[</span><span class="n">nameList</span><span class="p">][</span><span class="n">parameter</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">parameter</span><span class="o">==</span><span class="s1">&#39;ibrav&#39;</span><span class="p">:</span>
                        <span class="n">tokenCopy</span><span class="p">[</span><span class="n">nameList</span><span class="p">][</span><span class="n">parameter</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>
            <span class="k">if</span> <span class="n">nameList</span><span class="o">==</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">:</span>
                <span class="n">tokenCopy</span><span class="p">[</span><span class="n">nameList</span><span class="p">][</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">alat</span><span class="p">)</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">newInput</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>

                <span class="n">coords</span><span class="p">,</span><span class="n">flags</span> <span class="o">=</span> <span class="n">detachPosFlags</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]))</span>
                <span class="n">tokenCopy</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">attachPosFlags</span><span class="p">(</span><span class="n">atomCoord</span><span class="p">,</span><span class="n">flags</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="n">newInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_joinInput</span><span class="p">(</span><span class="n">tokenCopy</span><span class="p">)</span>        
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">engineOutput</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">newInput</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;ibrav\s*=\s*[0-9]*&#39;</span><span class="p">,</span><span class="s1">&#39;ibrav = 0&#39;</span><span class="p">,</span><span class="n">newInput</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;(?:celldm\(\s*[2-6]\s*\))\s*&#39;</span><span class="p">,</span><span class="n">newInput</span><span class="p">))</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">newInput</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&#39;(?:celldm\(\s*[2-6]\s*\))\s*=\s*[0-9.]*[,]*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span> <span class="p">,</span><span class="n">newInput</span><span class="p">)</span>
                <span class="n">newInput</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&#39;(?:celldm\(\s*1\s*\))\s*=\s*[0-9.]*[,]*&#39;</span><span class="p">,</span><span class="s1">&#39;celldm(1)=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">alat</span> <span class="p">,</span><span class="n">newInput</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">,</span><span class="n">newInput</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">cellParamRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(?:CELL_PARAMETERS)\s+.+\n((?:[-0-9|.]+)\s+(?:[-0-9|.]+)\s+(?:[-0-9|.]+)\s*\n*)+(?=(?:[A-Z|_|\s]+\n)|)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
                <span class="n">newInput</span> <span class="o">=</span> <span class="n">cellParamRegex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">CELL_PARAMETERS</span><span class="p">,</span><span class="n">newInput</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newInput</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">CELL_PARAMETERS</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">CELL_PARAMETERS</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="n">newInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">remove_blank_lines</span><span class="p">(</span><span class="n">newInput</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newInput</span>


<span class="k">def</span> <span class="nf">_prefixFromInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;CONSIDER FOR REMOVAL&gt;</span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">)[</span><span class="s1">&#39;&amp;control&#39;</span><span class="p">][</span><span class="s1">&#39;prefix&#39;</span><span class="p">]</span>
    <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">prefix</span>
    

<span class="k">def</span> <span class="nf">_writeInputFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Writes an input file of that step updated with the positions and lattice vectors of its output</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          replace (bool): if True then replace the input with the updated one</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_new.in&#39;</span><span class="p">)</span>
    <span class="n">newInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_writeInputFromOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newInput</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outFileName</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">newInput</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">replace</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_old.in&#39;</span><span class="p">))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;_new.in&#39;</span><span class="p">),</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        



<span class="k">def</span> <span class="nf">_writeEfermi</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Grabs the fermi enery or HOMO energy from the output files of the dos calculations</span>
<span class="sd">    and converts into rydberg then writes it to file &lt;ID&gt;.efermi</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">Efermi</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1">#if it&#39;s not a MP grid don&#39;t pull the fermi level</span>
    <span class="n">outfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.out&#39;</span> <span class="o">%</span> <span class="n">ID</span><span class="p">)]</span>
    <span class="k">try</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">outfile</span> <span class="ow">in</span> <span class="n">outfiles</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
                            <span class="n">outFileString</span> <span class="o">=</span> <span class="n">outFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>	

                            <span class="n">HOMOList</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;highest occupied, lowest unoccupied level \(ev\):\s*(.+?)\s&#39;</span><span class="p">,</span><span class="n">outFileString</span><span class="p">)</span>	      
                            <span class="n">EfermiList</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;\s*the Fermi energy is\s*([.0-9]+)\s*ev&#39;</span><span class="p">,</span><span class="n">outFileString</span><span class="p">)</span>	       
                            <span class="n">justHOMOList</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;highest occupied level\s*\(ev\)\:\s*([.0-9]+)\s*&#39;</span><span class="p">,</span><span class="n">outFileString</span><span class="p">)</span>

                            <span class="n">spin_polarized</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;the spin up/dw Fermi energies are\s*([-]*[0-9.])\s*([-]*[0-9.])&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">HOMOList</span><span class="p">):</span>
                                    <span class="n">Efermi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">HOMOList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;highest occupied, lowest unoccupied level: </span><span class="si">%s</span><span class="s1"> eV&#39;</span> <span class="o">%</span> <span class="n">Efermi</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">EfermiList</span><span class="p">):</span>
                                    <span class="n">Efermi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">EfermiList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;the Fermi energy is: </span><span class="si">%s</span><span class="s1"> eV&#39;</span> <span class="o">%</span> <span class="n">Efermi</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">justHOMOList</span><span class="p">):</span>
                                    <span class="n">Efermi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">justHOMOList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;highest occupied level: </span><span class="si">%s</span><span class="s1"> eV&#39;</span> <span class="o">%</span> <span class="n">Efermi</span><span class="p">)</span>

                            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">spin_polarized</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">outFileString</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">Efermi</span><span class="o">=</span><span class="n">spin_polarized</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>



    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span> <span class="n">e</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;could not find eFermi/HOMO-LUMO in </span><span class="si">%s</span><span class="s1"> checking to see if EFERMI/HOMOLUMO is in calc dictionary from previous calculation.&#39;</span><span class="p">)</span>

    <span class="s1">&#39;look to see if efermi is there from dos calc and if not add efermi as part of the dos calc&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">Efermi</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;EFERMI&#39;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Efermi</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;EFERMI&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Efermi</span>
    <span class="sd">&#39;&#39;&#39;save value of efermi&#39;&#39;&#39;</span>
    <span class="n">fermi_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.efermi&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fermi_file</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
            <span class="n">outFileObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Efermi</span><span class="p">))</span>
        

<span class="k">def</span> <span class="nf">_getEfermi</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">directID</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Grabs fermi level from &lt;ID&gt;.efermi file. if there is none returns 0.0</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          efermi (float): fermi level </span>
<span class="sd">   </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">directID</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">glob_ID</span><span class="o">=</span><span class="n">ID</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">glob_ID</span><span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;dos&#39;</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">straight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">fermi_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.efermi&#39;</span><span class="o">%</span><span class="n">glob_ID</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fermi_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
            <span class="n">efermi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">outFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">efermi</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">e</span>
        <span class="k">return</span> <span class="mf">0.0</span>


<span class="k">def</span> <span class="nf">_joinInput</span><span class="p">(</span><span class="n">inputDict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Joins input tokenized by AFLOWpi.retr._splitInput and returns a string of a QE pwscf input file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          inputDict (dict): tokenized input file</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          newInputString (str): a string of a QE pwscf input file</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">newInputString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">namelist</span><span class="p">,</span><span class="n">parameters</span> <span class="ow">in</span> <span class="n">inputDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;&amp;&#39;</span> <span class="ow">in</span> <span class="n">namelist</span><span class="p">:</span>        
            <span class="n">newInputString</span><span class="o">+=</span><span class="n">namelist</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">inputDict</span><span class="p">[</span><span class="n">namelist</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">newInputString</span><span class="o">+=</span> <span class="s1">&#39;   </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">,</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">value</span><span class="p">)</span>

            <span class="n">newInputString</span><span class="o">+=</span><span class="s1">&#39;/</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">newInputString</span><span class="o">+=</span><span class="n">namelist</span>
                <span class="k">if</span> <span class="n">namelist</span><span class="o">==</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span> <span class="ow">and</span> <span class="n">inputDict</span><span class="p">[</span><span class="n">namelist</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">inputDict</span><span class="p">[</span><span class="n">namelist</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{crystal}</span><span class="s1">&#39;</span>
                    
                <span class="n">newInputString</span><span class="o">+=</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">inputDict</span><span class="p">[</span><span class="n">namelist</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>                
                <span class="n">newInputString</span><span class="o">+=</span><span class="n">inputDict</span><span class="p">[</span><span class="n">namelist</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="n">newInputString</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">remove_blank_lines</span><span class="p">(</span><span class="n">newInputString</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newInputString</span>


<span class="k">def</span> <span class="nf">_getPath</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">points</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get path between HSP</span>

<span class="sd">    Arguments:</span>
<span class="sd">          dk (float): distance between points </span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">       </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          ID (str): ID string for the particular calculation and step          </span>
<span class="sd">          points (bool): Give the path as points or in aflow convention</span>

<span class="sd">    Returns:</span>
<span class="sd">          numPointStr (str): path between HSP</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">kdistance</span><span class="p">(</span><span class="n">hs</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">hs</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">hs</span><span class="p">)</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span>
        <span class="n">dist2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dist2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getSegments</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">segments</span>

    <span class="k">def</span> <span class="nf">getPoints</span><span class="p">(</span><span class="n">pathSegment</span><span class="p">):</span>
        <span class="n">pointsList</span> <span class="o">=</span> <span class="n">pathSegment</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pointsList</span>
    <span class="k">def</span> <span class="nf">getNumPoints</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">list1</span> <span class="o">=</span> <span class="n">getSegments</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">numPts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="p">(</span><span class="n">list1</span><span class="p">):</span>
            <span class="n">numPts</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">getPoints</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">numPts</span>

    <span class="n">ibrav</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ibravRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;ibrav[\s]*=[\s]*([\d]+)\s*[,</span><span class="se">\n</span><span class="s1">]*&#39;</span><span class="p">)</span>
    <span class="n">ibrav</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ibravRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>	

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s1">&#39;Lattice type </span><span class="si">%s</span><span class="s1"> is not implemented&#39;</span> <span class="o">%</span> <span class="n">ibrav</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;The ibrav value from expresso has not yet been implemented to the framework&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span>

    <span class="n">alat</span><span class="p">,</span><span class="n">cell</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>



    <span class="n">totalK</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">special_points</span><span class="p">,</span> <span class="n">band_path</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getHighSymPoints</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="o">=</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">hs</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>  <span class="c1"># reciprocal lattice</span>
    <span class="n">segs</span> <span class="o">=</span> <span class="n">getSegments</span><span class="p">(</span><span class="n">band_path</span><span class="p">)</span>

    <span class="n">numPointsStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">getNumPoints</span><span class="p">(</span><span class="n">band_path</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="c1">#starts the string we need to make</span>
    <span class="k">if</span> <span class="n">points</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">numPointsStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    <span class="n">path_points</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">segs</span><span class="p">:</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">getPoints</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="c1">#gets the points in each segment of path spereated by |            </span>
        <span class="n">point1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">point2</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">index2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">point1</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">index2</span><span class="p">]</span>
                <span class="n">point2</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">index2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">special_points</span><span class="p">[</span><span class="n">point1</span><span class="p">]</span> 
                <span class="n">p2</span> <span class="o">=</span> <span class="n">special_points</span><span class="p">[</span><span class="n">point2</span><span class="p">]</span>

                <span class="n">newDK</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">alat</span><span class="p">)</span><span class="o">*</span><span class="n">dk</span>
                <span class="n">numK</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">kdistance</span><span class="p">(</span><span class="n">hs</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span><span class="o">/</span><span class="n">newDK</span><span class="p">)))</span>
                <span class="n">totalK</span><span class="o">+=</span><span class="n">numK</span>

                <span class="n">numK</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numK</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">points</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                    <span class="n">a0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">numK</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
                    <span class="n">a1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">numK</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
                    <span class="n">a2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">numK</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>



                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a0</span><span class="p">)):</span>
                        <span class="n">lbl</span><span class="o">=</span><span class="n">point1</span>
                        <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">numK</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                            <span class="n">lbl</span><span class="o">=</span><span class="n">point2</span>
                        <span class="n">numPointsStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%8.7f</span><span class="s1"> </span><span class="si">%8.7f</span><span class="s1"> </span><span class="si">%8.7f</span><span class="s1"> !! </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">a0</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">a1</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">a2</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">lbl</span><span class="p">)</span>



                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sp1</span> <span class="o">=</span> <span class="n">special_points</span><span class="p">[</span><span class="n">point1</span><span class="p">]</span>
                    <span class="n">sp2</span> <span class="o">=</span> <span class="n">special_points</span><span class="p">[</span><span class="n">point2</span><span class="p">]</span>

                    <span class="n">numPointsStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> ! </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sp1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">sp1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sp1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">numK</span><span class="p">,</span><span class="n">point1</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">index2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
                        <span class="n">numPointsStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> ! </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sp2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">sp2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sp2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">point2</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span> <span class="n">e</span>
    <span class="k">if</span> <span class="n">points</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

        <span class="n">numPointsStr</span><span class="o">=</span><span class="n">numPointsStr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;!!&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%5.4f</span><span class="s1"> !!&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">totalK</span><span class="p">)))</span>
        <span class="n">numPointsStr</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">totalK</span><span class="o">+</span><span class="n">numPointsStr</span>
    <span class="k">return</span> <span class="n">numPointsStr</span>


<span class="k">def</span> <span class="nf">_joinMatrixLabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">matrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Joins a list of the atomic position species labels with a list or array of their atomic positions</span>

<span class="sd">    Arguments:</span>
<span class="sd">          labels (list): list or array of the atomic positions species labels</span>
<span class="sd">          matrix (numpy.matrix): the positions in matrix, array, or list form</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          outString (str): a string of the atomic positions joined with their species labels</span>

<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">matrixString</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_cellMatrixToString</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

    <span class="n">outString</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">matrixString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))])</span>
    <span class="k">return</span> <span class="n">outString</span>

<span class="k">def</span> <span class="nf">_orderSplitInput</span><span class="p">(</span><span class="n">inputCalc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Order tokenized input as QE needs it</span>

<span class="sd">    Arguments:</span>
<span class="sd">          inputCalc (calc): tokenized QE pwscf input</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          newOrderedDict (dict): the ordered tokenized QE pwscf input</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">newOrderedDict</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">inputOrder</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&amp;control&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;electrons&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;ions&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;cell&#39;</span><span class="p">,</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">,</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">,</span><span class="s1">&#39;K_POINTS&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">inputOrder</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">inputCalc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">newOrderedDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">item</span><span class="p">:</span><span class="n">inputCalc</span><span class="p">[</span><span class="n">item</span><span class="p">]})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newOrderedDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">item</span><span class="p">:</span><span class="n">OrderedDict</span><span class="p">()})</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputCalc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inputOrder</span><span class="p">:</span>
            <span class="n">newOrderedDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span><span class="n">inputCalc</span><span class="p">[</span><span class="n">key</span><span class="p">]})</span>

    <span class="k">return</span> <span class="n">newOrderedDict</span>

<span class="k">def</span> <span class="nf">_splitInput</span><span class="p">(</span><span class="n">inFileString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Tokenizes the QE pwscf input file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          inFileString (str): string of a QE pwscf input file</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          inputDict (dict): the tokenized input</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">inputDict</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">nameListRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;\s*(&amp;[A-Za-z]+)|(?:\s*(\S*?)\s*=\s*(\S+?)(?:(?:\s*\,\s*)|(?:\s*\n)))&#39;</span><span class="p">)</span>
    <span class="n">namelist</span> <span class="o">=</span> <span class="n">nameListRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">namelist</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">namelist</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">lastOne</span> <span class="o">=</span> <span class="n">namelist</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="n">lastOne</span><span class="p">]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>                    
                <span class="k">if</span> <span class="n">lastOne</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inputDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">inputDict</span><span class="p">[</span><span class="n">lastOne</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
                <span class="n">inputDict</span><span class="p">[</span><span class="n">lastOne</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="n">namelist</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">=</span><span class="n">namelist</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


    <span class="n">atomicSpecRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;ATOMIC_SPECIES\s*\n((?:(?:\s*[A-Za-z0-9]+)\s+(?:[0-9.]+)\s+(?:.+)\n*)+)(?=(?:[A-Z_\s]+\n)|)&#39;</span><span class="p">,(</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">atomicSpecRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>



    <span class="n">modifier_regex</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;modifier&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modifier_regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)):</span>

        <span class="n">paramUnits</span><span class="o">=</span><span class="n">modifier_regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paramUnits</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="n">paramUnits</span> <span class="o">=</span> <span class="n">paramUnits</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paramUnits</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="n">paramUnits</span> <span class="o">=</span> <span class="n">paramUnits</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paramUnits</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="n">paramUnits</span> <span class="o">=</span> <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">paramUnits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paramUnits</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">paramUnits</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    <span class="n">coordRegex</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">inFileString</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">coordRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">coords</span>
        <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">paramUnits</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">cellParamRegex</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">cell_parameters</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">unitsRegex</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">cell_parameters</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;modifier&#39;</span><span class="p">,</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)):</span>
            <span class="n">paramUnits</span><span class="o">=</span><span class="n">unitsRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">paramUnits</span> <span class="o">=</span> <span class="n">paramUnits</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">paramUnits</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span><span class="s1">&#39;crystal&#39;</span><span class="p">,</span><span class="s1">&#39;angstrom&#39;</span><span class="p">,</span><span class="s1">&#39;bohr&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paramUnits</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
                    <span class="n">paramUnits</span> <span class="o">=</span> <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">paramUnits</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">paramUnits</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">paramUnits</span><span class="o">=</span><span class="s1">&#39;&#39;</span>


        <span class="n">cellParams</span> <span class="o">=</span> <span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cellParams</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">cellParams</span><span class="o">=</span><span class="n">cellParams</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cellParams</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">paramUnits</span>



    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">kpoints</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">k_points</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>            
            <span class="n">modifier</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">k_points</span><span class="p">(</span><span class="n">inFileString</span><span class="p">,</span><span class="s1">&#39;modifier&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modifier</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
                <span class="n">modifier</span> <span class="o">=</span> <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">modifier</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">modifier</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

            <span class="n">kpointInput</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">kpoints</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;K_POINTS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;K_POINTS&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">modifier</span>
            <span class="n">inputDict</span><span class="p">[</span><span class="s1">&#39;K_POINTS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kpoints</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="n">modifier</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="nb">print</span> <span class="n">e</span>


    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">inputDict</span>


<span class="k">def</span> <span class="nf">getBravaisLatticeName</span><span class="p">(</span><span class="n">bravaisLatticeNumber</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the name of the crystal system from the bravias lattice number</span>

<span class="sd">    Arguments:</span>
<span class="sd">          braviasLatticeNumber (int): the number of the bravais lattice in QE convention</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          A string of the name of the crystal system</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;cubic&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;rhombohedral&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;hexagonal&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;tetragonal&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;orthorhombic&#39;</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;triclinic&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not a valid bravais lattice number&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;Not a valid bravais lattice number&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>


<span class="k">def</span> <span class="nf">pw2cif</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">inpt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">outp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">outputFolder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">filePrefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Writes a simple CIF file for engine input and outputs for viewing the structure</span>

<span class="sd">    Arguments:</span>
<span class="sd">	  calcs (dict): dictionary of dictionaries of calculations</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          inpt (bool): Do CIF for input</span>
<span class="sd">          outp (bool): Do CIF for output</span>
<span class="sd">          outputFolder (str): Output directory for the CIF</span>
<span class="sd">          filePrefix (str): Optional prefix to the CIF filenames</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>        
    <span class="k">if</span> <span class="n">inpt</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">outp</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">inpt_or_outp</span><span class="o">=</span><span class="s2">&quot;&#39;both&#39;&quot;</span>
    <span class="k">elif</span> <span class="n">inpt</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">output</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">inpt_or_outp</span><span class="o">=</span><span class="s2">&quot;&#39;False&#39;&quot;</span>
    <span class="k">elif</span> <span class="n">inpt</span><span class="o">==</span><span class="kc">False</span> <span class="ow">and</span> <span class="n">output</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">inpt_or_outp</span><span class="o">=</span><span class="s2">&quot;&#39;output&#39;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inpt_or_outp</span><span class="o">=</span><span class="s1">&#39;&quot;&quot;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">runlocal</span><span class="p">:</span>
                <span class="n">inOrOut</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="n">inpt_or_outp</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_pw2cif</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">inOrOut</span><span class="o">=</span><span class="n">inOrOut</span><span class="p">,</span><span class="n">outputFolder</span><span class="o">=</span><span class="n">outputFolder</span><span class="p">,</span><span class="n">filePrefix</span><span class="o">=</span><span class="n">filePrefix</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inOrOut</span><span class="o">=</span><span class="n">inpt_or_outp</span>
                <span class="k">if</span> <span class="n">outputFolder</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>

                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;RUN&#39;</span><span class="p">,</span><span class="s1">&#39;AFLOWpi.retr._pw2cif(oneCalc,ID,inOrOut=</span><span class="si">%s</span><span class="s1">,outputFolder=None,filePrefix=&quot;</span><span class="si">%s</span><span class="s1">&quot;)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">inOrOut</span><span class="p">,</span><span class="n">filePrefix</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;RUN&#39;</span><span class="p">,</span><span class="s1">&#39;AFLOWpi.retr._pw2cif(oneCalc,ID,inOrOut=</span><span class="si">%s</span><span class="s1">,outputFolder=&quot;</span><span class="si">%s</span><span class="s1">&quot;,filePrefix=&quot;</span><span class="si">%s</span><span class="s1">&quot;)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">inOrOut</span><span class="p">,</span><span class="n">outputFolder</span><span class="p">,</span><span class="n">filePrefix</span><span class="p">))</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_pw2cif</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">inOrOut</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="n">outputFolder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">filePrefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generates the CIF from input or output of single calculation at that step</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step         </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          inOrOut (str): which structs to do CIF for.. &#39;input&#39; &#39;output&#39; or &#39;both&#39;</span>
<span class="sd">          outputFolder (str): Output directory for the CIF</span>
<span class="sd">          filePrefix (str): Optional prefix to the CIF filenames</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">def</span> <span class="nf">atomPosPretty</span><span class="p">(</span><span class="n">atomicPositionString</span><span class="p">,</span><span class="n">ibrav</span><span class="p">):</span>
            
            <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">atomPosSortList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">splitAtomicPos</span> <span class="o">=</span> <span class="n">atomicPositionString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>                
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>


            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">splitAtomicPos</span><span class="p">:</span>
                
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">atomSplit</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">formattedAtomPos</span> <span class="o">=</span> <span class="n">atomSplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%14.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">atomSplit</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">atomSplit</span><span class="p">))])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">atomPosSortList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formattedAtomPos</span><span class="p">)</span>


            <span class="n">atomPosSortCifList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">atomPosSortCifListSecond</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">countDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">atomPosSortList</span><span class="p">:</span>
                <span class="n">splitItem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">firstItem</span> <span class="o">=</span> <span class="n">splitItem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">firstItem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">countDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span><span class="o">=</span><span class="n">count</span>

            <span class="n">countDictOrig</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">countDict</span><span class="p">)</span>
            <span class="n">origDictSecond</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">countDict</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">item1</span> <span class="ow">in</span> <span class="n">atomPosSortList</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">splitItem</span> <span class="o">=</span> <span class="n">item1</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">firstItem</span> <span class="o">=</span> <span class="n">splitItem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    
                    <span class="n">secondItem</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">firstItem</span><span class="p">,</span><span class="n">countDictOrig</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span><span class="o">-</span><span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

                    

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">entry</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> 1.0 </span><span class="si">%04f</span><span class="s1"> </span><span class="si">%04f</span><span class="s1"> </span><span class="si">%04f</span><span class="s1"> Biso 1.0 </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">secondItem</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">splitItem</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">splitItem</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">splitItem</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="n">firstItem</span><span class="p">)</span>
                        <span class="n">atomPosSortCifList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

                    
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                decriment the counter for the atom in question</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span> <span class="o">=</span> <span class="n">countDict</span><span class="p">[</span><span class="n">firstItem</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>                

<span class="c1">########################################################################################</span>
<span class="c1">########################################################################################</span>
<span class="c1">########################################################################################</span>
            <span class="n">loopblock</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;loop_</span>
<span class="s2">      _atom_site_label</span>
<span class="s2">      _atom_site_occupancy</span>
<span class="s2">      _atom_site_fract_x</span>
<span class="s2">      _atom_site_fract_y</span>
<span class="s2">      _atom_site_fract_z</span>
<span class="s2">      _atom_site_thermal_displace_type</span>
<span class="s2">      _atom_site_B_iso_or_equiv</span>
<span class="s2">      _atom_site_type_symbol</span>
<span class="s2">&quot;&quot;&quot;</span>
            
            <span class="n">outputString</span> <span class="o">=</span> <span class="n">loopblock</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">atomPosSortCifList</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">outputString</span>

    <span class="k">if</span> <span class="n">inOrOut</span> <span class="o">!=</span> <span class="s1">&#39;input&#39;</span> <span class="ow">and</span> <span class="n">inOrOut</span> <span class="o">!=</span> <span class="s1">&#39;output&#39;</span> <span class="ow">and</span> <span class="n">inOrOut</span> <span class="o">!=</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;options for variable &#39;inOrOut&#39; must be &#39;in&#39;,&#39;out&#39;,or &#39;both&#39;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;options for variable &#39;inOrOut&#39; must be &#39;in&#39;,&#39;out&#39;,or &#39;both&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">filePrefix</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">filePrefix</span><span class="o">=</span><span class="n">filePrefix</span><span class="o">+</span><span class="s1">&#39;_&#39;</span>
    <span class="n">input_suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">cif_suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">cif_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    <span class="n">cif_prefix</span><span class="o">=</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span>
    <span class="n">outFileString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">inputFileString</span>  <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>
    
    <span class="n">ibravRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;ibrav[\s]*=[\s]*([\d]+)\s*[,</span><span class="se">\n</span><span class="s1">]*&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inOrOut</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;input&#39;</span> <span class="ow">or</span> <span class="n">inOrOut</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;both&#39;</span><span class="p">:</span>

        <span class="n">labels</span><span class="p">,</span><span class="n">atomicPositions</span><span class="p">,</span><span class="n">cellParamVec</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getConventionalCellFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

        <span class="n">input_suffix</span><span class="o">=</span><span class="s1">&#39;.in&#39;</span>
        <span class="n">cif_suffix</span><span class="o">=</span><span class="s1">&#39;.in.cif&#39;</span>
        

        <span class="n">inputDict</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">inputFileString</span><span class="p">)</span>
        <span class="n">ibravRegex</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;ibrav\s*=\s*([0-9]{1,2})&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ibravOrig</span><span class="o">=</span> <span class="n">ibravRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inputFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ibravOrig</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>

                <span class="n">labels</span><span class="p">,</span><span class="n">atomicPositions</span><span class="p">,</span><span class="n">cellParamVec</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_rho2hex</span><span class="p">(</span><span class="n">cellParamVec</span><span class="p">,</span><span class="n">atomicPositions</span><span class="p">,</span><span class="n">labels</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span>  <span class="n">free2abc</span><span class="p">(</span><span class="n">cellParamVec</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span>
        
        <span class="n">outFileString</span><span class="o">+=</span><span class="s2">&quot;&quot;&quot;data_global</span>
<span class="s2">_chemical_name &#39;</span><span class="si">%s</span><span class="s2">&#39;</span>

<span class="s2">_cell_length_a </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_length_b </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_length_c </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_alpha </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_beta </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_gamma </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cif_prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">)</span>

        <span class="n">atomicPositions</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_cellMatrixToString</span><span class="p">(</span><span class="n">atomicPositions</span><span class="p">)</span>
        <span class="n">atomicPositions</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">atomicPositions</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))])</span>        
        <span class="n">outFileString</span> <span class="o">+=</span> <span class="n">atomPosPretty</span><span class="p">(</span><span class="n">atomicPositions</span><span class="p">,</span><span class="n">ibravOrig</span><span class="p">)</span>
        <span class="n">outFileString</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">outputFolder</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outputFolder</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputFolder</span><span class="p">,</span><span class="n">filePrefix</span><span class="o">+</span><span class="s1">&#39;STRUCT_&#39;</span><span class="o">+</span><span class="n">cif_prefix</span><span class="o">+</span><span class="n">ID</span><span class="o">+</span><span class="n">cif_suffix</span><span class="p">),</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inOrOut</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;output&#39;</span> <span class="ow">or</span> <span class="n">inOrOut</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">input_suffix</span><span class="o">=</span><span class="s1">&#39;.out&#39;</span>
        <span class="n">cif_suffix</span><span class="o">=</span><span class="s1">&#39;.out.cif&#39;</span>
        <span class="n">inputDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">outFileString</span><span class="o">=</span><span class="s1">&#39;&#39;</span>




        <span class="k">try</span><span class="p">:</span>
<span class="c1">#            labels,positions,cell = AFLOWpi.retr._getConventionalCellFromOutput(oneCalc,ID)</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getPosLabels</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
            <span class="n">alat</span><span class="p">,</span><span class="n">cellParamMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
            <span class="n">cell</span><span class="o">=</span><span class="n">cellParamMatrix</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">alat</span><span class="p">)</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getPositionsFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
            

            <span class="n">ibrav</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>        
            <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span>
            <span class="n">positions</span><span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>

            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFileObj</span><span class="p">:</span>
                     <span class="n">exceptionInputFileString</span>  <span class="o">=</span> <span class="n">inFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>



            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;Error finding ATOMIC_POSITIONS from output&quot;</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error finding ATOMIC_POSITIONS from output&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cellParamVec</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getCellOutDim</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span>


        <span class="n">a</span> <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
        <span class="n">b</span>  <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
        <span class="n">c</span>  <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
        <span class="n">alpha</span>  <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span>

        <span class="n">gamma</span> <span class="o">=</span> <span class="n">cellParamVec</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span>  <span class="n">free2abc</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span>        



        <span class="n">outFileString</span><span class="o">+=</span><span class="s2">&quot;&quot;&quot;data_global</span>
<span class="s2">_chemical_name &#39;</span><span class="si">%s</span><span class="s2">&#39;</span>
<span class="s2">_cell_length_a </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_length_b </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_length_c </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_alpha </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_beta </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">_cell_angle_gamma </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cif_prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">)</span>
        
        <span class="n">positions</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_joinMatrixLabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">positions</span><span class="p">)</span>


        <span class="n">outFileString</span> <span class="o">+=</span> <span class="n">atomPosPretty</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">ibrav</span><span class="p">)</span>
        <span class="n">outFileString</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">outputFolder</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outputFolder</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>
        <span class="n">joiner</span> <span class="o">=</span> <span class="n">filePrefix</span><span class="o">+</span><span class="s1">&#39;STRUCT_&#39;</span><span class="o">+</span><span class="n">cif_prefix</span><span class="o">+</span><span class="n">ID</span><span class="o">+</span><span class="n">cif_suffix</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputFolder</span><span class="p">,</span><span class="n">joiner</span><span class="p">),</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">celldm2params</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;Marked for removal&gt;</span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="sd">&#39;&#39;&#39;not sure what this is. probably is not needed anymore much and should be removed&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*1.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*2.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">b</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*3.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">c</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*4.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*5.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">beta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;\s*celldm.*6.*&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>



    <span class="n">a</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">b</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">c</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">alpha</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">beta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span>


<span class="k">def</span> <span class="nf">inputDict2params</span><span class="p">(</span><span class="n">inputDict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">inputDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>

        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;ibrav&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
            <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">inputDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">celldm2params</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> 
        <span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> 
        <span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">120.0</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="c1">#        beta = alpha</span>
<span class="c1">#        gamma = 120.0</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="o">-</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>                    
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>


    <span class="n">a</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">b</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">c</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">alpha</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">beta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span>

<span class="k">def</span> <span class="nf">_getCellOutDim</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the cell parameters a,b,c,alpha,beta,gamma of the primitive lattice from the output.</span>
<span class="sd">    If the primitive lattice does not change during the calculation it takes it from the input</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step         </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">         out_params (dict): dictionary of a,b,c,alpha,beta,gamma of the primitive lattice from the output</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">ibravRegex</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;ibrav\s*=\s*([0-9]{1,2})&#39;</span><span class="p">)</span>
    <span class="n">inputFileString</span>  <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ibravOrig</span><span class="o">=</span> <span class="n">ibravRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inputFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFileObj</span><span class="p">:</span>
        <span class="n">inFileString</span>  <span class="o">=</span> <span class="n">inFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">cellParamRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(?:CELL_PARAMETERS)\s*\(alat\s*=\s*[0-9.]*\)\n([.0-9\s-]*)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="n">splitParams</span> <span class="o">=</span>  <span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cellParamRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;crystal axes: \(cart. coord. in units of alat\)\n\s*a\(1\)\s*=\s*\(\s*([0-9.\s]*)\)\s*\n\s*a\(2\)\s*=\s*\(\s*([0-9.\s]*)\)\s*\n\s*a\(3\)\s*=\s*\(\s*([0-9.\s]*)\)\s*\n&#39;</span><span class="p">)</span>
            <span class="n">splitParams</span> <span class="o">=</span>  <span class="n">cellParamRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="n">alat</span><span class="p">,</span><span class="n">cellOld</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

    <span class="n">paramList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">alat</span><span class="p">,</span><span class="n">cellParaMatrix</span><span class="o">=</span><span class="n">__getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">cellParaMatrix</span><span class="o">*=</span><span class="n">alat</span>

    <span class="n">alatRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(?:CELL_PARAMETERS)\s*\(alat\s*=\s*([0-9.]*)\)&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

    <span class="n">splitInput</span>  <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>

    <span class="n">string</span><span class="o">=</span> <span class="n">free2abc</span><span class="p">(</span><span class="n">cellParaMatrix</span><span class="p">)</span>
    <span class="n">cellParams</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cellParams</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">cellParams</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.0000000001</span><span class="p">:</span>
            <span class="n">cellParams</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>



        

    <span class="n">ibravOrig</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;ibrav&#39;</span><span class="p">])</span>


    <span class="n">celldmDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">celldmDict</span><span class="p">[</span><span class="s1">&#39;ibrav&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ibravOrig</span>

    <span class="n">out_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;beta&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;gamma&#39;</span><span class="p">:</span><span class="n">cellParams</span><span class="p">[</span><span class="mi">5</span><span class="p">]}</span>

    <span class="k">if</span> <span class="n">cosine</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">out_params</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">out_params</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
        <span class="n">out_params</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">out_params</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
        <span class="n">out_params</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">out_params</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">degrees</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">out_params</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">*=</span><span class="mf">180.0</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">out_params</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">*=</span><span class="mf">180.0</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">out_params</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span><span class="o">*=</span><span class="mf">180.0</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>


    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">out_params</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">out_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%10.5e</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">out_params</span>

<span class="k">def</span> <span class="nf">_getInputParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the cell parameters a,b,c,alpha,beta,gamma of the primitive lattice from the input.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step         </span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">         out_params (dict): dictionary of a,b,c,alpha,beta,gamma of the primitive lattice from the input</span>

<span class="sd">    &#39;&#39;&#39;</span>        
        

    <span class="n">inputFileString</span>  <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>

    <span class="n">inputDict</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">inputFileString</span><span class="p">)[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;celldm&#39;</span><span class="p">,</span><span class="n">key</span><span class="p">):</span> 
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;ibrav&#39;</span><span class="p">,</span><span class="n">key</span><span class="p">):</span> 
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">inputDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">inputDict2params</span><span class="p">(</span><span class="n">inputDict</span><span class="p">)</span>

    <span class="n">BohrToAngstrom</span> <span class="o">=</span> <span class="mf">0.529177249</span>
    <span class="n">a</span><span class="o">*=</span> <span class="n">BohrToAngstrom</span>
    <span class="n">b</span><span class="o">*=</span> <span class="n">BohrToAngstrom</span>
    <span class="n">c</span><span class="o">*=</span> <span class="n">BohrToAngstrom</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span><span class="s1">&#39;beta&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span><span class="s1">&#39;gamma&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)}</span>

<span class="k">def</span> <span class="nf">celldm2free</span><span class="p">(</span><span class="n">ibrav</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm4</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm6</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">returnString</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts  QE&#39;s celldm format into QE convention primitive lattice vectors </span>

<span class="sd">    Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">           ibrav (int): bravais lattice type by QE convention</span>
<span class="sd">           celldm1 (float): a</span>
<span class="sd">           celldm2 (float): b/a</span>
<span class="sd">           celldm3 (float): c/a</span>
<span class="sd">           celldm4 (float): Cosine of the angle between axis b and c</span>
<span class="sd">           celldm5 (float): Cosine of the angle between axis a and c</span>
<span class="sd">           celldm6 (float): Cosine of the angle between axis a and b</span>
<span class="sd">           returnString (bool): return vectors as a string or as a numpy matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">         Either a numpy.matrix or a string of the primitive lattice vectors generated from the celldm input</span>

<span class="sd">    &#39;&#39;&#39;</span>        


    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">14</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ibrav = </span><span class="si">%s</span><span class="s1"> not a valid option&#39;</span> <span class="o">%</span> <span class="n">ibrav</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;ibrav = </span><span class="si">%s</span><span class="s1"> not a valid option&#39;</span> <span class="o">%</span> <span class="n">ibrav</span>

    <span class="n">ibrav</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span>




    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">celldm1</span><span class="p">,</span><span class="mi">0</span>      <span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                               <span class="p">(</span><span class="mi">0</span>      <span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                               <span class="p">(</span><span class="mi">0</span>     <span class="p">,</span><span class="mi">0</span>       <span class="p">,</span><span class="n">celldm1</span><span class="p">)))</span>
    

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="o">-</span><span class="n">celldm1</span>  <span class="p">,</span><span class="mi">0</span>      <span class="p">,</span><span class="n">celldm1</span><span class="p">),</span>
                               <span class="p">(</span> <span class="mi">0</span>        <span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="n">celldm1</span><span class="p">),</span>
                               <span class="p">(</span><span class="o">-</span><span class="n">celldm1</span>  <span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="mi">0</span>      <span class="p">)))</span><span class="o">/</span><span class="mf">2.0</span>
        
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span> <span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm1</span><span class="p">),</span>
                               <span class="p">(</span><span class="o">-</span><span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm1</span><span class="p">),</span>
                               <span class="p">(</span><span class="o">-</span><span class="n">celldm1</span><span class="p">,</span><span class="o">-</span><span class="n">celldm1</span><span class="p">,</span> <span class="n">celldm1</span><span class="p">)))</span><span class="o">/</span><span class="mf">2.0</span>
        
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span> <span class="mf">1.</span>        <span class="p">,</span><span class="mf">0.</span>               <span class="p">,</span> <span class="mf">0.</span>      <span class="p">),</span>
                               <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span>       <span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>  <span class="p">,</span> <span class="mf">0.</span>      <span class="p">),</span>
                               <span class="p">(</span> <span class="mf">0.</span>        <span class="p">,</span><span class="mf">0.</span>               <span class="p">,</span> <span class="n">celldm3</span><span class="p">)))</span><span class="o">*</span><span class="n">celldm1</span>

        <span class="c1"># if numpy.abs(celldm4-celldm5)&lt;0.01 and numpy.abs(celldm4-celldm6)&lt;0.01 and numpy.abs(celldm6-celldm5)&lt;0.01:</span>
        <span class="c1">#     c=celldm4</span>
        <span class="c1">#     tx=numpy.sqrt((1-c)/2)</span>
        <span class="c1">#     ty=numpy.sqrt((1-c)/6)</span>
        <span class="c1">#     tz=numpy.sqrt((1+2*c)/3)</span>

        <span class="c1">#     matrix = celldm1*numpy.matrix(((tx  ,-ty  , tz),</span>
        <span class="c1">#                                    (0   , 2*ty, tz),</span>
        <span class="c1">#                                    (-tx ,-ty  , tz)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">celldm1</span><span class="p">,</span><span class="n">celldm2</span><span class="p">,</span><span class="n">celldm3</span><span class="p">,</span><span class="n">celldm4</span><span class="p">,</span><span class="n">celldm5</span><span class="p">,</span><span class="n">celldm6</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="n">celldm4</span>
        <span class="n">tx</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ty</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">tz</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">matrix</span> <span class="o">=</span> <span class="n">celldm1</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">tx</span>  <span class="p">,</span><span class="o">-</span><span class="n">ty</span>  <span class="p">,</span> <span class="n">tz</span><span class="p">),</span>
                                       <span class="p">(</span><span class="mi">0</span>   <span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">ty</span><span class="p">,</span> <span class="n">tz</span><span class="p">),</span>
                                       <span class="p">(</span><span class="o">-</span><span class="n">tx</span> <span class="p">,</span><span class="o">-</span><span class="n">ty</span>  <span class="p">,</span> <span class="n">tz</span><span class="p">)))</span>




        <span class="c1"># if numpy.abs(celldm4+0.5)&lt;0.01 or numpy.abs(celldm5+0.5)&lt;0.01 or numpy.abs(celldm6+0.5)&lt;0.01:</span>
        <span class="c1">#     matrix = numpy.matrix((( 1.        ,0.               , 0.      ),</span>
        <span class="c1">#                            (-0.5       ,numpy.sqrt(3)/2  , 0.      ),</span>
        <span class="c1">#                            ( 0.        ,0.               , celldm3)))*celldm1</span>



                    
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==-</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">c</span><span class="o">=</span><span class="n">celldm4</span>
        <span class="n">tx</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ty</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">tz</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">tz</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">tz</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ty</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">celldm1</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
                                                     <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">celldm1</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">celldm3</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">((</span>
                <span class="p">(</span> <span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="n">celldm3</span><span class="p">),</span>
                <span class="p">(</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span><span class="n">celldm3</span><span class="p">),</span>
                <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="n">celldm3</span><span class="p">),</span>
                <span class="p">))</span><span class="o">*</span><span class="n">celldm1</span>
        <span class="n">matrix</span><span class="o">/=</span><span class="mf">2.0</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">8</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">celldm1</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span>     <span class="p">,</span> <span class="mf">0.0</span>    <span class="p">,),</span>
                                       <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">celldm2</span> <span class="p">,</span> <span class="mf">0.0</span>    <span class="p">,),</span>
                                       <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>     <span class="p">,</span> <span class="n">celldm3</span><span class="p">,)))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">a</span><span class="o">=</span><span class="n">celldm1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">b</span><span class="o">=</span><span class="n">celldm2</span><span class="o">*</span><span class="n">celldm1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">c</span><span class="o">=</span><span class="n">celldm3</span><span class="o">*</span><span class="n">celldm1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span> <span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="n">c</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==-</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="n">c</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">a</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span>  <span class="n">c</span>   <span class="p">),</span>
                               <span class="p">(</span><span class="n">a</span><span class="p">,</span>   <span class="n">b</span><span class="p">,</span>   <span class="mf">0.</span>  <span class="p">),</span>  
                               <span class="p">(</span><span class="mf">0.</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>   <span class="n">c</span>   <span class="p">)))</span><span class="o">/</span><span class="mf">2.0</span>




    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span> <span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> 
                             <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> 
                             <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">12</span><span class="p">:</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm4</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">a</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">),</span>
                               <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span><span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span>
                               <span class="p">(</span><span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>           <span class="n">c</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">13</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">celldm1</span><span class="p">,</span><span class="n">celldm2</span><span class="p">,</span><span class="n">celldm3</span><span class="p">,</span><span class="n">celldm4</span><span class="p">,</span><span class="n">celldm5</span><span class="p">,</span><span class="n">celldm6</span><span class="p">,</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm4</span><span class="p">)</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>                <span class="mi">0</span><span class="p">,</span>                <span class="o">-</span><span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>                <span class="mi">0</span><span class="p">,</span>                 <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">14</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm4</span><span class="p">)</span>
        <span class="n">beta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm5</span><span class="p">)</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm6</span><span class="p">)</span>

        <span class="n">twoone</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">))</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">insert</span> <span class="o">=</span>  <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">celldm4</span><span class="o">*</span><span class="n">celldm5</span><span class="o">*</span><span class="n">celldm6</span><span class="o">-</span><span class="n">celldm4</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">celldm5</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">celldm6</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">twotwo</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>

        <span class="n">matrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(((</span><span class="n">a</span><span class="p">,</span>                  <span class="mi">0</span><span class="p">,</span>                  <span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="n">b</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span>  <span class="n">twoone</span><span class="p">,</span>             <span class="n">twotwo</span><span class="p">)))</span>


    <span class="k">if</span> <span class="n">returnString</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">vecString</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span><span class="si">{:^6.10f}</span><span class="s1"> </span><span class="si">{:^6.10f}</span><span class="s1"> </span><span class="si">{:^6.10f}</span><span class="s1"></span>
<span class="si">{:6^.10f}</span><span class="s1"> </span><span class="si">{:6^.10f}</span><span class="s1"> </span><span class="si">{:6^.10f}</span><span class="s1"></span>
<span class="si">{:6^.10f}</span><span class="s1"> </span><span class="si">{:6^.10f}</span><span class="s1"> </span><span class="si">{:6^.10f}</span><span class="s1"></span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">vecString</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">matrix</span>

<span class="k">def</span> <span class="nf">_pw2aflowConvention</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;CONSIDER FOR REMOVAL&gt;</span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="sd">&#39;&#39;&#39;transform the positions first with the pre-transformed vectors&#39;&#39;&#39;</span>
    <span class="n">newSymMatrix</span>       <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_pw2aflowPositions</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;now get the transformed cell vectors&#39;&#39;&#39;</span>
    <span class="n">newCellParamMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_pw2aflowConventionVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">newCellParamMatrix</span><span class="p">,</span><span class="n">newSymMatrix</span>

<span class="k">def</span> <span class="nf">_pw2aflowConventionVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;CONSIDER FOR REMOVAL&gt;</span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">returnMatrix</span><span class="o">*=</span> <span class="mf">0.529177249</span>
    <span class="n">temp</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="n">lengths</span> <span class="o">=</span> <span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">0</span><span class="p">),(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">1</span><span class="p">),(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>

    <span class="n">tempIndex</span><span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]</span>

    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">returnMatrix</span>



<span class="k">def</span> <span class="nf">_pw2aflowPositions</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DEFUNCT &lt;CONSIDER FOR REMOVAL&gt;    </span>

<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        


    <span class="n">cellMatrix</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">cellMatrix</span><span class="o">*=</span> <span class="mf">0.529177249</span>

    <span class="n">temp</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">tempPos</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="n">lengths</span> <span class="o">=</span> <span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">0</span><span class="p">),(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">1</span><span class="p">),(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>

    <span class="n">tempIndex</span><span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]</span>
    <span class="sd">&#39;&#39;&#39;transpose so we can switch the vertical vectors easier&#39;&#39;&#39;</span>
    <span class="n">transposedPositions</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">T</span>
    <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">transposedPositions</span><span class="p">)</span>

    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">transposedPositions</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">transposedPositions</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">returnMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">transposedPositions</span><span class="p">[</span><span class="n">tempIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        
    <span class="sd">&#39;&#39;&#39;transpose the positions again so they&#39;re back to normal&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">returnMatrix</span><span class="o">.</span><span class="n">T</span>


<span class="k">def</span> <span class="nf">_free2celldm</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">primitive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert lattice vectors to celldm</span>

<span class="sd">    Arguments:</span>
<span class="sd">          cellparamatrix (numpy.matrix): matrix of cell vectors</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          ibrav (int): Overrides the bravais lattice automatically detected </span>
<span class="sd">                       (must be in QE convention if primitive)</span>
<span class="sd">          primitive (bool): If True it will treat cellparamatrix as primitive lattice vectors</span>

<span class="sd">    Returns:</span>
<span class="sd">         paramDict (dict): dictionary of the celldm generated by the input matrix</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">splitString</span><span class="o">=</span>  <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">free2ibrav</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">,</span><span class="n">primitive</span><span class="o">=</span><span class="n">primitive</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
    <span class="n">paramDict</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">splitString</span><span class="p">:</span>
        <span class="n">paramDict</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; ,&#39;</span><span class="p">)</span>
        
    <span class="n">newParamDict</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s1">&#39;ibrav&#39;</span><span class="p">:</span>
            <span class="n">newParamDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newParamDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">paramDict</span>

<span class="k">def</span> <span class="nf">free2ibrav</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">primitive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert lattice vectors to celldm</span>

<span class="sd">    Arguments:</span>
<span class="sd">          cellparamatrix (numpy.matrix): matrix of cell vectors</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          ibrav (int): Overrides the bravais lattice automatically detected </span>
<span class="sd">                       (must be in QE convention if primitive)</span>
<span class="sd">          primitive (bool): If True it will treat cellparamatrix as primitive lattice vectors</span>

<span class="sd">    Returns:</span>
<span class="sd">         ibravStr (str): string of the celldm used for QE pwscf input</span>

<span class="sd">    &#39;&#39;&#39;</span>        
    
    <span class="k">if</span> <span class="n">primitive</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">cellParamMatrixConv</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_prim2ConvVec</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">)</span>        

    <span class="k">else</span><span class="p">:</span>
        <span class="n">cellParamMatrixConv</span> <span class="o">=</span> <span class="n">cellparamatrix</span>



    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">ibrav</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">))</span>

    <span class="n">conv</span><span class="o">=</span><span class="n">cellParamMatrixConv</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span><span class="o">*</span><span class="mf">0.529177249</span>
    
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="k">try</span><span class="p">:</span>

        

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="n">cellParamMatrixConv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="n">celldm_1</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">celldm_2</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">a</span>
    <span class="n">celldm_3</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="n">a</span>

    <span class="n">celldm_6</span> <span class="o">=</span> <span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">celldm_5</span> <span class="o">=</span> <span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">celldm_4</span> <span class="o">=</span> <span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrixConv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>


    <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">celldm_1</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_1</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm_2</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_2</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm_3</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_3</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm_4</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_4</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm_5</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_5</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm_6</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm_6</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">4</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
            <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(4)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_4</span><span class="p">)</span> 


        <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">8</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==-</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span><span class="mi">10</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
            <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_2</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">12</span><span class="p">:</span>
            <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="s2">, celldm(4)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_2</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">,</span> <span class="n">celldm_4</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==-</span><span class="mi">12</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="s2">, celldm(5)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_2</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">,</span> <span class="n">celldm_5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">13</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="s2">, celldm(4)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_2</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">,</span> <span class="n">celldm_4</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">14</span><span class="p">:</span>
                <span class="n">ibravStr</span> <span class="o">=</span> <span class="s2">&quot;ibrav=</span><span class="si">%s</span><span class="s2">, celldm(1)=</span><span class="si">%f</span><span class="s2">, celldm(2)=</span><span class="si">%f</span><span class="s2">, celldm(3)=</span><span class="si">%f</span><span class="s2">, celldm(4)=</span><span class="si">%f</span><span class="s2"> celldm(5)=</span><span class="si">%f</span><span class="s2"> celldm(6)=</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm_1</span><span class="p">,</span> <span class="n">celldm_2</span><span class="p">,</span> <span class="n">celldm_3</span><span class="p">,</span> <span class="n">celldm_4</span><span class="p">,</span> <span class="n">celldm_5</span><span class="p">,</span> <span class="n">celldm_6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ibrav </span><span class="si">%s</span><span class="s1"> is not a valid option.&#39;</span> <span class="o">%</span> <span class="n">ibrav</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s1">&#39;ibrav </span><span class="si">%s</span><span class="s1"> is not a valid option.&#39;</span> <span class="o">%</span> <span class="n">ibrav</span>
            <span class="k">return</span> 

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>

        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ibravStr</span>




<span class="k">def</span> <span class="nf">free2abc</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bohr</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert lattice vectors to a,b,c,alpha,beta,gamma of the primitive lattice</span>

<span class="sd">    Arguments:</span>
<span class="sd">          cellparamatrix (numpy.matrix): matrix of cell vectors</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          cosine (bool): If True alpha,beta,gamma are cos(alpha),cos(beta),cos(gamma),</span>
<span class="sd">          degrees (bool): If True return alpha,beta,gamma in degrees; radians if False</span>
<span class="sd">          string (bool): If True return a,b,c,alpha,beta,gamma as a string; if False return as a list</span>
<span class="sd">          bohr (bool): If True return a,b,c in bohr radii; if False return in angstrom</span>

<span class="sd">    Returns:</span>
<span class="sd">         paramArray (list): a list of the parameters a,b,c,alpha,beta,gamma generated from the input matrix</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">ibrav</span> <span class="o">=</span> <span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cellparamatrix</span><span class="o">=</span><span class="n">cellparamatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>
<span class="c1">#        print e</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">cellparamatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="n">degree2radian</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>


    <span class="n">alpha</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">))</span>
    <span class="n">beta</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">))</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellparamatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000001</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000001</span><span class="p">:</span>
        <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000001</span><span class="p">:</span>
        <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0</span>


    <span class="n">AngstromToBohr</span> <span class="o">=</span> <span class="mf">1.88971616463207</span>
    <span class="n">BohrToAngstrom</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">AngstromToBohr</span>
    <span class="k">if</span> <span class="n">bohr</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">a</span><span class="o">*=</span><span class="n">BohrToAngstrom</span>
        <span class="n">b</span><span class="o">*=</span><span class="n">BohrToAngstrom</span>
        <span class="n">c</span><span class="o">*=</span><span class="n">BohrToAngstrom</span>

        <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%10.5e</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">b</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%10.5e</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">c</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%10.5e</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">cosine</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">cosBC</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">cosAC</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">cosAB</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">paramArray</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">cosBC</span><span class="p">,</span><span class="n">cosAC</span><span class="p">,</span><span class="n">cosAB</span><span class="p">]</span>

        <span class="n">param_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paramArray</span><span class="p">)):</span>
            <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%10.5e</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">paramArray</span><span class="p">[</span><span class="n">v</span><span class="p">],</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)))</span>
        <span class="n">paramArray</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span>

        <span class="n">returnString</span> <span class="o">=</span> <span class="s1">&#39;a=</span><span class="si">%s</span><span class="s1">,b=</span><span class="si">%s</span><span class="s1">,c=</span><span class="si">%s</span><span class="s1">,cos(alpha)=</span><span class="si">%s</span><span class="s1">,cos(beta)=</span><span class="si">%s</span><span class="s1">,cos(gamma)=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">paramArray</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">degrees</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">/=</span><span class="n">degree2radian</span>
        <span class="n">beta</span><span class="o">/=</span> <span class="n">degree2radian</span>
        <span class="n">gamma</span><span class="o">/=</span><span class="n">degree2radian</span>

    <span class="k">if</span> <span class="n">cosine</span><span class="o">!=</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">paramArray</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">)</span>

        <span class="n">param_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paramArray</span><span class="p">)):</span>
            <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%10.5e</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">paramArray</span><span class="p">[</span><span class="n">v</span><span class="p">],</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)))</span>
        <span class="n">paramArray</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span>
            
        <span class="n">returnString</span> <span class="o">=</span> <span class="s1">&#39;A=</span><span class="si">%s</span><span class="s1">,B=</span><span class="si">%s</span><span class="s1">,C=</span><span class="si">%s</span><span class="s1">,alpha=</span><span class="si">%s</span><span class="s1">,beta=</span><span class="si">%s</span><span class="s1">,gamma=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">paramArray</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">string</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">returnString</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">paramArray</span>
            
 

<span class="k">def</span> <span class="nf">celldm2abc</span><span class="p">(</span><span class="n">ibrav</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm4</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">celldm6</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cosine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">degrees</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert celldm for espresso into A,B,C,and angles alpha,beta,gamma</span>

<span class="sd">    Arguments:</span>
<span class="sd">          cellparamatrix (numpy.matrix): matrix of cell vectors</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          cosine (bool): If True alpha,beta,gamma are cos(alpha),cos(beta),cos(gamma),</span>
<span class="sd">          degrees (bool): If True return alpha,beta,gamma in degrees; radians if False</span>

<span class="sd">    Returns:</span>
<span class="sd">         paramArray (list): a list of the parameters a,b,c,alpha,beta,gamma generated from the input matrix</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">celldm2</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">celldm3</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">celldm4</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">celldm5</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">celldm6</span><span class="o">=</span><span class="mf">0.0</span>


    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">8</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
        <span class="n">celldm4</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">celldm5</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">celldm6</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">12</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">13</span><span class="p">:</span>
        <span class="n">celldm5</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">celldm6</span><span class="o">=</span><span class="mf">0.0</span>


        
    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
        <span class="n">celldm2</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">celldm4</span><span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">celldm5</span><span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">celldm6</span><span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
        <span class="n">celldm2</span><span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">celldm4</span><span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">celldm5</span><span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">celldm6</span><span class="o">=-</span><span class="mf">0.5</span>

    <span class="k">elif</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">celldm2</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">celldm3</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">celldm5</span><span class="o">=</span><span class="n">celldm4</span>
        <span class="n">celldm6</span><span class="o">=</span><span class="n">celldm4</span>
        
    <span class="k">else</span><span class="p">:</span>

        <span class="nb">print</span> <span class="s1">&#39;ibrav=</span><span class="si">%s</span><span class="s1"> not supported&#39;</span> <span class="o">%</span> <span class="n">ibrav</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;ibrav=</span><span class="si">%s</span><span class="s1"> not supported&#39;</span> <span class="o">%</span> <span class="n">ibrav</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">a</span><span class="o">=</span><span class="n">celldm1</span>
    <span class="n">b</span><span class="o">=</span><span class="n">celldm2</span><span class="o">*</span><span class="n">celldm1</span>
    <span class="n">c</span><span class="o">=</span><span class="n">celldm3</span><span class="o">*</span><span class="n">celldm1</span>
    <span class="k">if</span> <span class="n">cosine</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm4</span><span class="p">)</span>
        <span class="n">beta</span><span class="o">=</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm5</span><span class="p">)</span>
        <span class="n">gamma</span><span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">celldm6</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
            <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
            <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">=</span> <span class="n">celldm4</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">celldm5</span>
        <span class="n">gamma</span><span class="o">=</span> <span class="n">celldm6</span>
    <span class="n">degree2radian</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="k">if</span> <span class="n">degrees</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">/=</span> <span class="n">degree2radian</span>
        <span class="n">beta</span> <span class="o">/=</span> <span class="n">degree2radian</span>
        <span class="n">gamma</span><span class="o">/=</span> <span class="n">degree2radian</span>


    <span class="n">a</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">b</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">c</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">alpha</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">beta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span>

<span class="k">def</span> <span class="nf">abc2celldm</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert a,b,c,alpha,beta,gamma into celldm for QE</span>

<span class="sd">    Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          a (float): length of a</span>
<span class="sd">          b (float): length of b</span>
<span class="sd">          c (float): length of c</span>
<span class="sd">          alpha (float): Angle between axis b and c</span>
<span class="sd">          beta  (float): Angle between axis a and c</span>
<span class="sd">          gamma (float): Angle between axis a and b</span>
<span class="sd">          ibrav (int): ibrav to be used to convert for defaults</span>

<span class="sd">    Returns:</span>
<span class="sd">          celldm_array (array): an array of (ibrav,celldm(1),celldm(2),celldm(3),celldm(4),celldm(5),celldm(6))</span>

<span class="sd">    &#39;&#39;&#39;</span>        


    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==-</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">90.0</span>
        <span class="n">beta</span>  <span class="o">=</span> <span class="mf">90.0</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">120.0</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">b</span>
<span class="c1">#        beta = alpha</span>
<span class="c1">#        gamma = alpha</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">12</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">13</span><span class="p">:</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">90.0</span>
        <span class="n">beta</span><span class="o">=</span><span class="mf">90.0</span>

    <span class="n">celldm1</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">celldm2</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">a</span>
    <span class="n">celldm3</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="n">a</span>
    <span class="n">celldm4</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
    <span class="n">celldm5</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
    <span class="n">celldm6</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>


    <span class="n">celldm1</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm1</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm2</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm2</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm3</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm3</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm4</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm4</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm5</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm5</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">celldm6</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">celldm6</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">celldm4</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000000001</span><span class="p">:</span>
       <span class="n">celldm4</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">celldm5</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000000001</span><span class="p">:</span>
       <span class="n">celldm5</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">celldm6</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.000000001</span><span class="p">:</span>
       <span class="n">celldm6</span><span class="o">=</span><span class="mf">0.0</span>


    <span class="k">return</span> <span class="n">ibrav</span><span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="n">celldm2</span><span class="p">,</span><span class="n">celldm3</span><span class="p">,</span><span class="n">celldm4</span><span class="p">,</span><span class="n">celldm5</span><span class="p">,</span><span class="n">celldm6</span>

<span class="k">def</span> <span class="nf">abcVol</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get volume from a,b,c,alpha,beta,gamma</span>

<span class="sd">    Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          a (float): length of a</span>
<span class="sd">          b (float): length of b</span>
<span class="sd">          c (float): length of c</span>
<span class="sd">          alpha (float): Angle between axis b and c</span>
<span class="sd">          beta  (float): Angle between axis a and c</span>
<span class="sd">          gamma (float): Angle between axis a and b</span>
<span class="sd">          ibrav (int): ibrav to be used to convert for defaults</span>

<span class="sd">    Returns:</span>
<span class="sd">          cell_vol (float): volume of the cell</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">cellParamMatrix</span> <span class="o">=</span> <span class="n">abc2free</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">,</span><span class="n">returnString</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellVolumeFromVectors</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">abc2free</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">returnString</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts a,b,c,alpha,beta,gamma into QE convention primitive lattice vectors </span>

<span class="sd">    Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          a (float): length of a</span>
<span class="sd">          b (float): length of b</span>
<span class="sd">          c (float): length of c</span>
<span class="sd">          alpha (float): Angle between axis b and c</span>
<span class="sd">          beta  (float): Angle between axis a and c</span>
<span class="sd">          gamma (float): Angle between axis a and b</span>
<span class="sd">          ibrav (int): bravais lattice type by QE convention</span>
<span class="sd">          returnString (bool): return vectors as a string or as a numpy matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">          Either a numpy.matrix or a string of the primitive lattice vectors generated from the celldm input</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">ibrav</span><span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="n">celldm2</span><span class="p">,</span><span class="n">celldm3</span><span class="p">,</span><span class="n">celldm4</span><span class="p">,</span><span class="n">celldm5</span><span class="p">,</span><span class="n">celldm6</span> <span class="o">=</span> <span class="n">abc2celldm</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">)</span>
    <span class="n">cell_vectors</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">celldm2free</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">celldm1</span><span class="p">,</span><span class="n">celldm2</span><span class="p">,</span><span class="n">celldm3</span><span class="p">,</span><span class="n">celldm4</span><span class="p">,</span><span class="n">celldm5</span><span class="p">,</span><span class="n">celldm6</span><span class="p">,</span><span class="n">returnString</span><span class="o">=</span><span class="n">returnString</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cell_vectors</span>

<span class="c1"># def ibrav2String(ibrav=None,celldm1=None,celldm2=None,celldm3=None,celldm4=None,celldm5=None,celldm6=None):</span>
<span class="c1">#     &#39;&#39;&#39;</span>
<span class="c1">#     DEFUNCT &lt;CONSIDER FOR REMOVAL&gt;</span>

<span class="c1">#     Arguments:</span>


<span class="c1">#     Keyword Arguments:</span>


<span class="c1">#     Returns:</span>


<span class="c1">#     &#39;&#39;&#39;        </span>

<span class="c1">#     ibravStr = &quot;&quot;</span>

<span class="c1">#     try:</span>
<span class="c1">#         if ibrav == 1 or ibrav == 2 or ibrav ==3:</span>
<span class="c1">#                 ibravStr = &quot;ibrav=1, celldm(1)=%f\n&quot;%celldm1</span>
<span class="c1">#         elif ibrav == 5:</span>
<span class="c1">#                 ibravStr = &quot;ibrav=5, celldm(1)=%f, celldm(4)=%f\n&quot;%(celldm1, celldm2) </span>
<span class="c1">#         elif ibrav == 4 or ibrav == 6 or ibrav ==7:</span>
<span class="c1">#                 ibravStr = &quot;ibrav=2, celldm(1)=%f, celldm(3)=%f\n&quot;%(celldm1, celldm3)</span>
<span class="c1">#         elif ibrav == 8 or ibrav == 9 or ibrav == 10 or ibrav == 11:</span>
<span class="c1">#                 ibravStr = &quot;ibrav=2, celldm(1)=%f, celldm(2)=%f, celldm(3)=%f\n&quot;%(celldm1, celldm2, celldm3)</span>
<span class="c1">#         elif ibrav == 12 or ibrav == 13:</span>
<span class="c1">#                 ibravStr = &quot;ibrav=2, celldm(1)=%f, celldm(2)=%f, celldm(3)=%f, celldm(4)=%f\n&quot;%(celldm1, celldm2, celldm3, celldm4)</span>
<span class="c1">#         elif ibrav == 14:</span>
<span class="c1">#                 ibravStr = &quot;ibrav=2, celldm(1)=%f, celldm(2)=%f, celldm(3)=%f, celldm(4)=%f celldm(5)=%f celldm(6)=%f\n&quot;%(celldm1, celldm2, celldm3, celldm4, celldm5, celldm6)</span>
<span class="c1">#         else:</span>
<span class="c1">#             logging.error(&#39;ibrav %s is not a valid option.&#39; % ibrav)</span>
<span class="c1">#             print &#39;ibrav %s is not a valid option.&#39; % ibrav</span>
<span class="c1">#             return </span>

<span class="c1">#     except Exception,e:</span>
<span class="c1">#         AFLOWpi.run._fancy_error_log(e)</span>

<span class="c1">#     return ibravStr</span>



<span class="k">def</span> <span class="nf">getPositionsFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the atomic positions from the output. If atomic positons can not be read from</span>
<span class="sd">    output then the the positions from the input are returned.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          pos (numpy.matrix): atomic positions</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
            <span class="n">outFileString</span>  <span class="o">=</span> <span class="n">outFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">pos</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getPositions</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pos</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
                <span class="n">outFileString</span>  <span class="o">=</span> <span class="n">outFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getPositions</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">pos</span> 
    <span class="k">except</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outFileObj</span><span class="p">:</span>
                <span class="n">outFileString</span>  <span class="o">=</span> <span class="n">outFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="n">pos</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getPositions</span><span class="p">(</span><span class="n">outFileString</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">pos</span> 
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">getCellMatrixFromInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">,</span><span class="n">string</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the primitive cell vectors from the input.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          string (bool): Return a string or matrix</span>
<span class="sd">          scale (bool): scale the vectors by alat</span>

<span class="sd">    Returns:</span>
<span class="sd">          cellParamMatrix (numpy.matrix): primitive lattice params</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">splitInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;CELL_PARAMETERS&#39;</span> <span class="ow">in</span> <span class="n">splitInput</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="sd">&#39;&#39;&#39;sanitize the modifier&#39;&#39;&#39;</span>
        <span class="n">modifier</span><span class="o">=</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">][</span><span class="s1">&#39;__modifier__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;()</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">cellTimes</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">scale</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modifier</span><span class="o">==</span><span class="s1">&#39;angstrom&#39;</span><span class="p">:</span>
                <span class="n">cellTimes</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">0.529177249</span>
        <span class="n">cellParamString</span> <span class="o">=</span> <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span>
        <span class="n">cellParamMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_cellStringToMatrix</span><span class="p">(</span><span class="n">cellParamString</span><span class="p">)</span><span class="o">*</span><span class="n">cellTimes</span>

        <span class="k">return</span> <span class="n">cellParamMatrix</span>
    <span class="n">celldm2freeDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ibrav&#39;</span><span class="p">:</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;ibrav&#39;</span><span class="p">],</span><span class="s1">&#39;returnString&#39;</span><span class="p">:</span><span class="n">string</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;celldm&#39;</span><span class="p">,</span><span class="n">items</span><span class="p">)):</span>
            <span class="n">inputVar</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">inputVar</span> <span class="o">=</span> <span class="n">inputVar</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="n">celldm2freeDict</span><span class="p">[</span><span class="n">inputVar</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="n">items</span><span class="p">])</span>

    <span class="n">pos</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">celldm2free</span><span class="p">(</span><span class="o">**</span><span class="n">celldm2freeDict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pos</span>


<span class="k">def</span> <span class="nf">_getCelldm2freeDict</span><span class="p">(</span><span class="n">free2celldm_output_dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Cleans fortran array format into a format for python ex. celldm(1) to celldm1</span>

<span class="sd">    Arguments:</span>
<span class="sd">          free2celldm_output_dict (dict): output from AFLOWpi.retr.free2celldm</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          output_dict (dict) dictionary with cleaned keywords</span>

<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">outputDict</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">free2celldm_output_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;celldm&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">)):</span>
            <span class="n">inputVar</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">inputVar</span> <span class="o">=</span> <span class="n">inputVar</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">outputDict</span><span class="p">[</span><span class="n">inputVar</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s1">&#39;ibrav&#39;</span><span class="p">:</span>
            <span class="n">outputDict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outputDict</span>

<span class="k">def</span> <span class="nf">getPositionsFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFileObj</span><span class="p">:</span>
            <span class="n">inFileString</span>  <span class="o">=</span> <span class="n">inFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">return</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getPositions</span><span class="p">(</span><span class="n">inFileString</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_getPositions</span><span class="p">(</span><span class="n">inputString</span><span class="p">,</span><span class="n">matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="n">atomicPos</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">atomicPos</span><span class="p">,</span><span class="n">flags</span> <span class="o">=</span> <span class="n">detachPosFlags</span><span class="p">(</span><span class="n">atomicPos</span><span class="p">)</span>

    <span class="n">splitAtomicPos</span> <span class="o">=</span> <span class="n">atomicPos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">posArray</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">splitAtomicPos</span><span class="p">:</span>
        <span class="n">splitAtom</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitAtom</span><span class="p">):</span>
            <span class="n">posArray</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">splitAtom</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>

    <span class="k">if</span> <span class="n">matrix</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">arrayStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">posArray</span><span class="p">:</span>
            <span class="n">addition</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>                

            <span class="n">arrayStr</span><span class="o">+=</span><span class="n">addition</span>

        <span class="k">return</span> <span class="n">arrayStr</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">posArray</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputMatrix</span>


<span class="k">def</span> <span class="nf">_getPosLabels</span><span class="p">(</span><span class="n">inputString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="n">atomicPos</span>     <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">qe</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">atomic_positions</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">splitAtomicPos</span> <span class="o">=</span> <span class="n">atomicPos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">splitAtomicPos</span><span class="p">:</span>
        <span class="n">splitAtom</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitAtom</span><span class="p">):</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitAtom</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">labels</span>


<span class="c1">#################################################################################################################</span>
<span class="c1">#################################################################################################################</span>
<span class="c1">## prim to conv cell transform</span>
<span class="c1">#################################################################################################################</span>
<span class="c1">#################################################################################################################</span>

<span class="k">def</span> <span class="nf">_rho2hex</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">2.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                            <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                            <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span><span class="o">-</span><span class="mf">2.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span><span class="o">/</span><span class="mf">3.0</span>


    <span class="n">prim2conv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">conv2prim</span><span class="p">)</span>
    <span class="n">hex_vec</span><span class="o">=</span><span class="n">prim2conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">first</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">2.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                        <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                        <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span><span class="o">/</span><span class="mf">3.0</span>
    <span class="n">second</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.0</span>  <span class="p">,</span><span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                        <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">2.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                        <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">2.0</span> <span class="p">]])</span><span class="o">/</span><span class="mf">3.0</span>

    <span class="n">first_copy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="n">second_copy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">first_copy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">first</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">second_copy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">first</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="n">sym_list</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>


    <span class="n">first_list</span> <span class="o">=</span> <span class="n">first_copy</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">second_list</span><span class="o">=</span> <span class="n">second_copy</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">sym_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">first_list</span><span class="p">)</span>
    <span class="n">sym_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">second_list</span><span class="p">)</span>
    <span class="n">symMatrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">sym_list</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">symMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">prim2conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">hex_vec</span>

<span class="k">def</span> <span class="nf">_prim2ConvMatrix</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">ibrav</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">))</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">cellParamMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                             <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                             <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span>

<span class="c1">#    &#39;&#39;&#39;conventional cells are primative cells so don&#39;t do anything&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span>  <span class="ow">or</span>  <span class="n">ibrav</span><span class="o">==</span><span class="mi">4</span>  <span class="ow">or</span>  <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">8</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">12</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">14</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span>        


<span class="c1">#    &#39;&#39;&#39;Face Centered Cubic and Orthorhombic&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
                <span class="p">[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                <span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>


    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
                <span class="p">[</span> <span class="mf">1.0</span>  <span class="p">,</span><span class="o">-</span><span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span><span class="o">-</span><span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span> 
                <span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>

    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">]:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
                <span class="p">[</span> <span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span><span class="o">-</span><span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span> 
                <span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>
        

<span class="c1">#    &#39;&#39;&#39;Base Centered Orthorhombic and Monoclinic C centered&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">0.5</span>  <span class="p">,</span> <span class="mf">0.5</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span>  <span class="p">,</span> <span class="mf">0.5</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">]])</span>

    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">13</span><span class="p">:</span>
        <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">0.5</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span><span class="o">-</span><span class="mf">0.5</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
                                <span class="p">[</span> <span class="mf">0.5</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.5</span> <span class="p">]])</span>

    
    <span class="n">prim2conv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">conv2prim</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">prim2conv</span>




<span class="k">def</span> <span class="nf">_prim2ConvVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">prim2conv</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_prim2ConvMatrix</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">)</span>
    <span class="n">cellParamMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
<span class="c1">#    conv=prim2conv.dot(cellParamMatrixCopy).astype(numpy.float32)</span>
    <span class="k">return</span> <span class="n">prim2conv</span>

<span class="k">def</span> <span class="nf">_conv2PrimVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">prim2conv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">_prim2ConvMatrix</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">,</span><span class="n">ibrav</span><span class="o">=</span><span class="n">ibrav</span><span class="p">))</span>
    <span class="n">cellParamMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
<span class="c1">#    prim=prim2conv.dot(cellParamMatrixCopy).astype(numpy.float32)</span>
    <span class="k">return</span> <span class="n">prim2conv</span>

<span class="k">def</span> <span class="nf">_getConventionalCellFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">inputString</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>
    <span class="n">cellParamMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getCellMatrixFromInput</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>

    <span class="n">convCell</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_prim2ConvVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="sd">&#39;&#39;&#39;for aflow integration&#39;&#39;&#39;</span>
        
    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getPositionsFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getPosLabels</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_prim2convPositions</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">convCell</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">convCell</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span><span class="p">,</span><span class="n">convCell</span>


<span class="k">def</span> <span class="nf">_getConventionalCellFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">outputString</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getOutputString</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">alat</span><span class="p">,</span><span class="n">cellParamMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

    <span class="n">convCell</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_prim2ConvVec</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="o">*</span><span class="n">alat</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>

    <span class="sd">&#39;&#39;&#39;for aflow integration&#39;&#39;&#39;</span>


    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getPositionsFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">inputString</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">]</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getPosLabels</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_prim2convPositions</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellParamMatrix</span><span class="p">)</span>



    <span class="n">convCell</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">convCell</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span><span class="p">,</span><span class="n">convCell</span>

<span class="k">def</span> <span class="nf">transform_input_conv</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span><span class="p">,</span><span class="n">convCell</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getConventionalCellFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    
    <span class="n">atomic_pos</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_joinMatrixLabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">transformedPos</span><span class="p">)</span>
    <span class="n">celldmDict</span>  <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_free2celldm</span><span class="p">(</span><span class="n">convCell</span><span class="p">)</span>
    
    <span class="n">splitInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">celldmDict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">][</span><span class="s1">&#39;__content__&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">atomic_pos</span>
    <span class="n">splitInput</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;nat&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">newInput</span>  <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_joinInput</span><span class="p">(</span><span class="n">splitInput</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newInput</span>



<span class="k">def</span> <span class="nf">_prim2convPositions</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellParamMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="n">symMatrix</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfter</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="n">returnMatrix</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="n">ibrav</span> <span class="o">=</span> <span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>

    <span class="c1">#&#39;&#39;&#39;primative=conv&#39;&#39;&#39;</span>





    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">6</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">8</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">12</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">14</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span>
    

    <span class="c1">#&#39;&#39;&#39;base centered&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
        <span class="k">pass</span>


        
    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">13</span><span class="p">:</span>  

        <span class="k">pass</span>

    <span class="c1">#&#39;&#39;&#39;face centered&#39;&#39;&#39;        </span>

    <span class="c1">#&#39;&#39;&#39;body centered&#39;&#39;&#39;    </span>

    <span class="c1">#&#39;&#39;&#39;hexagonal&#39;&#39;&#39;    </span>


    <span class="n">prim2Conv</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_prim2ConvMatrix</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>




    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">3</span> <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span>

        <span class="n">largerReturn</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="c1">#double length of labels</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="n">lat1</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>
        <span class="n">lat2</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>


        <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">largerReturn</span>


        <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfter</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span>
            <span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">prim2Conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>

<span class="c1">#        for entry in range(len(lat1)):</span>
<span class="c1">#            largerReturn[entry]=AFLOWpi.retr._shiftAfter(lat1[entry])</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat1</span><span class="p">)):</span>
            <span class="n">lat1</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftX</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lat1</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftY</span><span class="p">(</span><span class="n">lat1</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lat1</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftZ</span><span class="p">(</span><span class="n">lat1</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1">#            largerReturn[entry+1*len(lat1)]= AFLOWpi.retr._shiftAfter(lat1[entry])</span>
<span class="c1">#            returnMatrix[entry+1*len(lat1)]= lat1[entry]</span>







    <span class="k">if</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">2</span>  <span class="ow">or</span> <span class="n">ibrav</span><span class="o">==</span><span class="mi">10</span><span class="p">:</span>
        <span class="n">largerReturn</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="c1">#double the length of the labels twice</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="n">lat1</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>
        <span class="n">lat2</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>
        <span class="n">lat3</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>
        <span class="n">lat4</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat1</span><span class="p">)):</span>
            <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfter</span><span class="p">(</span><span class="n">lat1</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>
            
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat2</span><span class="p">)):</span>
            <span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftY</span><span class="p">(</span><span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftZ</span><span class="p">(</span><span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="o">+</span><span class="mi">1</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">lat1</span><span class="p">)]</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfter</span><span class="p">(</span><span class="n">lat2</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat3</span><span class="p">)):</span>
            <span class="n">lat3</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftX</span><span class="p">(</span><span class="n">lat3</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lat3</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftZ</span><span class="p">(</span><span class="n">lat3</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">lat1</span><span class="p">)]</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfter</span><span class="p">(</span><span class="n">lat3</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat4</span><span class="p">)):</span>
            <span class="n">lat4</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftY</span><span class="p">(</span><span class="n">lat4</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lat4</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftZ</span><span class="p">(</span><span class="n">lat4</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">lat1</span><span class="p">)]</span><span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfter</span><span class="p">(</span><span class="n">lat4</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>

        
        <span class="n">largerReturn</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfter</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">largerReturn</span><span class="p">))</span>
        <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">largerReturn</span>
        

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">largerReturn</span><span class="p">)):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">largerReturn</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span>
            <span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">prim2Conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="n">returnMatrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>

    <span class="n">returnMatrixList</span><span class="o">=</span><span class="n">returnMatrix</span>
    <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">returnMatrix</span>


<span class="k">def</span> <span class="nf">_conv2primPositions</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellParamMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">returnMatrix</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="n">prim2Conv</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_prim2ConvMatrix</span><span class="p">(</span><span class="n">cellParamMatrix</span><span class="p">)</span>
    <span class="n">symMatrix</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span>  <span class="n">prim2Conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">returnMatrix</span>


<span class="k">def</span> <span class="nf">convertFCC</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="n">ID</span><span class="o">+</span><span class="s1">&#39;.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFileObj</span><span class="p">:</span>
            <span class="n">inputString</span>  <span class="o">=</span> <span class="n">inFileObj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getPosLabels</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>
    <span class="n">cellVectors</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getCellInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">getPositionsFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">posNew</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>

        <span class="n">posTemp</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_duplicateEdgeAtoms</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span>
        <span class="n">posTemp</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_reduceDuplicates</span><span class="p">(</span><span class="n">posTemp</span><span class="p">)</span>
        <span class="n">posNew</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">posTemp</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">posNew</span><span class="p">]</span>

    <span class="n">conv2prim</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                            <span class="p">[</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
                            <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span>  <span class="p">,</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span> <span class="p">]])</span><span class="o">/</span><span class="mi">2</span>

    <span class="n">prim2conv</span> <span class="o">=</span>     <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">conv2prim</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">conv</span> <span class="o">=</span>  <span class="n">prim2conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="n">a</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span>  <span class="n">b</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span>  <span class="n">c</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="p">]],)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
        <span class="n">positions</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">prim2conv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>




<span class="c1">##############################################################################################################</span>
<span class="c1">##</span>
<span class="c1">## NOT DONE</span>
<span class="c1">##</span>
<span class="c1">##############################################################################################################</span>

<span class="c1"># def get_aflow_transform(ibrav):</span>

<span class="c1">#     #SC ST SO RHO TRI SMCL                                                                                                                                                                                                                                                        </span>
<span class="c1">#     if ibrav in [1,4,5,6,8,12,14]:</span>
<span class="c1">#         cellParamMatrix = numpy.matrix([[ 1.0  , 0.0 , 0.0 ],</span>
<span class="c1">#                                         [ 0.0  , 1.0 , 0.0 ],</span>
<span class="c1">#                                         [ 0.0  , 0.0 , 1.0 ]])</span>
<span class="c1">#     #FC                                                                                                                                                                                                                                                                           </span>
<span class="c1">#     if ibrav in [2,10]:</span>
<span class="c1">#         cellParamMatrix = numpy.matrix([[ 0.0  , 1.0 , 1.0, ],</span>
<span class="c1">#                                         [ 1.0  , 0.0 , 1.0, ],</span>
<span class="c1">#                                         [ 1.0  , 1.0 , 0.0, ],])/2.0</span>
<span class="c1">#     #BC                                                                                                                                                                                                                                                                           </span>
<span class="c1">#     if ibrav in [3,7,11]:</span>
<span class="c1">#         cellParamMatrix = numpy.matrix([[-1.0  , 1.0 , 1.0 ],</span>
<span class="c1">#                                         [ 1.0  ,-1.0 , 1.0 ],</span>
<span class="c1">#                                         [ 1.0  , 1.0 ,-1.0 ]])/2.0</span>
<span class="c1">#     #ORCC                                                                                                                                                                                                                                                                         </span>
<span class="c1">#     if ibrav in [9]:</span>
<span class="c1">#         cellParamMatrix = numpy.matrix([[ 1.0  ,-1.0 , 0.0 ],</span>
<span class="c1">#                                         [ 1.0  , 1.0 , 0.0 ],</span>
<span class="c1">#                                         [ 0.0  , 0.0 , 2.0 ]])/2.0</span>
<span class="c1">#     #MCLC                                                                                                             </span>

<span class="c1">#     if ibrav in [13]:</span>
<span class="c1">#         cellParamMatrix = numpy.matrix([[ 1.0  , 1.0 , 0.0 ],</span>
<span class="c1">#                                         [-1.0  , 1.0 , 0.0 ],</span>
<span class="c1">#                                         [ 0.0  , 0.0 , 2.0 ]])/2.0</span>
<span class="c1">#     return cellParamMatrix</span>

<span class="c1"># def get_conv_aflow(cellParamMatrix,ibrav=0):</span>

<span class="c1">#     transform_matrix = get_aflow_transform(ibrav)</span>
<span class="c1">#     transform = numpy.linalg.inv(transform_matrix)</span>
<span class="c1">#     return transform.dot(cellParamMatrix)</span>


<span class="c1"># def QE_AFLOW(inputString):</span>

<span class="c1">#     cellParamMatrix = AFLOWpi.retr.getCellMatrixFromInput(inputString,scale=False)</span>
<span class="c1">#     to_prim=numpy.linalg.inv(AFLOWpi.retr._prim2ConvMatrix(cellParamMatrix,ibrav+1))</span>

<span class="c1">#     symMatrix = AFLOWpi.retr._getPositions(inputString).astype(numpy.float16)</span>

<span class="c1">#     input_dict = AFLOWpi.retr._splitInput(inputString)</span>
<span class="c1">#     cellParamMatrix = to_prim.dot(get_conv_aflow(cellParamMatrix,ibrav=ibrav+1))</span>
<span class="c1">#     cellParamMatrix = AFLOWpi.retr._cellMatrixToString(cellParamMatrix)</span>

<span class="c1">#     input_dict[&#39;CELL_PARAMETERS&#39;][&#39;__content__&#39;]=cellParamMatrix</span>

<span class="c1">#     pos_conv_aflow = get_conv_aflow(symMatrix.T,ibrav=ibrav+1)</span>
<span class="c1">#     symMatrix = to_prim.dot(pos_conv_aflow).T</span>
<span class="c1">#     symMatrix = AFLOWpi.retr._shiftAfter(symMatrix)</span>
<span class="c1">#     labels = AFLOWpi.retr._getPosLabels(inputString)</span>
<span class="c1">#     symMatrix = AFLOWpi.retr._joinMatrixLabels(labels,symMatrix)</span>

<span class="c1">#     input_dict[&#39;ATOMIC_POSITIONS&#39;][&#39;__content__&#39;]=symMatrix</span>
<span class="c1">#     input_dict[&#39;ATOMIC_SPECIES&#39;][&#39;__content__&#39;]=&#39;\n&#39;.join(list(set(labels)))+&#39;\n&#39;</span>
<span class="c1">#     inputString = AFLOWpi.retr._joinInput(input_dict)</span>

<span class="c1">#     return inputString</span>

<span class="c1">##############################################################################################################</span>
<span class="c1">##</span>
<span class="c1">## NOT DONE</span>
<span class="c1">##</span>
<span class="c1">##############################################################################################################</span>

<span class="k">def</span> <span class="nf">getIbravFromVectors</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>


    <span class="n">alpha</span> <span class="o">=</span> <span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">beta</span>  <span class="o">=</span> <span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">cellVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">alphaDegrees</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">alphaDegrees</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">betaDegrees</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">betaDegrees</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gammaDegrees</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">gammaDegrees</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>



    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0001</span><span class="p">:</span>
        <span class="n">alphaDegrees</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0001</span><span class="p">:</span>
        <span class="n">betaDegrees</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0001</span><span class="p">:</span>
        <span class="n">gammaDegrees</span><span class="o">=</span><span class="mf">0.0</span>

    

    <span class="c1"># print a</span>
    <span class="c1"># print b</span>
    <span class="c1"># print c</span>
    <span class="c1"># print alphaDegrees</span>
    <span class="c1"># print betaDegrees</span>
    <span class="c1"># print gammaDegrees</span>

    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>

        <span class="n">sortedVec</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_sortMatrix</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>

        <span class="n">reversedMat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">sortedVec</span><span class="o">.</span><span class="n">getA</span><span class="p">())])</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
        <span class="sd">&#39;&#39;&#39;in the case of FCC&#39;&#39;&#39;</span>
        <span class="k">if</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mf">60.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">60.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mf">60.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span>
            
            <span class="sd">&#39;&#39;&#39;in the case of simple cubic&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">reversedMat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">a</span> <span class="ow">and</span> <span class="n">reversedMat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">b</span> <span class="ow">and</span> <span class="n">reversedMat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
            <span class="sd">&#39;&#39;&#39;in the case of BCC&#39;&#39;&#39;</span>


        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span>  <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">109.471225753</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">5</span>            
            
        <span class="sd">&#39;&#39;&#39;in the case of hexagonal&#39;&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">120.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">4</span>
        <span class="sd">&#39;&#39;&#39;in the case of rhombohedral&#39;&#39;&#39;</span>


    <span class="k">elif</span> <span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span>  <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mf">109.471220</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">109.471220</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mf">109.471220</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)):</span>
        <span class="k">return</span> <span class="mi">3</span>

    
    <span class="k">elif</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;in the case of simple Tet&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">6</span>
            <span class="sd">&#39;&#39;&#39;in the case of ORCC base cenetered ortho&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">9</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">9</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">9</span>


            <span class="s1">&#39;in the case of MCLC base centered monoclinic&#39;</span>
        <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">13</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">13</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">13</span>



        <span class="sd">&#39;&#39;&#39;in the case of BCO&#39;&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span>  <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">7</span>

            <span class="sd">&#39;&#39;&#39;in the case of ORCI&#39;&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">11</span>


        <span class="sd">&#39;&#39;&#39;in the case of simple ortho&#39;&#39;&#39;</span>
    <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span>  <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span><span class="p">:</span>

        <span class="n">sortedVec</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_sortMatrix</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>
        <span class="n">reversedMat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">sortedVec</span><span class="o">.</span><span class="n">getA</span><span class="p">())])</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>

        <span class="k">if</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="n">gammaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">betaDegrees</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">8</span>



            <span class="s1">&#39;in the case of MCL simple monoclinic&#39;</span>
        <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">12</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">12</span>
        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegrees</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">12</span>



        <span class="k">elif</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegrees</span><span class="o">-</span><span class="n">alphaDegrees</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="n">ORCFtest</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertCellBC</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>

            <span class="n">aTest</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
            <span class="n">bTest</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
            <span class="n">cTest</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>


            <span class="n">alphaTest</span> <span class="o">=</span> <span class="n">ORCFtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">bTest</span><span class="o">*</span><span class="n">cTest</span><span class="p">)</span>
            <span class="n">betaTest</span>  <span class="o">=</span> <span class="n">ORCFtest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">aTest</span><span class="o">*</span><span class="n">cTest</span><span class="p">)</span>
            <span class="n">gammaTest</span> <span class="o">=</span> <span class="n">ORCFtest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ORCFtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">aTest</span><span class="o">*</span><span class="n">bTest</span><span class="p">)</span>

            <span class="n">alphaDegreesTest</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">alphaTest</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">betaDegreesTest</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">betaTest</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">gammaDegreesTest</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">gammaTest</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
        

            <span class="s1">&#39;in the case of ORCF try to convert cell to ORCF and see if alpha,beta,gamma=90 degrees&#39;</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaDegreesTest</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaDegreesTest</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaDegreesTest</span><span class="o">-</span><span class="mf">90.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">10</span>
                <span class="s1">&#39;if not then this is triclinic &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">14</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
        

        <span class="s1">&#39;in the case of ORCI body centered ortho&#39;</span>

<span class="k">def</span> <span class="nf">_convertCellBC</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">,</span><span class="n">toPrimOrConv</span><span class="o">=</span><span class="s1">&#39;conv&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>
    <span class="n">convertMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span>
                                  <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">],</span>
                                  <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>


    <span class="n">div2matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
                               <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
                               <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]])</span>

    <span class="n">convertMatrix</span> <span class="o">=</span> <span class="n">convertMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">div2matrix</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">toPrimOrConv</span><span class="o">==</span><span class="s1">&#39;prim&#39;</span><span class="p">:</span>
        <span class="n">convertMatrix</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">convertMatrix</span><span class="p">)</span>
    
    <span class="n">returnMatrix</span> <span class="o">=</span> <span class="n">convertMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellVectors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">returnMatrix</span>
    <span class="sd">&#39;&#39;&#39;needs to be removed sometime soon&#39;&#39;&#39;</span>
    <span class="sd">&#39;&#39;&#39;needs to be removed sometime soon&#39;&#39;&#39;</span>

<span class="k">def</span> <span class="nf">_cellStringToMatrix</span><span class="p">(</span><span class="n">cellParamString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">cellParamSplit</span> <span class="o">=</span> <span class="n">cellParamString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>                                                                  
                                                                                                                   
    <span class="n">splitList</span> <span class="o">=</span> <span class="p">[]</span>                                                                                                    

    <span class="n">splitList</span> <span class="o">=</span> <span class="p">[</span><span class="n">split</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">cellParamSplit</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">)]</span>
    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">splitList</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">symMatrix</span>

<span class="k">def</span> <span class="nf">_cellMatrixToString</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cellMatrix</span><span class="o">=</span><span class="n">cellMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">outputString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">indent</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">)):</span>
            <span class="n">outputString</span><span class="o">+=</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%16.10f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cellMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">)):</span>
            <span class="n">outputString</span><span class="o">+=</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%10.10f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cellMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="k">return</span> <span class="n">outputString</span>

<span class="k">def</span> <span class="nf">_getCellInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">scaled</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gets the primitive cell vectors from the input file</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          scaled (bool): scale vectors by alat</span>

<span class="sd">    Returns:</span>
<span class="sd">          symMatrix (numpy.matrix): matrix representing primive lattice vectors</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cellParamMatrixDict</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_splitInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])</span>
        <span class="n">ibrav</span><span class="o">=</span><span class="n">cellParamMatrixDict</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">][</span><span class="s1">&#39;ibrav&#39;</span><span class="p">]</span>
        <span class="n">celldmDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ibrav&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)}</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span>  <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cellParamMatrixDict</span><span class="p">[</span><span class="s1">&#39;&amp;system&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;celldm&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">!=</span><span class="mi">0</span> <span class="p">]:</span>
            <span class="n">fixed</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[)(\s]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">celldmDict</span><span class="p">[</span><span class="n">fixed</span><span class="p">]</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                       
        
        <span class="n">cellParams</span> <span class="o">=</span> <span class="n">celldm2free</span><span class="p">(</span><span class="o">**</span><span class="n">celldmDict</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;no CELL_PARAMETERS in input&#39;</span>
        <span class="k">return</span>

    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_cellStringToMatrix</span><span class="p">(</span><span class="n">cellParams</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">scaled</span><span class="p">:</span>
        <span class="n">symMatrix</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">/</span><span class="n">a</span>

    <span class="k">return</span> <span class="n">symMatrix</span>


<span class="c1">#####################################################################################################################</span>
<span class="c1">#####################################################################################################################</span>
<span class="c1">## cell and position transform</span>
<span class="c1">#####################################################################################################################</span>
<span class="c1">#####################################################################################################################</span>

<span class="k">def</span> <span class="nf">_getSymmInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>        

    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">getPositionsFromInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">orig</span>


<span class="k">def</span> <span class="nf">_duplicateEdgeAtoms</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">arrayList</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">arrayMat</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="o">=</span><span class="n">arrayMat</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
            <span class="sd">&#39;&#39;&#39;if atom is on side of cell make duplicate on the other side&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>            

        <span class="n">formMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayList</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">formMatrix</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">arrayList</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">arrayMat</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="o">=</span><span class="n">arrayMat</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
            <span class="sd">&#39;&#39;&#39;if atom is on side of cell make duplicate on the other side&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">add</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>            

        <span class="n">formMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayList</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">formMatrix</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">symMatrix</span>


<span class="k">def</span> <span class="nf">_getCartConvMatrix</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="sd">&#39;&#39;&#39;get the conventional matrix from the primitive including the positions&#39;&#39;&#39;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>


    <span class="n">cosA</span> <span class="o">=</span> <span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">cosB</span>  <span class="o">=</span> <span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
    <span class="n">cosG</span> <span class="o">=</span> <span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>


    <span class="n">alphaRad</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cosA</span><span class="p">)</span>
    <span class="n">betaRad</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cosB</span><span class="p">)</span>
    <span class="n">gammaRad</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cosG</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaRad</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
        <span class="n">alphaRad</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">betaRad</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
        <span class="n">betaRad</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gammaRad</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
        <span class="n">gammaRad</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">sinA</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alphaRad</span><span class="p">)</span>
    <span class="n">sinB</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">betaRad</span><span class="p">)</span>
    <span class="n">sinG</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gammaRad</span><span class="p">)</span>

    
    <span class="n">cartMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="n">cosG</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">cosB</span>                     <span class="p">],</span>
                               <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="n">sinG</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">sinB</span><span class="o">*</span><span class="n">cosA</span>                <span class="p">],</span>
                               <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>      <span class="n">c</span><span class="o">*</span><span class="n">sinB</span><span class="o">*</span><span class="n">sinA</span>                <span class="p">],])</span>


    <span class="k">return</span> <span class="n">cartMatrix</span>

<span class="k">def</span> <span class="nf">_convertCartesian</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">scaleFactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts atomic positions from crystal to cartesian coordinates</span>

<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          scaleFactor (int): scaling factor for output matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">          in_cart (postions in cartiesian coordinates)</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cellMatrix</span> <span class="o">=</span> <span class="n">cellMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span> 

    <span class="k">try</span><span class="p">:</span>
        <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">symMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span> 

    <span class="n">cellMatrix</span><span class="o">=</span><span class="n">cellMatrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">symMatrix</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">returnMatrix</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)):</span>
        <span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">=</span><span class="n">cellMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="n">in_cart</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">returnMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">in_cart</span>

<span class="k">def</span> <span class="nf">_convertFractional</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">scaleFactor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts atomic positions from cartesian to crystal coordinates</span>

<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          scaleFactor (int): scaling factor for output matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">          in_cart (numpy.matrix): postions in crystal coordinates</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">symMatrix</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cellMatrix</span><span class="o">=</span><span class="n">cellMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>


    <span class="n">cartMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getCartConvMatrix</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="n">cartMatrixInv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cartMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">cartMatrixInv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">=</span><span class="n">cartMatrixInv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span>

    <span class="n">returnMat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">returnMat</span>




<span class="k">def</span> <span class="nf">_expandBoundariesNoScale</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">numX</span><span class="p">,</span><span class="n">numY</span><span class="p">,</span><span class="n">numZ</span><span class="p">,</span><span class="n">inList</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrix</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">symMatrixList</span><span class="o">=</span><span class="n">symMatrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">superList</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">if</span> <span class="n">expand</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixList</span><span class="p">)):</span>
            <span class="n">superList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">item</span><span class="p">],</span><span class="n">symMatrixList</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">symMatrixList</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">symMatrixList</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">2</span><span class="p">],])</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)):</span>
        <span class="n">superList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">entry</span><span class="p">],</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">numX</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">numY</span><span class="p">,</span><span class="n">symMatrix</span><span class="p">[</span><span class="n">entry</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">numZ</span><span class="p">])</span>


                    
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">inList</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">symMatrix</span><span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">symMatrix</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">superList</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">symMatrix</span>


<span class="k">def</span> <span class="nf">_shiftX</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          coordVec (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">arrayVec</span><span class="o">=</span><span class="n">coordVec</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">arrayVec</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+=</span><span class="n">shift</span>


    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_shiftY</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          coordVec (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">arrayVec</span><span class="o">=</span><span class="n">coordVec</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">arrayVec</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>



    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="n">shift</span>

    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_shiftZ</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          coordVec (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">arrayVec</span><span class="o">=</span><span class="n">coordVec</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">arrayVec</span><span class="o">=</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+=</span><span class="n">shift</span>


    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_checkEqualPoint</span><span class="p">(</span><span class="n">oldMatrix</span><span class="p">,</span><span class="n">newMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">oldMatrix</span><span class="o">==</span><span class="n">newMatrix</span>


<span class="k">def</span> <span class="nf">_shiftAfterRotation</span><span class="p">(</span><span class="n">coordVec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          coordVec (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="sd">&#39;&#39;&#39;shift back to centering around the middle of cell&#39;&#39;&#39;</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+=</span><span class="mf">0.5</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="mf">0.5</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+=</span><span class="mf">0.5</span>


    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>




<span class="k">def</span> <span class="nf">getPointGroup</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    NOT COMPLETED.</span>

<span class="sd">    Arguments:</span>
<span class="sd">          oneCalc (dict): a dictionary containing properties about the AFLOWpi calculation</span>
<span class="sd">          ID (str): ID string for the particular calculation and step</span>


<span class="sd">    Keyword Arguments:</span>
<span class="sd">          source (string): either &#39;input&#39; or &#39;output&#39; to get point group from input</span>
<span class="sd">                           or output atomic positions</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">source</span><span class="o">!=</span><span class="s1">&#39;input&#39;</span> <span class="ow">and</span> <span class="n">source</span><span class="o">!=</span><span class="s1">&#39;output&#39;</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s1">&#39;source must equal &quot;input&quot; or &quot;output&quot;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;source must equal &quot;input&quot; or &quot;output&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> 
    <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s1">&#39;input&#39;</span><span class="p">:</span>
        <span class="n">cellInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getCellInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
        <span class="n">symInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getSymmInput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s1">&#39;output&#39;</span><span class="p">:</span>
        <span class="n">symInput</span> <span class="o">=</span> <span class="n">getPositionsFromOutput</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
        <span class="n">alat</span><span class="p">,</span><span class="n">symInput</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getCellParams</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>


        
    <span class="n">ibrav</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">getIbravFromVectors</span><span class="p">(</span><span class="n">cellInput</span><span class="p">)</span>

        

    

    
<span class="k">def</span> <span class="nf">_sortMatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          matrix (numpy.matrix): sorts the matrix</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">sortedMatrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">uniqueSet</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;if atom is at side of cell pull it back&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">arrayVec</span> <span class="ow">in</span> <span class="n">sortedMatrix</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;add it to a set so we don&#39;t have repeats&#39;&#39;&#39;</span>
        <span class="n">uniqueSet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">))</span>
    <span class="n">sortedMatrix</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">uniqueSet</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;sort it so we can have a proper comparison&#39;&#39;&#39;</span>
    <span class="n">sortedMatrix</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sortedMatrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">sortedMatrix</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_shiftAfter</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          matrix (numpy.matrix): sorts the matrix</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">arrayList</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">=</span><span class="n">matrix</span>



    <span class="k">for</span> <span class="n">arrayVec</span> <span class="ow">in</span> <span class="n">matrix</span><span class="p">:</span>
        <span class="n">arrayVec</span><span class="o">=</span><span class="n">arrayVec</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="sd">&#39;&#39;&#39;shift positions in cell to account for sides of cell&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-=</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-=</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0</span>

        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+=</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">/</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">arrayVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+=</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">/</span><span class="mf">1.0</span>
        <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>
    

    <span class="n">MATRIX</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayList</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayList</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">compMatrices</span><span class="p">(</span><span class="n">matrix1</span><span class="p">,</span><span class="n">matrix2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Compare two numpy matrices to see if they are equal or not</span>

<span class="sd">    Arguments:</span>
<span class="sd">          matrix1 (numpy.matrix): first matrix</span>
<span class="sd">          matrix2 (numpy.matrix): second matrix</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">          equalBool (bool): True if they&#39;re equal False if they&#39;re not</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">matrix1</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftCell</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
    <span class="n">matrix2</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftCell</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>

    <span class="n">matrix1</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_reduceDuplicates</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
    <span class="n">matrix2</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_reduceDuplicates</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>

    <span class="n">sortedMatrix1</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_sortMatrix</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
    <span class="n">sortedMatrix2</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_sortMatrix</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">equalBool</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">sortedMatrix1</span> <span class="o">==</span> <span class="n">sortedMatrix2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">equalBool</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="n">matrix1</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_duplicateEdgeAtoms</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
            <span class="n">matrix2</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_duplicateEdgeAtoms</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>
            <span class="n">matrix1</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_reduceDuplicates</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
            <span class="n">matrix2</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_reduceDuplicates</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>

            <span class="n">sortedMatrix1</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_sortMatrix</span><span class="p">(</span><span class="n">matrix1</span><span class="p">)</span>
            <span class="n">sortedMatrix2</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_sortMatrix</span><span class="p">(</span><span class="n">matrix2</span><span class="p">)</span>
            <span class="n">equalBool</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">sortedMatrix1</span> <span class="o">==</span> <span class="n">sortedMatrix2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">equalBool</span>
    <span class="k">except</span><span class="p">:</span>

        <span class="k">return</span> <span class="kc">False</span>

        
        


<span class="k">def</span> <span class="nf">invertXYZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">):</span>    
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertCartesian</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__invertXYZ</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>


    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">symMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">symMatrix</span>


        

<span class="k">def</span> <span class="nf">invertX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_invertX</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)):</span>
        <span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfterRotation</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">outputMatrix</span>
<span class="k">def</span> <span class="nf">invertY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_invertY</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)):</span>
        <span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfterRotation</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">outputMatrix</span>

<span class="k">def</span> <span class="nf">invertZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_invertZ</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)):</span>
        <span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfterRotation</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">outputMatrix</span>


        
<span class="k">def</span> <span class="nf">shiftX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftX</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">shift</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">symMatrixCopy</span>


<span class="k">def</span> <span class="nf">shiftY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftY</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">shift</span><span class="o">*</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">symMatrixCopy</span>




<span class="k">def</span> <span class="nf">shiftZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>
    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cellMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftZ</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">shift</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">outputMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertFractional</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>


    <span class="k">return</span> <span class="n">symMatrixCopy</span>


        
<span class="k">def</span> <span class="nf">glideXshiftY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftY</span><span class="p">(</span><span class="n">invertX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">glideXshiftZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftZ</span><span class="p">(</span><span class="n">invertX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">glideYshiftZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftZ</span><span class="p">(</span><span class="n">invertY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">glideYshiftX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftX</span><span class="p">(</span><span class="n">invertY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">glideZshiftX</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftX</span><span class="p">(</span><span class="n">invertZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">glideZshiftY</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shiftY</span><span class="p">(</span><span class="n">invertZ</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">),</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span>




<span class="k">def</span> <span class="nf">rotateAlpha</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="s1">&#39;shift fractional coords to center around 0,0,0&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="s1">&#39;convert to cartesian&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="s1">&#39;rotate in cartesian around z axis&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">coordMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_rotateAlpha</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordMatrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="s1">&#39;transform back to fractional coords&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertFractional</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>



    <span class="s1">&#39;shift back to center around 0.5,0.5,0.5&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">symMatrixCopy</span>

<span class="k">def</span> <span class="nf">rotateBeta</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="s1">&#39;shift fractional coords to center around 0,0,0&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="s1">&#39;convert to cartesian&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="s1">&#39;rotate in cartesian around z axis&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">coordMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_rotateBeta</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordMatrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="s1">&#39;transform back to fractional coords&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertFractional</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>



    <span class="s1">&#39;shift back to center around 0.5,0.5,0.5&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">symMatrixCopy</span>

<span class="k">def</span> <span class="nf">rotateGamma</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>
<span class="sd">          cellMatrix (numpy.matrix): primitive lattice vectors in matrix form</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outputMatrix</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">symMatrixCopy</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>
    <span class="s1">&#39;shift fractional coords to center around 0,0,0&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftBeforeRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="s1">&#39;convert to cartesian&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertCartesian</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>

    <span class="s1">&#39;rotate in cartesian around z axis&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="n">symMatrixCopy</span><span class="p">:</span>
        <span class="n">coordMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_rotateGamma</span><span class="p">(</span><span class="n">coordMatrix</span><span class="p">,</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">outputMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordMatrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">outputMatrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

    <span class="s1">&#39;transform back to fractional coords&#39;</span>
    <span class="n">symMatrixCopy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_convertFractional</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">,</span><span class="n">cellMatrix</span><span class="p">)</span>



    <span class="s1">&#39;shift back to center around 0.5,0.5,0.5&#39;</span>
    <span class="k">for</span> <span class="n">coordMatrix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">)):</span>
        <span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfterRotation</span><span class="p">(</span><span class="n">symMatrixCopy</span><span class="p">[</span><span class="n">coordMatrix</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">symMatrixCopy</span>
        

<span class="k">def</span> <span class="nf">_invertXYZ</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">xScale</span><span class="p">,</span><span class="n">yScale</span><span class="p">,</span><span class="n">zScale</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=-</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">=-</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_invertX</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">xScale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=-</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_invertY</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">yScale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_invertZ</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">zScale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">=-</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>


                      
<span class="k">def</span> <span class="nf">_rotateAlpha</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">angle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">([</span><span class="n">angle</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>

    <span class="n">rotationMatrix</span> <span class="o">=</span>     <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span>       <span class="mi">1</span>         <span class="p">,</span>       <span class="mi">0</span>         <span class="p">,</span>    <span class="mi">0</span>               <span class="p">],</span>
                                       <span class="p">[</span>       <span class="mi">0</span>          <span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>   <span class="p">],</span>
                                       <span class="p">[</span>       <span class="mi">0</span>          <span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>   <span class="p">],</span> <span class="p">])</span>



    <span class="n">coordVec</span> <span class="o">=</span> <span class="n">rotationMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coordVec</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="k">return</span> <span class="n">coordVec</span>



<span class="k">def</span> <span class="nf">_rotateBeta</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">angle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">([</span><span class="n">angle</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>



    <span class="n">rotationMatrix</span> <span class="o">=</span>     <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="p">,</span>     <span class="mi">0</span>           <span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>    <span class="p">],</span>
                                       <span class="p">[</span>     <span class="mi">0</span>           <span class="p">,</span>     <span class="mi">1</span>           <span class="p">,</span>    <span class="mi">0</span>               <span class="p">],</span>
                                       <span class="p">[</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>     <span class="mi">0</span>           <span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>    <span class="p">],</span> <span class="p">])</span>

    


    <span class="n">coordVec</span> <span class="o">=</span> <span class="n">rotationMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coordVec</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="k">return</span> <span class="n">coordVec</span>


    


<span class="k">def</span> <span class="nf">_rotateGamma</span><span class="p">(</span><span class="n">coordVec</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">angle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">([</span><span class="n">angle</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>


    <span class="n">rotationMatrix</span> <span class="o">=</span>     <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="p">,</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>      <span class="mi">0</span>             <span class="p">],</span>
                                       <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>      <span class="mi">0</span>             <span class="p">],</span>
                                       <span class="p">[</span>        <span class="mi">0</span>         <span class="p">,</span>     <span class="mi">0</span>           <span class="p">,</span>     <span class="mi">1</span>             <span class="p">],</span> <span class="p">])</span>

    <span class="n">coordVec</span> <span class="o">=</span> <span class="n">rotationMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coordVec</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">coordVec</span>

<span class="k">def</span> <span class="nf">_shiftBeforeRotation</span><span class="p">(</span><span class="n">coordVec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">coordVec</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coordVec</span><span class="p">)</span>
    <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">coordVec</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
    <span class="sd">&#39;&#39;&#39;shift to center all atoms around cartesian origin&#39;&#39;&#39;</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-=</span><span class="mf">0.5</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-=</span><span class="mf">0.5</span>
    <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="mf">0.5</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_shiftCell</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">arrayList</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">arrayMat</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
        <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">arrayMat</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
        <span class="sd">&#39;&#39;&#39;shift positions in cell to account for sides of cell&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">arrayMat</span><span class="o">-=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">arrayMat</span><span class="o">-=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">arrayMat</span><span class="o">-=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>
    <span class="k">for</span> <span class="n">arrayMat</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
        <span class="n">arrayVec</span> <span class="o">=</span> <span class="n">arrayMat</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">arrayMat</span><span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">arrayMat</span><span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>
        <span class="k">if</span> <span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">arrayMat</span><span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">shift</span>



        <span class="n">arrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>


    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayList</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>


    <span class="k">return</span> <span class="n">outMatrix</span>



<span class="k">def</span> <span class="nf">shiftCell</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfter</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">)</span>

    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_reduceDuplicates</span><span class="p">(</span><span class="n">outMatrix</span><span class="p">)</span>

    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_duplicateEdgeAtoms</span><span class="p">(</span><span class="n">outMatrix</span><span class="p">)</span>
    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_reduceDuplicates</span><span class="p">(</span><span class="n">outMatrix</span><span class="p">)</span>
    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_shiftAfter</span><span class="p">(</span><span class="n">outMatrix</span><span class="p">)</span>
    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_reduceDuplicates</span><span class="p">(</span><span class="n">outMatrix</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outMatrix</span>

<span class="k">def</span> <span class="nf">_reduceDuplicates</span><span class="p">(</span><span class="n">symMatrix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>
<span class="sd">          symMatrix (numpy.matrix): atomic positions in matrix form</span>

<span class="sd">    Keyword Arguments:</span>


<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">arrayListCopy</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>

    <span class="sd">&#39;&#39;&#39;to get rid of duplicates&#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">arrayMat</span> <span class="ow">in</span> <span class="n">symMatrix</span><span class="p">:</span>
        <span class="n">arrayVec</span><span class="o">=</span><span class="n">arrayMat</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">arrayListCopy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">arrayVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">arrayListCopy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arrayListCopy</span><span class="p">)</span>
    <span class="n">outMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">arrayListCopy</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">outMatrix</span>


<span class="k">def</span> <span class="nf">_get_cell_mass</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="n">num_of_each</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getAtomNum</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">],</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">total_mass</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">atom</span><span class="p">,</span><span class="n">number</span> <span class="ow">in</span> <span class="n">num_of_each</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">total_mass</span><span class="o">+=</span><span class="nb">float</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">_getAMass</span><span class="p">(</span><span class="n">atom</span><span class="p">))</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">total_mass</span>
<span class="c1">#####################################################################################################################</span>
<span class="c1">#####################################################################################################################</span>
<span class="c1">## misc</span>
<span class="c1">#####################################################################################################################</span>
<span class="c1">#####################################################################################################################</span>
<span class="k">def</span> <span class="nf">chemAsKeys</span><span class="p">(</span><span class="n">calcs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    For sets of calcs that only differ by chemistry you can replace the</span>
<span class="sd">    hash by the chemical name. May not always work. Especially if there</span>
<span class="sd">    are two compounds with swapped positions of atoms of different elements</span>

<span class="sd">    Arguments:</span>
<span class="sd">	  calcs (dict): dictionary of dictionaries of calculations</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          None</span>

<span class="sd">    Returns:</span>
<span class="sd">	  calcsCopy (dict): returns new dictionay with keys as the chemical stoiciometry</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">calcsCopy</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">stoicNameList</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">newKey</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">_getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">)</span>
        <span class="n">stoicNameList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newKey</span><span class="p">)</span>
        <span class="n">calcsCopy</span><span class="p">[</span><span class="n">newKey</span><span class="p">]</span><span class="o">=</span><span class="n">oneCalc</span>


    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">stoicNameList</span><span class="p">))</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">calcs</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;cannot uniquely identify each calc with a corresponding chem. returning original calcs&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;cannot uniquely identify each calc with a corresponding chem. returning original calcs&#39;</span>
    

    <span class="k">return</span> <span class="n">calcsCopy</span>

<span class="kn">import</span> <span class="nn">functools</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">la</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;aflow_prim2conv&#39;</span><span class="p">,</span> <span class="s1">&#39;aflow_conv2prim&#39;</span><span class="p">,</span> <span class="s1">&#39;qe_prim2conv&#39;</span><span class="p">,</span> <span class="s1">&#39;qe_conv2prim&#39;</span><span class="p">,</span>
           <span class="s1">&#39;conv_aflow2qe&#39;</span><span class="p">,</span> <span class="s1">&#39;conv_qe2aflow&#39;</span><span class="p">,</span> <span class="s1">&#39;prim_aflow2qe&#39;</span><span class="p">,</span> <span class="s1">&#39;prim_qe2aflow&#39;</span><span class="p">,</span>
           <span class="s1">&#39;InvalidIbravError&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InvalidIBravError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Supplied Bravais lattice index (ibrav) is not valid.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        value: The invalid Bravais lattice index that caused this error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="nb">super</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not a valid Bravais lattice&#39;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">validate_ibrav</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorates a basis transformation function to validate the Bravais lattice</span>
<span class="sd">    index in the range [0, 14].</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        func: The decorated function of two arguments, cell and ibrav.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Decorated function that raises `InvalidIBravError` when bad values are</span>
<span class="sd">        encountered.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">ibrav</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidIBravError</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">decorator</span>


<span class="k">def</span> <span class="nf">matmul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates the accumulated matrix or dot product of the arguments.&quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">others</span>
    <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">IBrav</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ibrav namespace&quot;&quot;&quot;</span>
    <span class="n">FREE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">CUB</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">FCC</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">BCC</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">HEX</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">RHL</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">TET</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">BCT</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">ORC</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">ORCC</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">ORCF</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">ORCI</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">MCL</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">MCLC</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="n">TRI</span> <span class="o">=</span> <span class="mi">14</span>


<span class="k">def</span> <span class="nf">aflow_primitive_to_aflow_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a transformation matrix for converting primtive cell vectors to</span>
<span class="sd">    conventional cell vectors using AFLOW convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` transformation matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># face-centered lattices</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="n">IBrav</span><span class="o">.</span><span class="n">FCC</span><span class="p">,</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">ORCF</span><span class="p">):</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">]])</span>
        
    <span class="c1"># body-centered lattices</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="n">IBrav</span><span class="o">.</span><span class="n">BCC</span><span class="p">,</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">BCT</span><span class="p">,</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">ORCI</span><span class="p">):</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">]])</span>
        
    <span class="c1"># orthorhombic base-centered lattice</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">ORCC</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
                               <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">]])</span>
        
    <span class="c1"># monoclinic base-centered lattice</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">MCLC</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">]])</span>
        
    <span class="c1"># lattices without centering share the same cell vectors between</span>
    <span class="c1"># their primitive cells and conventional cells, so no change is necessary</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">transform</span>
    
    
<span class="k">def</span> <span class="nf">aflow_conventional_to_aflow_primitive_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a transformation matrix for converting conventional cell vectors to</span>
<span class="sd">    primitive cell vectors using AFLOW convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` transformation matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># primitive to conventional is the inverse of the transform we want to do</span>
    <span class="n">inverse_transform</span> <span class="o">=</span> <span class="n">aflow_primitive_to_aflow_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span>
    
    <span class="c1"># invert the inverse transform</span>
    <span class="k">return</span> <span class="n">la</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">inverse_transform</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">qe_primitive_to_qe_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a transformation matrix for converting primitive cell vectors to</span>
<span class="sd">    conventional cell vectors using Quantum Espresso convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` transformation matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">FCC</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span>
                               <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">]])</span>
        
    <span class="c1"># body-centered lattices</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="n">IBrav</span><span class="o">.</span><span class="n">BCC</span><span class="p">,</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">ORCI</span><span class="p">):</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">]])</span>
        
    <span class="c1"># can&#39;t stuff BCT in with the other body-centered lattices</span>
    <span class="c1"># like in AFLOW because QE uniquely defines its lattice vectors</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">BCT</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span>
                               <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">]])</span>
    
    <span class="c1"># orthorhombic base-centered lattice</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">ORCC</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">]])</span>
        
    <span class="c1"># orthorhombic face-centered lattice</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">ORCF</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span>
                               <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">]])</span>
    
    <span class="c1"># monoclinic base-centered lattice</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">MCLC</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
                               <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">]])</span>
        
    <span class="c1"># lattices without centering share the same cell vectors between</span>
    <span class="c1"># their primitive cells and conventional cells, so no change is necessary</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">transform</span>


<span class="k">def</span> <span class="nf">qe_conventional_to_qe_primitive_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a transformation matrix for converting conventional cell vectors to</span>
<span class="sd">    primitive cell vectors using Quantum Espresso convention.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># primitive to conventional is the inverse of the transform we want to do</span>
    <span class="n">inverse_transform</span> <span class="o">=</span> <span class="n">qe_primitive_to_qe_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span>
    
    <span class="c1"># invert the inverse transform</span>
    <span class="k">return</span> <span class="n">la</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">inverse_transform</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">aflow_conventional_to_qe_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a transformation matrix for converting conventional cell vectors</span>
<span class="sd">    using AFLOW convention to conventional cell vectors using Quantum Espresso</span>
<span class="sd">    convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">        angle (float): Characteristic angle for the lattice structure, only</span>
<span class="sd">                       necessary for rhombohedral (RHL) lattices</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` transformation matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">HEX</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
                               <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
                               <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">]])</span>
    
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">RHL</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        
        <span class="k">assert</span> <span class="n">angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;characteristic angle must be supplied for RHL&quot;</span>
        
        <span class="n">cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">cos_half</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">sin_half</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="n">aflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
            <span class="p">[</span>      <span class="n">cos_half</span><span class="p">,</span> <span class="o">-</span><span class="n">sin_half</span><span class="p">,</span>                                <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span>      <span class="n">cos_half</span><span class="p">,</span>  <span class="n">sin_half</span><span class="p">,</span>                                <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="n">cos</span> <span class="o">/</span> <span class="n">cos_half</span><span class="p">,</span>         <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">cos</span> <span class="o">/</span> <span class="n">cos_half</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)]</span>
        <span class="p">])</span>
        
        <span class="n">tx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">tz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">cos</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        
        <span class="n">qe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span>
            <span class="p">[</span> <span class="n">tx</span><span class="p">,</span>  <span class="o">-</span><span class="n">ty</span><span class="p">,</span> <span class="n">tz</span><span class="p">],</span>
            <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">ty</span><span class="p">,</span> <span class="n">tz</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">tx</span><span class="p">,</span>  <span class="o">-</span><span class="n">ty</span><span class="p">,</span> <span class="n">tz</span><span class="p">]</span>
        <span class="p">])</span>
        
        <span class="n">transform</span> <span class="o">=</span> <span class="n">matmul</span><span class="p">(</span><span class="n">qe</span><span class="p">,</span> <span class="n">la</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">aflow</span><span class="p">))</span>
    
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">(</span><span class="n">IBrav</span><span class="o">.</span><span class="n">MCL</span><span class="p">,</span> <span class="n">IBrav</span><span class="o">.</span><span class="n">MCLC</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">transform</span>


<span class="k">def</span> <span class="nf">qe_conventional_to_aflow_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a transformation matrix for converting conventional cell vectors</span>
<span class="sd">    using Quantum Espresso convention to conventional cell vectors using AFLOW</span>
<span class="sd">    convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">        angle (float): Characteristic angle for the lattice structure, only</span>
<span class="sd">                       necessary for rhombohedral (RHL) lattices</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` transformation matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inverse_transform</span> <span class="o">=</span> <span class="n">aflow_conventional_to_qe_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">la</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">inverse_transform</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">aflow_primitive_to_qe_primitive_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a transformation matrix for converting primitive cell vectors using</span>
<span class="sd">    AFLOW convention to primitive cell vectors using Quantum Espresso convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` transformation matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># successive transforms AFLOW prim -&gt; AFLOW conv -&gt; QE conv -&gt; QE prim</span>
    <span class="n">transforms</span> <span class="o">=</span> <span class="p">(</span><span class="n">aflow_primitive_to_aflow_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">),</span>
                  <span class="n">aflow_conventional_to_qe_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="p">),</span>
                  <span class="n">qe_conventional_to_qe_primitive_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">matmul</span><span class="p">(</span><span class="o">*</span><span class="nb">reversed</span><span class="p">(</span><span class="n">transforms</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">qe_primitive_to_aflow_primitive_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a transformation matrix for converting primitive cell vectors using</span>
<span class="sd">    Quantum Espresso convention to primitive cell vectors using AFLOW convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` transformation matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># successive transforms QE prim -&gt; QE conv -&gt; AFLOW conv -&gt; AFLOW prim</span>
    <span class="n">transforms</span> <span class="o">=</span> <span class="p">(</span><span class="n">qe_primitive_to_qe_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">),</span>
                  <span class="n">qe_conventional_to_aflow_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="p">),</span>
                  <span class="n">aflow_conventional_to_aflow_primitive_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">matmul</span><span class="p">(</span><span class="o">*</span><span class="nb">reversed</span><span class="p">(</span><span class="n">transforms</span><span class="p">))</span>


<span class="nd">@validate_ibrav</span>
<span class="k">def</span> <span class="nf">aflow_primitive_to_aflow_conventional</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">ibrav</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts primitive cell vectors to conventional cell vectors using AFLOW</span>
<span class="sd">    convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        cell (numpy.matrix): 3x3 AFLOW primitive cell vectors</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` of the cell in AFLOW conventional lattice vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">aflow_primitive_to_aflow_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matmul</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
    

<span class="nd">@validate_ibrav</span>
<span class="k">def</span> <span class="nf">aflow_conventional_to_aflow_primitive</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">ibrav</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts conventional cell vectors to primitive cell vectors using AFLOW</span>
<span class="sd">    convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        cell (numpy.matrix): 3x3 AFLOW conventional cell vectors</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` of the cell in AFLOW primitive lattice vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">aflow_conventional_to_aflow_primitive_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matmul</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>


<span class="nd">@validate_ibrav</span>
<span class="k">def</span> <span class="nf">qe_primitive_to_qe_conventional</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">ibrav</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts primitive cell vectors to conventional cell vectors using Quantum</span>
<span class="sd">    Espresso convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        cell (numpy.matrix): 3x3 Quantum Espresso conventional cell vectors</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` of the cell in Quantum Espresso primitive lattice</span>
<span class="sd">        vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">qe_primitive_to_qe_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matmul</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>


<span class="nd">@validate_ibrav</span>
<span class="k">def</span> <span class="nf">qe_conventional_to_qe_primitive</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">ibrav</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts conventional cell vectors to primitive cell vectors using Quantum</span>
<span class="sd">    Espresso convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        cell (numpy.matrix): 3x3 Quantum Espresso conventional cell vectors</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` of the cell in Quantum Espresso primitive lattice</span>
<span class="sd">        vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">qe_conventional_to_qe_primitive_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matmul</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>


<span class="nd">@validate_ibrav</span>
<span class="k">def</span> <span class="nf">aflow_conventional_to_qe_conventional</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts conventional cell vectors using AFLOW convention to conventional</span>
<span class="sd">    cell vectors using Quantum Espresso convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        cell (numpy.matrix): 3x3 AFLOW conventional cell vectors</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">        angle (float): Characteristic angle for the lattice structure, only</span>
<span class="sd">                       necessary for rhombohedral (RHL) lattices</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` of the cell in Quantum Espresso conventional lattice</span>
<span class="sd">        vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">aflow_conventional_to_qe_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matmul</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>


<span class="nd">@validate_ibrav</span>
<span class="k">def</span> <span class="nf">qe_conventional_to_aflow_conventional</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts conventional cell vectors using Quantum Espresso convention to</span>
<span class="sd">    conventional cell vectors using AFLOW convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        cell (numpy.matrix): 3x3 Quantum Espresso conventional cell vectors</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">        angle (float): Characteristic angle for the lattice structure, only</span>
<span class="sd">                       necessary for rhombohedral (RHL) lattices</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` of the cell in AFLOW conventional lattice vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">qe_conventional_to_aflow_conventional_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matmul</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>


<span class="nd">@validate_ibrav</span>
<span class="k">def</span> <span class="nf">aflow_primitive_to_qe_primitive</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts primitive cell vectors using AFLOW convention to primitive cell</span>
<span class="sd">    vectors using Quantum Espresso convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        cell (numpy.matrix): 3x3 AFLOW primitive cell vectors</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` of the cell in Quantum Espresso primitive lattice</span>
<span class="sd">        vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">aflow_primitive_to_qe_primitive_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matmul</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>


<span class="nd">@validate_ibrav</span>
<span class="k">def</span> <span class="nf">qe_primitive_to_aflow_primitive</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts primitive cell vectors using Quantum Espresso convention to</span>
<span class="sd">    primitive cell vectors using AFLOW convention.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        cell (numpy.matrix): 3x3 AFLOW primitive cell vectors</span>
<span class="sd">        ibrav (int): Quantum Espresso Bravais lattice index of the crystal</span>
<span class="sd">                     structure</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        3x3 `numpy.matrix` of the cell in Quantum Espresso primitive lattice</span>
<span class="sd">        vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">qe_primitive_to_aflow_primitive_transform</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matmul</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>


<span class="c1"># aliases</span>
<span class="n">aflow_prim2conv</span> <span class="o">=</span> <span class="n">aflow_primitive_to_aflow_conventional</span>
<span class="n">aflow_conv2prim</span> <span class="o">=</span> <span class="n">aflow_conventional_to_aflow_primitive</span>
<span class="n">conv_aflow2qe</span> <span class="o">=</span> <span class="n">aflow_conventional_to_qe_conventional</span>
<span class="n">conv_qe2aflow</span> <span class="o">=</span> <span class="n">qe_conventional_to_aflow_conventional</span>
<span class="n">qe_prim2conv</span> <span class="o">=</span> <span class="n">qe_primitive_to_qe_conventional</span>
<span class="n">qe_conv2prim</span> <span class="o">=</span> <span class="n">qe_conventional_to_qe_primitive</span>
<span class="n">prim_aflow2qe</span> <span class="o">=</span> <span class="n">aflow2qe</span> <span class="o">=</span> <span class="n">aflow_primitive_to_qe_primitive</span>
<span class="n">prim_qe2aflow</span> <span class="o">=</span> <span class="n">qe2aflow</span> <span class="o">=</span> <span class="n">qe_primitive_to_aflow_primitive</span>


</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Andrew Supka.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>