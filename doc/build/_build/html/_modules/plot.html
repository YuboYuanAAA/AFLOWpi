<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>plot &mdash; AFLOWpi  documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="AFLOWpi  documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          AFLOWpi</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../plot.html">plot module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep.html">prep module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pseudo.html">pseudo module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retr.html">retr module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../run.html">run module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scfuj.html">scfuj module</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Source code for plot</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">logging</span> 
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pylab</span>
<span class="kn">import</span> <span class="nn">numpy</span> 
<span class="kn">import</span> <span class="nn">StringIO</span>
<span class="kn">import</span> <span class="nn">copy</span> 
<span class="kn">import</span> <span class="nn">re</span> 
<span class="kn">import</span> <span class="nn">AFLOWpi.prep</span>
<span class="kn">import</span> <span class="nn">AFLOWpi.retr</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> 
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span>

<span class="k">def</span> <span class="nf">__getPath_WanT</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Arguments:</span>


<span class="sd">    Keyword Arguments:</span>

<span class="sd">        </span>
<span class="sd">    Returns:</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">want_stdout_path</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/*_WanT_bands.out&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">want_stdout_path</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file_obj</span><span class="p">:</span>
        <span class="n">in_string</span> <span class="o">=</span> <span class="n">in_file_obj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getPath</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="o">=</span><span class="n">ID</span><span class="p">)</span>

    <span class="n">plot_bool</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">path_name</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">path_split</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>  <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path_split</span><span class="p">:</span>
        <span class="n">path_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span>  <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]):</span>

            <span class="n">plot_bool</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_bool</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">gg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;  Number of kpts in each segment</span><span class="se">\n</span><span class="s2">((?:.*:\W+(?:\d*)</span><span class="se">\n</span><span class="s2">)*)&quot;</span><span class="p">,</span><span class="n">in_string</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;line.*:\W+(\d+)&#39;</span><span class="p">,</span><span class="n">gg</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">include</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1">#print path_name</span>
    <span class="n">output_path_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)):</span>
        <span class="n">total</span><span class="o">+=</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">plot_bool</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">output_path_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">path_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output_path_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">path_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_path_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">path_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
            <span class="n">include</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plot_bool</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">include</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1">#    print print_out</span>
    <span class="n">output_path_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">path_name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> 

    <span class="n">want_bands_data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_bands_want.dat&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">want_bands_data_path</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file_obj</span><span class="p">:</span>
        <span class="n">bands_dat</span> <span class="o">=</span> <span class="n">in_file_obj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">split_bands</span> <span class="o">=</span> <span class="n">bands_dat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>


    <span class="n">split_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">per_band</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">split_bands</span><span class="p">:</span>
    <span class="c1">#    print len(i.strip())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">per_band</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">split_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per_band</span><span class="p">)</span>
                <span class="n">per_band</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">per_band</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="c1">#print len(split_data)</span>

    <span class="n">final_data</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">split_data</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">split_data</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="k">if</span> <span class="n">include</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">final_data</span><span class="o">+=</span> <span class="n">split_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">final_data</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>


    <span class="n">want_bands_data_path_new</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_bands_want.dat&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">want_bands_data_path_new</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file_obj</span><span class="p">:</span>
        <span class="n">in_file_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">final_data</span><span class="p">)</span>

    <span class="k">return</span>  <span class="n">output_path_string</span>


<span class="k">def</span> <span class="nf">__smoothGauss</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="n">strippedXs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>  
	<span class="sd">&#39;&#39;&#39;</span>


<span class="sd">	Arguments:</span>


<span class="sd">	Keyword Arguments:</span>

<span class="sd">        </span>
<span class="sd">        Returns:</span>


<span class="sd">	&#39;&#39;&#39;</span>

<span class="c1">#	return list</span>
	<span class="c1">#scale the degree to the number of data points for consistent</span>
	<span class="c1">#smoothing over different density k point grids	</span>
	<span class="n">degree</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">degree</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span><span class="o">/</span><span class="mf">500.0</span><span class="p">)))</span>

	
	<span class="n">window</span><span class="o">=</span><span class="n">degree</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>  
	<span class="n">weight</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]</span><span class="o">*</span><span class="n">window</span><span class="p">)</span>  
	<span class="n">weightGauss</span><span class="o">=</span><span class="p">[]</span>  
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">window</span><span class="p">):</span>  
		<span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="n">degree</span><span class="o">+</span><span class="mi">1</span>  
		<span class="n">frac</span><span class="o">=</span><span class="n">i</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>  
		<span class="n">gauss</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">frac</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>  
		<span class="n">weightGauss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gauss</span><span class="p">)</span>  
	<span class="n">weight</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weightGauss</span><span class="p">)</span><span class="o">*</span><span class="n">weight</span>  
	<span class="n">smoothed</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">-</span><span class="n">window</span><span class="p">)</span>  
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">smoothed</span><span class="p">)):</span>  
		<span class="n">smoothed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">window</span><span class="p">])</span><span class="o">*</span><span class="n">weight</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>  
	<span class="k">return</span> <span class="n">smoothed</span>




<span class="c1">###############################################################################################################################</span>
<div class="viewcode-block" id="transport_plots"><a class="viewcode-back" href="../plot.html#plot.transport_plots">[docs]</a><span class="k">def</span> <span class="nf">transport_plots</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>


	<span class="k">if</span> <span class="n">runlocal</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">__transport_plot</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="n">postfix</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
			<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;PLOT&#39;</span><span class="p">,</span><span class="s2">&quot;AFLOWpi.plot.__transport_plot(oneCalc,ID,postfix=&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span><span class="n">postfix</span><span class="p">)</span>


</div>
<span class="k">def</span> <span class="nf">__transport_plot</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">nm</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>


<span class="sd">	Arguments:</span>


<span class="sd">	Keyword Arguments:</span>


<span class="sd">	&#39;&#39;&#39;</span>

        <span class="n">trans_plot_dict</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">trans_plot_dict</span><span class="p">[</span><span class="s1">&#39;ZetaT&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pf&#39;</span><span class="p">:</span><span class="s1">&#39;ZetaT_&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;ft&#39;</span><span class="p">:</span><span class="s1">&#39;${\zeta}$T:&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;lc&#39;</span><span class="p">:</span><span class="s1">&#39;{\zeta}T &#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;xl&#39;</span><span class="p">:</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;yl&#39;</span><span class="p">:</span><span class="s1">&#39;${\zeta}T$ (au)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;fp&#39;</span><span class="p">:</span><span class="s1">&#39;ZETAT_&#39;</span><span class="p">,</span>
                                            <span class="p">}</span>
        <span class="n">trans_plot_dict</span><span class="p">[</span><span class="s1">&#39;cond&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pf&#39;</span><span class="p">:</span><span class="s1">&#39;cond_&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;ft&#39;</span><span class="p">:</span><span class="s1">&#39;$Conduction$:&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;lc&#39;</span><span class="p">:</span><span class="s1">&#39;Cond. &#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;xl&#39;</span><span class="p">:</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;yl&#39;</span><span class="p">:</span><span class="s1">&#39;$Conduction$ (au)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;fp&#39;</span><span class="p">:</span><span class="s1">&#39;CONDUCTION&#39;</span><span class="p">,</span>
                                            <span class="p">}</span>
        <span class="n">trans_plot_dict</span><span class="p">[</span><span class="s1">&#39;seebeck&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pf&#39;</span><span class="p">:</span><span class="s1">&#39;seebeck_&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;ft&#39;</span><span class="p">:</span><span class="s1">&#39;$Seebeck$:&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;lc&#39;</span><span class="p">:</span><span class="s1">&#39;Seebeck &#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;xl&#39;</span><span class="p">:</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;yl&#39;</span><span class="p">:</span><span class="s1">&#39;S ($\mu$V/K)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;fp&#39;</span><span class="p">:</span><span class="s1">&#39;SEEBECK&#39;</span><span class="p">,</span>
                                            <span class="p">}</span>
        <span class="n">trans_plot_dict</span><span class="p">[</span><span class="s1">&#39;sig_seebeck&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pf&#39;</span><span class="p">:</span><span class="s1">&#39;sigma_seebeck_&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;ft&#39;</span><span class="p">:</span><span class="s1">&#39;$\sigma_{Seebeck}$:&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;lc&#39;</span><span class="p">:</span><span class="s1">&#39;\sigma_{Seebeck} &#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;xl&#39;</span><span class="p">:</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;yl&#39;</span><span class="p">:</span><span class="s1">&#39;$\sigma_{Seebeck}$ (au)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;fp&#39;</span><span class="p">:</span><span class="s1">&#39;SIGMA_SEEBECK&#39;</span><span class="p">,</span>
                                            <span class="p">}</span>
        <span class="n">trans_plot_dict</span><span class="p">[</span><span class="s1">&#39;kappa&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pf&#39;</span><span class="p">:</span><span class="s1">&#39;kappa_&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;ft&#39;</span><span class="p">:</span><span class="s1">&#39;$\kappa$:&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;lc&#39;</span><span class="p">:</span><span class="s1">&#39;\kappa &#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;xl&#39;</span><span class="p">:</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;yl&#39;</span><span class="p">:</span><span class="s1">&#39;$\kappa$ (au)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;fp&#39;</span><span class="p">:</span><span class="s1">&#39;KAPPA&#39;</span><span class="p">,</span>
                                            <span class="p">}</span>
        <span class="n">trans_plot_dict</span><span class="p">[</span><span class="s1">&#39;epsilon_i&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pf&#39;</span><span class="p">:</span><span class="s1">&#39;epsilon_imag_&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;ft&#39;</span><span class="p">:</span><span class="s1">&#39;$\epsilon_{imaginary}$:&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;lc&#39;</span><span class="p">:</span><span class="s1">&#39;\epsilon_{i} &#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;xl&#39;</span><span class="p">:</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;yl&#39;</span><span class="p">:</span><span class="s1">&#39;$\epsilon_{imag}$ (au)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;fp&#39;</span><span class="p">:</span><span class="s1">&#39;EPSILON_IMAG&#39;</span><span class="p">,</span>
                                            <span class="p">}</span>
        <span class="n">trans_plot_dict</span><span class="p">[</span><span class="s1">&#39;epsilon_r&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pf&#39;</span><span class="p">:</span><span class="s1">&#39;epsilon_real_&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;ft&#39;</span><span class="p">:</span><span class="s1">&#39;$\epsilon_{real}$:&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;lc&#39;</span><span class="p">:</span><span class="s1">&#39;\epsilon_{r} &#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;xl&#39;</span><span class="p">:</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;yl&#39;</span><span class="p">:</span><span class="s1">&#39;$\epsilon_{real}$ (au)&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;fp&#39;</span><span class="p">:</span><span class="s1">&#39;EPSILON_REAL&#39;</span><span class="p">,</span>
                                            <span class="p">}</span>
        


<span class="c1">####################################################################################################################</span>
        <span class="c1">##needed to make sure the real and imaginary parts of epsilon have the same scaling</span>
        <span class="n">min_val</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">max_val</span><span class="o">=</span><span class="mf">0.0</span>




        <span class="n">file_name</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">_WanT_epsilon*.dat&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="p">))</span>




        <span class="k">try</span><span class="p">:</span>                            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_name</span><span class="p">)):</span>
                <span class="n">en</span><span class="p">,</span><span class="n">val</span> <span class="o">=</span> <span class="n">read_transport_datafile</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="n">set_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">set_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">set_max</span><span class="o">&gt;</span><span class="n">max_val</span><span class="p">:</span>
                    <span class="n">max_val</span><span class="o">=</span><span class="n">set_max</span>
                <span class="k">if</span> <span class="n">set_min</span><span class="o">&lt;</span><span class="n">min_val</span><span class="p">:</span>
                    <span class="n">min_val</span><span class="o">=</span><span class="n">set_min</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span> 
            <span class="k">print</span> <span class="n">e</span>
        
        <span class="n">max_val_ep</span> <span class="o">=</span>  <span class="n">max_val</span>
        <span class="n">min_val_ep</span> <span class="o">=</span>  <span class="n">min_val</span>

        <span class="n">ID_list</span> <span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;transport&#39;</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">straight</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1">####################################################################################################################</span>

        <span class="n">type_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;kappa&#39;</span><span class="p">,</span><span class="s1">&#39;sig_seebeck&#39;</span><span class="p">,</span><span class="s1">&#39;ZetaT&#39;</span><span class="p">,</span><span class="s1">&#39;seebeck&#39;</span><span class="p">,</span><span class="s1">&#39;cond&#39;</span><span class="p">,</span><span class="s1">&#39;epsilon_i&#39;</span><span class="p">,</span><span class="s1">&#39;epsilon_r&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">Type</span> <span class="ow">in</span> <span class="n">type_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">max_val</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">min_val</span><span class="o">=</span><span class="mf">0.0</span>


                <span class="n">file_name</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">file_name_up</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">file_name_down</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">ID_ent</span> <span class="ow">in</span> <span class="n">ID_list</span><span class="p">:</span>

                    <span class="n">search</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">_WanT_</span><span class="si">%s</span><span class="s1">*.dat&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ID_ent</span><span class="p">,</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;pf&#39;</span><span class="p">])</span> 

                    <span class="n">file_name</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">search</span><span class="p">))</span>

                    <span class="n">file_name_up</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">_WanT_</span><span class="si">%s</span><span class="s1">up_*.dat&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ID_ent</span><span class="p">,</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;pf&#39;</span><span class="p">])</span> <span class="p">))</span>
                    <span class="n">file_name_down</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">_WanT_</span><span class="si">%s</span><span class="s1">down_*.dat&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ID_ent</span><span class="p">,</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;pf&#39;</span><span class="p">])</span> <span class="p">))</span>



                <span class="n">spin_polarized</span><span class="o">=</span><span class="bp">False</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_name_down</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">spin_polarized</span><span class="o">=</span><span class="bp">True</span>


                <span class="k">if</span> <span class="n">spin_polarized</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                        <span class="c1">############################################################################################</span>
                        <span class="c1">##Non Spin Polarized Case</span>
                        <span class="c1">############################################################################################</span>
                        <span class="n">data_by_temp</span><span class="o">=</span><span class="p">{}</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_name</span><span class="p">)):</span>
                            <span class="n">temperature</span> <span class="o">=</span> <span class="n">file_name</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">data_by_temp</span><span class="p">[</span><span class="n">temperature</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_transport_datafile</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>                 
                        <span class="c1"># for i in [vals]:</span>
                        <span class="c1"># 	set_max=max(i)</span>
                        <span class="c1"># 	if set_max&gt;max_val:</span>
                        <span class="c1"># 		max_val=set_max</span>

                <span class="k">if</span> <span class="n">spin_polarized</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                        <span class="c1">#############################################################################################</span>
                        <span class="c1">##Spin Polarized Case</span>
                        <span class="c1">#############################################################################################</span>
                        <span class="n">data_by_temp_dn</span><span class="o">=</span><span class="p">{}</span>
                        <span class="n">data_by_temp_up</span><span class="o">=</span><span class="p">{}</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_name_down</span><span class="p">)):</span>
                            <span class="n">temperature</span> <span class="o">=</span> <span class="n">file_name_down</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">data_by_temp_dn</span><span class="p">[</span><span class="n">temperature</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_transport_datafile</span><span class="p">(</span><span class="n">file_name_down</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
                            <span class="n">data_by_temp_up</span><span class="p">[</span><span class="n">temperature</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_transport_datafile</span><span class="p">(</span><span class="n">file_name_up</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
                        <span class="c1"># for i in [vals_up,vals_down]:</span>
                        <span class="c1"># 	set_max=max(i)</span>
                        <span class="c1"># 	if set_max&gt;max_val:</span>
                        <span class="c1"># 		max_val=set_max</span>

                <span class="c1">#############################################################################################</span>

                <span class="c1">#############################################################################################</span>
                <span class="n">width</span> <span class="o">=</span> <span class="mi">20</span>
                <span class="n">height</span> <span class="o">=</span> <span class="mi">14</span>
                <span class="k">if</span> <span class="n">spin_polarized</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                    <span class="n">height</span> <span class="o">=</span> <span class="mi">28</span>
                <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span> <span class="c1">#to adjust the figure size</span>
                <span class="c1">#&quot;2&quot;</span>
                <span class="n">markers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;o&quot;</span><span class="p">,</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="s2">&quot;8&quot;</span><span class="p">,</span><span class="s2">&quot;D&quot;</span><span class="p">,</span><span class="s2">&quot;H&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">]</span>
                <span class="n">colors</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;0.75&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;orange&#39;</span><span class="p">]</span>
                <span class="n">lines</span>  <span class="o">=</span><span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,]</span>




                                   

                <span class="k">if</span> <span class="n">spin_polarized</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                        <span class="n">ax2</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
                        <span class="n">sorted_all</span> <span class="o">=</span>  <span class="nb">sorted</span><span class="p">([[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data_by_temp</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

                        <span class="k">for</span> <span class="n">temp_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_all</span><span class="p">)):</span>                    
                            <span class="n">label_text</span><span class="o">=</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;lc&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;$ @ </span><span class="si">%s</span><span class="s1">K&#39;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="n">sorted_all</span><span class="p">[</span><span class="n">temp_index</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">ls_choice</span>  <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">temp_index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)]</span>
                            <span class="n">color_choice</span>  <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">temp_index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
                            <span class="n">marker_choice</span> <span class="o">=</span> <span class="n">markers</span><span class="p">[</span><span class="n">temp_index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)]</span>

                            <span class="n">x_vals</span><span class="o">=</span><span class="n">sorted_all</span><span class="p">[</span><span class="n">temp_index</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">y_vals</span><span class="o">=</span><span class="n">sorted_all</span><span class="p">[</span><span class="n">temp_index</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                            <span class="n">max_x</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
                            <span class="n">min_x</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">y_vals</span><span class="p">]:</span>
                                <span class="n">set_max</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">set_max</span><span class="o">&gt;</span><span class="n">max_val</span><span class="p">:</span>
                                    <span class="n">max_val</span><span class="o">=</span><span class="n">set_max</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">y_vals</span><span class="p">]:</span>
                                <span class="n">set_min</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">set_min</span><span class="o">&lt;</span><span class="n">min_val</span><span class="p">:</span>
                                    <span class="n">min_val</span><span class="o">=</span><span class="n">set_min</span>

<span class="c1">#                            ax2.plot(x_vals,y_vals,label=label_text,color=color_choice,marker=marker_choice,linestyle=ls_choice)</span>
                            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_vals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label_text</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color_choice</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">ls_choice</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                            
          <span class="c1">#                          pyplot.setp(out_line, linewidth=2)</span>

                <span class="k">if</span> <span class="n">spin_polarized</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                    <span class="n">ax1</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
                    <span class="n">ax2</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
                    <span class="n">sorted_dn</span> <span class="o">=</span>  <span class="nb">sorted</span><span class="p">([[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data_by_temp_dn</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
                    <span class="n">sorted_up</span> <span class="o">=</span>  <span class="nb">sorted</span><span class="p">([[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data_by_temp_up</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

                    <span class="k">for</span> <span class="n">temp_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_dn</span><span class="p">)):</span>                    
                            <span class="n">label_text</span><span class="o">=</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;lc&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;^{down}$ @ </span><span class="si">%s</span><span class="s1">K&#39;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="n">sorted_dn</span><span class="p">[</span><span class="n">temp_index</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">color_choice</span>  <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">temp_index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
                            <span class="n">ls_choice</span>  <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">temp_index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)]</span>
                            <span class="n">marker_choice</span> <span class="o">=</span> <span class="n">markers</span><span class="p">[</span><span class="n">temp_index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)]</span>
                            <span class="n">x_vals</span><span class="o">=</span><span class="n">sorted_dn</span><span class="p">[</span><span class="n">temp_index</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">y_vals</span><span class="o">=</span><span class="n">sorted_dn</span><span class="p">[</span><span class="n">temp_index</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                            <span class="n">max_x</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
                            <span class="n">min_x</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>

                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">y_vals</span><span class="p">]:</span>
                                <span class="n">set_max</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">set_max</span><span class="o">&gt;</span><span class="n">max_val</span><span class="p">:</span>
                                    <span class="n">max_val</span><span class="o">=</span><span class="n">set_max</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">y_vals</span><span class="p">]:</span>
                                <span class="n">set_min</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">set_min</span><span class="o">&lt;</span><span class="n">min_val</span><span class="p">:</span>
                                    <span class="n">min_val</span><span class="o">=</span><span class="n">set_min</span>

                            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_vals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label_text</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color_choice</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">ls_choice</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;xl&#39;</span><span class="p">],{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>
                            <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;yl&#39;</span><span class="p">],{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>
                            
<span class="c1">#                            ax1.plot(x_vals,y_vals,label=label_text,color=color_choice,marker=marker_choice,linestyle=&#39;-&#39;)</span>
<span class="c1">#                            ax.set_xlabel(xaxisTitle)</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span>
<span class="c1">#                    ax1.legend(loc=&#39;upper left&#39;,fontsize=18)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="mf">0.0</span><span class="p">])</span>
                    <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;xl&#39;</span><span class="p">],{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>
                    <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;yl&#39;</span><span class="p">],{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>
 
                    <span class="k">for</span> <span class="n">temp_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_up</span><span class="p">)):</span>                    
                            <span class="n">label_text</span><span class="o">=</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;lc&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;^{up}$ @ </span><span class="si">%s</span><span class="s1">K&#39;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="n">sorted_up</span><span class="p">[</span><span class="n">temp_index</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">color_choice</span>  <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">temp_index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
                            <span class="n">marker_choice</span> <span class="o">=</span> <span class="n">markers</span><span class="p">[</span><span class="n">temp_index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)]</span>
                            <span class="n">ls_choice</span>  <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">temp_index</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)]</span>
                            <span class="n">x_vals</span><span class="o">=</span><span class="n">sorted_up</span><span class="p">[</span><span class="n">temp_index</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">y_vals</span><span class="o">=</span><span class="n">sorted_up</span><span class="p">[</span><span class="n">temp_index</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                            <span class="n">max_x</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
                            <span class="n">min_x</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>

                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">y_vals</span><span class="p">]:</span>
                                <span class="n">set_max</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">set_max</span><span class="o">&gt;</span><span class="n">max_val</span><span class="p">:</span>
                                    <span class="n">max_val</span><span class="o">=</span><span class="n">set_max</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">y_vals</span><span class="p">]:</span>
                                <span class="n">set_min</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">set_min</span><span class="o">&lt;</span><span class="n">min_val</span><span class="p">:</span>
                                    <span class="n">min_val</span><span class="o">=</span><span class="n">set_min</span>
    
                            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_vals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label_text</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color_choice</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">ls_choice</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#line separating up and down spni</span>

                <span class="c1">#we set these earlier</span>
                <span class="k">if</span> <span class="n">Type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;epsilon_i&#39;</span><span class="p">,</span><span class="s1">&#39;epsilon_r&#39;</span><span class="p">]:</span>
                    <span class="n">max_val</span><span class="o">=</span><span class="n">max_val_ep</span>
                    <span class="n">min_val</span><span class="o">=</span><span class="n">min_val_ep</span>

                <span class="n">mult_max</span><span class="o">=</span><span class="mf">1.05</span>
                <span class="k">if</span> <span class="n">max_val</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">mult_max</span><span class="o">=</span><span class="mf">0.95</span>
                <span class="n">mult_min</span><span class="o">=</span><span class="mf">1.05</span>
                <span class="k">if</span> <span class="n">min_val</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">mult_min</span><span class="o">=</span><span class="mf">0.95</span>
                    

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">min_val</span><span class="o">*</span><span class="n">mult_min</span><span class="p">,</span><span class="n">max_val</span><span class="o">*</span><span class="n">mult_max</span><span class="p">])</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> 
                        <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="mf">0.0</span><span class="p">])</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">min_x</span><span class="p">,</span><span class="n">max_x</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>


                    <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;xl&#39;</span><span class="p">],{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>
                    <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;yl&#39;</span><span class="p">],{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>
<span class="c1">#                    ax1.set_xlabel(trans_plot_dict[Type][&#39;xl&#39;],{&#39;fontsize&#39;:18})</span>
<span class="c1">#                    ax1.set_ylabel(trans_plot_dict[Type][&#39;yl&#39;],{&#39;fontsize&#39;:18})</span>

                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                    <span class="k">print</span> <span class="n">e</span>
                    <span class="k">pass</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">min_val</span><span class="o">*</span><span class="n">mult_min</span><span class="p">,</span><span class="n">max_val</span><span class="o">*</span><span class="n">mult_max</span><span class="p">])</span>
<span class="c1">#                ax2.legend(loc=&#39;upper left&#39;,fontsize=18)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

                <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">min_x</span><span class="p">,</span><span class="n">max_x</span><span class="p">])</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="mf">0.0</span><span class="p">])</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;xl&#39;</span><span class="p">],{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;yl&#39;</span><span class="p">],{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span>

<span class="c1">#                ax2.set_xlabel(trans_plot_dict[Type][&#39;xl&#39;],{&#39;fontsize&#39;:18})</span>
<span class="c1">#                ax2.set_ylabel(trans_plot_dict[Type][&#39;yl&#39;],{&#39;fontsize&#39;:18})</span>

<span class="c1">#                pylab.xlabel(trans_plot_dict[Type][&#39;xl&#39;])</span>
<span class="c1">#                pylab.ylabel(trans_plot_dict[Type][&#39;yl&#39;]) </span>


        <span class="c1">#	pylab.ylim([0,max_val*1.1])</span>
                <span class="n">compoundName</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">compoundNameLatex</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">latex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1">#                ax2.legend(loc=&#39;upper left&#39;,fontsize=18)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="mf">0.0</span><span class="p">])</span>

        <span class="c1">#        ax2.axes.yaxis.set_label_position(&#39;right&#39;)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

                <span class="n">pylab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#line separating up and down spin</span>

<span class="c1">#                figtitle = r&#39;%s %s%s&#39; % (trans_plot_dict[Type][&#39;ft&#39;],compoundNameLatex,ID.split(&#39;_&#39;)[0])</span>
                <span class="n">figtitle</span> <span class="o">=</span> <span class="s1">r&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;ft&#39;</span><span class="p">],</span><span class="n">compoundNameLatex</span><span class="p">)</span>

                <span class="n">t</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">figtitle</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span> <span class="c1">#[x,y]</span>

 

                <span class="k">if</span> <span class="n">postfix</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">postfix</span>

                <span class="n">fileplot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s%s</span><span class="s1">.pdf&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">trans_plot_dict</span><span class="p">[</span><span class="n">Type</span><span class="p">][</span><span class="s1">&#39;fp&#39;</span><span class="p">],</span><span class="n">compoundName</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">postfix</span><span class="p">))</span>
                <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileplot</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>


            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">e</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span>



<span class="c1">###############################################################################################################################</span>
<div class="viewcode-block" id="read_transport_datafile"><a class="viewcode-back" href="../plot.html#plot.read_transport_datafile">[docs]</a><span class="k">def</span> <span class="nf">read_transport_datafile</span><span class="p">(</span><span class="n">ep_data_file</span><span class="p">,</span><span class="n">mult_x</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">mult_y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>


<span class="sd">	Arguments:</span>


<span class="sd">	Keyword Arguments:</span>


<span class="sd">        Returns:</span>

<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ep_data_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">epsilon_data_file</span><span class="p">:</span>
		<span class="n">ep_data_string</span><span class="o">=</span><span class="n">epsilon_data_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

	<span class="n">lines</span><span class="o">=</span><span class="n">ep_data_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
	<span class="n">en_array</span><span class="o">=</span><span class="p">[]</span>
	<span class="n">val_array</span><span class="o">=</span><span class="p">[]</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">float_array</span><span class="o">=</span><span class="p">[]</span>
			<span class="n">split_line</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

			<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">split_line</span><span class="p">:</span>
				<span class="n">float_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
			<span class="n">en_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">float_array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">val_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">float_array</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">float_array</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">float_array</span><span class="p">[</span><span class="mi">9</span><span class="p">]]))</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>


		<span class="n">en_array</span><span class="o">=</span><span class="p">[</span><span class="n">mult_x</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">en_array</span><span class="p">]</span>
		<span class="n">val_array</span><span class="o">=</span><span class="p">[</span><span class="n">mult_y</span><span class="o">*</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">val_array</span><span class="p">]</span>

		
	<span class="k">return</span> <span class="n">en_array</span><span class="p">,</span><span class="n">val_array</span>	




<span class="c1">###############################################################################################################################</span>

</div>
<span class="k">def</span> <span class="nf">__dosPlot</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">yLim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">LSDA</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Function to take the data generated for the DOS and plot them with energy shifted relative to the Fermi Energy.                       </span>

<span class="sd">	Arguments:</span>
<span class="sd">              oneCalc (dict): Single calculation that is the value of the dictionary of dictionaries of calculations</span>
<span class="sd">              ID (str): ID of the calculation</span>
<span class="sd">              </span>
<span class="sd">	Keyword Arguments:</span>
<span class="sd">              yLim (list): List or tuple of two integers for max and min range in horizontal axis of DOS plot</span>
<span class="sd">              LSDA (bool): To plot DOS as spin polarized or not (calculation must have been done as spin polarized)</span>

<span class="sd">        Returns:</span>
<span class="sd">              None</span>

<span class="sd">	&#39;&#39;&#39;</span>
	
	<span class="k">print</span> <span class="s1">&#39;Entering </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>
	<span class="sd">&#39;&#39;&#39;extracts HOMO from nscf calculation output file as input to the plotting&#39;&#39;&#39;</span>
	<span class="k">print</span> <span class="s1">&#39;Plotting DOS&#39;</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">Efermi</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getEfermi</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Efermi</span><span class="p">)</span><span class="o">!=</span><span class="nb">type</span><span class="p">(</span><span class="mf">0.5</span><span class="p">):</span>
			<span class="n">LSDA</span><span class="o">=</span><span class="bp">True</span>
			
	<span class="k">except</span><span class="p">:</span>
		<span class="n">Efermi</span><span class="o">=</span><span class="mf">0.0</span>
	<span class="n">subdir</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>

	<span class="sd">&quot;&quot;&quot;get the path to the subdirectory of the calc that you are making plots for&quot;&quot;&quot;</span>
	<span class="n">filedos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;dos_</span><span class="si">%s</span><span class="s1">.out&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>

	<span class="sd">&#39;&#39;&#39;name of file of the DOS plots is dosBandPlot_&lt;_AFLOWPI_PREFIX_&gt;&#39;&#39;&#39;</span>
	<span class="n">fileplot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;DOS_</span><span class="si">%s%s</span><span class="s1">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">]))</span>

	<span class="c1">#to set figure size and default fonts</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;serif&quot;</span><span class="p">)</span>      <span class="c1">#to set the font type</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>             <span class="c1">#to set the font size</span>

	<span class="sd">&quot;&quot;&quot;get the path to the subdirectory of the calc that you are making plots for&quot;&quot;&quot;</span>
        <span class="n">filedos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;dos_</span><span class="si">%s</span><span class="s1">.out&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>
        
        <span class="n">width</span> <span class="o">=</span> <span class="mi">20</span>
	<span class="n">height</span> <span class="o">=</span> <span class="mi">14</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span> <span class="c1">#to adjust the figure size</span>

     <span class="c1">####################################</span>
     <span class="c1">#to plot the DOS</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filedos</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
	<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
		<span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;output from dos calculation not found. Are you sure you ran ppDOS and it completed properly?&quot;</span><span class="p">)</span>
		<span class="k">print</span> <span class="s1">&#39;Are you sure that you ran ppDos and that it completed properly?&#39;</span>
		<span class="k">return</span>
		
	<span class="n">en</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">enup</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">endown</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">dos</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">dosdw</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>      <span class="c1">#append DOS data to en,dos,dosw lists</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">LSDA</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
				<span class="n">enup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">Efermi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">endown</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">Efermi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
				
			<span class="k">else</span><span class="p">:</span>
				<span class="n">en</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">Efermi</span><span class="p">)</span> <span class="c1">#to shift all the y values with respect to the Fermi level</span>
			
			<span class="n">dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
			<span class="n">dosdw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]))</span>
		
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">pass</span>
	<span class="k">if</span> <span class="n">LSDA</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
		<span class="n">enup</span>  <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">enup</span><span class="p">)</span>
		<span class="n">endown</span><span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">endown</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">endos</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">en</span><span class="p">)</span>  <span class="c1">#to convert the list x from float to numbers</span>
	<span class="n">floatdos</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">dos</span><span class="p">)</span>
	<span class="n">floatdosDOWN</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">dosdw</span><span class="p">)</span>
	<span class="n">enshift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">endos</span><span class="p">)</span> <span class="c1">#to treat the list b as an array?</span>
  

	<span class="n">ax2</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
	<span class="n">floatdos</span><span class="p">,</span><span class="n">floatdosDOWN</span><span class="p">,</span><span class="n">enshift</span><span class="o">=</span><span class="n">__smoothGauss</span><span class="p">(</span><span class="n">floatdos</span><span class="p">),</span><span class="n">__smoothGauss</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">),</span><span class="n">__smoothGauss</span><span class="p">(</span><span class="n">enshift</span><span class="p">)</span>
<span class="c1">#        plot(f,enshift,&#39;k&#39;) #to plot the original data</span>
       	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">enshift</span><span class="p">,</span><span class="n">floatdos</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span> <span class="c1">#to plot the smoothed dat</span>
	<span class="n">dosMAX</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="nb">max</span><span class="p">([</span><span class="n">dos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dos</span><span class="p">))</span> <span class="k">if</span> <span class="n">en</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">en</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">LSDA</span><span class="p">:</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">enshift</span><span class="p">,</span><span class="n">floatdos</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span> <span class="c1">#to plot the smoothed data</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dosMAX</span><span class="p">)</span> <span class="c1"># scales DOS to larges value of DOS in the given energy range</span>
		
	<span class="k">else</span><span class="p">:</span>
		<span class="n">dosMIN</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="nb">min</span><span class="p">([</span><span class="n">floatdosDOWN</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">))</span> <span class="k">if</span> <span class="n">en</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">en</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
		<span class="n">enshiftup</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">enup</span><span class="p">)</span>
		<span class="n">enshiftdown</span><span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">endown</span><span class="p">)</span>
		<span class="n">floatdosup</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">dos</span><span class="p">)</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">enshiftdown</span><span class="p">,</span><span class="n">floatdosDOWN</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">enshiftup</span><span class="p">,</span><span class="n">floatdosUP</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>

		<span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">dosMIN</span><span class="p">,</span><span class="n">dosMAX</span><span class="p">)</span> <span class="c1"># scales DOS to larges value of DOS in the given energy range</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#line separating up and down spin</span>
<span class="c1">#	else:</span>
<span class="c1">#		pylab.ylim(0,dosMAX) # scales DOS to larges value of DOS in the given energy range</span>

	<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#Fermi level line</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
     <span class="c1">##############################</span>
     <span class="c1">#to increase the linewidth of the axis</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>


     <span class="c1">#other useful options for the frame! :D</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density of States (States/eV)&#39;</span><span class="p">)</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>	
	<span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;E(eV)&#39;</span><span class="p">)</span>

	<span class="n">figtitle</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
	<span class="n">compoundName</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

     <span class="c1">#to set a centerd title, with a bigger font</span>
	<span class="n">figtitle</span> <span class="o">=</span> <span class="s1">r&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">compoundName</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">])</span>
	<span class="n">t</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">figtitle</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span> <span class="c1">#[x,y]</span>

	<span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileplot</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
<span class="c1">#		with open(fileplot+&#39;.pkl&#39;,&#39;wb&#39;) as pickleOutput:</span>
<span class="c1">#			cPickle.dump(ax2,pickleOutput)</span>

<span class="c1">#			AFLOWpi.retr.__moveToSavedir(fileplot+&#39;.pkl&#39;)</span>
			<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__moveToSavedir</span><span class="p">(</span><span class="n">fileplot</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
		<span class="k">pass</span>
<span class="c1">#		AFLOWpi.run._fancy_error_log(e)</span>

	<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__moveToSavedir</span><span class="p">(</span><span class="n">fileplot</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>




<span class="k">def</span> <span class="nf">__combinePDOS</span><span class="p">(</span><span class="n">dosfiles</span><span class="p">):</span>
	<span class="n">mat</span><span class="o">=</span><span class="p">[]</span>  <span class="c1"># matrix with total sum of ldos</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dosfiles</span><span class="p">)):</span>
		<span class="n">mati</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># temporal matrix for each DOS file &quot;i&quot;</span>
		<span class="n">k</span><span class="o">=</span><span class="mi">0</span>
		<span class="n">kresolved</span> <span class="o">=</span> <span class="bp">False</span>

		<span class="k">if</span> <span class="ow">not</span> <span class="n">kresolved</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dosfiles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pDOSFile</span><span class="p">:</span>
				<span class="n">pDOSString</span> <span class="o">=</span> <span class="n">pDOSFile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pDOSString</span><span class="p">:</span>
					<span class="sd">&#39;&#39;&#39;projwfc.x outputs ####### when the value of the kpoint is less than -100 so we skip those&#39;&#39;&#39;</span>
<span class="c1">#					if len(line) &gt; 10 and len(re.findall(&#39;[*]+&#39;,line)) == 0 and line.split()[0] != &quot;#&quot;:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
							<span class="n">mati</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])])</span>	  
			
					<span class="k">except</span><span class="p">:</span>
						<span class="k">pass</span>

						
				<span class="k">if</span> <span class="n">mat</span> <span class="o">==</span> <span class="p">[]:</span> <span class="c1"># if it is the first dos file, copy total matrix (mat) = the first dos files&#39;s data</span>
					<span class="n">mat</span><span class="o">=</span><span class="n">mati</span><span class="p">[:]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mati</span><span class="p">)):</span> <span class="c1"># if it is not the first file, sum values</span>
						<span class="k">try</span><span class="p">:</span>
							<span class="n">mat</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">mat</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">mat</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">mati</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">mat</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">mati</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>  
						<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
							<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
							

<span class="c1">##############################################################################################################################################</span>

		<span class="k">if</span> <span class="n">kresolved</span><span class="p">:</span>
			<span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;k resolved not supported&#39;</span><span class="p">)</span>
			<span class="k">print</span> <span class="s1">&#39;k resolved not supported&#39;</span>
			<span class="k">raise</span> <span class="ne">SystemExit</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dosfiles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pDOSFile</span><span class="p">:</span>
				<span class="n">pDOSString</span> <span class="o">=</span> <span class="n">pDOSFile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pDOSString</span><span class="p">:</span>

					<span class="sd">&#39;&#39;&#39;projwfc.x outputs ####### when the value of the kpoint is less than -100 so we skip those&#39;&#39;&#39;</span>
					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;[*]+&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>

						<span class="n">ik</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>


						<span class="n">ik</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ik</span><span class="p">)</span>


						<span class="k">if</span> <span class="n">ik</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>  <span class="c1">#if it is a different k block</span>

							<span class="n">k</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
							<span class="n">oldmat</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># temporal matrix for each k-point</span>


						<span class="k">if</span> <span class="n">ik</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
							<span class="n">mati</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])])</span> <span class="c1"># append: energy, ldosup, ldosdw</span>
						<span class="k">elif</span> <span class="n">ik</span> <span class="o">==</span> <span class="n">k</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
							<span class="n">oldmat</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])])</span>
						<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1">#if blank line, sum k-frame to the total</span>
							<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oldmat</span><span class="p">)):</span>  
								<span class="n">mati</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">mati</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">mati</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">oldmat</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">mati</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">oldmat</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>

				<span class="k">if</span> <span class="n">mat</span> <span class="o">==</span> <span class="p">[]:</span> <span class="c1"># if it is the first dos file, copy total matrix (mat) = the first dos files&#39;s data</span>
					<span class="n">mat</span><span class="o">=</span><span class="n">mati</span><span class="p">[:]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mati</span><span class="p">)):</span> <span class="c1"># if it is not the first file, sum values</span>
						<span class="n">mat</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">mat</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">mat</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">mati</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">mat</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">mati</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>  


	<span class="k">return</span> <span class="n">mat</span>





<span class="k">def</span> <span class="nf">__sumpdos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Takes the output files from projwfx.x that is called in the ppDOS function and sums </span>
<span class="sd">	the projected orbitals across the files of each orbital for each atomic species</span>
<span class="sd">	and outputs the summed data in files named &lt;species&gt;_&lt;orbital&gt;.sumpdos.</span>


<span class="sd">	Arguments:</span>
<span class="sd">	      oneCalc (dict): dictionary of one calculation</span>
<span class="sd">              ID (str): ID of the calculation</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">              None</span>

<span class="sd">        Returns:</span>
<span class="sd">              None</span>

<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">subdir</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>
	
	<span class="c1">#print &quot;Summing pDOS in %s&quot; % subdir</span>
	<span class="sd">&#39;&#39;&#39;get a list of all the pdos files to be combined then plotted&#39;&#39;&#39;</span>
	<span class="n">atomList</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">pDOSDict</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">oneCalc</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
		<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;_AFLOWPI_[A-Z][0-9]*_&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
			<span class="c1">#print v</span>
			<span class="n">atomList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="c1">#	print atomList</span>
	
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	just the possible names of orbitals that projwfc.x will output</span>
<span class="sd">	skips over orbitals for atomic species that are not there</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">orbitalList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;All&#39;</span><span class="p">]</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	globs for the file names that match the expression to sort out files for</span>
<span class="sd">	the different atomic species and each of their orbitals</span>

<span class="sd">	it then gives a list of the files for each orbital for each species in the </span>
<span class="sd">	calculation and saves them as a dictionary with:</span>
<span class="sd">	the atom species as key</span>
<span class="sd">	a list of dictionaries of each atomic orbital for the species as the value</span>
<span class="sd">	those dictionaries have the orbital as key </span>
<span class="sd">	and the value is a list of the files obtained by glob</span>
<span class="sd">	&#39;&#39;&#39;</span>

        <span class="n">glob_ID</span><span class="o">=</span>  <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;dos&#39;</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">straight</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

	<span class="n">byAtomDict</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atomList</span><span class="p">:</span>
		<span class="n">byAtom</span><span class="o">=</span><span class="p">[]</span>
		<span class="k">for</span> <span class="n">orbital</span> <span class="ow">in</span> <span class="n">orbitalList</span><span class="p">:</span>
			<span class="n">pDOSFiles</span><span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.pdos_atm*(</span><span class="si">%s</span><span class="s1">)*(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">glob_ID</span><span class="p">,</span><span class="n">atom</span><span class="p">,</span><span class="n">orbital</span><span class="p">)))</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pDOSFiles</span><span class="p">):</span>
				<span class="n">byAtom</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">orbital</span><span class="p">:</span><span class="n">pDOSFiles</span><span class="p">})</span>
		<span class="n">byAtomDict</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">byAtom</span>

	<span class="k">for</span> <span class="n">atom</span><span class="p">,</span><span class="n">orbital</span> <span class="ow">in</span> <span class="n">byAtomDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>			
			<span class="k">for</span> <span class="n">orbitalDict</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">orbital</span><span class="p">)):</span>
				<span class="k">for</span> <span class="n">orbitalName</span><span class="p">,</span><span class="n">fileList</span> <span class="ow">in</span> <span class="n">orbital</span><span class="p">[</span><span class="n">orbitalDict</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
					<span class="n">data</span> <span class="o">=</span> <span class="n">__combinePDOS</span><span class="p">(</span><span class="n">fileList</span><span class="p">)</span>
					<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.sumpdos&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom</span><span class="p">,</span><span class="n">orbitalName</span><span class="p">)),</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outputFile</span><span class="p">:</span>
						<span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">outputFile</span><span class="p">)</span>


	<span class="n">byAtom</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atomList</span><span class="p">:</span>	
		<span class="n">pDOSFiles</span><span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.pdos_atm*(</span><span class="si">%s</span><span class="s1">)_wfc*&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">glob_ID</span><span class="p">,</span><span class="n">atom</span><span class="p">)))</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pDOSFiles</span><span class="p">):</span>
			<span class="n">pDOSDict</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_All&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">atom</span><span class="p">)]</span> <span class="o">=</span>  <span class="n">pDOSFiles</span>


	<span class="sd">&#39;&#39;&#39;Cycle through all of the atoms in a single calculation and sum over the pdos files</span>
<span class="sd">	in the calculation directory and saves  &#39;&#39;&#39;</span>

	<span class="k">for</span> <span class="n">atom</span><span class="p">,</span><span class="n">files</span> <span class="ow">in</span> <span class="n">pDOSDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>		
		<span class="n">data</span> <span class="o">=</span> <span class="n">__combinePDOS</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.sumpdos&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom</span><span class="p">)),</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outputFile</span><span class="p">:</span>
					<span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">outputFile</span><span class="p">)</span>

<span class="c1">###################################################################################################################</span>


<span class="k">def</span> <span class="nf">__bandPlot</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">yLim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">DOSPlot</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">LSDA</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">tight_banding</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span> 
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to take the data files generated by the sumpdos ppBands functions and plots </span>
<span class="sd">        the electronic band structure and the projected density of states with energy shifted </span>
<span class="sd">        relative to the Fermi Energy.</span>


<span class="sd">	Arguments:</span>
<span class="sd">              oneCalc (tuple): Single calculation dictionary and the ID of the calculation </span>
<span class="sd">                               NEEDS TO BE CHANGED TO oneCalc,ID FORMAT SOON</span>
<span class="sd">              </span>
<span class="sd">	Keyword Arguments:</span>
<span class="sd">              yLim (list): List or tuple of two integers for max and min range in horizontal axis of DOS plot</span>
<span class="sd">              LSDA (bool): To plot DOS as spin polarized or not (calculation must have been done as spin polarized)</span>
<span class="sd">              DOSPlot (str): DOS or the PDOS plots next to the eletronic band structure plot (assuming you ran </span>
<span class="sd">                             either ppDOS or ppPDOS) (default: NONE) </span>
<span class="sd">              tight_banding (bool): Whether to treat the input data as from Quantum Espresso or WanT bands.x</span>
<span class="sd">              postfix (str): Postfix to the filename of the plot</span>

<span class="sd">        Returns:</span>
<span class="sd">              None</span>

<span class="sd">	&#39;&#39;&#39;</span>
	
	<span class="n">calcCopy</span> <span class="o">=</span> <span class="n">oneCalc</span>
	<span class="n">calcID</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">oneCalc</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">calcID</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">calcID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;bands&#39;</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        

	<span class="k">if</span> <span class="n">DOSPlot</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">DOSPlot</span> <span class="o">!=</span> <span class="s1">&#39;APDOS&#39;</span> <span class="ow">and</span> <span class="n">DOSPlot</span> <span class="o">!=</span> <span class="s1">&#39;DOS&#39;</span><span class="p">:</span>
		<span class="k">print</span> <span class="s2">&quot;Not a valid choice for DOSPlot. Valid options are:&#39;APDOS&#39;,&#39;DOS&#39;&quot;</span>
		<span class="k">return</span>

	<span class="k">if</span> <span class="n">postfix</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
		<span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">postfix</span>

	<span class="k">if</span> <span class="n">DOSPlot</span><span class="o">==</span><span class="s1">&#39;APDOS&#39;</span> <span class="ow">or</span> <span class="n">DOSPlot</span><span class="o">==</span><span class="s1">&#39;DOS&#39;</span><span class="p">:</span>
		<span class="n">__sumpdos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">calcID</span><span class="p">)</span>	
	

	<span class="k">if</span> <span class="n">tight_banding</span><span class="p">:</span>
		<span class="n">bandSym</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">__getPath_WanT</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">calcID</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">bandSym</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getPathFromFile</span><span class="p">(</span><span class="n">calcCopy</span><span class="p">)</span>
	
<span class="c1">#	print calcCopy</span>
	<span class="k">if</span> <span class="n">bandSym</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
		<span class="k">print</span> <span class="s1">&#39;ERRORRRR!&#39;</span>
		<span class="k">return</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">Efermi</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getEfermi</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">calcID</span><span class="p">)</span>

		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Efermi</span><span class="p">)</span><span class="o">!=</span><span class="nb">type</span><span class="p">(</span><span class="mf">0.5</span><span class="p">):</span>
			<span class="n">Efermi</span><span class="o">=</span><span class="n">Efermi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#			LSDA=True</span>
	<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>
            <span class="n">Efermi</span><span class="o">=</span><span class="mf">0.0</span>

	<span class="n">subdir</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>
       	<span class="n">fileplot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;BANDS_</span><span class="si">%s%s%s</span><span class="s1">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="n">calcID</span><span class="p">,</span><span class="n">postfix</span><span class="p">))</span>

	<span class="sd">&quot;&quot;&quot;get the path to the subdirectory of the calc that you are making plots for&quot;&quot;&quot;</span>

<span class="c1">#	tight_banding=True</span>
	<span class="k">if</span> <span class="n">tight_banding</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
		<span class="n">filebands</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;bands_want_new.dat&#39;</span><span class="p">)</span>
                <span class="n">Efermi_shift</span><span class="o">=</span><span class="mf">0.0</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="n">filebands</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_bands.xmgr&#39;</span><span class="o">%</span><span class="n">calcID</span><span class="p">)</span>
                <span class="n">Efermi_shift</span><span class="o">=</span><span class="n">Efermi</span>



        <span class="n">dos_ID</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">calcID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;bands&#39;</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
	<span class="n">filedos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_dos.dat&#39;</span><span class="o">%</span><span class="n">dos_ID</span><span class="p">)</span>

	<span class="sd">&#39;&#39;&#39;name of file of the DOS plots is dosBandPlot_&lt;_AFLOWPI_PREFIX_&gt;&#39;&#39;&#39;</span>
	

       <span class="c1">#to set figure size and default fonts</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;serif&quot;</span><span class="p">)</span>      <span class="c1">#to set the font type</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>             <span class="c1">#to set the font size</span>

        
        <span class="n">width</span> <span class="o">=</span> <span class="mi">20</span>
	<span class="n">height</span> <span class="o">=</span> <span class="mi">14</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span><span class="c1">#to adjust the figure size</span>
	

     <span class="c1">#to do the gaussian smoothing               </span>
 
     <span class="c1">#################################</span>

     <span class="c1"># to plot the bands</span>
     

	<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">k_x</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">k_y</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        looks at the filebands file and reads in the columns for the energy of the</span>
<span class="sd">        band and the value of the k point to make the path. this looks at the output</span>
<span class="sd">        of the plot_bands.x script and when it finds a blank line in the data it </span>
<span class="sd">        appends a list of k point values and energy values for each band into a list</span>
<span class="sd">        of the bands</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">try</span><span class="p">:</span>

		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filebands</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">datafile</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span><span class="n">datafile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

			<span class="k">if</span> <span class="n">line</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">x_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                                        <span class="c1">#to shift all the y values with respect to the Fermi level</span>
					<span class="n">y_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="n">Efermi_shift</span>
					<span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_val</span><span class="p">)</span>
					<span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_val</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
					<span class="k">pass</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>

				<span class="n">k_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
				<span class="n">k_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
				<span class="n">x</span><span class="o">=</span><span class="p">[]</span>
				<span class="n">y</span><span class="o">=</span><span class="p">[]</span>


	<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
		<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
		<span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;output from bands calculation not found. Are you sure you ran ppBands and it completed properly?&quot;</span><span class="p">)</span>
		<span class="k">print</span> <span class="s2">&quot;Are you sure you ran ppBands and it completed properly?&quot;</span>
		<span class="k">return</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Eliminating the gaps between the paths in band structure plots by looking </span>
<span class="sd">        for gaps in the data in the k point values that are greater than some value</span>
<span class="sd">	&#39;&#39;&#39;</span>
 	<span class="n">gapThreshold</span> <span class="o">=</span> <span class="mf">2.00</span>

 	<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_x</span><span class="p">)):</span>
 		<span class="k">for</span> <span class="n">kpoint</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">])):</span>
			<span class="k">if</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="p">]</span> <span class="o">-</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">gapThreshold</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
					<span class="n">difference</span> <span class="o">=</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="p">]</span> <span class="o">-</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
					<span class="n">higher_vals</span> <span class="o">=</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="p">:]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">difference</span><span class="o">=</span><span class="mi">0</span>
			
				<span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="n">difference</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="p">:]]</span>
		
				
	<span class="n">a</span><span class="o">=</span><span class="n">k_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>   <span class="c1"># a set of k point values for one band for axis scaling purposes</span>
	<span class="n">b</span><span class="o">=</span><span class="n">k_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

	<span class="k">if</span> <span class="n">DOSPlot</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
		<span class="n">ax1</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">DOSPlot</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
		<span class="n">ax1</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>	
		<span class="k">print</span> <span class="s1">&#39;Plotting electronic band structure of </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
		<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting electronic band structure of </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot each band (k_x[i]),(k_y[i]) on the band structure plot from list of</span>
<span class="sd">        the values of energy and position from their respective list by k points</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_x</span><span class="p">)):</span>
  		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">k_x</span><span class="p">[</span><span class="n">i</span><span class="p">]),(</span><span class="n">k_y</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>

	<span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;E(eV)&#39;</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">k_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">k_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> 
	<span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>    
	<span class="n">pylab</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        takes in a list of k points that was used as pw.x input for the &#39;bands&#39;</span>
<span class="sd">        calculation as a string. It puts parts of that string into lists and </span>
<span class="sd">        manipulates them to display the symmetry point boundary lines on the </span>
<span class="sd">        band structure plot</span>
<span class="sd">	&#39;&#39;&#39;</span>
          
	<span class="n">bandSymSplit</span> <span class="o">=</span>  <span class="n">bandSym</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="n">HSPList</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">HSPSymList</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">buf</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">bandSym</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">buf</span><span class="p">:</span>
		<span class="n">splitLine</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="c1">#		print splitLine</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitLine</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="c1"># new style kpoint path input case</span>
			<span class="n">HSPList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">specialPointName</span> <span class="o">=</span> <span class="n">splitLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
			
 	                <span class="c1">#renames gG to greek letter for capital gamma</span>
			<span class="k">if</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;Gamma&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;gG&#39;</span><span class="p">:</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">r&quot;$\Gamma$&quot;</span>

			<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">specialPointName</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">&quot;$&quot;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">r&#39;_{&#39;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;}$&#39;</span> <span class="c1">#if there is a subscript it makes the print out on the plot have the number subscripted </span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">&quot;$&quot;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;$&quot;</span> <span class="c1">#formats with internal math renderer so all the labels look the same</span>
			<span class="n">HSPSymList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">specialPointName</span><span class="p">)</span>
			
		<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitLine</span><span class="p">)</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span> <span class="c1"># old style kpoint path input case with kpoint names</span>
			<span class="n">HSPList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
			<span class="n">specialPointName</span> <span class="o">=</span> <span class="n">splitLine</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

			<span class="k">if</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;Gamma&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;gG&#39;</span><span class="p">:</span> <span class="c1">#renames gG to greek letter for capital gamma</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">r&quot;$\Gamma$&quot;</span>
			<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">specialPointName</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">&quot;$&quot;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">r&#39;_{&#39;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;}$&#39;</span> <span class="c1">#if there is a subscript it makes the print out on the plot have the number subscripted </span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">&quot;$&quot;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;$&quot;</span>  <span class="c1">#formats with internal math renderer so all the labels look the same</span>
			<span class="n">HSPSymList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">specialPointName</span><span class="p">)</span>                     

		<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitLine</span><span class="p">)</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span> <span class="c1"># old style kpoint path input case without kpoint names</span>
			<span class="k">try</span><span class="p">:</span>
				
				<span class="k">if</span> <span class="n">HSPSymList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
					<span class="n">HSPList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
					<span class="n">HSPSymList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
					<span class="n">counter</span><span class="o">=</span><span class="mi">1</span>

				<span class="k">else</span><span class="p">:</span>
					<span class="n">counter</span><span class="o">+=</span><span class="mi">1</span>
			<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
				<span class="k">print</span> <span class="n">e</span>
				<span class="n">counter</span><span class="o">=</span><span class="mi">1</span>
<span class="c1">#				HSPList.append(counter)</span>
				<span class="n">HSPSymList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>


<span class="c1">#			HSPSymList.append(&#39; &#39;)</span>


<span class="c1">#	print HSPList</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        takes the number of k points between each point in the k point paths and</span>
<span class="sd">        figures out if they are separate paths (where the end of one path and the </span>
<span class="sd">        next begin have zero k points between them). it also takes the labels for </span>
<span class="sd">        the k points that were in the bands calculation input and creates a list </span>
<span class="sd">        of them and makes a special label for the path boundary e.g. X|Q. All of</span>
<span class="sd">        these symmetry lines and symmetry path symbols are put into their own list</span>
<span class="sd">        symIndex: for the symmetry line&#39;s index in the data set</span>
<span class="sd">        symPrint: for the symbols that represent the special symmetry path k points </span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">symIndex</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">totalX</span> <span class="o">=</span><span class="mi">0</span>
	<span class="n">SymPrint</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">HSPList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># for the first k point in the first path</span>
			<span class="n">SymPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HSPSymList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">HSPList</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="c1"># for the end of a path (where the number of k points between one point and another is zero)</span>
			<span class="k">continue</span>
		<span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">HSPList</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="c1"># for the point that begins a new path where the end of the last path (which has zero k points from it to this k point)</span>
			<span class="n">totalX</span> <span class="o">+=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
			<span class="n">symIndex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">totalX</span><span class="p">)</span>
			<span class="n">mid</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span>
			<span class="n">pathBetweenString</span> <span class="o">=</span> <span class="n">HSPSymList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">mid</span><span class="o">+</span><span class="n">HSPSymList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
			<span class="n">SymPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathBetweenString</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># for kpoints that are not at the beginning or end of paths</span>
			<span class="n">SymPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HSPSymList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">totalX</span> <span class="o">+=</span><span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="n">symIndex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">totalX</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">i</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">HSPList</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="c1"># for the end of the last path</span>
			<span class="n">symIndex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">totalX</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="n">SymPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HSPSymList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">HSPList</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
			<span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;can not find HSP in __bandPlot. This shouldnt be able to be tripped&#39;</span><span class="p">)</span>

     <span class="c1">#add symmetry lines to the band structure plot</span>
	<span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">symIndex</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">sym</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
			<span class="k">pass</span>
     <span class="c1">#Print path labels to band structure x-axis</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">symIndex</span><span class="p">],</span><span class="n">SymPrint</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
		<span class="k">pass</span>
		<span class="k">return</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#Femi level line</span>
	<span class="n">locs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">xticks</span><span class="p">()</span>

<span class="c1">##########################################################################################################</span>
	<span class="k">if</span> <span class="n">DOSPlot</span> <span class="o">==</span> <span class="s1">&#39;APDOS&#39;</span><span class="p">:</span>
		<span class="k">print</span> <span class="s1">&#39;Plotting electronic band structure and projected DOS of </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
		<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting electronic band structure and projected DOS of </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span>

		<span class="n">fileplot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;BANDPDOS_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s%s</span><span class="s1">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="n">calcID</span><span class="p">,</span><span class="n">postfix</span><span class="p">))</span>	
		<span class="n">ax2</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
		<span class="k">def</span> <span class="nf">getPlotData</span><span class="p">(</span><span class="n">sumpdosFile</span><span class="p">):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sumpdosFile</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataFile</span><span class="p">:</span>
					<span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dataFile</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sumpdosFile</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataFile</span><span class="p">:</span>
					<span class="n">data</span> <span class="o">=</span> <span class="n">dataFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
					<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
					<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
						<span class="n">data</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
					

			<span class="n">en</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">pdos</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">ldos</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">ldosDOWN</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>      <span class="c1">#append DOS data to en,dos,dosw lists</span>
				<span class="k">try</span><span class="p">:</span>
					
					<span class="n">en</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">Efermi</span><span class="p">)</span> <span class="c1">#to shift all the y values with respect to the Fermi level</span>
					<span class="n">ldos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
					<span class="n">pdos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
					<span class="n">ldosDOWN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
					
				<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
					<span class="k">pass</span>

			<span class="n">endos</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">en</span><span class="p">)</span>  <span class="c1">#to convert the list x from float to numbers</span>
			<span class="n">floatdos</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">ldos</span><span class="p">)</span>
			<span class="n">floatdosDOWN</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">ldosDOWN</span><span class="p">)</span>
			<span class="n">enshift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">endos</span><span class="p">)</span> <span class="c1">#to treat the list b as an array?</span>

			<span class="k">return</span> <span class="n">enshift</span><span class="p">,</span><span class="n">floatdos</span><span class="p">,</span><span class="n">floatdosDOWN</span>

		<span class="n">maxDOS</span><span class="o">=</span><span class="mi">0</span>
		<span class="n">minDOS</span><span class="o">=</span><span class="mi">0</span>
		<span class="n">atomName</span><span class="o">=</span> <span class="p">[]</span>
		<span class="n">pDOSNoPath</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">atomList</span><span class="o">=</span><span class="p">[]</span>

		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_dos.dat&#39;</span><span class="o">%</span><span class="n">dos_ID</span><span class="p">)):</span>
			<span class="n">pDOSNoPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_dos.dat&#39;</span><span class="o">%</span><span class="n">dos_ID</span><span class="p">))</span>

<span class="c1">#		for k,v in oneCalc.iteritems():</span>
		<span class="n">atomList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getPosLabels</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_INPUT_&#39;</span><span class="p">])))</span>

<span class="c1">#		print atomList</span>
<span class="c1">#			if re.match(r&#39;_AFLOWPI_[A-Z][0-9]*_&#39;,k):</span>
<span class="c1">#				atomList.append(v)</span>
		<span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">atomList</span><span class="p">:</span>
			<span class="n">filePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_All.sumpdos&#39;</span> <span class="o">%</span> <span class="n">species</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
				<span class="n">pDOSNoPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
		<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_color_cycle</span><span class="p">([</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">LSDA</span><span class="p">:</span>
			<span class="n">ax2</span><span class="o">.</span><span class="n">set_color_cycle</span><span class="p">([</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;,y&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">])</span>
		
		<span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">pDOSNoPath</span><span class="p">:</span>
			<span class="n">filename</span> <span class="o">=</span>  <span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

			<span class="k">try</span><span class="p">:</span>
				<span class="n">species</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">r&#39;(.+?)_.+&#39;</span><span class="p">,</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">filename</span><span class="o">==</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_dos.dat&#39;</span><span class="o">%</span><span class="n">dos_ID</span><span class="p">:</span>
					<span class="n">species</span><span class="o">=</span><span class="s1">&#39;TOTAL&#39;</span>
			
			<span class="sd">&#39;&#39;&#39;gets the energy and the DOS for the orbital for the atom&#39;&#39;&#39;</span>
			<span class="n">enshift</span><span class="p">,</span> <span class="n">floatdos</span><span class="p">,</span><span class="n">floatdosDOWN</span> <span class="o">=</span> <span class="n">getPlotData</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
			<span class="sd">&quot;&quot;&quot;makes a sum of all the pdos for a total&quot;&quot;&quot;</span>
			
			<span class="n">floatdos</span><span class="p">,</span><span class="n">floatdosDOWN</span><span class="p">,</span><span class="n">enshift</span><span class="o">=</span><span class="n">__smoothGauss</span><span class="p">(</span><span class="n">floatdos</span><span class="p">),</span><span class="n">__smoothGauss</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">),</span><span class="n">__smoothGauss</span><span class="p">(</span><span class="n">enshift</span><span class="p">)</span>

			<span class="sd">&#39;&#39;&#39; scales DOS to larges value of DOS in the given energy range and finds the largest DOS between the different orbitals&#39;&#39;&#39;</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">max</span><span class="p">([</span><span class="n">floatdos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">floatdos</span><span class="p">))</span> <span class="k">if</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span> <span class="o">&gt;</span> <span class="n">maxDOS</span><span class="p">:</span>
					<span class="n">maxDOS</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">floatdos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">floatdos</span><span class="p">))</span> <span class="k">if</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
			
				<span class="k">if</span> <span class="nb">min</span><span class="p">([</span><span class="n">floatdosDOWN</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">))</span> <span class="k">if</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span> <span class="o">&lt;</span> <span class="n">minDOS</span><span class="p">:</span>
					
					<span class="n">minDOS</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">floatdosDOWN</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">))</span> <span class="k">if</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">print</span> <span class="s1">&#39;nuh uh uh you didnt say the magic word&#39;</span>
			<span class="k">if</span> <span class="n">species</span><span class="o">==</span><span class="s1">&#39;TOTAL&#39;</span><span class="p">:</span>	
				<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">floatdos</span><span class="p">,</span><span class="n">enshift</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">species</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>		
			<span class="k">else</span><span class="p">:</span>
				<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">floatdos</span><span class="p">,</span><span class="n">enshift</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">species</span><span class="p">)</span>							

			<span class="k">if</span> <span class="n">LSDA</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">species</span><span class="o">==</span><span class="s1">&#39;TOTAL&#39;</span><span class="p">:</span>
					<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">,</span><span class="n">enshift</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">species</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>		
				<span class="k">else</span><span class="p">:</span>
					<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">,</span><span class="n">enshift</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">species</span><span class="p">)</span>							
		<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">LSDA</span><span class="p">:</span>
			<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[::</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">labels</span><span class="p">[::</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">minDOS</span><span class="p">,</span><span class="mf">1.1</span><span class="o">*</span><span class="n">maxDOS</span><span class="p">)</span> <span class="c1"># scales DOS to larges value of DOS in the given energy range </span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#line separating up and down spin</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">labels</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="o">*</span><span class="n">maxDOS</span><span class="p">)</span> <span class="c1"># scales DOS to larges value of DOS in the given energy range</span>

		<span class="n">pylab</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

		<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>

	     <span class="c1">#to hide ticklabels</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

		<span class="n">ax1</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.67</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span> <span class="c1">#[left,bottom,width,height]</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.20</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>

	     <span class="c1">#other useful options for the frame! :D</span>

		<span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Density of States (States/eV)&#39;</span><span class="p">)</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
		<span class="n">locs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">xticks</span><span class="p">()</span>
		
		<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
			<span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
				<span class="n">labels</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;arbitrary units&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">labels</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
		
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

<span class="c1">##########################################################################################################</span>
	     <span class="c1">#to plot the DOS</span>
	<span class="k">if</span> <span class="n">DOSPlot</span> <span class="o">==</span> <span class="s1">&#39;DOS&#39;</span><span class="p">:</span>
		<span class="k">print</span> <span class="s1">&#39;Plotting electronic band structure and DOS of </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
		<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting electronic band structure and DOS of </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span>
		<span class="n">fileplot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;BANDDOS_</span><span class="si">%s%s%s</span><span class="s1">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">],</span><span class="n">postfix</span><span class="p">))</span>
		<span class="n">ax2</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filedos</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
			<span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;output from dos calculation not found. Are you sure you ran ppDOS and it completed properly?&quot;</span><span class="p">)</span>
			<span class="k">print</span> <span class="s2">&quot;Are you sure you ran ppDOS and it completed properly?&quot;</span>
			<span class="k">return</span>

		<span class="n">en</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">dos</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">dosdw</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>      <span class="c1">#append DOS data to en,dos,dosw lists</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="c1">#to shift all the y values with respect to the Fermi level </span>
				<span class="n">en</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">Efermi</span><span class="p">)</span> 
				<span class="n">dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
				<span class="n">dosdw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]))</span>

			<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
				<span class="k">pass</span>

		<span class="n">endos</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">en</span><span class="p">)</span>  <span class="c1">#to convert the list x from float to numbers</span>
		<span class="n">floatdos</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">dos</span><span class="p">)</span>
		<span class="n">floatdosDOWN</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">dosdw</span><span class="p">)</span>
		<span class="n">enshift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">endos</span><span class="p">)</span> <span class="c1">#to treat the list b as an array?</span>
		<span class="n">floatdos</span><span class="p">,</span><span class="n">floatdosDOWN</span><span class="p">,</span><span class="n">enshift</span><span class="o">=</span><span class="n">__smoothGauss</span><span class="p">(</span><span class="n">floatdos</span><span class="p">),</span><span class="n">__smoothGauss</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">),</span><span class="n">__smoothGauss</span><span class="p">(</span><span class="n">enshift</span><span class="p">)</span>		
		<span class="n">ax2</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>

		<span class="n">dosMAX</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">dos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dos</span><span class="p">))</span> <span class="k">if</span> <span class="n">en</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">en</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">floatdos</span><span class="p">,</span><span class="n">enshift</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span> <span class="c1">#to plot the smoothed data</span>

<span class="c1">#		pylab.plot(__smoothGauss(floatdos),__smoothGauss(enshift),&#39;k&#39;) #to plot the smoothed data</span>
		
		<span class="k">if</span> <span class="n">LSDA</span><span class="p">:</span>
			<span class="n">dosMIN</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">floatdosDOWN</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">))</span> <span class="k">if</span> <span class="n">en</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">en</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">,</span><span class="n">enshift</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span> <span class="c1">#to plot the smoothed data</span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">dosMIN</span><span class="p">,</span><span class="mf">1.1</span><span class="o">*</span><span class="n">dosMAX</span><span class="p">)</span> <span class="c1"># scales DOS to larges value of DOS in the given energy range</span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#line separating up and down spin</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="o">*</span><span class="n">dosMAX</span><span class="p">)</span> <span class="c1"># scales DOS to larges value of DOS in the given energy range</span>

		<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>


	     <span class="c1">#to hide ticklabels</span>
<span class="c1">#		ax2.set_yticklabels([])</span>

		<span class="n">locs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">xticks</span><span class="p">()</span>
		
		<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
			<span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
				<span class="n">labels</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;arbitrary units&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">labels</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
		
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.67</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span> <span class="c1">#[left,bottom,width,height]</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.20</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>

	     <span class="c1">#other useful options for the frame! :D</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Density of States (States/eV)&#39;</span><span class="p">)</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
<span class="c1">###########################################################################################</span>

	<span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
	<span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
	<span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
	<span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
	<span class="n">ax1</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span> <span class="c1">#or False </span>

	<span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#Fermi level line</span>

     <span class="c1">##############################</span>
     <span class="c1">#to increase the linewidth of the axis, on both subplots</span>

	<span class="sd">&#39;&#39;&#39;gives the name of the compound in the calculation in the name of the file for the band structure plot&#39;&#39;&#39;</span>
	<span class="n">figtitle</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
	<span class="n">figtitle</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">])</span> 
	<span class="n">t</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">figtitle</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span> <span class="c1">#[x,y]</span>

	<span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileplot</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__moveToSavedir</span><span class="p">(</span><span class="n">fileplot</span><span class="p">)</span>
<span class="c1">#		with open(fileplot+&#39;.pkl&#39;,&#39;wb&#39;) as pickleOutput:</span>
<span class="c1">#			cPickle.dump(ax1,pickleOutput)</span>
<span class="c1">#			cPickle.dump(ax2,pickleOutput)</span>
<span class="c1">#			AFLOWpi.retr.__moveToSavedir(fileplot+&#39;.pkl&#39;)</span>

	<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
		<span class="k">pass</span>
<span class="c1">#		AFLOWpi.run._fancy_error_log(e)</span>

        <span class="n">pyplot</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>



<div class="viewcode-block" id="dos"><a class="viewcode-back" href="../plot.html#plot.dos">[docs]</a><span class="k">def</span> <span class="nf">dos</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">yLim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">LSDA</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Generates DOS plots for the calculations in the dictionary of dictionaries of calculations</span>

<span class="sd">	Arguments:</span>
<span class="sd">              calcs (dict): dictionary of dictionaries representing the set of calculations</span>
<span class="sd">              </span>
<span class="sd">	Keyword Arguments:</span>
<span class="sd">              yLim (list): List or tuple of two integers for max and min range in horizontal axis of DOS plot</span>
<span class="sd">              LSDA (bool): To plot DOS as spin polarized or not (calculation must have been done as spin polarized)</span>
<span class="sd">              runlocal (bool): Do the plotting right now or if False do it when the calculations are running</span>
<span class="sd">              postfix (str): Postfix to the filename of the plot</span>
<span class="sd">              tight_banding (bool): Whether to treat the input data as from Quantum Espresso or WanT bands.x</span>

<span class="sd">        Returns:</span>
<span class="sd">              None</span>
<span class="sd">              </span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">if</span> <span class="n">runlocal</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
			<span class="n">__dosPlot</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">yLim</span><span class="p">,</span><span class="n">LSDA</span><span class="o">=</span><span class="n">LSDA</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
			<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;PLOT&#39;</span><span class="p">,</span><span class="s2">&quot;AFLOWpi.plot.__dosPlot(oneCalc,ID,[</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">],LSDA=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">LSDA</span> <span class="p">))</span>



</div>
<span class="k">def</span> <span class="nf">__plotByAtom</span><span class="p">(</span><span class="n">maxNum</span><span class="p">,</span><span class="n">speciesNum</span><span class="p">,</span><span class="n">fig</span><span class="p">,</span><span class="n">atom</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">yLim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">LSDA</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Function to take the data files generated by the sumpdos function and</span>
<span class="sd">        plots them with energy shifted relative to the Fermi Energy.</span>
<span class="sd">	</span>
<span class="sd">	Arguments:</span>
<span class="sd">	      atom (str): Species of atom you are wanting to plot (&#39;All&#39; will</span>
<span class="sd">                          plot the combined pdos for all atoms in the system)</span>
<span class="sd">              oneCalc (dict): single calculation that is the value of the dictionary</span>
<span class="sd">                              of dictionaries of calculations</span>
<span class="sd">	</span>
<span class="sd">	Keyword Arguments:</span>
<span class="sd">    	      yLim (list): the limits of the ordinate on the plot (default: [-10,10]</span>

<span class="sd">        Returns:</span>
<span class="sd">              ax2 (matplotlib.pyplot.axis): returns an axes object with the plotted proj. DOS</span>
<span class="sd">              </span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">Efermi</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getEfermi</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Efermi</span><span class="p">)</span><span class="o">!=</span><span class="nb">type</span><span class="p">(</span><span class="mf">0.5</span><span class="p">):</span>
			<span class="n">Efermi</span><span class="o">=</span><span class="n">Efermi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="n">Efermi</span><span class="o">=</span><span class="mf">0.0</span>
<span class="c1">#        enshift=Efermi</span>
	<span class="k">print</span> <span class="s1">&#39;Efermi/HOMO-LUMO = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">Efermi</span>
<span class="c1">#	fig1,ax = pylab.subplots(1,maxNum)</span>
<span class="c1">#	print fig1</span>
<span class="c1">#	print </span>
<span class="c1">#	print ax</span>

        
<span class="c1">#	ax2 = ax[speciesNum]</span>
<span class="c1">#	print ax2</span>
<span class="c1">#	ax2 = fig.add_subplot(ax)</span>
<span class="c1">#	print speciesNum</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ax2</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">speciesNum</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ax2</span><span class="o">=</span><span class="n">ax</span>


<span class="c1">#	ax2 = ax</span>
<span class="c1">#	print ax2</span>
	<span class="k">print</span> <span class="s1">&#39;Entering </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>
	<span class="sd">&#39;&#39;&#39;extracts HOMO from nscf calculation output file as input to the plotting&#39;&#39;&#39;</span>

	<span class="sd">&quot;&quot;&quot;get the path to the subdirectory of the calc that you are making plots for&quot;&quot;&quot;</span>	
	<span class="n">subdir</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>
	
	<span class="k">try</span><span class="p">:</span>
		<span class="n">filePlotName</span> <span class="o">=</span> <span class="s1">&#39;PDOS_</span><span class="si">%s%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="n">ID</span><span class="p">,</span><span class="n">atom</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="n">filePlotName</span> <span class="o">=</span> <span class="s1">&#39;PDOS_</span><span class="si">%s%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="n">ID</span><span class="p">,</span><span class="n">atom</span><span class="p">)</span>

	<span class="n">fileplot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="n">filePlotName</span><span class="p">)</span>

	<span class="c1">#to set figure size and default fonts</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;serif&quot;</span><span class="p">)</span>      <span class="c1">#to set the font type</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>             <span class="c1">#to set the font size</span>

        <span class="n">width</span> <span class="o">=</span> <span class="mi">20</span>
	<span class="n">height</span> <span class="o">=</span> <span class="mf">14.0</span>
<span class="c1">#	fig1 = pylab.figure(figsize=(width, 3.5*float(speciesNum))) #to adjust the figure size</span>

     <span class="c1">#to set a centerd title with a bigger font</span>
     <span class="c1">####################################</span>
     <span class="c1">#to plot the DOS</span>


	<span class="k">def</span> <span class="nf">getPlotData</span><span class="p">(</span><span class="n">sumpdosFile</span><span class="p">):</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sumpdosFile</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataFile</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dataFile</span><span class="p">)</span>

		<span class="n">en</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">pdos</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">ldos</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">ldosDOWN</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>      <span class="c1">#append DOS data to en,dos,dosw lists</span>
			<span class="k">try</span><span class="p">:</span>
                                <span class="n">one_en</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">Efermi</span>
                                <span class="k">if</span> <span class="n">one_en</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1.05</span> <span class="ow">and</span> <span class="n">one_en</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.05</span><span class="p">:</span>
                                    <span class="n">en</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">Efermi</span><span class="p">)</span> <span class="c1">#to shift all the y values with respect to the Fermi level</span>
                                    <span class="n">ldos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                                    <span class="n">pdos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
                                    <span class="n">ldosDOWN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
			<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
				<span class="k">pass</span>


		<span class="n">endos</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">en</span><span class="p">)</span>  <span class="c1">#to convert the list x from float to numbers</span>
		<span class="n">floatdos</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">ldos</span><span class="p">)</span>
		<span class="n">floatdosDOWN</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">ldosDOWN</span><span class="p">)</span>
		<span class="n">enshift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">endos</span><span class="p">)</span> <span class="c1">#to treat the list b as an array?</span>

                <span class="k">return</span> <span class="n">__smoothGauss</span><span class="p">(</span><span class="n">enshift</span><span class="p">),</span><span class="n">__smoothGauss</span><span class="p">(</span><span class="n">floatdos</span><span class="p">),</span><span class="n">__smoothGauss</span><span class="p">(</span><span class="n">floatdosDOWN</span><span class="p">)</span>

<span class="c1">#		return enshift,floatdos,floatdosDOWN</span>

	<span class="n">maxDOS</span><span class="o">=</span><span class="mi">0</span>
	<span class="n">minDOS</span><span class="o">=</span><span class="mi">0</span>
	<span class="n">orbitalList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,]</span>
	<span class="n">pDOSFiles</span><span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_*.sumpdos&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom</span><span class="p">)))</span>

	<span class="n">pDOSNoPath</span> <span class="o">=</span> <span class="p">[]</span>
	
	<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">orbitalList</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.sumpdos&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom</span><span class="p">,</span><span class="n">item</span><span class="p">))):</span>
			<span class="n">pDOSNoPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.sumpdos&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom</span><span class="p">,</span><span class="n">item</span><span class="p">)))</span>

	<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
	<span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">pDOSNoPath</span><span class="p">:</span>
		<span class="n">filename</span> <span class="o">=</span>  <span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">orbitalName</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">species</span> <span class="o">=</span>  <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
			
		<span class="k">if</span> <span class="n">orbitalName</span> <span class="o">!=</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
			<span class="c1">#print &#39;Plotting %s orbital of %s for %s&#39; % (orbitalName,atom,__getStoicName(oneCalc))</span>
			<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting </span><span class="si">%s</span><span class="s1"> orbital of </span><span class="si">%s</span><span class="s1"> for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">orbitalName</span><span class="p">,</span><span class="n">atom</span><span class="p">,</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1">#print &#39;Plotting %s orbital of  %s&#39; % (orbitalName,__getStoicName(oneCalc))</span>
			<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting </span><span class="si">%s</span><span class="s1"> orbital of </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">orbitalName</span><span class="p">,</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span>
		<span class="k">if</span> <span class="n">orbitalName</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
			<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
		<span class="k">elif</span> <span class="n">orbitalName</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span>
			<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
		<span class="k">elif</span> <span class="n">orbitalName</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
			<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
		<span class="k">elif</span> <span class="n">orbitalName</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
			<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span>
		<span class="k">elif</span> <span class="n">orbitalName</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
			<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
		<span class="sd">&#39;&#39;&#39;gets the energy and the DOS for the orbital for the atom&#39;&#39;&#39;</span>
		<span class="n">enshift</span><span class="p">,</span> <span class="n">floatdos</span><span class="p">,</span><span class="n">floatdosDOWN</span> <span class="o">=</span> <span class="n">getPlotData</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
<span class="c1">#		enshift, floatdos,floatdosDOWN = </span>


		<span class="sd">&#39;&#39;&#39; scales DOS to larges value of DOS in the given energy range and finds the largest DOS between the different orbitals&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="nb">max</span><span class="p">([</span><span class="n">floatdos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">floatdos</span><span class="p">))</span> <span class="k">if</span> <span class="p">(</span><span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span> <span class="o">&gt;</span> <span class="n">maxDOS</span><span class="p">:</span>
                    <span class="n">maxDOS</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">floatdos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">floatdos</span><span class="p">))</span> <span class="k">if</span> <span class="p">(</span><span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)])</span>
<span class="c1">#			maxDOS = max([floatdos[k] for k in range(len(floatdos)) if enshift[k] &lt; yLim[1] and enshift[k] &gt; yLim[0] ])</span>



		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">min</span><span class="p">([</span><span class="n">floatdosDOWN</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">floatdos</span><span class="p">))</span> <span class="k">if</span> <span class="p">(</span><span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&lt;</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span><span class="o">&lt;</span><span class="n">minDOS</span><span class="p">:</span>
                            <span class="n">minDOS</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">floatdosDOWN</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">floatdos</span><span class="p">))</span> <span class="k">if</span> <span class="p">(</span><span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">enshift</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)])</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">minDOS</span><span class="o">=</span><span class="mi">0</span>
		
		<span class="k">if</span> <span class="ow">not</span> <span class="n">LSDA</span><span class="p">:</span>
			<span class="n">minDOS</span><span class="o">=</span><span class="mi">0</span>
			
		<span class="k">if</span> <span class="n">orbitalName</span> <span class="o">!=</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
			<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">enshift</span><span class="p">,</span><span class="n">floatdos</span><span class="p">,</span><span class="n">color</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">orbitalName</span><span class="p">)</span>

			<span class="k">if</span> <span class="n">LSDA</span><span class="p">:</span>
				<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">enshift</span><span class="p">,</span><span class="n">floatdosDOWN</span><span class="p">,</span><span class="n">color</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">orbitalName</span><span class="p">)</span>
	
		       	
<span class="c1">#	ax2=fig.add_subplot(subplotNum)</span>
	<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>

	<span class="k">if</span> <span class="n">LSDA</span><span class="p">:</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[::</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">labels</span><span class="p">[::</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">minDOS</span><span class="p">,</span><span class="n">maxDOS</span><span class="p">)</span> <span class="c1"># scales DOS to larges value of DOS in the given energy range</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#line to separate up and down spin</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">labels</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">maxDOS</span><span class="p">)</span> <span class="c1"># scales DOS to larges value of DOS in the given energy range</span>


        <span class="n">max_x</span> <span class="o">=</span>  <span class="nb">max</span><span class="p">(</span><span class="n">enshift</span><span class="p">)</span>
        <span class="n">min_x</span> <span class="o">=</span>  <span class="nb">min</span><span class="p">(</span><span class="n">enshift</span><span class="p">)</span>

  <span class="c1">#      if min_x&gt;yLim[0]:</span>
  <span class="c1">#          yLim[0]=min_x</span>
 <span class="c1">#       if max_x&lt;yLim[1]:</span>
<span class="c1">#            yLim[1]=max_x</span>

	<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1">#plot the ticks only on the bottom plot of the figure</span>

        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>


	<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#Fermi level line</span>

     <span class="c1">##############################</span>
     <span class="c1">#to increase the linewidth of the axis</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>


     <span class="c1">#other useful options for the frame! :D</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
		<span class="n">i</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">speciesYPos</span> <span class="o">=</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">50.0</span><span class="p">)</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="n">speciesYPos</span> <span class="o">=</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">50.0</span><span class="p">)</span>
<span class="c1">#	ax2.text(speciesYPos,maxDOS,atom,fontsize=15,fontweight=&#39;bold&#39;)</span>


	<span class="n">ax2</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>	

	<span class="n">figtitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
	<span class="n">compoundName</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c1">#to set a centerd title, with a bigger font</span>
	<span class="n">figtitle</span> <span class="o">=</span> <span class="s1">r&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">compoundName</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">])</span>
<span class="c1">#	t = pylab.gcf().text(0.5,0.92, figtitle,fontsize=14,horizontalalignment=&#39;center&#39;) #[x,y]</span>


	<span class="k">try</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">ax2</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="k">return</span> <span class="s1">&#39;&#39;</span>


<div class="viewcode-block" id="opdos"><a class="viewcode-back" href="../plot.html#plot.opdos">[docs]</a><span class="k">def</span> <span class="nf">opdos</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">yLim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">LSDA</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Generates electronic band structure plots for the calculations in the dictionary of dictionaries</span>
<span class="sd">	of calculations with the option to have a DOS or PDOS plot to accompany it.</span>

<span class="sd">	Arguments:</span>
<span class="sd">              calcs (dict): dictionary of dictionaries representing the set of calculations</span>
<span class="sd">              </span>
<span class="sd">	Keyword Arguments:</span>
<span class="sd">              yLim (list): List or tuple of two integers for max and min range in horizontal axis of DOS plot</span>
<span class="sd">              LSDA (bool): To plot DOS as spin polarized or not (calculation must have been done as spin polarized)</span>
<span class="sd">              runlocal (bool): Do the plotting right now or if False do it when the calculations are running</span>
<span class="sd">              postfix (str): Postfix to the filename of the plot</span>
<span class="sd">              tight_banding (bool): Whether to treat the input data as from Quantum Espresso or WanT bands.x</span>

<span class="sd">        Returns:</span>
<span class="sd">              None</span>

<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>	
		<span class="k">if</span> <span class="n">runlocal</span><span class="p">:</span>
			<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">__opdos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">yLim</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="n">postfix</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;PLOT&#39;</span><span class="p">,</span><span class="s2">&quot;AFLOWpi.plot.__opdos(oneCalc,ID,[</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">],LSDA=</span><span class="si">%s</span><span class="s2">,postfix=&#39;</span><span class="si">%s</span><span class="s2">&#39;,scale=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">LSDA</span><span class="p">,</span><span class="n">postfix</span><span class="p">,</span><span class="n">scale</span><span class="p">))</span>


</div>
<span class="k">def</span> <span class="nf">__opdos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">yLim</span><span class="p">,</span><span class="n">LSDA</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="k">print</span> <span class="s1">&#39;Entering </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>
	<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting Orbital Projected DOS&#39;</span><span class="p">)</span>
	<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;summing pdos for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>





	<span class="n">__sumpdos</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">postfix</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
		<span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">postfix</span>

        <span class="n">atomList</span><span class="o">=</span><span class="p">[]</span>
	<span class="n">atomPlotArray</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
	<span class="n">perSpecies</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">oneCalc</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;_AFLOWPI_[A-Z][0-9]*_&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
                        <span class="n">atomList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="c1">#	if len(atomList)&gt;9:</span>
<span class="c1">#		atomList=[]</span>
<span class="c1">#		for k,v in oneCalc.iteritems():</span>
<span class="c1">#			if re.match(r&#39;_AFLOWPI_[A-Z][0-9]*_&#39;,k):</span>
<span class="c1">#				atomList.append(v.strip(&#39;1234567890&#39;))</span>
	<span class="n">atomList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">atomList</span><span class="p">)))</span>


	<span class="c1">#to set figure size and default fonts</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;serif&quot;</span><span class="p">)</span>      <span class="c1">#to set the font type</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>             <span class="c1">#to set the font size</span>


        <span class="n">width</span> <span class="o">=</span> <span class="mi">20</span>
	<span class="n">height</span> <span class="o">=</span> <span class="mi">14</span>

        <span class="c1">##sometimes smearing will give negative pdos vals</span>
        <span class="c1">##and we dont want that to show if not lsda</span>
<span class="c1">#	pyplot.title(&#39;Orbital Proj. DOS: %s&#39;%AFLOWpi.retr.__getStoicName(oneCalc,strip=True),weight=&#39;bold&#39;)</span>
        <span class="n">figtitle</span><span class="o">=</span><span class="s1">&#39;Orbital Proj. DOS: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">LSDA</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">#	fig = pylab.figure(figsize=(width, height)) #to adjust the figure size</span>
	<span class="n">fig</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atomList</span><span class="p">),</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">14.0</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">3.5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">atomList</span><span class="p">))))</span>
<span class="c1">#        pyplot.subplots_adjust(bottom=0.00, top=0.97)</span>



<span class="c1">#	fig.figsize=(20,3.5*len(atomList))</span>

	<span class="n">atomAxisArray</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
	<span class="n">frame1</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="c1">#	for i in frame1.axes.get_xticklabels():</span>
<span class="c1">#		i.set_visible(False)</span>

<span class="c1">#	for i in frame1.axes.get_yticklabels():</span>
<span class="c1">#		i.set_visible(False)</span>
<span class="c1">#	frame1.axes.set_axis_off()</span>
<span class="c1">#	frame1.axes.get_xaxis().set_visible(False)</span>
<span class="c1">#	frame1.axes.get_yaxis().set_visible(False)</span>
	<span class="n">old_high</span><span class="o">=</span><span class="mf">0.0</span>
	<span class="n">old_low</span> <span class="o">=</span><span class="mf">0.0</span>
	<span class="n">t</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">figtitle</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,)</span> <span class="c1">#[x,y]</span>

	<span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atomList</span><span class="p">)):</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">__plotByAtom</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atomList</span><span class="p">),</span><span class="n">species</span><span class="p">,</span><span class="n">fig</span><span class="p">,</span><span class="n">atomList</span><span class="p">[</span><span class="n">species</span><span class="p">],</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">yLim</span><span class="p">,</span><span class="n">LSDA</span><span class="o">=</span><span class="n">LSDA</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax_list</span><span class="p">)</span>

		<span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density of States (States/eV)&#39;</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">atomList</span><span class="p">[</span><span class="n">species</span><span class="p">],</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

		<span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_autoscalex_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
		
		<span class="n">ylim</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
		<span class="n">new_low</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">new_low</span><span class="o">&lt;</span><span class="n">old_low</span><span class="p">:</span>
			<span class="n">old_low</span><span class="o">=</span><span class="n">new_low</span>
		<span class="n">new_high</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">new_high</span><span class="o">&gt;</span><span class="n">old_high</span><span class="p">:</span>
			<span class="n">old_high</span><span class="o">=</span><span class="n">new_high</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">LSDA</span><span class="p">:</span>
                    <span class="n">old_low</span><span class="o">=</span><span class="mf">0.0</span>

                



                <span class="k">if</span> <span class="n">species</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">atomList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="c1">#                    ax.axes.set_xticklabels(numpy.arange(yLim[0]*2,yLim[1]*2,5)/2.0)</span>
<span class="c1">#               else:</span>

                    
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ax_list</span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="o">=</span><span class="n">ax</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">ax_list</span><span class="o">=</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span>
<span class="c1">#		fig.add_axes()</span>
<span class="c1">#		atomPlotArray.update({species:atomPlot})</span>
		<span class="n">atomAxisArray</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">species</span><span class="p">:</span><span class="n">ax</span><span class="p">})</span>



 <span class="c1">#       for ax in fig.get_axes():</span>


        <span class="k">for</span> <span class="n">species</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="n">atomAxisArray</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">1.05</span><span class="o">*</span><span class="n">old_low</span><span class="p">,</span><span class="mf">1.05</span><span class="o">*</span><span class="n">old_high</span><span class="p">])</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="c1">#	for species in range(len(atomList)):        </span>
<span class="c1">#            y_range=abs(old_high-old_low)</span>
<span class="c1">#            x_range=abs(yLim[1]-yLim[0])</span>
<span class="c1">#            ax = ax_list[species]</span>
<span class="c1">#            ax.axes.text(yLim[0]+x_range*0.01,old_high-y_range*0.07,atomList[species],weight=&#39;bold&#39;,fontsize=18)</span>

	<span class="n">subdir</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>

	<span class="sd">&quot;&quot;&quot;get the path to the subdirectory of the calc that you are making plots for&quot;&quot;&quot;</span>

	<span class="sd">&#39;&#39;&#39;name of file of the DOS plots is dosBandPlot_&lt;_AFLOWPI_PREFIX_&gt;&#39;&#39;&#39;</span>
	
	<span class="n">fileplot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;PDOS_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s%s</span><span class="s1">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="n">ID</span><span class="p">,</span><span class="n">postfix</span><span class="p">))</span>

	<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileplot</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__moveToSavedir</span><span class="p">(</span><span class="n">fileplot</span><span class="p">)</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="k">pass</span>

<span class="c1">#	try:</span>
<span class="c1">#		with open(fileplot+&#39;.pkl&#39;,&#39;wb&#39;) as pickleOutput:</span>
<span class="c1">#			</span>
<span class="c1">#			cPickle.dump(atomAxisArray,pickleOutput)</span>
<span class="c1">#			AFLOWpi.retr.__moveToSavedir(fileplot+&#39;.pkl&#39;)</span>
<span class="c1">#			AFLOWpi.retr.__moveToSavedir(fileplot)</span>
<span class="c1">#	except Exception,e:</span>
<span class="c1">#		AFLOWpi.run._fancy_error_log(e)</span>




        <span class="n">pyplot</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<div class="viewcode-block" id="bands"><a class="viewcode-back" href="../plot.html#plot.bands">[docs]</a><span class="k">def</span> <span class="nf">bands</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">yLim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">DOSPlot</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">LSDA</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">tight_banding</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Generates electronic band structure plots for the calculations in the dictionary of dictionaries</span>
<span class="sd">	of calculations with the option to have a DOS or PDOS plot to accompany it.</span>

<span class="sd">	Arguments:</span>
<span class="sd">              calcs (dict): dictionary of dictionaries representing the set of calculations</span>
<span class="sd">              </span>
<span class="sd">	Keyword Arguments:</span>
<span class="sd">              yLim (list): List or tuple of two integers for max and min range in horizontal axis of DOS plot</span>
<span class="sd">              LSDA (bool): To plot DOS as spin polarized or not (calculation must have been done as spin polarized)</span>
<span class="sd">              DOSPlot (str): DOS or the PDOS plots next to the eletronic band structure plot (assuming you ran </span>
<span class="sd">                             either ppDOS or ppPDOS) (default: NONE) </span>
<span class="sd">              postfix (str): Postfix to the filename of the plot</span>
<span class="sd">              tight_banding (bool): Whether to treat the input data as from Quantum Espresso or WanT bands.x</span>

<span class="sd">        Returns:</span>
<span class="sd">              None</span>

<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">for</span> <span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="k">if</span> <span class="n">runlocal</span><span class="p">:</span>
			<span class="n">__bandPlot</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">yLim</span><span class="p">,</span><span class="n">DOSPlot</span><span class="p">,</span><span class="n">LSDA</span><span class="o">=</span><span class="n">LSDA</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="n">postfix</span><span class="p">,</span><span class="n">tight_banding</span><span class="o">=</span><span class="n">tight_banding</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">oneCalc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;PLOT&#39;</span><span class="p">,</span><span class="s2">&quot;AFLOWpi.plot.__bands(oneCalc,ID,yLim=[</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">],DOSPlot=&#39;</span><span class="si">%s</span><span class="s2">&#39;,LSDA=</span><span class="si">%s</span><span class="s2">,postfix=&#39;</span><span class="si">%s</span><span class="s2">&#39;,tight_banding=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">DOSPlot</span><span class="p">,</span><span class="n">LSDA</span><span class="p">,</span><span class="n">postfix</span><span class="p">,</span><span class="n">tight_banding</span><span class="p">))</span>	

</div>
<span class="k">def</span> <span class="nf">__bands</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">yLim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">DOSPlot</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">LSDA</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">tight_banding</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wrapper function for AFLOWpi.plot.__bandPlot </span>
<span class="sd">        OBSOLETE. NEEDS REMOVAL</span>


<span class="sd">	Arguments:</span>
<span class="sd">              oneCalc (dict): Single calculation that is the value of the dictionary of dictionaries of calculations</span>
<span class="sd">              ID (str): ID of the calculation</span>
<span class="sd">              </span>
<span class="sd">	Keyword Arguments:</span>
<span class="sd">              yLim (list): List or tuple of two integers for max and min range in horizontal axis of DOS plot</span>
<span class="sd">              LSDA (bool): To plot DOS as spin polarized or not (calculation must have been done as spin polarized)</span>
<span class="sd">              DOSPlot (str): DOS or the PDOS plots next to the eletronic band structure plot (assuming you ran </span>
<span class="sd">                             either ppDOS or ppPDOS) (default: NONE) </span>
<span class="sd">              postfix (str): Postfix to the filename of the plot</span>
<span class="sd">              tight_banding (bool): Whether to treat the input data as from Quantum Espresso or WanT bands.x</span>

<span class="sd">        Returns:</span>
<span class="sd">              None</span>

<span class="sd">	&#39;&#39;&#39;</span>

        <span class="n">oneCalc</span> <span class="o">=</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">)</span>
        <span class="n">__bandPlot</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">yLim</span><span class="p">,</span><span class="n">DOSPlot</span><span class="p">,</span><span class="n">LSDA</span><span class="o">=</span><span class="n">LSDA</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="n">postfix</span><span class="p">,</span><span class="n">tight_banding</span><span class="o">=</span><span class="n">tight_banding</span><span class="p">)</span>


<div class="viewcode-block" id="interpolatePlot"><a class="viewcode-back" href="../plot.html#plot.interpolatePlot">[docs]</a><span class="k">def</span> <span class="nf">interpolatePlot</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">variable1</span><span class="p">,</span><span class="n">variable2</span><span class="p">,</span><span class="n">zaxis</span><span class="o">=</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span><span class="n">xaxisTitle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yaxisTitle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">zaxisTitle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fileName</span><span class="o">=</span><span class="s1">&#39;interpolatePlot.pdf&#39;</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">text_min</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">vhline_min</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">circle_min</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">delta_min</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">rel_center</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">plot_color</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">find_min</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>    
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Takes a list of calculations and plots the energy of the calculations as a function of two input variables</span>
<span class="sd">    the first value is the baseline for the energy value and the energy plotted is the difference between that</span>
<span class="sd">    energy and the other energies in the grid</span>

<span class="sd">    Arguments:</span>
<span class="sd">          calcs (dict): dictionary of dictionaries of calculations</span>
<span class="sd">          variable1 (str): a string of the variable in the calculations that you want as your x axis</span>
<span class="sd">          variable2 (str): a string of the variable in the calculations that you want to your y axis</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          title (str): Title of plot (default: None)</span>
<span class="sd">          zaxis (str): Choice out of the keywords in each calc to plot in the Z axis (default: Energy)</span>
<span class="sd">          xaxisTitle (str): title of xaxis (default: same as variable1)</span>
<span class="sd">          yaxisTitle (str): title of yaxis (default: same as variable2)</span>
<span class="sd">          zaxisTitle (str): title of zaxis (default: same as zaxis)</span>
<span class="sd">          fileName (str): Name (and path where default is directory where script is run from ) of the </span>
<span class="sd">                          output file (default: &#39;interpolatePlot.pdf&#39;)</span>
<span class="sd">          delta (bool): Z-axis scale relative to its first value</span>
<span class="sd">          delta_min (bool): Z-axis scale relative to its lowest value</span>
<span class="sd">          text_min (bool): Display text of minimum value next to the minimum value if find_min=True</span>
<span class="sd">          vhline_min (bool): Display text of minimum value next to the minimum value if find_min=True</span>
<span class="sd">          circle_min (bool): Display text of minimum value next to the minimum value if find_min=True</span>
<span class="sd">          delta_min (bool): Display text of minimum value next to the minimum value if find_min=True</span>
<span class="sd">          rel_center (bool): Display text of minimum value next to the minimum value if find_min=True</span>
<span class="sd">          plot_color (str): string of the matplotlib colormap to be used </span>
<span class="sd">          find_min (bool): Interpolate between points and find value of </span>
<span class="sd">                           variable1 and variable2 for the minimum value of Z axis</span>

<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">xaxisTitle</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
	    <span class="n">xaxisTitle</span><span class="o">=</span><span class="n">variable1</span>
    <span class="k">if</span> <span class="n">yaxisTitle</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
	    <span class="n">yaxisTitle</span><span class="o">=</span><span class="n">variable2</span>
    <span class="n">X</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">Y</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">Z</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">zaxis</span><span class="o">==</span><span class="s1">&#39;Energy&#39;</span><span class="p">:</span>
            <span class="n">calcs</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">grabEnergyOut</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
	    <span class="k">pass</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">,</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="n">variable1</span><span class="p">]))</span>
        <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="n">variable2</span><span class="p">]))</span>
        <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="n">zaxis</span><span class="p">]))</span>


    <span class="n">X</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">Y</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">X</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">Y</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">Z</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
    <span class="n">x_bkup</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">y_bkup</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>

    <span class="n">X</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">Y</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">numpy</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span><span class="n">numpy</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">delta_min</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
	    <span class="n">Z</span><span class="o">-=</span><span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
    <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">Z</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Z</span><span class="p">,(</span><span class="n">X</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">Y</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">delta</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
	    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">-</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
	    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

    <span class="n">Z</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_values</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="o">-</span><span class="mf">9999999.0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span> <span class="p">))</span>
    <span class="n">interp</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1">#    rel_center=True</span>
    <span class="k">if</span> <span class="n">zaxis</span><span class="o">==</span><span class="s1">&#39;Energy&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">find_min</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                    <span class="n">valEnergy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">pseudo</span><span class="o">.</span><span class="n">__getMinimization</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">fitVars</span><span class="o">=</span><span class="p">[</span><span class="n">variable1</span><span class="p">,</span><span class="n">variable2</span><span class="p">],</span><span class="n">return_energy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">plotVals</span><span class="o">=</span><span class="n">valEnergy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#	    if vhline_min==True:</span>
    <span class="c1">#		    ax.axvline(x=plotVals[variable1],color=&#39;k&#39;)</span>
    <span class="c1">#		    ax.axhline(y=plotVals[variable2],color=&#39;k&#39;)</span>
                <span class="k">if</span> <span class="n">rel_center</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">([(</span><span class="n">xmax</span><span class="o">+</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span> <span class="p">,</span><span class="n">plotVals</span><span class="p">[</span><span class="n">variable1</span><span class="p">]],</span> <span class="p">[(</span><span class="n">ymax</span><span class="o">+</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span> <span class="p">,</span><span class="n">plotVals</span><span class="p">[</span><span class="n">variable2</span><span class="p">]</span> <span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">text_min</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                        <span class="n">coordText</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">plotVals</span><span class="p">[</span><span class="n">variable1</span><span class="p">],</span><span class="n">decimals</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span><span class="n">numpy</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">plotVals</span><span class="p">[</span><span class="n">variable2</span><span class="p">],</span><span class="n">decimals</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
                        <span class="n">pyplot</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.98</span><span class="o">*</span><span class="n">plotVals</span><span class="p">[</span><span class="n">variable1</span><span class="p">],</span><span class="mf">0.98</span><span class="o">*</span><span class="n">plotVals</span><span class="p">[</span><span class="n">variable2</span><span class="p">],</span><span class="n">coordText</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">circle_min</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                        <span class="n">circ</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">plotVals</span><span class="p">[</span><span class="n">variable1</span><span class="p">],</span><span class="n">plotVals</span><span class="p">[</span><span class="n">variable2</span><span class="p">]</span> <span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.01000000000</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">),</span><span class="n">height</span><span class="o">=</span><span class="mf">0.01000000000</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">rel_center</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                                <span class="n">circ</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">(((</span><span class="n">xmax</span><span class="o">+</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">ymax</span><span class="o">+</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">),</span>  <span class="n">width</span><span class="o">=</span><span class="mf">0.01000000000</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">),</span><span class="n">height</span><span class="o">=</span><span class="mf">0.01000000000</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>


        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>    
    



    <span class="n">im</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plot_color</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">z_min</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">z_max</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="n">interp</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">hold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">zaxisTitle</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
	    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">zaxisTitle</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xaxisTitle</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">yaxisTitle</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
	    <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="c1">#    if os.path.abspath(fileName):</span>

    <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
<span class="c1">#	    with open(fileName+&#39;.pkl&#39;,&#39;wb&#39;) as pickleOutput:</span>
<span class="c1">#		    cPickle.dump(ax,pickleOutput)</span>
<span class="c1">#	    AFLOWpi.retr.__moveToSavedir(fileName+&#39;.pkl&#39;)</span>
	    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__moveToSavedir</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
	    <span class="k">pass</span>
<span class="c1">#	    AFLOWpi.run._fancy_error_log(e)</span>

</div>
<div class="viewcode-block" id="interpolatePlot1D"><a class="viewcode-back" href="../plot.html#plot.interpolatePlot1D">[docs]</a><span class="k">def</span> <span class="nf">interpolatePlot1D</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">variable1</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span><span class="n">xaxisTitle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yaxisTitle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fileName</span><span class="o">=</span><span class="s1">&#39;interpolatePlot.pdf&#39;</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">circle_min</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>    
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Takes a list of calculations and plots the energy of the calculations as a function of two input variables</span>
<span class="sd">    the first value is the baseline for the energy value and the energy plotted is the difference between that</span>
<span class="sd">    energy and the other energies in the grid</span>

<span class="sd">    Arguments:</span>
<span class="sd">          calcs (dict): dictionary of dictionaries of calculations</span>
<span class="sd">          variable1 (dict): a string of the variable in the calculations that you want as your x axis</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          yaxis (str): Choice out of the keywords in each calc to plot in the Z axis (default: Energy)</span>
<span class="sd">          xaxisTitle (str): title of xaxis (default: same as variable1)</span>
<span class="sd">          yaxisTitle (str): title of yaxis (default: same as yaxis)</span>
<span class="sd">          title (str): Title of plot (default: None)</span>
<span class="sd">          fileName (str): Name (and path where default is directory where script is run from ) of the </span>
<span class="sd">                          output file (default: &#39;interpolatePlot.pdf&#39;)</span>
<span class="sd">          delta (bool): Z-axis scale relative to its first value</span>
<span class="sd">          circle_min (bool): Display text of minimum value next to the minimum value</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">xaxisTitle</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
	    <span class="n">xaxisTitle</span><span class="o">=</span><span class="n">variable1</span>
    <span class="k">if</span> <span class="n">yaxisTitle</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
	    <span class="n">yaxisTitle</span><span class="o">=</span><span class="n">yaxis</span>
    <span class="n">X</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">Y</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
	    <span class="n">calcs</span><span class="o">=</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">grabEnergyOut</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
	    <span class="k">pass</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">,</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="n">variable1</span><span class="p">])</span>
        <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="n">yaxis</span><span class="p">])</span>
	
    <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">numpy</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    



        
    <span class="n">Y</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">Y</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_values</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="o">-</span><span class="mf">9999999.0</span><span class="p">)</span>
    <span class="n">origYMin</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">origYMax</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">Y</span><span class="o">-=</span><span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

    <span class="n">x_interp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">interp_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
	    <span class="n">valEnergy</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">pseudo</span><span class="o">.</span><span class="n">__getMinimization</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">fitVars</span><span class="o">=</span><span class="p">[</span><span class="n">variable1</span><span class="p">],</span><span class="n">return_energy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
	    <span class="n">plotVals</span><span class="o">=</span><span class="n">valEnergy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	    <span class="n">foundMin</span><span class="o">=</span><span class="n">plotVals</span><span class="p">[</span><span class="n">yaxis</span><span class="p">]</span><span class="o">-</span><span class="n">origYMin</span>
	    
	    <span class="n">minBound</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
	    <span class="k">if</span> <span class="n">minBound</span><span class="o">&gt;</span><span class="n">foundMin</span><span class="p">:</span>
		    <span class="n">minBound</span><span class="o">=</span><span class="n">foundMin</span>

	    <span class="n">minBound</span><span class="o">-=</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Y</span><span class="p">)))</span><span class="o">*</span><span class="mf">0.02</span>

	    <span class="n">pyplot</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">minBound</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">*</span><span class="mf">1.01</span><span class="p">])</span>
	    <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">x_interp</span><span class="p">,</span><span class="n">interp_func</span><span class="p">(</span><span class="n">x_interp</span><span class="p">),</span><span class="s1">&#39;-&#39;</span><span class="p">,[</span><span class="n">plotVals</span><span class="p">[</span><span class="n">variable1</span><span class="p">]],[</span><span class="n">foundMin</span><span class="p">],</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>




	    <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;interpolated&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>





	    

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
	    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>    
    
    


    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xaxisTitle</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">yaxisTitle</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
	    <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

	    
    <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
	    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__moveToSavedir</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
	    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="c1">#    try:</span>
<span class="c1">#	    with open(fileName+&#39;.pkl&#39;,&#39;w&#39;) as pickleOutput:</span>
<span class="c1">#		    cPickle.dump(ax,pickleOutput)</span>
<span class="c1">#	    AFLOWpi.retr.__moveToSavedir(fileName+&#39;.pkl&#39;)</span>
 <span class="c1">#   except Exception,e:</span>
<span class="c1">#	    pass</span>
<span class="c1">#	    AFLOWpi.run._fancy_error_log(e)</span>




</div>
<div class="viewcode-block" id="grid_plot"><a class="viewcode-back" href="../plot.html#plot.grid_plot">[docs]</a><span class="k">def</span> <span class="nf">grid_plot</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">xaxis</span><span class="p">,</span><span class="n">yaxis</span><span class="p">,</span><span class="n">zaxis</span><span class="o">=</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span><span class="n">colorbarUnits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">zaxis_title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">plot_title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">xAxisStr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">yAxisStr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fileName</span><span class="o">=</span><span class="s1">&#39;grid_plot.pdf&#39;</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

    <span class="n">calcs_aux</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zaxis</span><span class="o">==</span><span class="s1">&#39;Energy&#39;</span><span class="p">:</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">calcs</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">grabEnergyOut</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span>
            <span class="n">zaxis</span><span class="o">=</span><span class="s1">&#39;aux_energy&#39;</span>            
            <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">calcs</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="n">zaxis</span><span class="p">]</span><span class="o">=</span><span class="n">calcs</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>


        <span class="k">if</span> <span class="n">zaxis_title</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">zaxis_title</span><span class="o">=</span><span class="s1">&#39;Energy (Ry)&#39;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">zaxis_title</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">zaxis_title</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zaxis_title</span><span class="o">=</span><span class="p">[</span><span class="n">zaxis_title</span><span class="p">]</span>

        <span class="n">calcs_aux</span><span class="o">=</span><span class="n">calcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">__distortionEnergy</span><span class="p">(</span><span class="n">calcs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xaxis</span><span class="p">,</span><span class="n">yaxis</span><span class="p">,</span><span class="n">zaxis</span><span class="o">=</span><span class="n">zaxis</span><span class="p">,</span><span class="n">calcs</span><span class="o">=</span><span class="n">calcs</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">colorbarUnits</span><span class="o">=</span><span class="n">colorbarUnits</span><span class="p">,</span><span class="n">titleArray</span><span class="o">=</span><span class="n">zaxis_title</span><span class="p">,</span><span class="n">plotTitle</span><span class="o">=</span><span class="n">plot_title</span><span class="p">,</span><span class="n">xAxisStr</span><span class="o">=</span><span class="n">xAxisStr</span><span class="p">,</span><span class="n">yAxisStr</span><span class="o">=</span><span class="n">yAxisStr</span><span class="p">,</span><span class="n">fileName</span><span class="o">=</span><span class="n">fileName</span><span class="p">,</span><span class="n">percentage</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">calcs_aux</span><span class="p">[</span><span class="n">ID</span><span class="p">][</span><span class="n">zaxis</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>

        <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">__distortionEnergy</span><span class="p">(</span><span class="n">calcs_aux</span><span class="p">,</span><span class="n">xaxis</span><span class="p">,</span><span class="n">yaxis</span><span class="p">,</span><span class="n">zaxis</span><span class="o">=</span><span class="n">zaxis</span><span class="p">,</span><span class="n">calcs</span><span class="o">=</span><span class="p">[</span><span class="n">calcs</span><span class="p">],</span><span class="n">colorbarUnits</span><span class="o">=</span><span class="n">colorbarUnits</span><span class="p">,</span><span class="n">titleArray</span><span class="o">=</span><span class="p">[</span><span class="n">zaxis_title</span><span class="p">],</span><span class="n">plotTitle</span><span class="o">=</span><span class="n">plotTitle</span><span class="p">,</span><span class="n">xAxisStr</span><span class="o">=</span><span class="n">xAxisStr</span><span class="p">,</span><span class="n">yAxisStr</span><span class="o">=</span><span class="n">yAxisStr</span><span class="p">,</span><span class="n">fileName</span><span class="o">=</span><span class="n">fileName</span><span class="p">,</span><span class="n">percentage</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="distortionEnergy"><a class="viewcode-back" href="../plot.html#plot.distortionEnergy">[docs]</a><span class="k">def</span> <span class="nf">distortionEnergy</span><span class="p">(</span><span class="n">calcs1</span><span class="p">,</span><span class="n">xaxis</span><span class="p">,</span><span class="n">yaxis</span><span class="p">,</span><span class="n">zaxis</span><span class="o">=</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span><span class="n">calcs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">colorbarUnits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">titleArray</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">plotTitle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">xAxisStr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">yAxisStr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fileName</span><span class="o">=</span><span class="s1">&#39;distortionEnergy.pdf&#39;</span><span class="p">,</span><span class="n">percentage</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">runlocal</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">__distortionEnergy</span><span class="p">(</span><span class="n">calcs1</span><span class="p">,</span><span class="n">xaxis</span><span class="p">,</span><span class="n">yaxis</span><span class="p">,</span><span class="n">zaxis</span><span class="o">=</span><span class="n">zaxis</span><span class="p">,</span><span class="n">calcs</span><span class="o">=</span><span class="n">calcs</span><span class="p">,</span><span class="n">colorbarUnits</span><span class="o">=</span><span class="n">colorbarUnits</span><span class="p">,</span><span class="n">titleArray</span><span class="o">=</span><span class="n">titleArray</span><span class="p">,</span><span class="n">plotTitle</span><span class="o">=</span><span class="n">plotTitle</span><span class="p">,</span><span class="n">xAxisStr</span><span class="o">=</span><span class="n">xAxisStr</span><span class="p">,</span><span class="n">yAxisStr</span><span class="o">=</span><span class="n">yAxisStr</span><span class="p">,</span><span class="n">fileName</span><span class="o">=</span><span class="n">fileName</span><span class="p">,</span><span class="n">percentage</span><span class="o">=</span><span class="n">percentage</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>


        <span class="n">calc_array</span><span class="o">=</span><span class="p">[</span><span class="n">calcs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">calcs1</span><span class="p">)]</span>
	<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">	   calcArray=[]</span>

<span class="s2">	   labels= [&#39;CUB&#39;,&#39;RHO&#39;,&#39;TET&#39;]</span>
<span class="s2">	   refDict={}</span>
<span class="s2">	   import os</span>
<span class="s2">	   curDir = os.path.abspath(os.curdir)</span>
<span class="s2">	   for label in labels:</span>

<span class="s2">		calcs =  AFLOWpi.prep.loadlogs(&#39;CRT&#39;, label,label,config=&#39;/Users/supka/fornari-research-dev/tests/AFLOWpi_tests.config&#39;)</span>


<span class="s2">	## append the calculations to a list for input them into the plotting function</span>
<span class="s2">		calcArray.append(calcs)</span>

<span class="s2">	   AFLOWpi.plot.__distortionEnergy(calcArray[0],&#39;_AFLOWPI_A_&#39;,&#39;_AFLOWPI_B_&#39;,calcs=calcArray[1:],plotTitle=&#39;$ABO_{3}$ Distortion $\Delta$E&#39;,titleArray=[labels[1]+&#39;$\Delta$E Ry&#39;,labels[2]+&#39;$\Delta$E Ry&#39;],xAxisStr=&#39;A&#39;,yAxisStr=&#39;B&#39;)</span>
<span class="s2">	&quot;&quot;&quot;</span>
	<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">runAfterAllDone</span><span class="p">(</span><span class="n">calcArray</span><span class="p">,</span><span class="n">command</span><span class="p">)</span>


</div>
<span class="k">def</span> <span class="nf">__distortionEnergy</span><span class="p">(</span><span class="n">calcs1</span><span class="p">,</span><span class="n">xaxis</span><span class="p">,</span><span class="n">yaxis</span><span class="p">,</span><span class="n">zaxis</span><span class="o">=</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span><span class="n">calcs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">colorbarUnits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">titleArray</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">plotTitle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">xAxisStr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">yAxisStr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fileName</span><span class="o">=</span><span class="s1">&#39;distortionEnergy.pdf&#39;</span><span class="p">,</span><span class="n">percentage</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plots the change in energy of a certain chemistry when the structure is changed</span>

<span class="sd">    Arguments:</span>
<span class="sd">          calcs1 (dict):  calculations of calculations with which to compare calcs2 and calcs3 with</span>
<span class="sd">          xaxis  (str):  variable in the calculations you want as yaxis</span>
<span class="sd">          yaxis  (str): variable in the calculations you want as yaxis</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">          calcs (list): a set of calcs that has distorted parameters from calcs1 (default:None)</span>
<span class="sd">          title (str): title of plot (default:None)</span>
<span class="sd">          colorbarUnits (str): the units of the elements in the array.(default:same as xaxis)</span>
<span class="sd">          xaxisStr (str): The label for the horizontal axis of the plot.(default:same as yaxis)</span>
<span class="sd">          yaxisStr (str): The label for the vertical axis of the plot.(default:None)</span>
<span class="sd">          plotTitle (str) The title of the plot.(default:None)</span>
<span class="sd">          titleArray (list): an array for the labels for the colorbar for the sets (default:None)</span>
<span class="sd">          fileName (str): name (and path where default is directory where script is run from ) </span>
<span class="sd">                          of the output file (default: &#39;distortionEnergy.pdf&#39;)</span>
<span class="sd">	</span>
<span class="sd">    Returns:</span>
<span class="sd">          None</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
	    <span class="k">print</span> <span class="s1">&#39;List of distortion calculations must not exceed 3&#39;</span>
	    <span class="k">return</span>

    <span class="k">if</span> <span class="n">xAxisStr</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
	    <span class="n">xAxisStr</span><span class="o">=</span><span class="n">xaxis</span>
    <span class="k">if</span> <span class="n">yAxisStr</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
	    <span class="n">yAxisStr</span><span class="o">=</span><span class="n">yaxis</span>

    

    <span class="k">def</span> <span class="nf">grabMatrix</span><span class="p">(</span><span class="n">calcs</span><span class="p">):</span>
	    <span class="n">calcs1</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">grabEnergyOut</span><span class="p">(</span><span class="n">calcs</span><span class="p">)</span>
	    <span class="n">X</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
	    <span class="n">Y</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
	    <span class="n">Z</span><span class="o">=</span><span class="p">[]</span>
	    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">,</span> <span class="ow">in</span> <span class="n">calcs1</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
		    <span class="n">X</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="n">xaxis</span><span class="p">])</span>
		    <span class="n">Y</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="n">yaxis</span><span class="p">])</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">oneCalc</span><span class="p">[</span><span class="n">zaxis</span><span class="p">]</span>

		    <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

	    <span class="n">Z</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>    
	    <span class="n">Z</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>  
	    <span class="k">return</span> <span class="n">Z</span>


    <span class="k">def</span> <span class="nf">grabLabels</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">xLabel</span><span class="p">,</span><span class="n">yLabel</span><span class="p">):</span>
	    <span class="n">xVals</span><span class="o">=</span><span class="p">[]</span>
	    <span class="n">yVals</span><span class="o">=</span><span class="p">[]</span>
	    <span class="n">counter</span><span class="o">=</span><span class="mi">0</span>
	    <span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
		    <span class="k">if</span> <span class="n">oneCalc</span><span class="p">[</span><span class="n">xLabel</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xVals</span><span class="p">:</span>
			    <span class="n">xVals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="n">xLabel</span><span class="p">])</span>
		    <span class="k">if</span> <span class="n">oneCalc</span><span class="p">[</span><span class="n">yLabel</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">yVals</span><span class="p">:</span>
			    <span class="n">yVals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="n">yLabel</span><span class="p">])</span>
	    
	    <span class="k">return</span> <span class="p">[</span><span class="n">xVals</span><span class="p">,</span><span class="n">yVals</span><span class="p">]</span>

    <span class="n">energy1</span> <span class="o">=</span> <span class="n">grabMatrix</span><span class="p">(</span><span class="n">calcs1</span><span class="p">)</span>
    <span class="n">energyArrayList</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">printBool</span><span class="o">=</span><span class="mi">0</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">neg_flag</span><span class="o">=</span><span class="bp">True</span>    

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">calcs</span><span class="p">)):</span>
        <span class="n">diff</span><span class="o">=</span><span class="n">grabMatrix</span><span class="p">(</span><span class="n">calcs</span><span class="p">[</span><span class="n">item</span><span class="p">])</span><span class="o">-</span><span class="n">energy1</span>
        <span class="k">if</span> <span class="n">percentage</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="mf">100.0</span><span class="o">*</span><span class="n">diff</span><span class="o">/</span><span class="n">energy1</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
                        <span class="n">neg_flag</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>

        <span class="n">energyArrayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

    <span class="n">energyArrayListMask</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">energyArrayList</span><span class="p">)</span>
    <span class="n">z_max</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">z_min</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energyArrayList</span><span class="p">)):</span>
	    <span class="k">if</span> <span class="n">energyArrayList</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">&gt;</span><span class="n">z_max</span><span class="p">:</span>
		    <span class="n">z_max</span> <span class="o">=</span> <span class="n">energyArrayList</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
	    <span class="k">if</span> <span class="n">energyArrayList</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">&lt;</span><span class="n">z_min</span><span class="p">:</span>
		    <span class="n">z_min</span> <span class="o">=</span> <span class="n">energyArrayList</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energyArrayList</span><span class="p">)):</span>
	    <span class="k">for</span> <span class="n">item1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energyArrayList</span><span class="p">)):</span>
                

                <span class="n">energyArrayListMask</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">energyArrayList</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">&gt;</span><span class="n">energyArrayList</span><span class="p">[</span><span class="n">item1</span><span class="p">],</span> <span class="n">energyArrayListMask</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
    
    <span class="n">varLabels</span><span class="o">=</span> <span class="n">grabLabels</span><span class="p">(</span><span class="n">calcs1</span><span class="p">,</span><span class="n">xaxis</span><span class="p">,</span><span class="n">yaxis</span><span class="p">)</span>

    
    <span class="n">cbcolor</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Greens_r&#39;</span><span class="p">,</span><span class="s1">&#39;Blues_r&#39;</span><span class="p">,</span><span class="s1">&#39;Reds_r&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">neg_flag</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="n">cbcolor</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span><span class="s1">&#39;Reds&#39;</span><span class="p">]</span>
<span class="c1">#    cbcolor = [&#39;PiYG&#39;,&#39;PuOr&#39;,&#39;RdBux&#39;]</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energyArrayListMask</span><span class="p">)):</span>
	    <span class="n">parr</span><span class="o">=</span><span class="n">energyArrayListMask</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
 	    <span class="c1">#plot2 = pyplot.pcolor(parr, vmin=energyArrayList[item].min(), vmax=energyArrayList[item].max(),cmap=cbcolor[((item+1)%len(cbcolor)-1)]) 	 </span>
	    <span class="n">plot2</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">parr</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">z_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">z_max</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cbcolor</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
	    <span class="n">parrMask</span><span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmaskarray</span><span class="p">(</span><span class="n">parr</span><span class="p">)</span>
	    <span class="k">if</span> <span class="n">printBool</span><span class="p">:</span>
		    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parrMask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
			    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parrMask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
				    <span class="k">if</span> <span class="ow">not</span> <span class="n">parrMask</span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">]:</span>
					    <span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">parr</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span>
							<span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
							<span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
							<span class="p">)</span>

	    <span class="k">try</span><span class="p">:</span>
		    <span class="n">pyplot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">titleArray</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
	    <span class="k">except</span><span class="p">:</span>
		    <span class="k">pass</span>


    <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xAxisStr</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">yAxisStr</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">plotTitle</span><span class="p">)</span>
    
    <span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">varLabels</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">varLabels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">varLabels</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">varLabels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
<span class="c1">#	    with open(fileName+&#39;.pkl&#39;,&#39;wb&#39;) as pickleOutput:</span>
<span class="c1">#		    cPickle.dump(ax,pickleOutput)</span>
<span class="c1">#	    AFLOWpi.retr.__moveToSavedir(fileName+&#39;.pkl&#39;)</span>
	    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__moveToSavedir</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
	    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="n">pyplot</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__moveToSavedir</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>


<div class="viewcode-block" id="radialPDF"><a class="viewcode-back" href="../plot.html#plot.radialPDF">[docs]</a><span class="k">def</span> <span class="nf">radialPDF</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">atomNum</span><span class="p">,</span><span class="n">filterElement</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	kwargs get passed to pyplot.hist</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">returnDict</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
		<span class="k">if</span> <span class="n">runlocal</span><span class="p">:</span>
			<span class="n">figObj</span> <span class="o">=</span> <span class="n">__radialPDF</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">atomNum</span><span class="p">,</span><span class="n">filterElement</span><span class="o">=</span><span class="n">filterElement</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="c1">#print figObj</span>
			<span class="n">oneCalc</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;radialPDF_atom</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">atomNum</span><span class="p">:</span><span class="n">figObj</span><span class="p">})</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">kwargsStringList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;runlocal&#39;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">)]</span>
			<span class="n">kwargsStringList</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;runlocal&#39;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">)])</span>

			<span class="n">kwargsString</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwargsStringList</span><span class="p">)</span>
			<span class="n">kwargsString</span><span class="o">+=</span><span class="s1">&#39;,title=&quot;</span><span class="si">%s</span><span class="s1">&quot;,&#39;</span> <span class="o">%</span> <span class="n">title</span>
			
			<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__addToBlock</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="s1">&#39;PLOT&#39;</span><span class="p">,</span><span class="s2">&quot;AFLOWpi.plot.__radialPDF(oneCalc,ID,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atomNum</span><span class="p">,</span><span class="n">kwargsString</span><span class="p">))</span>	

	<span class="k">return</span> <span class="n">calcs</span>



<span class="c1">###################################################################################################</span></div>
<span class="k">def</span> <span class="nf">__radialPDF</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">atomNum</span><span class="p">,</span><span class="n">filterElement</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">file_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">file_postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">y_range</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    kwargs get passed onto the hist function inside</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_dist.out&#39;</span> <span class="o">%</span> <span class="n">ID</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inFile</span><span class="p">:</span>
            <span class="n">inFileString</span> <span class="o">=</span> <span class="n">inFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Could not find </span><span class="si">%s</span><span class="s1">_dist.out in </span><span class="si">%s</span><span class="s1">. Are you sure you ran AFLOWpi.retr.atomicDistances?&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]))</span>
        <span class="k">print</span> <span class="s1">&#39;Could not find </span><span class="si">%s</span><span class="s1">_dist.out in </span><span class="si">%s</span><span class="s1">. Are you sure you  ran AFLOWpi.retr.atomicDistances?&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">])</span>
	<span class="k">return</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">inFileStringSplit</span> <span class="o">=</span> <span class="n">inFileString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">splitLines</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inFileString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">])</span>

    <span class="n">lineList</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">splitLines</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">atomNum</span><span class="p">:</span>
		    <span class="k">if</span> <span class="n">filterElement</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
			    <span class="k">if</span> <span class="n">filterElement</span><span class="o">==</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
				    <span class="n">lineList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
		    <span class="k">else</span><span class="p">:</span>
			    <span class="n">lineList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>			    
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
	    <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;filterElements&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
	    <span class="k">pass</span>


    
    <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">lineList</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">y_range</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>
    <span class="n">newbin</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)):</span>
	    <span class="k">try</span><span class="p">:</span>
		    <span class="n">newbin</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bins</span><span class="p">[</span><span class="n">entry</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">bins</span><span class="p">[</span><span class="n">entry</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
	    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
		    <span class="k">pass</span>

    <span class="k">if</span> <span class="n">file_prefix</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">file_prefix</span><span class="o">+=</span><span class="s1">&#39;_&#39;</span>

    <span class="k">if</span> <span class="n">file_postfix</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">file_postfix</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">file_postfix</span>

    <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">radialPDF_</span><span class="si">%s%s</span><span class="s1">_atom_</span><span class="si">%s%s</span><span class="s1">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file_prefix</span><span class="p">,</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_PREFIX_&#39;</span><span class="p">],</span><span class="n">atomNum</span><span class="p">,</span><span class="n">file_postfix</span><span class="p">))</span>


    <span class="k">if</span> <span class="n">title</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
	    <span class="n">figtitle</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="n">ID</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span>
	    <span class="n">figtitle</span><span class="o">=</span><span class="n">title</span>
    
    <span class="n">t</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">figtitle</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span> <span class="c1">#[x,y]</span>
    <span class="n">newplot</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">newbin</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">pylab</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Radial Distance from Atom ($\AA$)&#39;</span><span class="p">)</span>
    <span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;No. of Atoms&#39;</span><span class="p">)</span>
    <span class="n">plotObj</span><span class="o">=</span><span class="n">newplot</span>

    <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
   
    <span class="k">try</span><span class="p">:</span>
<span class="c1">#	    with open(fileName+&#39;.pkl&#39;,&#39;wb&#39;) as pickleOutput:</span>
<span class="c1">#		    cPickle.dump(ax1,pickleOutput)</span>
<span class="c1">#	    AFLOWpi.retr.__moveToSavedir(fileName+&#39;.pkl&#39;)</span>
	    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__moveToSavedir</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
	    <span class="k">pass</span>
<span class="c1">#	    AFLOWpi.run._fancy_error_log(e)</span>




    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__moveToSavedir</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">lineList</span>



<span class="c1">###################################################################################################</span>



<div class="viewcode-block" id="phonon"><a class="viewcode-back" href="../plot.html#plot.phonon">[docs]</a><span class="k">def</span> <span class="nf">phonon</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="n">runlocal</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">THz</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">ID</span><span class="p">,</span><span class="n">oneCalc</span> <span class="ow">in</span> <span class="n">calcs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
		<span class="k">if</span> <span class="n">runlocal</span><span class="p">:</span>
                    <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">__plot_phonon</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="n">postfix</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__addToAll</span><span class="p">(</span><span class="n">calcs</span><span class="p">,</span><span class="s1">&#39;PLOT&#39;</span><span class="p">,</span><span class="s2">&quot;AFLOWpi.plot.__plot_phonon(oneCalc,ID,postfix=</span><span class="si">%s</span><span class="s2">,THz=</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">postfix</span><span class="p">),</span><span class="n">THz</span><span class="p">))</span>


</div>
<span class="k">def</span> <span class="nf">__plot_phonon</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">THz</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span> 
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Function to take the data files generated by the sumpdos ppBands functions and plots the electronic band structure and the projected density of states with energy shifted relative to the Fermi Energy.</span>
<span class="sd">	</span>
<span class="sd">	Arguments:</span>
<span class="sd">              oneCalc (dict): Single calculation that is the value of the dictionary of dictionaries of calculations</span>
<span class="sd">              ID (str): ID of the calculation	</span>
<span class="sd">	Keyword Arguments:</span>
<span class="sd">              postfix (str): Output filename postfix</span>
<span class="sd">              THz (bool): Plot the frequencies in THz or cm^-1</span>

<span class="sd">        Returns:</span>
<span class="sd">              None</span>

<span class="sd">	&quot;&quot;&quot;</span>
	
	<span class="n">calcCopy</span> <span class="o">=</span> <span class="n">oneCalc</span>
	<span class="n">calcID</span> <span class="o">=</span> <span class="n">ID</span>

        <span class="n">calcID</span> <span class="o">=</span> <span class="n">AFLOWpi</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">__return_ID</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">calcID</span><span class="p">,</span><span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;phonon&#39;</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>        


	<span class="k">if</span> <span class="n">postfix</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
		<span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">postfix</span>

	<span class="n">subdir</span><span class="o">=</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">]</span>
       	<span class="n">fileplot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;PHONON_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s%s</span><span class="s1">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="n">ID</span><span class="p">,</span><span class="n">postfix</span><span class="p">))</span>

	<span class="sd">&quot;&quot;&quot;get the path to the subdirectory of the calc that you are making plots for&quot;&quot;&quot;</span>

        <span class="n">filebands</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.phBAND.gp&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>

        <span class="n">filedos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.phDOS.gp&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>
        <span class="n">filedos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.phdos&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>

	<span class="sd">&#39;&#39;&#39;name of file of the DOS plots is dosBandPlot_&lt;_AFLOWPI_PREFIX_&gt;&#39;&#39;&#39;</span>
	

       <span class="c1">#to set figure size and default fonts</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;serif&quot;</span><span class="p">)</span>      <span class="c1">#to set the font type</span>
	<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>             <span class="c1">#to set the font size</span>

        
        <span class="n">width</span> <span class="o">=</span> <span class="mi">20</span>
	<span class="n">height</span> <span class="o">=</span> <span class="mi">8</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span><span class="c1">#to adjust the figure size</span>
     

	<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">k_x</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">k_y</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        looks at the filebands file and reads in the columns for the energy of the</span>
<span class="sd">        band and the value of the k point to make the path. this looks at the output</span>
<span class="sd">        of the plot_bands.x script and when it finds a blank line in the data it </span>
<span class="sd">        appends a list of k point values and energy values for each band into a list</span>
<span class="sd">        of the bands</span>
<span class="sd">	&#39;&#39;&#39;</span>
        <span class="c1">#scale for THz or cm^-1</span>
        <span class="k">if</span> <span class="n">THz</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">sf</span><span class="o">=</span><span class="mf">0.0299792458</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sf</span><span class="o">=</span><span class="mf">1.0</span>

	<span class="k">try</span><span class="p">:</span>
                <span class="n">max_val</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">min_val</span><span class="o">=</span><span class="mf">0.0</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filebands</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">datafile</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span><span class="n">datafile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>



		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">x_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                        
                        <span class="n">y_val</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">*</span><span class="n">sf</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]]</span>
                        
                        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_val</span><span class="p">)</span>
                        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_val</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="n">k_y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">k_y</span><span class="p">:</span>
                    <span class="n">k_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


 	<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
 		<span class="n">AFLOWpi</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_fancy_error_log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>        
 		<span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;output from bands calculation not found. Are you sure you ran ppBands and it completed properly?&quot;</span><span class="p">)</span>
 		<span class="k">print</span> <span class="s2">&quot;Are you sure you ran ppBands and it completed properly?&quot;</span>
 		<span class="k">return</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Eliminating the gaps between the paths in band structure plots by looking </span>
<span class="sd">        for gaps in the data in the k point values that are greater than some value</span>
<span class="sd">	&#39;&#39;&#39;</span>
 	<span class="n">gapThreshold</span> <span class="o">=</span> <span class="mf">2.00</span>

 	<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_x</span><span class="p">)):</span>
 		<span class="k">for</span> <span class="n">kpoint</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">])):</span>
			<span class="k">if</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="p">]</span> <span class="o">-</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">gapThreshold</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
					<span class="n">difference</span> <span class="o">=</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="p">]</span> <span class="o">-</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
					<span class="n">higher_vals</span> <span class="o">=</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="p">:]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">difference</span><span class="o">=</span><span class="mi">0</span>
			
				<span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="n">difference</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">k_x</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">kpoint</span><span class="p">:]]</span>
		
				
	<span class="n">a</span><span class="o">=</span><span class="n">k_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>   <span class="c1"># a set of k point values for one band for axis scaling purposes</span>
	<span class="n">b</span><span class="o">=</span><span class="n">k_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>



        <span class="n">ax1</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>	
<span class="c1">#        ax1=pylab.subplot(111)	</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot each band (k_x[i]),(k_y[i]) on the band structure plot from list of</span>
<span class="sd">        the values of energy and position from their respective list by k points</span>
<span class="sd">	&#39;&#39;&#39;</span>
        <span class="n">colors</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;orange&#39;</span><span class="p">]</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_x</span><span class="p">)):</span>
            <span class="n">new_min_val</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">k_y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">new_max_val</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">k_y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">color_choice</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>

            <span class="k">if</span> <span class="n">new_max_val</span><span class="o">&gt;</span><span class="n">max_val</span><span class="p">:</span>
                <span class="n">max_val</span><span class="o">=</span><span class="n">new_max_val</span>
            <span class="k">if</span> <span class="n">new_min_val</span><span class="o">&lt;</span><span class="n">min_val</span><span class="p">:</span>
                <span class="n">min_val</span><span class="o">=</span><span class="n">new_min_val</span>
<span class="c1">#            pylab.plot((k_x[i]),(k_y[i]),&#39;k.&#39;)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">k_x</span><span class="p">[</span><span class="n">i</span><span class="p">]),(</span><span class="n">k_y</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="n">color</span><span class="o">=</span><span class="n">color_choice</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>



        <span class="k">if</span> <span class="n">THz</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency (THz)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency (cm$^{-1}$)&#39;</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">k_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">max</span><span class="p">(</span><span class="n">k_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> 
        

        <span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span><span class="n">max_val</span><span class="p">)</span> 

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        takes in a list of k points that was used as pw.x input for the &#39;bands&#39;</span>
<span class="sd">        calculation as a string. It puts parts of that string into lists and </span>
<span class="sd">        manipulates them to display the symmetry point boundary lines on the </span>
<span class="sd">        band structure plot</span>
<span class="sd">	&#39;&#39;&#39;</span>
        <span class="n">ph_band_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">[</span><span class="s1">&#39;_AFLOWPI_FOLDER_&#39;</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_matdyn_phBand.in&#39;</span><span class="o">%</span><span class="n">ID</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ph_band_in</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ph_band_in_file</span><span class="p">:</span>
            <span class="n">ph_band_in_file_string</span> <span class="o">=</span> <span class="n">ph_band_in_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">bandSym</span><span class="o">=</span><span class="n">ph_band_in_file_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
 	<span class="n">bandSymSplit</span> <span class="o">=</span>  <span class="n">bandSym</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

 	<span class="n">HSPList</span> <span class="o">=</span> <span class="p">[]</span>
 	<span class="n">HSPSymList</span> <span class="o">=</span> <span class="p">[]</span>
 	<span class="n">buf</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">bandSym</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">buf</span><span class="p">:</span>
		<span class="n">splitLine</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitLine</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="c1"># new style kpoint path input case</span>
			<span class="n">HSPList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">specialPointName</span> <span class="o">=</span> <span class="n">splitLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
			
 	                <span class="c1">#renames gG to greek letter for capital gamma</span>
			<span class="k">if</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;Gamma&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;gG&#39;</span><span class="p">:</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">r&quot;$\Gamma$&quot;</span>

			<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">specialPointName</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">&quot;$&quot;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">r&#39;_{&#39;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;}$&#39;</span> <span class="c1">#if there is a subscript it makes the print out on the plot have the number subscripted </span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">&quot;$&quot;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;$&quot;</span> <span class="c1">#formats with internal math renderer so all the labels look the same</span>
			<span class="n">HSPSymList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">specialPointName</span><span class="p">)</span>
			
		<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitLine</span><span class="p">)</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span> <span class="c1"># old style kpoint path input case with kpoint names</span>
			<span class="n">HSPList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
			<span class="n">specialPointName</span> <span class="o">=</span> <span class="n">splitLine</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

			<span class="k">if</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;Gamma&#39;</span> <span class="ow">or</span> <span class="n">specialPointName</span> <span class="o">==</span> <span class="s1">&#39;gG&#39;</span><span class="p">:</span> <span class="c1">#renames gG to greek letter for capital gamma</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">r&quot;$\Gamma$&quot;</span>
			<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">specialPointName</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">&quot;$&quot;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">r&#39;_{&#39;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;}$&#39;</span> <span class="c1">#if there is a subscript it makes the print out on the plot have the number subscripted </span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">specialPointName</span> <span class="o">=</span> <span class="s2">&quot;$&quot;</span><span class="o">+</span><span class="n">specialPointName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;$&quot;</span>  <span class="c1">#formats with internal math renderer so all the labels look the same</span>
			<span class="n">HSPSymList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">specialPointName</span><span class="p">)</span>                     

		<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitLine</span><span class="p">)</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span> <span class="c1"># old style kpoint path input case without kpoint names</span>
			<span class="k">try</span><span class="p">:</span>
				
				<span class="k">if</span> <span class="n">HSPSymList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
					<span class="n">HSPList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
					<span class="n">HSPSymList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
					<span class="n">counter</span><span class="o">=</span><span class="mi">1</span>

				<span class="k">else</span><span class="p">:</span>
					<span class="n">counter</span><span class="o">+=</span><span class="mi">1</span>
			<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
				<span class="k">print</span> <span class="n">e</span>
				<span class="n">counter</span><span class="o">=</span><span class="mi">1</span>
				<span class="n">HSPSymList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>


	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        takes the number of k points between each point in the k point paths and</span>
<span class="sd">        figures out if they are separate paths (where the end of one path and the </span>
<span class="sd">        next begin have zero k points between them). it also takes the labels for </span>
<span class="sd">        the k points that were in the bands calculation input and creates a list </span>
<span class="sd">        of them and makes a special label for the path boundary e.g. X|Q. All of</span>
<span class="sd">        these symmetry lines and symmetry path symbols are put into their own list</span>
<span class="sd">        symIndex: for the symmetry line&#39;s index in the data set</span>
<span class="sd">        symPrint: for the symbols that represent the special symmetry path k points </span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="n">symIndex</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">totalX</span> <span class="o">=</span><span class="mi">0</span>
	<span class="n">SymPrint</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">HSPList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># for the first k point in the first path</span>
			<span class="n">SymPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HSPSymList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">HSPList</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="c1"># for the end of a path (where the number of k points between one point and another is zero)</span>
			<span class="k">continue</span>
		<span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">HSPList</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="c1"># for the point that begins a new path where the end of the last path (which has zero k points from it to this k point)</span>
			<span class="n">totalX</span> <span class="o">+=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
			<span class="n">symIndex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">totalX</span><span class="p">)</span>
			<span class="n">mid</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span>
			<span class="n">pathBetweenString</span> <span class="o">=</span> <span class="n">HSPSymList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">mid</span><span class="o">+</span><span class="n">HSPSymList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
			<span class="n">SymPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathBetweenString</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># for kpoints that are not at the beginning or end of paths</span>
			<span class="n">SymPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HSPSymList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">totalX</span> <span class="o">+=</span><span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="n">symIndex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">totalX</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">i</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">HSPList</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="c1"># for the end of the last path</span>
			<span class="n">symIndex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">totalX</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="n">SymPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HSPSymList</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">HSPList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">HSPList</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
			<span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;can not find HSP in __bandPlot. This shouldnt be able to be tripped&#39;</span><span class="p">)</span>

     <span class="c1">#add symmetry lines to the band structure plot</span>
	<span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">symIndex</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">sym</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
			<span class="k">pass</span>
     <span class="c1">#Print path labels to band structure x-axis</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">symIndex</span><span class="p">],</span><span class="n">SymPrint</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
		<span class="k">pass</span>
		<span class="k">return</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#Femi level line</span>
	<span class="n">locs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">xticks</span><span class="p">()</span>

<span class="c1">##########################################################################################################</span>


        <span class="k">print</span> <span class="s1">&#39;Plotting Phonons and phDOS of  </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting Phonons and phDOS of  </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span>

        <span class="n">ax2</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filedos</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;output from dos calculation not found. Are you sure you ran ppDOS and it completed properly?&quot;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s2">&quot;Are you sure you ran ppDOS and it completed properly?&quot;</span>
                <span class="k">return</span>
        

        <span class="n">freq_dos</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">dos</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">plot_dos_x</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>      <span class="c1">#convert to floats</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="n">freq_dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">sf</span><span class="p">)</span>
            <span class="c1">#/(10.0*numpy.pi)</span>
            <span class="n">dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">plot_dos_x</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">plot_dos_y</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">pre_sort</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dos</span><span class="p">,</span><span class="n">freq_dos</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="c1">#to plot the smoothed data</span>
        <span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span><span class="n">max_val</span><span class="p">)</span> 

        <span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Phonon Density of States (arb. units)&#39;</span><span class="p">)</span>
        <span class="n">pylab</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span> <span class="c1">#Fermi level line</span>


        <span class="n">ax1</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.67</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span> <span class="c1">#[left,bottom,width,height]</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.20</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>

 	<span class="n">figtitle</span> <span class="o">=</span> <span class="s1">&#39;Phonon Dispersion and DOS: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AFLOWpi</span><span class="o">.</span><span class="n">retr</span><span class="o">.</span><span class="n">__getStoicName</span><span class="p">(</span><span class="n">oneCalc</span><span class="p">,</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span> 
 	<span class="n">t</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">figtitle</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span> <span class="c1">#[x,y]</span>

  	<span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileplot</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="n">pyplot</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
 	<span class="n">pyplot</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
 	<span class="n">pyplot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016, Andrew Supka.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>